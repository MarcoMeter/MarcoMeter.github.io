<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row wrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MysteryPath-Grid-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>cardinal_origin_choice</b>: [0, 1, 2, 3]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>show_origin</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>show_goal</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>visual_feedback</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_goal</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_fall_off</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_path_progress</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 0<br><b>reward_normalization</b>: 0<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 256<br><b>transformer</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_blocks</b>: 2<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>embed_dim</b>: 256<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_heads</b>: 4<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>memory_length</b>: 96<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>positional_encoding</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_norm</b>: pre<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>init_weights</b>: xavier<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>gtrxl</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>gtrxl_bias</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>gtrxl_swap</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>share_heads</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_episode_steps</b>: 128<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>add_positional_encoding_to_query</b>: False<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 10000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: {'initial': 0.0}<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <br>
      <center>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Transformer</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Top Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_0_58.webm', '', '', '', '', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.8464759588241577], [0.8472583889961243], [0.8497564792633057], [0.8414791226387024], [0.8425264954566956], [0.8492161631584167], [0.8156803846359253], [0.8270894885063171], [0.8266634941101074], [0.8330328464508057], [0.8360468149185181], [0.8319754600524902], [0.8392295837402344], [0.8549225330352783], [0.8372253179550171], [0.839434027671814], [0.8475492000579834], [0.8459687232971191], [0.8544018268585205], [0.8601151704788208], [0.8856728076934814], [0.9127839207649231], [0.9517402648925781], [0.9643786549568176]];
        var y_entropy = [[0.00012884355965070426], [0.0005772165022790432], [0.001150217605754733], [1.0801074504852295], [0.001030618790537119], [0.00012792216148227453], [0.3926616311073303], [7.063334123813547e-06], [0.005793548654764891], [0.0003611371503211558], [0.0007529990980401635], [0.00014045098214410245], [0.0038348305970430374], [0.00019676025840453804], [0.08237341046333313], [6.534213298436953e-06], [0.004597867373377085], [0.00012233387678861618], [1.6848014638526365e-05], [0.0007165412534959614], [0.0005431335885077715], [0.0007317267591133714], [0.02282157726585865], [0.008643871173262596]];
        var y_attention_weights = [[[], []], [[1.0], [1.0]], [[0.3387841582298279, 0.6612157821655273], [0.5900759100914001, 0.40992408990859985]], [[0.22267557680606842, 0.5546488761901855, 0.22267557680606842], [0.46491748094558716, 0.2877614498138428, 0.2473210096359253]], [[0.11922496557235718, 0.16191184520721436, 0.11922496557235718, 0.5996381044387817], [0.3574530780315399, 0.24910801649093628, 0.1904921531677246, 0.2029467225074768]], [[0.05236387625336647, 0.29675328731536865, 0.05236387625336647, 0.5461550951004028, 0.05236387625336647], [0.3093048334121704, 0.1711646020412445, 0.17507772147655487, 0.17461374402046204, 0.16983911395072937]], [[0.06332862377166748, 0.18880772590637207, 0.06332862377166748, 0.4323986768722534, 0.06332862377166748, 0.18880772590637207], [0.2938149571418762, 0.1591160148382187, 0.126298189163208, 0.15549767017364502, 0.1272611916065216, 0.13801203668117523]], [[0.029267646372318268, 0.128073051571846, 0.029267646372318268, 0.15820075571537018, 0.029267646372318268, 0.128073051571846, 0.4978501796722412], [0.27007707953453064, 0.11041851341724396, 0.12120135128498077, 0.11831334233283997, 0.12172837555408478, 0.12547315657138824, 0.13278813660144806]], [[0.05454638600349426, 0.073792964220047, 0.05454638600349426, 0.33574631810188293, 0.05454638600349426, 0.073792964220047, 0.2792356312274933, 0.073792964220047], [0.2587171196937561, 0.1462172269821167, 0.11119953542947769, 0.10523880273103714, 0.09141834080219269, 0.10054361075162888, 0.11280505359172821, 0.07386031001806259]], [[0.04271310195326805, 0.07322171330451965, 0.04271310195326805, 0.28766167163848877, 0.04271310195326805, 0.07322171330451965, 0.32182079553604126, 0.07322171330451965, 0.04271310195326805], [0.252957820892334, 0.11153214424848557, 0.0975826308131218, 0.0897672027349472, 0.08728288114070892, 0.09644970297813416, 0.10253725945949554, 0.07467767596244812, 0.08721267431974411]], [[0.07160452008247375, 0.085859015583992, 0.07160452008247375, 0.1742282211780548, 0.07160452008247375, 0.085859015583992, 0.1992812156677246, 0.085859015583992, 0.07160452008247375, 0.08249540627002716], [0.22680401802062988, 0.1210584044456482, 0.09644826501607895, 0.09834212064743042, 0.07304935902357101, 0.08660866320133209, 0.10122235119342804, 0.06377850472927094, 0.06430111825466156, 0.0683872252702713]], [[0.03364621475338936, 0.09354028105735779, 0.03364621475338936, 0.16565464437007904, 0.03364621475338936, 0.09354028105735779, 0.24105869233608246, 0.09354028105735779, 0.03364621475338936, 0.11786746978759766, 0.06021349877119064], [0.25147125124931335, 0.12805813550949097, 0.09441286325454712, 0.08966977894306183, 0.0687117800116539, 0.06690162420272827, 0.08304737508296967, 0.04729281738400459, 0.05910225957632065, 0.05669046938419342, 0.05464161932468414]], [[0.03879059478640556, 0.0649208351969719, 0.03879059478640556, 0.2160968780517578, 0.03879059478640556, 0.0649208351969719, 0.2205953449010849, 0.0649208351969719, 0.03879059478640556, 0.12087270617485046, 0.029610052704811096, 0.0629001334309578], [0.20493075251579285, 0.10034248232841492, 0.08657248318195343, 0.08601478487253189, 0.06899777054786682, 0.06984690576791763, 0.0906548798084259, 0.052964065223932266, 0.06175757572054863, 0.06226880103349686, 0.05922023206949234, 0.056429311633110046]], [[0.027102168649435043, 0.09018757939338684, 0.027102168649435043, 0.1731095314025879, 0.027102168649435043, 0.09018757939338684, 0.1830335408449173, 0.09018757939338684, 0.027102168649435043, 0.13163237273693085, 0.06883732229471207, 0.03481452167034149, 0.029601316899061203], [0.21067410707473755, 0.12575557827949524, 0.07233738899230957, 0.07616102695465088, 0.06206446886062622, 0.06649551540613174, 0.08943304419517517, 0.04440224915742874, 0.05231418460607529, 0.052917588502168655, 0.05579959601163864, 0.04094136878848076, 0.05070389807224274]], [[0.019420217722654343, 0.09645114839076996, 0.019420217722654343, 0.15873898565769196, 0.019420217722654343, 0.09645114839076996, 0.24851283431053162, 0.09645114839076996, 0.019420217722654343, 0.055096808820962906, 0.04272788017988205, 0.06123080104589462, 0.022999880835413933, 0.043658547103405], [0.26026254892349243, 0.09967789053916931, 0.07476449757814407, 0.08328568935394287, 0.048599258065223694, 0.05197815224528313, 0.06927677989006042, 0.032308898866176605, 0.04064250364899635, 0.03895650431513786, 0.04793117940425873, 0.03593730553984642, 0.03449109569191933, 0.08188773691654205]], [[0.01943005807697773, 0.04531634598970413, 0.01943005807697773, 0.15859268605709076, 0.01943005807697773, 0.04531634598970413, 0.18420755863189697, 0.04531634598970413, 0.01943005807697773, 0.08247595280408859, 0.06980016827583313, 0.04431651905179024, 0.02608163096010685, 0.05873992294073105, 0.16211627423763275], [0.22836381196975708, 0.07523752748966217, 0.06432763487100601, 0.05476188287138939, 0.05291963368654251, 0.052218951284885406, 0.05851928889751434, 0.03966665640473366, 0.05140308290719986, 0.03778081387281418, 0.03872080147266388, 0.03713826835155487, 0.040549978613853455, 0.07319360226392746, 0.09519810974597931]], [[0.03872256353497505, 0.05776894465088844, 0.03872256353497505, 0.12298330664634705, 0.03872256353497505, 0.05776894465088844, 0.1486952304840088, 0.05776894465088844, 0.03872256353497505, 0.05270122364163399, 0.025164805352687836, 0.03057185932993889, 0.02095588482916355, 0.05855464190244675, 0.15947479009628296, 0.05270122364163399], [0.18799515068531036, 0.0924091562628746, 0.06444637477397919, 0.06085463613271713, 0.047292813658714294, 0.05362994968891144, 0.06109461933374405, 0.037324193865060806, 0.039533745497465134, 0.03707766905426979, 0.045616619288921356, 0.03447137027978897, 0.036064811050891876, 0.07470864802598953, 0.09035064280033112, 0.037129614502191544]], [[0.012882621958851814, 0.058547165244817734, 0.012882621958851814, 0.0893864557147026, 0.012882621958851814, 0.058547165244817734, 0.1371813267469406, 0.058547165244817734, 0.012882621958851814, 0.054560743272304535, 0.02184680663049221, 0.014163237996399403, 0.0741773471236229, 0.031749315559864044, 0.2733551859855652, 0.054560743272304535, 0.02184680663049221], [0.21360041201114655, 0.09218676388263702, 0.06377673149108887, 0.05429616570472717, 0.047567933797836304, 0.045729294419288635, 0.05162622779607773, 0.030466988682746887, 0.03889874368906021, 0.03340025991201401, 0.03279648721218109, 0.0280607957392931, 0.036138277500867844, 0.08156473934650421, 0.09265603870153427, 0.03274093568325043, 0.024493172764778137]], [[0.018750257790088654, 0.04778478294610977, 0.018750257790088654, 0.14048826694488525, 0.018750257790088654, 0.04778478294610977, 0.1283923238515854, 0.04778478294610977, 0.018750257790088654, 0.03997617959976196, 0.015676703304052353, 0.03573291376233101, 0.020120324566960335, 0.030759304761886597, 0.2791128158569336, 0.03997617959976196, 0.015676703304052353, 0.03573291376233101], [0.1822139471769333, 0.0846574455499649, 0.058454081416130066, 0.049375101923942566, 0.04313753545284271, 0.045053631067276, 0.054120711982250214, 0.032552268356084824, 0.038131240755319595, 0.0340191014111042, 0.0370413139462471, 0.03322811424732208, 0.040961142629384995, 0.08384369313716888, 0.09243697673082352, 0.031052950769662857, 0.02684144116938114, 0.032879311591386795]], [[0.019013874232769012, 0.04964394122362137, 0.019013874232769012, 0.0900115966796875, 0.019013874232769012, 0.04964394122362137, 0.1198984757065773, 0.04964394122362137, 0.019013874232769012, 0.04286758974194527, 0.0225042924284935, 0.030560726299881935, 0.014536786824464798, 0.06604465842247009, 0.27811920642852783, 0.04286758974194527, 0.0225042924284935, 0.030560726299881935, 0.014536786824464798], [0.2038690447807312, 0.0800795704126358, 0.05707835406064987, 0.04661231487989426, 0.04164314642548561, 0.04079288989305496, 0.04828808456659317, 0.03031773678958416, 0.04121685400605202, 0.03090028092265129, 0.032298970967531204, 0.031288597732782364, 0.03186822310090065, 0.07810251414775848, 0.08921317756175995, 0.02749752439558506, 0.024064745754003525, 0.030812447890639305, 0.03405548259615898]], [[0.01282669696956873, 0.06756573915481567, 0.01282669696956873, 0.08515796065330505, 0.01282669696956873, 0.06756573915481567, 0.1326550543308258, 0.06756573915481567, 0.01282669696956873, 0.03054277040064335, 0.01269509457051754, 0.031441450119018555, 0.011570688337087631, 0.03982704505324364, 0.23191547393798828, 0.03054277040064335, 0.01269509457051754, 0.031441450119018555, 0.011570688337087631, 0.08394041657447815], [0.2117839902639389, 0.07633677124977112, 0.05716927349567413, 0.048331860452890396, 0.037683647125959396, 0.03593054786324501, 0.04595503956079483, 0.026265686377882957, 0.037050679326057434, 0.029840748757123947, 0.03304940089583397, 0.03216090798377991, 0.023331785574555397, 0.08351655304431915, 0.0887763500213623, 0.030392639338970184, 0.025417065247893333, 0.02759767882525921, 0.02258802205324173, 0.02682138793170452]], [[0.010993333533406258, 0.07578863203525543, 0.010993333533406258, 0.08291522413492203, 0.010993333533406258, 0.07578863203525543, 0.14986088871955872, 0.07578863203525543, 0.010993333533406258, 0.028680671006441116, 0.015888333320617676, 0.06694374233484268, 0.06386902183294296, 0.018840858712792397, 0.08648369461297989, 0.028680671006441116, 0.015888333320617676, 0.06694374233484268, 0.06386902183294296, 0.02408345602452755, 0.01571311056613922], [0.19534924626350403, 0.08650633692741394, 0.059785548597574234, 0.05368558317422867, 0.034799724817276, 0.037580788135528564, 0.04328436404466629, 0.02685857005417347, 0.03641868382692337, 0.02949577197432518, 0.032640181481838226, 0.031172802671790123, 0.024819552898406982, 0.06563253700733185, 0.08104212582111359, 0.025537943467497826, 0.023396605625748634, 0.029818039387464523, 0.022637173533439636, 0.024912502616643906, 0.034625936299562454]], [[0.020667944103479385, 0.0742219090461731, 0.020667944103479385, 0.09389647841453552, 0.020667944103479385, 0.0742219090461731, 0.10237244516611099, 0.0742219090461731, 0.020667944103479385, 0.031575269997119904, 0.015993040055036545, 0.0325300432741642, 0.04555423930287361, 0.021782325580716133, 0.025883452966809273, 0.031575269997119904, 0.015993040055036545, 0.0325300432741642, 0.04555423930287361, 0.023230617865920067, 0.056809183210134506, 0.1193828284740448], [0.17910341918468475, 0.11225709319114685, 0.05352247506380081, 0.047832001000642776, 0.038044609129428864, 0.03573630750179291, 0.04292313754558563, 0.024627501145005226, 0.039140813052654266, 0.027960287407040596, 0.02820015512406826, 0.028664488345384598, 0.022422194480895996, 0.05059124901890755, 0.06833609193563461, 0.02474823407828808, 0.02144896797835827, 0.027005115523934364, 0.021660173311829567, 0.021052930504083633, 0.02741064317524433, 0.05731217563152313]], [[0.015063478611409664, 0.07786791771650314, 0.015063478611409664, 0.11387528479099274, 0.015063478611409664, 0.07786791771650314, 0.1476733386516571, 0.07786791771650314, 0.015063478611409664, 0.05398043245077133, 0.04355919361114502, 0.03505467623472214, 0.01908007077872753, 0.01675666868686676, 0.018199365586042404, 0.05398043245077133, 0.04355919361114502, 0.03505467623472214, 0.01908007077872753, 0.013750536367297173, 0.02831564098596573, 0.022015806287527084, 0.04220696538686752], [0.16421358287334442, 0.06767081469297409, 0.04734455421566963, 0.05366634577512741, 0.04073503986001015, 0.03841596841812134, 0.045968227088451385, 0.02505161613225937, 0.03404013440012932, 0.025754306465387344, 0.028871789574623108, 0.02617933414876461, 0.029372017830610275, 0.052671052515506744, 0.07125845551490784, 0.022326836362481117, 0.02214921824634075, 0.023466214537620544, 0.022795308381319046, 0.020540373399853706, 0.025041555985808372, 0.047199901193380356, 0.06526738405227661]]];
        var y_action = [[[6.126161224528914e-06, 6.144197186586098e-07, 0.9999903440475464, 2.9008369892835617e-06]], [[9.339597454527393e-06, 0.9999493360519409, 1.1742900341005225e-07, 4.127002102904953e-05]], [[6.220316572580487e-05, 4.992268820558365e-10, 4.405958316056058e-05, 0.9998937845230103]], [[0.33242303133010864, 0.18028602004051208, 0.011598941870033741, 0.4756920039653778]], [[1.4039754887562594e-06, 9.099054295802489e-05, 0.9999020099639893, 5.563262220675824e-06]], [[3.737939550774172e-06, 5.95139863435179e-06, 3.3850575675842265e-09, 0.9999903440475464]], [[0.020602252334356308, 0.9020568132400513, 0.0710807517170906, 0.006260186433792114]], [[1.2364257884200924e-07, 0.9999995231628418, 2.2944030320104503e-07, 9.849826199115341e-08]], [[6.389871032297378e-08, 0.9992992877960205, 0.0007002398488111794, 3.6620232890527404e-07]], [[2.6639681891538203e-06, 1.0660568250386859e-07, 2.8124733944423497e-05, 0.9999691247940063]], [[5.235266144154593e-06, 1.3681076893590216e-07, 0.999930739402771, 6.394662341335788e-05]], [[5.390134916183342e-08, 4.1898525182659796e-07, 1.0650953299773391e-05, 0.9999889135360718]], [[1.5591082046739757e-05, 0.9995785355567932, 1.7086033039959148e-05, 0.00038884684909135103]], [[3.874469712172868e-06, 1.2490801282183384e-07, 1.1542874744918663e-05, 0.9999845027923584]], [[0.0013937035109847784, 0.9852554798126221, 0.01317206583917141, 0.00017878174548968673]], [[2.2361453133612486e-08, 4.870120418054569e-10, 4.1729569488779816e-07, 0.9999995231628418]], [[8.957434260992159e-07, 3.074581513828889e-07, 0.9994619488716125, 0.000536904321052134]], [[2.6768296379486856e-07, 5.899300958844833e-06, 2.9628065476572374e-06, 0.9999908208847046]], [[2.772155482944072e-08, 1.1251352134422632e-06, 1.176981689193779e-11, 0.9999988079071045]], [[2.1662664551058697e-07, 6.71802627039142e-05, 1.6805284941412424e-09, 0.9999326467514038]], [[1.4405579349840991e-05, 1.8706818082137033e-05, 1.1816190635727253e-05, 0.9999550580978394]], [[6.912776734679937e-05, 4.4645855901137566e-09, 4.542305021004722e-08, 0.9999308586120605]], [[0.003417852334678173, 5.1232993542038585e-11, 2.7634163402012746e-08, 0.9965820908546448]], [[1.8853537540053367e-06, 0.9988947510719299, 0.0011034029303118587, 2.9770504283987975e-08]]]; // action probs
        var action =  [[2], [1], [3], [3], [2], [3], [1], [1], [1], [3], [2], [3], [1], [3], [1], [3], [2], [3], [3], [3], [3], [3], [3], [1]];
        var action_names = [['no-op', 'rotate left', 'rotate right', 'move forward']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Transformer") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step;
        visualizeAttentionScores(y_attention_weights[step], top_n);
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>