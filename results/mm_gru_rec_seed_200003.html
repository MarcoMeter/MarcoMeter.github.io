<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
        min-width: 1737px;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row nowrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: absolute;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="location.href='../index.html'">Back</button>
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MortarMayhem-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 200003<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>arena_size</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>allowed_commands</b>: 9<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_count</b>: [10]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_duration</b>: [6]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_delay</b>: [18]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_failure</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_success</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_episode_success</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 200003<br><b>reward_normalization</b>: 0<br><b>positional_endocing</b>: False<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: -1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 512<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_layers</b>: 1<br><b>obs_decoder</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>attach_to</b>: memory<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>detach_gradient</b>: False<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 30000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 1000<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <br>
      <center>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Attention Scores</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Number of Top Attention Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_200003_73.webm', '', 'videos/video_seed_200003_74.webm', '', 'videos/video_seed_200003_75.webm', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.340604305267334], [0.3415372371673584], [0.3430974781513214], [0.34404250979423523], [0.34463053941726685], [0.3469126522541046], [0.34932106733322144], [0.34998828172683716], [0.35361096262931824], [0.35618624091148376], [0.3576470613479614], [0.3588313162326813], [0.3634152412414551], [0.36568954586982727], [0.36770591139793396], [0.36832311749458313], [0.3764660060405731], [0.37962865829467773], [0.38166800141334534], [0.3816027343273163], [0.38248127698898315], [0.3850405216217041], [0.3866557478904724], [0.3881971538066864], [0.39010635018348694], [0.39308443665504456], [0.3950394093990326], [0.3962041735649109], [0.39839664101600647], [0.40094974637031555], [0.40208977460861206], [0.4062003195285797], [0.40698209404945374], [0.4090035855770111], [0.4103727340698242], [0.41386550664901733], [0.41449597477912903], [0.4168563783168793], [0.4174571931362152], [0.42025819420814514], [0.4229048490524292], [0.4263917803764343], [0.4281750023365021], [0.4306693375110626], [0.43169549107551575], [0.4381147027015686], [0.43925297260284424], [0.439680278301239], [0.44138285517692566], [0.4434572160243988], [0.44600388407707214], [0.4479122459888458], [0.45037052035331726], [0.4543575644493103], [0.45704689621925354], [0.45869144797325134], [0.4601036012172699], [0.46110114455223083], [0.3613016903400421], [0.3625965416431427], [0.3629891872406006], [0.36745306849479675], [0.3708539307117462], [0.37174364924430847], [0.3750494420528412], [0.3787504732608795], [0.37854453921318054], [0.3842100501060486], [0.38723212480545044], [0.38912954926490784], [0.3899536430835724], [0.39314720034599304], [0.3948234021663666], [0.3964492678642273], [0.3992525339126587], [0.3991771638393402], [0.4027889668941498], [0.40463635325431824], [0.40653958916664124], [0.4091862738132477], [0.41010698676109314], [0.41211646795272827], [0.31358474493026733], [0.3141123652458191], [0.31655916571617126], [0.31482481956481934], [0.3168370723724365], [0.31418365240097046], [0.31986117362976074], [0.32189542055130005], [0.3229357898235321], [0.32429903745651245], [0.32549816370010376], [0.32513099908828735], [0.32932189106941223], [0.33238962292671204], [0.33461794257164], [0.33626601099967957], [0.3374979496002197], [0.3386543393135071], [0.33988645672798157], [0.341306209564209], [0.34246164560317993], [0.34276700019836426], [0.34323686361312866], [0.3433363437652588], [0.2499866783618927], [0.24759387969970703], [0.2496577352285385], [0.2556016445159912], [0.2602761685848236], [0.25697922706604004], [0.25043985247612], [0.25645169615745544], [0.2593744099140167], [0.260248064994812], [0.2613576352596283], [0.26220670342445374], [0.2641372084617615], [0.2659798562526703], [0.2676060199737549], [0.26947253942489624], [0.27104452252388], [0.2723695635795593], [0.273448646068573], [0.2742914855480194], [0.274841845035553], [0.2756006121635437], [0.27725982666015625], [0.2780115008354187], [0.18160948157310486], [0.18357989192008972], [0.18010298907756805], [0.1844806671142578], [0.18383893370628357], [0.18406027555465698], [0.18678581714630127], [0.18936295807361603], [0.18993034958839417], [0.19314947724342346], [0.19241172075271606], [0.19267776608467102], [0.19144481420516968], [0.19280868768692017], [0.19375798106193542], [0.19496434926986694], [0.1961427628993988], [0.19694699347019196], [0.19828678667545319], [0.19808675348758698], [0.1984831690788269], [0.19904552400112152], [0.1990969479084015], [0.20063230395317078], [0.09883957356214523], [0.09798511862754822], [0.09603200107812881], [0.1014329046010971], [0.0985572561621666], [0.10017212480306625], [0.09764494746923447], [0.10086506605148315], [0.10183363407850266], [0.10325095802545547], [0.10795535892248154], [0.1056765615940094], [0.10790260881185532], [0.10754671692848206], [0.10887910425662994], [0.11145389080047607], [0.11339288204908371], [0.11400464177131653], [0.11461517959833145], [0.11463403701782227], [0.11478197574615479], [0.11476455628871918], [0.11454164981842041], [0.11434055864810944], [0.023312129080295563], [0.016499891877174377], [0.015830770134925842], [0.01694101095199585], [0.014526739716529846], [0.017175547778606415], [0.014692850410938263], [0.021173499524593353], [0.014322727918624878], [0.018017977476119995], [0.018375828862190247], [0.01593470573425293], [0.016413703560829163], [0.0173209086060524], [0.016256406903266907], [0.016157589852809906], [0.01616653800010681], [0.019374363124370575], [0.018156960606575012], [0.01819998025894165], [0.018346518278121948], [0.019886009395122528], [0.01854749023914337], [0.019134752452373505], [0.01594214141368866]];
        var y_entropy = [[0.8406729698181152, 0.8814406394958496], [0.8442856669425964, 0.8374426960945129], [0.9524993300437927, 0.8169485330581665], [0.4277404248714447, 0.08765265345573425], [0.6154811382293701, 0.2575884163379669], [0.46077480912208557, 0.13399860262870789], [0.4919406473636627, 0.0974588543176651], [0.03522394970059395, 0.05184928700327873], [0.9813013672828674, 0.2984324097633362], [1.0180845260620117, 0.3032556474208832], [1.0411295890808105, 0.292904794216156], [0.29940733313560486, 0.793007493019104], [0.7271489500999451, 0.9673823118209839], [0.6968660354614258, 0.9713290929794312], [0.7152704000473022, 0.9797021150588989], [0.34494489431381226, 1.0852525234222412], [0.8461342453956604, 0.8267854452133179], [0.9438111186027527, 0.7954695820808411], [0.9532600045204163, 0.7996870875358582], [0.10967502743005753, 0.7295909523963928], [0.8731828927993774, 0.9624735116958618], [0.9598838686943054, 0.9574724435806274], [0.9618030786514282, 0.9610645771026611], [0.04393041133880615, 0.6841745972633362], [0.690994381904602, 0.9996224641799927], [0.8566962480545044, 0.9696433544158936], [0.8723040819168091, 0.9666675329208374], [0.023903144523501396, 0.5557330846786499], [0.6305440664291382, 1.0236835479736328], [0.7249917984008789, 1.0032129287719727], [0.7343783974647522, 1.0017540454864502], [0.021123696118593216, 0.6175207495689392], [0.984390377998352, 1.0038899183273315], [1.0835715532302856, 0.9502031803131104], [1.0881969928741455, 0.9426211714744568], [0.01618867553770542, 0.42657360434532166], [0.454042911529541, 0.9974995851516724], [0.6405324935913086, 0.9458136558532715], [0.7023321390151978, 0.9384511113166809], [0.01375389751046896, 0.4368126392364502], [0.0007463512592948973, 0.0297862496227026], [0.012733506970107555, 0.00044173700734972954], [0.015414861030876637, 0.000167126752785407], [0.008938528597354889, 7.51410480006598e-05], [0.015293902717530727, 0.0004166500875726342], [0.13483449816703796, 0.07702633738517761], [1.0538485050201416, 0.7750297784805298], [0.9256954193115234, 0.7477927803993225], [0.8586365580558777, 0.7500794529914856], [0.8175753355026245, 0.7532896399497986], [0.7887077331542969, 0.7514266967773438], [0.6987359523773193, 0.9045687913894653], [0.6468246579170227, 0.5717552304267883], [0.8523561954498291, 0.2959184944629669], [0.7011834979057312, 0.8349902629852295], [0.7056827545166016, 0.7126308679580688], [0.6027724742889404, 0.8961036205291748], [0.5937206745147705, 0.9348899126052856], [0.47349798679351807, 0.4128838777542114], [0.48999208211898804, 0.6931663751602173], [0.006053912453353405, 0.009577912278473377], [0.3142836391925812, 0.09497067332267761], [0.00023361224157270044, 0.48142123222351074], [0.00199347035959363, 0.9235876798629761], [0.0003962207701988518, 0.35319584608078003], [0.012888694182038307, 0.3301848769187927], [0.5181739926338196, 0.7834267616271973], [0.9832088947296143, 0.7413355708122253], [0.9616491794586182, 0.6701407432556152], [0.9915381669998169, 0.5084049105644226], [1.0381516218185425, 0.7744343876838684], [0.8193768858909607, 0.3582840859889984], [0.8554890155792236, 0.9058672785758972], [0.5478394031524658, 0.4216598868370056], [0.6541302800178528, 1.005393385887146], [0.6338277459144592, 0.16250726580619812], [1.0021228790283203, 0.3785165250301361], [0.4303700029850006, 0.4571320116519928], [0.7541990280151367, 1.018779993057251], [0.6376968622207642, 0.2500797212123871], [0.3205268979072571, 0.8766372203826904], [0.7098431587219238, 0.21409153938293457], [0.6423850655555725, 0.6755208373069763], [0.6395682096481323, 0.5921423435211182], [0.9381422400474548, 0.25826576352119446], [0.025588201358914375, 0.004849904682487249], [0.0203973650932312, 0.000645296648144722], [0.0007453453144989908, 3.198390550096519e-05], [0.0008971330244094133, 0.000694155169185251], [3.300646369552851e-07, 0.24835947155952454], [3.6608123537007486e-06, 0.5420559048652649], [0.00019501840870361775, 0.23448839783668518], [0.0226985365152359, 0.2648695409297943], [0.16738978028297424, 0.6502207517623901], [0.25878095626831055, 0.5678778886795044], [0.30266061425209045, 0.26581868529319763], [0.3471359610557556, 0.11711840331554413], [0.37559235095977783, 0.058135077357292175], [0.4056697487831116, 0.034684985876083374], [0.43178167939186096, 0.02443300560116768], [0.46001678705215454, 0.018932130187749863], [0.5159722566604614, 0.01652570441365242], [0.5797340273857117, 0.016201401129364967], [0.6460064649581909, 0.017371995374560356], [0.682272732257843, 0.019344905391335487], [0.6976514458656311, 0.022002756595611572], [0.5140466690063477, 0.0012234202586114407], [0.07513377815485, 0.00726341363042593], [0.3371255695819855, 0.007575404364615679], [0.00030062542646192014, 3.363547148182988e-05], [2.418667222059412e-08, 0.00012266149860806763], [3.7769037897206204e-11, 0.00024323482648469508], [2.9566528780833323e-08, 0.05061494931578636], [0.15136149525642395, 0.10682684183120728], [0.2733227014541626, 0.11619679629802704], [0.5832678079605103, 0.2978273034095764], [0.6491330862045288, 0.2698477804660797], [0.6769145727157593, 0.22123977541923523], [0.708930253982544, 0.20541194081306458], [0.73455411195755, 0.17351903021335602], [0.7553632855415344, 0.14007557928562164], [0.7603517770767212, 0.11545035243034363], [0.7576184272766113, 0.09859183430671692], [0.7462248206138611, 0.08528999984264374], [0.7309768199920654, 0.07457204163074493], [0.7173610925674438, 0.06647709012031555], [0.18867023289203644, 0.17676711082458496], [0.7540331482887268, 0.07511197030544281], [0.8438817262649536, 0.058006759732961655], [0.8349838852882385, 0.05466935411095619], [0.5635418891906738, 0.21401476860046387], [0.6721795797348022, 0.011922425590455532], [0.03651602938771248, 0.03172778710722923], [0.5783644914627075, 0.6685065031051636], [0.5592918395996094, 0.2742227613925934], [0.01853081025183201, 0.021305076777935028], [0.23039400577545166, 0.010296138934791088], [0.31648290157318115, 0.5945242643356323], [0.2791311740875244, 0.04920126125216484], [0.6055279970169067, 0.10322640836238861], [0.34539803862571716, 0.015407808125019073], [0.3755767345428467, 0.02057143859565258], [0.304115891456604, 0.04704374074935913], [0.3846139907836914, 0.06465522944927216], [0.4353277087211609, 0.09322270005941391], [0.47175121307373047, 0.12380458414554596], [0.5211748480796814, 0.14486372470855713], [0.5648313760757446, 0.17145591974258423], [0.4378278851509094, 0.4631514549255371], [0.45263800024986267, 0.5329511165618896], [0.48054152727127075, 0.5482412576675415], [0.48366957902908325, 0.5568395853042603], [0.8024651408195496, 0.6256079077720642], [0.47956323623657227, 0.5121515393257141], [0.3113085627555847, 0.020239027217030525], [0.464701771736145, 0.39383989572525024], [0.4968850910663605, 0.3383799195289612], [0.22935327887535095, 0.4878648817539215], [0.005913443397730589, 0.08465822041034698], [0.014976926147937775, 0.5408245921134949], [0.00019731841166503727, 0.36932069063186646], [0.0007132655009627342, 8.367883128812537e-05], [0.1240479126572609, 1.6486270396853797e-05], [0.02461257576942444, 0.024095725268125534], [0.35859575867652893, 0.7611967325210571], [0.12910045683383942, 0.5979898571968079], [0.18787527084350586, 0.6250417828559875], [0.23729947209358215, 0.5330986976623535], [0.16692261397838593, 0.647283136844635], [0.18680115044116974, 0.30134469270706177], [0.17591573297977448, 0.4310966432094574], [0.17260728776454926, 0.4114686846733093], [0.1737990826368332, 0.4398350417613983], [0.16760243475437164, 0.4787375330924988], [0.16909153759479523, 0.5019952058792114], [0.16446538269519806, 0.532271683216095], [0.1627473682165146, 0.5554945468902588], [0.16173724830150604, 0.5743552446365356], [0.03719047084450722, 0.0034233673941344023], [0.0012092544930055737, 3.522928454913199e-05], [0.00015659401833545417, 0.00012531141692306846], [5.1278962928336114e-05, 0.0012584544019773602], [1.0867278575897217, 1.4465395906881895e-05], [9.181849236483686e-06, 9.382652933709323e-05], [1.2584539945237339e-05, 3.7966384525134345e-07], [6.567976718052648e-10, 4.256862303009257e-05], [1.125356696718427e-08, 6.036254518448914e-08], [1.1222389684206746e-10, 0.6194186806678772], [3.02271783991781e-11, 0.18409840762615204], [0.008110245689749718, 1.5319039092798192e-10], [0.5898988842964172, 3.6762880739615866e-08], [2.4303409418280353e-07, 1.5679580656069447e-07], [0.6881629824638367, 0.004116455093026161], [0.0027551352977752686, 0.0034720527473837137], [0.0003733924822881818, 3.770233888644725e-05], [0.5964092016220093, 0.0009978098096325994], [9.455241922751156e-09, 5.990044087411661e-07], [1.256517043657368e-05, 0.0014238839503377676], [0.00016390102973673493, 0.0008766697719693184], [0.22571314871311188, 0.32145288586616516], [1.577225461346643e-08, 2.477380860455014e-07], [0.00031874654814600945, 0.03051544539630413], [0.0008481532568112016, 1.941973323482671e-06]];
        var y_attention_weights = [];
        var y_action = [[[0.04707655683159828, 0.5441855788230896, 0.40873780846595764], [0.5903469920158386, 0.3279262185096741, 0.0817267894744873]], [[0.10277583450078964, 0.23231089115142822, 0.6649132966995239], [0.540567934513092, 0.4142875373363495, 0.0451444573700428]], [[0.15018415451049805, 0.26769086718559265, 0.5821250081062317], [0.5021294951438904, 0.4639686346054077, 0.03390185162425041]], [[0.886616051197052, 0.07235431671142578, 0.0410296805202961], [0.01207426842302084, 0.9845882058143616, 0.0033374722115695477]], [[0.021922577172517776, 0.21102583408355713, 0.7670515775680542], [0.058248549699783325, 0.9359191656112671, 0.005832279566675425]], [[0.026440443471074104, 0.10770435631275177, 0.8658552169799805], [0.02431166172027588, 0.9728134274482727, 0.002874926198273897]], [[0.029645824804902077, 0.1176428347826004, 0.8527113795280457], [0.016252581030130386, 0.9817487597465515, 0.001998709747567773]], [[0.9948845505714417, 0.0035683829337358475, 0.0015470214420929551], [0.006904081907123327, 0.9916917085647583, 0.0014042339753359556]], [[0.12714837491512299, 0.3914509117603302, 0.48140066862106323], [0.06670936942100525, 0.9237123727798462, 0.009578203782439232]], [[0.39862602949142456, 0.15732911229133606, 0.444044828414917], [0.06617313623428345, 0.9228630065917969, 0.010963857173919678]], [[0.375043123960495, 0.1848977506160736, 0.4400591552257538], [0.06280192732810974, 0.9265427589416504, 0.010655210353434086]], [[0.9167236685752869, 0.08033952862024307, 0.0029368787072598934], [0.13706614077091217, 0.7162313461303711, 0.14670252799987793]], [[0.1569674164056778, 0.09293387085199356, 0.750098705291748], [0.3463842570781708, 0.5263624787330627, 0.12725327908992767]], [[0.19376467168331146, 0.056721821427345276, 0.749513566493988], [0.37137314677238464, 0.5049919486045837, 0.1236349567770958]], [[0.19520387053489685, 0.06325669586658478, 0.741539478302002], [0.3715006113052368, 0.49881139397621155, 0.12968793511390686]], [[0.08558584004640579, 0.9049353003501892, 0.0094788558781147], [0.25795307755470276, 0.37123575806617737, 0.37081122398376465]], [[0.10730423033237457, 0.6664947271347046, 0.22620099782943726], [0.683357298374176, 0.2097419649362564, 0.10690075159072876]], [[0.14205703139305115, 0.5869221091270447, 0.27102088928222656], [0.6925676465034485, 0.22529780864715576, 0.08213449269533157]], [[0.14849822223186493, 0.5798356533050537, 0.2716660797595978], [0.6878689527511597, 0.2309548556804657, 0.08117617666721344]], [[0.01886064000427723, 0.9788594245910645, 0.0022798709105700254], [0.1858150064945221, 0.7395313382148743, 0.07465362548828125]], [[0.16236133873462677, 0.6624065041542053, 0.1752321422100067], [0.5776229500770569, 0.25991371273994446, 0.16246342658996582]], [[0.18269161880016327, 0.5886654853820801, 0.22864288091659546], [0.5836324095726013, 0.25412970781326294, 0.16223791241645813]], [[0.1851424127817154, 0.5871959924697876, 0.2276616394519806], [0.581127941608429, 0.25317177176475525, 0.165700301527977]], [[0.00623096339404583, 0.9930281043052673, 0.0007409680401906371], [0.17093423008918762, 0.764494001865387, 0.06457177549600601]], [[0.10133858770132065, 0.7733685970306396, 0.12529276311397552], [0.5293170809745789, 0.300110399723053, 0.17057250440120697]], [[0.1467549353837967, 0.6732112765312195, 0.18003374338150024], [0.5656459927558899, 0.27563565969467163, 0.15871836245059967]], [[0.1523374319076538, 0.6620269417762756, 0.18563570082187653], [0.5706546306610107, 0.2693125903606415, 0.160032719373703]], [[0.0029859566129744053, 0.9966097474098206, 0.00040427412022836506], [0.12197554111480713, 0.8304740786552429, 0.047550372779369354]], [[0.11333417892456055, 0.8029905557632446, 0.08367524296045303], [0.2529337406158447, 0.520814061164856, 0.22625218331813812]], [[0.14116670191287994, 0.754368245601654, 0.1044650673866272], [0.28032389283180237, 0.5348946452140808, 0.18478143215179443]], [[0.14480064809322357, 0.7490268349647522, 0.10617244988679886], [0.285118967294693, 0.5343031287193298, 0.18057796359062195]], [[0.002579042688012123, 0.9970657229423523, 0.00035527997533790767], [0.15129569172859192, 0.7978029847145081, 0.05090135335922241]], [[0.19773049652576447, 0.5650029182434082, 0.23726658523082733], [0.44489502906799316, 0.4119933843612671, 0.14311155676841736]], [[0.2619627118110657, 0.4027996361255646, 0.33523762226104736], [0.5063552260398865, 0.387363076210022, 0.10628170520067215]], [[0.27029451727867126, 0.3853112757205963, 0.34439417719841003], [0.5181483030319214, 0.3787727355957031, 0.1030789464712143]], [[0.001948464778251946, 0.9978304505348206, 0.00022118206834420562], [0.1030491292476654, 0.8772145509719849, 0.01973634772002697]], [[0.051868654787540436, 0.8780158162117004, 0.07011548429727554], [0.41507506370544434, 0.4475369155406952, 0.13738802075386047]], [[0.09104090183973312, 0.7988406419754028, 0.11011851578950882], [0.45042315125465393, 0.4516231417655945, 0.09795376658439636]], [[0.10418973863124847, 0.7674164772033691, 0.12839382886886597], [0.45962321758270264, 0.4471059739589691, 0.09327080845832825]], [[0.001668917597271502, 0.9981876015663147, 0.00014346741954796016], [0.10208379477262497, 0.8748648166656494, 0.02305133081972599]], [[6.878285785205662e-05, 0.9999300241470337, 1.2513841056716046e-06], [0.004212248604744673, 0.9955110549926758, 0.00027678595506586134]], [[0.0017231212696060538, 0.9982733726501465, 3.4290110306756105e-06], [2.463788587192539e-05, 0.9999626874923706, 1.2693023563770112e-05]], [[0.0018200055928900838, 0.9979549646377563, 0.00022498055477626622], [4.044573870487511e-06, 0.999987006187439, 8.949315997597296e-06]], [[0.0009375685476697981, 0.9989131689071655, 0.0001493105955887586], [1.8353478026256198e-06, 0.9999945163726807, 3.6459407510847086e-06]], [[0.002025447553023696, 0.9979077577590942, 6.680698425043374e-05], [3.7121197237866e-05, 0.9999629259109497, 4.5728764774821684e-08]], [[0.026803510263562202, 0.9716695547103882, 0.0015269314171746373], [0.014735701493918896, 0.9852427244186401, 2.1504340111277997e-05]], [[0.41323286294937134, 0.3877228796482086, 0.19904431700706482], [0.607510507106781, 0.36280229687690735, 0.02968716062605381]], [[0.6115760207176208, 0.14703097939491272, 0.24139304459095], [0.5669593214988708, 0.41850098967552185, 0.014539675787091255]], [[0.6546277403831482, 0.10741844773292542, 0.2379538118839264], [0.5349039435386658, 0.45208215713500977, 0.013013923540711403]], [[0.6860845685005188, 0.09861992299556732, 0.21529550850391388], [0.4975859224796295, 0.48946481943130493, 0.012949207797646523]], [[0.7084990739822388, 0.09669793397188187, 0.1948028951883316], [0.4549589157104492, 0.5317893028259277, 0.01325173769146204]], [[0.6098847985267639, 0.38437002897262573, 0.005745179485529661], [0.5633074045181274, 0.08801653981208801, 0.3486761450767517]], [[0.32929253578186035, 0.6687896251678467, 0.0019178573274984956], [0.2289438396692276, 0.7653341293334961, 0.005722015630453825]], [[0.6672374606132507, 0.1177649274468422, 0.21499758958816528], [0.08589928597211838, 0.9137674570083618, 0.0003333661297801882]], [[0.4040716290473938, 0.004517474677413702, 0.5914109349250793], [0.46268409490585327, 0.4964189827442169, 0.040896862745285034]], [[0.7459908127784729, 0.06010715290904045, 0.19390200078487396], [0.4517867863178253, 0.004096526186913252, 0.5441166162490845]], [[0.8072035908699036, 0.14067134261131287, 0.05212515592575073], [0.6451711058616638, 0.17102943360805511, 0.18379944562911987]], [[0.8188313841819763, 0.11180286854505539, 0.0693657249212265], [0.6124292612075806, 0.21026252210140228, 0.17730829119682312]], [[0.843533992767334, 0.14549437165260315, 0.01097163837403059], [0.14182189106941223, 0.8576235175132751, 0.000554509402718395]], [[0.8076944351196289, 0.19225789606571198, 4.763724427903071e-05], [0.49384593963623047, 7.869767614465673e-06, 0.5061461925506592]], [[0.9992907047271729, 0.0006509150261990726, 5.837010030518286e-05], [0.0012459143763408065, 1.4612340504260857e-10, 0.9987540245056152]], [[0.9049156904220581, 1.402236466674367e-05, 0.0950702652335167], [0.019143594428896904, 2.4443095753667876e-05, 0.980832040309906]], [[1.9619885279098526e-05, 8.625502800896356e-08, 0.9999803304672241], [0.8565066456794739, 0.11595485359430313, 0.027538565918803215]], [[0.00021039599960204214, 1.1971144431299763e-07, 0.9997895359992981], [0.26713892817497253, 0.6024366617202759, 0.1304243952035904]], [[3.519769961712882e-05, 7.553013769978634e-12, 0.9999648332595825], [0.10975245386362076, 0.8893341422080994, 0.0009132885024882853]], [[0.0017548373434692621, 4.72255914929498e-12, 0.998245120048523], [0.9150691032409668, 0.06997089087963104, 0.014959961175918579]], [[0.20132748782634735, 0.002331649651750922, 0.796340823173523], [0.5119633078575134, 0.022290077060461044, 0.46574658155441284]], [[0.2273222953081131, 0.20516109466552734, 0.5675166249275208], [0.36828550696372986, 0.6132844090461731, 0.018430018797516823]], [[0.31635454297065735, 0.1334892213344574, 0.5501562356948853], [0.2655506134033203, 0.019878413528203964, 0.7145709991455078]], [[0.1555425226688385, 0.5264613628387451, 0.31799617409706116], [0.19648467004299164, 0.801693320274353, 0.0018220613710582256]], [[0.22204512357711792, 0.4973028600215912, 0.28065207600593567], [0.2953692674636841, 0.045081205666065216, 0.6595495343208313]], [[0.11838697642087936, 0.6945268511772156, 0.18708613514900208], [0.11314275860786438, 0.8862202167510986, 0.0006370454211719334]], [[0.16317567229270935, 0.6752533316612244, 0.1615709811449051], [0.32885313034057617, 0.09435436129570007, 0.5767925381660461]], [[0.23425155878067017, 0.00040715187788009644, 0.7653412818908691], [0.13340020179748535, 0.8619663119316101, 0.0046335384249687195]], [[0.1581660360097885, 0.781353771686554, 0.060480184853076935], [0.3111714720726013, 0.17040374875068665, 0.5184247493743896]], [[0.32756727933883667, 0.00014691564138047397, 0.672285795211792], [0.03740442171692848, 0.0003223314124625176, 0.9622731804847717]], [[0.5453382730484009, 0.2489282339811325, 0.20573347806930542], [0.10782606899738312, 0.8860577344894409, 0.006116200238466263]], [[0.10830727219581604, 0.8738620281219482, 0.017830686643719673], [0.15174637734889984, 0.005146979819983244, 0.8431066274642944]], [[0.5146503448486328, 0.013446938246488571, 0.47190266847610474], [0.27646729350090027, 0.5207600593566895, 0.2027725875377655]], [[0.33356520533561707, 0.00010473968723090366, 0.666330099105835], [0.06053323671221733, 0.003247641958296299, 0.9362191557884216]], [[0.07214566320180893, 0.9164790511131287, 0.011375262401998043], [0.3406774401664734, 0.07576266676187515, 0.5835599303245544]], [[0.4833030104637146, 0.0027715256437659264, 0.5139253735542297], [0.05095463618636131, 0.9472939372062683, 0.0017514093779027462]], [[0.3417869508266449, 1.4635243132943287e-05, 0.658198356628418], [0.32948818802833557, 0.6628891229629517, 0.007622679229825735]], [[0.19473285973072052, 0.03583559766411781, 0.7694315314292908], [0.8011303544044495, 0.03551062196493149, 0.16335906088352203]], [[0.6074714660644531, 0.22354236245155334, 0.16898620128631592], [0.07143659889698029, 9.05340930330567e-05, 0.9284729361534119]], [[0.0033624107018113136, 0.0003434918762650341, 0.9962940812110901], [0.0005717006861232221, 6.094497848607716e-07, 0.9994276165962219]], [[0.0013703379081562161, 0.0013086621183902025, 0.9973210692405701], [6.012912854203023e-05, 4.887915139306642e-08, 0.9999397993087769]], [[6.865480827400461e-05, 1.2588052413775586e-06, 0.9999300241470337], [2.3180743937700754e-06, 2.6286089190724615e-12, 0.9999977350234985]], [[8.663073094794527e-05, 1.2068611665583262e-09, 0.9999133348464966], [6.530520477099344e-05, 7.610625454498865e-13, 0.9999346733093262]], [[1.8532153589490008e-08, 4.702316661053807e-12, 1.0], [0.9320287108421326, 5.83290471478648e-10, 0.06797131896018982]], [[2.401384051609057e-07, 2.501329351978221e-11, 0.9999997615814209], [0.7676873803138733, 7.683698122207261e-09, 0.2323126494884491]], [[1.617546695342753e-05, 2.02188790154878e-08, 0.9999837875366211], [0.9437161684036255, 0.05084750056266785, 0.0054362681694328785]], [[0.002979062031954527, 0.0002590233343653381, 0.9967619180679321], [0.07269085198640823, 0.9268008470535278, 0.0005083151627331972]], [[0.033065423369407654, 0.0033192471601068974, 0.963615357875824], [0.6876229643821716, 0.005892121698707342, 0.3064848482608795]], [[0.06208667904138565, 0.004053083248436451, 0.9338602423667908], [0.7485575675964355, 0.0005574269453063607, 0.2508849799633026]], [[0.07930894196033478, 0.0039697736501693726, 0.9167212247848511], [0.9264155030250549, 0.0005021722754463553, 0.07308230549097061]], [[0.10087095201015472, 0.003007055027410388, 0.8961220383644104], [0.9753522872924805, 0.00027389382012188435, 0.024373825639486313]], [[0.11650348454713821, 0.002251031342893839, 0.8812455534934998], [0.9896883368492126, 0.00013197924999985844, 0.01017964817583561]], [[0.1338164061307907, 0.0016674452926963568, 0.8645161986351013], [0.9944480657577515, 5.626583151752129e-05, 0.005495588760823011]], [[0.1499871015548706, 0.0012030856451019645, 0.8488098978996277], [0.9963223934173584, 2.453155320836231e-05, 0.0036530494689941406]], [[0.1685122400522232, 0.0008203148026950657, 0.8306674361228943], [0.9972665309906006, 1.0576006388873793e-05, 0.0027228579856455326]], [[0.2076701521873474, 0.0006289788288995624, 0.7917008399963379], [0.9976629018783569, 4.210322913422715e-06, 0.0023329677060246468]], [[0.2619498372077942, 0.0005690166144631803, 0.7374811172485352], [0.9977136850357056, 1.894826823445328e-06, 0.0022843850310891867]], [[0.3392346501350403, 0.000697867595590651, 0.6600674390792847], [0.99751877784729, 1.0365768048359314e-06, 0.0024801604449748993]], [[0.40853917598724365, 0.0007797981379553676, 0.5906809568405151], [0.9971856474876404, 6.207439469108067e-07, 0.0028137576300650835]], [[0.4697260856628418, 0.000852881174068898, 0.5294210910797119], [0.9967265129089355, 3.9014091157696384e-07, 0.0032731557730585337]], [[0.1997307389974594, 0.0020061125978827477, 0.7982631325721741], [0.9998779296875, 1.4707954676396184e-07, 0.00012195621820865199]], [[0.01434583030641079, 1.98031798959164e-07, 0.9856539368629456], [0.9990925788879395, 3.779677903992251e-09, 0.0009073992259800434]], [[0.10539208352565765, 3.145023583783768e-05, 0.8945764303207397], [0.9990479350090027, 9.393493982656764e-09, 0.000952067959588021]], [[2.5917875973391347e-05, 0.9999740123748779, 7.103034960209698e-08], [0.999997615814209, 2.542028028074128e-07, 2.0947566099493997e-06]], [[1.1760238338709428e-09, 1.0, 2.1591021613816264e-13], [0.9999904632568359, 9.098188456846401e-06, 5.195624908083118e-07]], [[1.381030272779027e-12, 1.0, 1.6329292798372718e-15], [0.9999796152114868, 2.9677602242372814e-07, 2.019104067585431e-05]], [[1.4529214498182341e-09, 1.0, 7.970079754828494e-16], [0.9911574125289917, 1.6889642040496256e-07, 0.00884245429188013]], [[0.03489271178841591, 0.9651070237159729, 1.8028100612355047e-07], [0.022291133180260658, 6.57011245408512e-09, 0.9777088761329651]], [[0.9290356040000916, 0.06630342453718185, 0.004661002196371555], [0.9752010107040405, 2.6955833618558245e-06, 0.024796253070235252]], [[0.745333731174469, 0.25176578760147095, 0.002900522667914629], [0.9120497703552246, 5.380125458032126e-06, 0.0879448875784874]], [[0.6967476010322571, 0.29564768075942993, 0.0076047321781516075], [0.9236875772476196, 1.9202001567464322e-05, 0.07629324495792389]], [[0.697425127029419, 0.2861292362213135, 0.01644558273255825], [0.9421464204788208, 2.5092855139519088e-05, 0.05782853811979294]], [[0.7032698392868042, 0.265019953250885, 0.03171023726463318], [0.9477166533470154, 2.652475996001158e-05, 0.0522567518055439]], [[0.695223867893219, 0.2641289234161377, 0.04064720869064331], [0.958295464515686, 2.290046541020274e-05, 0.04168173298239708]], [[0.6811780333518982, 0.2740359902381897, 0.0447860024869442], [0.9685001373291016, 1.8703673049458303e-05, 0.03148118034005165]], [[0.681541919708252, 0.2706693112850189, 0.047788772732019424], [0.9754312038421631, 1.5134572095121257e-05, 0.024553688243031502]], [[0.6871989965438843, 0.26349323987960815, 0.049307793378829956], [0.9798847436904907, 1.2433812116796616e-05, 0.020102860406041145]], [[0.698474645614624, 0.25236931443214417, 0.04915600270032883], [0.9832263588905334, 1.0474910595803522e-05, 0.0167632307857275]], [[0.7108966708183289, 0.24130885303020477, 0.04779443517327309], [0.9858030080795288, 8.54073732625693e-06, 0.014188435859978199]], [[0.7207342982292175, 0.23316936194896698, 0.04609629884362221], [0.9876781105995178, 7.080875548126642e-06, 0.012314814142882824]], [[0.04669275879859924, 7.085404831741471e-07, 0.9533064961433411], [0.9646449089050293, 0.02100329101085663, 0.014351758174598217]], [[0.4231765568256378, 0.5609354376792908, 0.015888020396232605], [0.9861882328987122, 0.0005310900742188096, 0.013280589133501053]], [[0.5642169713973999, 0.3839370012283325, 0.05184602737426758], [0.9901008009910583, 0.0006766916485503316, 0.009222612716257572]], [[0.64155513048172, 0.2844882905483246, 0.07395657151937485], [0.9908141493797302, 0.0006874658283777535, 0.008498425595462322]], [[0.7993518114089966, 0.01872917264699936, 0.18191903829574585], [0.9465296864509583, 0.052358631044626236, 0.0011116279056295753]], [[0.3925749361515045, 0.00026219006394967437, 0.6071629524230957], [0.9984782338142395, 0.00016797777789179236, 0.0013538149651139975]], [[0.0059683313593268394, 0.9940316081047058, 3.0489156077210454e-17], [0.995015561580658, 0.004922993015497923, 6.142571510281414e-05]], [[0.26488617062568665, 0.7350911498069763, 2.271113589813467e-05], [0.6105743050575256, 0.389424592256546, 1.170796849692124e-06]], [[0.23058611154556274, 0.7664727568626404, 0.002941109938547015], [0.07814415544271469, 0.9218551516532898, 6.36674371889967e-07]], [[0.0024354697670787573, 0.00014685059431940317, 0.997417688369751], [0.99718177318573, 0.001287032850086689, 0.0015312634641304612]], [[0.06095908209681511, 7.63835123507306e-05, 0.9389645457267761], [0.0013537752674892545, 1.1152015133575333e-07, 0.998646080493927]], [[0.9129694700241089, 0.08139675855636597, 0.0056337653659284115], [0.2816639542579651, 4.0619059404889413e-07, 0.7183355689048767]], [[0.9322805404663086, 0.011869272217154503, 0.055850159376859665], [0.9914964437484741, 2.9224480385892093e-05, 0.008474395610392094]], [[0.7156103253364563, 0.0013325667241588235, 0.2830571234226227], [0.9787915945053101, 7.907378312665969e-05, 0.02112930454313755]], [[0.9001418352127075, 0.0945897176861763, 0.005268452223390341], [0.997955322265625, 0.00022269249893724918, 0.0018219130579382181]], [[0.8895301222801208, 0.10271350294351578, 0.007756377104669809], [0.9972634315490723, 0.0008430024026893079, 0.0018935672705993056]], [[0.9249444603919983, 0.06001996621489525, 0.015035574324429035], [0.9927753210067749, 0.001962740905582905, 0.0052619450725615025]], [[0.8948797583580017, 0.08693155646324158, 0.018188700079917908], [0.9893624186515808, 0.002452715067192912, 0.008184915408492088]], [[0.8729404807090759, 0.10750032961368561, 0.019559167325496674], [0.9835274815559387, 0.00410590972751379, 0.01236655842512846]], [[0.858079195022583, 0.11865504086017609, 0.023265758529305458], [0.9765869975090027, 0.005501181352883577, 0.01791173219680786]], [[0.8332468271255493, 0.14174818992614746, 0.025005070492625237], [0.9713879227638245, 0.0062192510813474655, 0.022392762824892998]], [[0.808899462223053, 0.16455091536045074, 0.026549579575657845], [0.9643990397453308, 0.007076206151396036, 0.028524698689579964]], [[0.8742622137069702, 0.1028715968132019, 0.02286621928215027], [0.8621309399604797, 0.11491784453392029, 0.022951239719986916]], [[0.8661293983459473, 0.11239079385995865, 0.02147980034351349], [0.8343125581741333, 0.13177800178527832, 0.03390942141413689]], [[0.8603944778442383, 0.10664938390254974, 0.032956115901470184], [0.8309283256530762, 0.12791891396045685, 0.041152726858854294]], [[0.8583061695098877, 0.10973396897315979, 0.03195982798933983], [0.8248525857925415, 0.13613934814929962, 0.03900802135467529]], [[0.7097494006156921, 0.15773501992225647, 0.13251549005508423], [0.7228643894195557, 0.269380122423172, 0.007755468599498272]], [[0.8681123852729797, 0.076853908598423, 0.05503365024924278], [0.8174921274185181, 0.1731279343366623, 0.00937995221465826]], [[0.9109771251678467, 0.08662348985671997, 0.0023993700742721558], [0.002968289190903306, 0.9970316886901855, 2.8171967869639047e-08]], [[0.172672837972641, 0.0005539637058973312, 0.8267732262611389], [0.8737130165100098, 0.1231817677617073, 0.003105189884081483]], [[0.19747716188430786, 0.8025227785110474, 1.1408935428336431e-11], [0.10610274970531464, 0.8938900828361511, 7.1626504904998e-06]], [[0.060813892632722855, 0.9391736388206482, 1.2438023986760527e-05], [0.809055507183075, 0.19091647863388062, 2.8006001230096444e-05]], [[0.000717155693564564, 0.9992826581001282, 2.6090199867212505e-07], [0.016639582812786102, 0.9833602905273438, 1.445573190039795e-07]], [[0.0005388279678300023, 0.9980937838554382, 0.0013672977220267057], [0.7700508236885071, 0.22974909842014313, 0.0002000585081987083]], [[2.196705821688738e-07, 0.9999836683273315, 1.6104751921375282e-05], [0.09651408344507217, 0.8941521048545837, 0.009333789348602295]], [[6.366691377479583e-05, 0.9999338388442993, 2.4665348519192776e-06], [1.6359817891498096e-06, 0.9999938011169434, 4.524928954197094e-06]], [[0.9737112522125244, 0.025794683024287224, 0.0004941120860166848], [1.1269265769442427e-06, 0.999998927116394, 5.144999981609999e-09]], [[0.9964348077774048, 0.0032941026147454977, 0.00027101743035018444], [0.0036401175893843174, 0.9963584542274475, 1.3927219697507098e-06]], [[0.8873246312141418, 0.11150210350751877, 0.001173320459201932], [0.4920712113380432, 0.4927668869495392, 0.015161951072514057]], [[0.9734361171722412, 0.024790285155177116, 0.0017735898727551103], [0.24475277960300446, 0.7478687763214111, 0.007378415670245886]], [[0.9543778300285339, 0.04518697410821915, 0.0004351924580987543], [0.6824094653129578, 1.3564130085796933e-07, 0.3175903558731079]], [[0.9475294351577759, 0.03727860748767853, 0.015191897749900818], [0.19127997756004333, 0.8006902933120728, 0.008029663003981113]], [[0.9611935615539551, 0.038279104977846146, 0.0005273348651826382], [0.6502640843391418, 1.7424516940423018e-08, 0.3497358560562134]], [[0.9544190764427185, 0.04533877223730087, 0.0002420766104478389], [0.9105158448219299, 1.466311658759878e-07, 0.08948403596878052]], [[0.9591099619865417, 0.039764657616615295, 0.0011254382552579045], [0.8451120257377625, 9.615553153707879e-08, 0.15488792955875397]], [[0.9594461917877197, 0.040004830807447433, 0.0005489775794558227], [0.856387197971344, 4.4219298445113964e-08, 0.1436128318309784]], [[0.9590855240821838, 0.0403544083237648, 0.0005600618897005916], [0.83990079164505, 5.115707679692605e-08, 0.16009914875030518]], [[0.9609981775283813, 0.038462717086076736, 0.0005391217418946326], [0.8151041269302368, 3.348219834720112e-08, 0.18489590287208557]], [[0.9604288935661316, 0.0391097255051136, 0.00046143378131091595], [0.798848569393158, 2.5449258700405153e-08, 0.20115147531032562]], [[0.9618083834648132, 0.037771791219711304, 0.000419901916757226], [0.7757203578948975, 2.2934543153496634e-08, 0.22427965700626373]], [[0.9623162746429443, 0.03727945685386658, 0.0004043072694912553], [0.7561352252960205, 1.9364090775297882e-08, 0.2438647747039795]], [[0.9626009464263916, 0.037013135850429535, 0.0003858994459733367], [0.7387549877166748, 1.7170012966971626e-08, 0.2612450122833252]], [[0.006100556813180447, 0.9938994646072388, 6.702251058830766e-13], [0.0003865022154059261, 5.934959284008973e-14, 0.9996135830879211]], [[0.00012047418567817658, 0.9998793601989746, 9.00733567732459e-08], [2.5101046503550606e-06, 2.1906945463735978e-16, 0.9999974966049194]], [[5.641459210892208e-07, 1.2010867976641748e-05, 0.9999874830245972], [9.680351467977744e-06, 2.3130911586122238e-07, 0.9999901056289673]], [[3.033303983102087e-06, 6.246314114832785e-07, 0.9999963045120239], [2.0007399143651128e-05, 0.00010009788093157113, 0.9998798370361328]], [[0.2630370259284973, 0.3578718304634094, 0.3790911138057709], [5.724957645725226e-07, 3.5578949564296636e-07, 0.9999990463256836]], [[1.6316739959165716e-07, 4.1912949200195726e-07, 0.9999994039535522], [2.326619096493232e-06, 4.639039161702385e-06, 0.999993085861206]], [[5.350753085053839e-08, 7.62032755119435e-07, 0.9999991655349731], [1.0291644869653283e-08, 1.0354750834551396e-08, 1.0]], [[1.3381454798400139e-11, 1.282990033657505e-11, 1.0], [4.906790991299204e-07, 2.527849119360326e-06, 0.9999970197677612]], [[1.2443653963148393e-12, 5.250713752680269e-10, 1.0], [3.029038131430184e-09, 3.957348684857642e-11, 1.0]], [[5.880365638866181e-13, 3.631693903938249e-12, 1.0], [0.001296121976338327, 0.6997597813606262, 0.2989441454410553]], [[1.0975078268068983e-12, 1.0973716157562877e-16, 1.0], [0.044472239911556244, 0.9552921652793884, 0.00023560289992019534]], [[7.96652898316097e-07, 0.9989714622497559, 0.0010277139954268932], [5.925313191490478e-12, 2.922681890545043e-16, 1.0]], [[1.378268848384323e-06, 0.7232258915901184, 0.27677276730537415], [1.8096528719979688e-09, 1.3352186543913458e-11, 1.0]], [[5.855125828624352e-10, 1.2681366179378983e-08, 1.0], [5.233958155770324e-09, 2.899162243608089e-09, 1.0]], [[0.5498799681663513, 1.1979764402703097e-10, 0.4501200020313263], [0.0004759024013765156, 0.9995241165161133, 1.182574316249685e-10]], [[5.444869657367235e-07, 0.0003016232803929597, 0.9996978044509888], [2.230534482805524e-05, 0.9996181726455688, 0.0003595324815250933]], [[1.5258649455063278e-07, 0.999967098236084, 3.273933180025779e-05], [2.7139972189615946e-06, 2.834265044882045e-09, 0.9999972581863403]], [[0.0068358564749360085, 0.747563362121582, 0.24560075998306274], [8.239360795414541e-06, 0.9999055862426758, 8.622609311714768e-05]], [[4.2351656903694135e-11, 3.897275835385017e-10, 1.0], [3.486383093331824e-08, 1.3136106785660573e-11, 1.0]], [[8.292275310850528e-07, 4.76455084153643e-13, 0.9999991655349731], [0.00012698714272119105, 0.9998601675033569, 1.287103532376932e-05]], [[4.239730699850952e-08, 0.9999866485595703, 1.3348992979445029e-05], [8.446559513686225e-05, 3.0485225455123555e-09, 0.9999154806137085]], [[4.9344169383402914e-05, 0.9405998587608337, 0.059350814670324326], [7.841570186428726e-05, 0.9019328951835632, 0.0979887917637825]], [[1.9285115171463474e-10, 5.368068767275247e-10, 1.0], [1.368126056888741e-08, 2.850710932502526e-13, 1.0]], [[2.7742626116378233e-05, 4.968014281209188e-12, 0.9999722242355347], [0.004436712246388197, 0.9953457713127136, 0.00021754989575129002]], [[2.2759227835678075e-09, 8.141211583279073e-05, 0.9999185800552368], [1.2198823640119372e-07, 2.6661234458764775e-14, 0.9999998807907104]]]; // action probs
        var action =  [[2, 1], [2, 0], [2, 0], [0, 1], [2, 1], [1, 1], [2, 1], [0, 1], [2, 1], [0, 0], [1, 1], [0, 1], [2, 1], [1, 1], [2, 1], [1, 2], [2, 0], [2, 1], [1, 0], [1, 1], [1, 2], [1, 1], [1, 0], [1, 1], [1, 0], [1, 2], [1, 0], [1, 1], [1, 2], [1, 0], [1, 0], [1, 0], [2, 0], [0, 1], [2, 0], [1, 1], [1, 0], [1, 1], [1, 1], [1, 1], [1, 1], [1, 1], [1, 1], [1, 1], [1, 1], [1, 1], [0, 0], [0, 0], [0, 0], [0, 0], [2, 1], [0, 2], [1, 0], [1, 1], [2, 1], [2, 2], [0, 0], [0, 0], [0, 1], [0, 0], [0, 2], [0, 2], [2, 0], [2, 0], [2, 1], [2, 0], [2, 2], [1, 1], [2, 2], [1, 1], [2, 2], [1, 1], [1, 2], [2, 1], [1, 1], [0, 2], [2, 1], [1, 2], [0, 1], [2, 2], [1, 2], [0, 1], [2, 0], [2, 0], [1, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 0], [2, 2], [2, 0], [2, 1], [2, 0], [2, 0], [2, 0], [2, 0], [2, 0], [2, 0], [2, 0], [2, 0], [2, 0], [0, 0], [2, 0], [2, 0], [2, 0], [0, 0], [2, 0], [2, 0], [1, 0], [1, 0], [1, 0], [1, 0], [1, 2], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1, 0], [2, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2, 0], [1, 0], [1, 0], [1, 1], [2, 0], [2, 2], [1, 2], [0, 0], [2, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 2], [0, 0], [0, 0], [0, 0], [1, 0], [2, 0], [0, 0], [1, 1], [2, 0], [1, 1], [1, 0], [1, 1], [1, 0], [1, 1], [1, 1], [0, 1], [0, 1], [0, 1], [0, 1], [0, 2], [0, 1], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1, 2], [1, 2], [2, 2], [2, 2], [1, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 1], [2, 1], [1, 2], [1, 2], [2, 2], [0, 1], [2, 1], [1, 2], [1, 1], [2, 2], [2, 1], [1, 2], [1, 1], [2, 2], [2, 1], [2, 2]];
        var action_names = [['no-op', 'left', 'right'], ['no-op', 'up', 'down']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Attention Scores") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step;
        visualizeAttentionScores(y_attention_weights[step], top_n);
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
        // Add event handler for clicking on a marker
        document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);

          // Add event handler for clicking on a marker
          document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>