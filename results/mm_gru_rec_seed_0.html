<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row wrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MortarMayhem-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>arena_size</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>allowed_commands</b>: 9<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_count</b>: [10]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_duration</b>: [6]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_delay</b>: [18]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_failure</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_success</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_episode_success</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 0<br><b>reward_normalization</b>: 0<br><b>positional_endocing</b>: False<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: -1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 512<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_layers</b>: 1<br><b>obs_decoder</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>attach_to</b>: memory<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>detach_gradient</b>: False<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 30000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 1000<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <br>
      <center>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Transformer</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Top Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_0_31.webm', '', '', '', '', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.3377254009246826], [0.34034717082977295], [0.34141799807548523], [0.3432845175266266], [0.3449094295501709], [0.3467736542224884], [0.3489967882633209], [0.35037127137184143], [0.3512701690196991], [0.3530220687389374], [0.35467103123664856], [0.3581778407096863], [0.360835462808609], [0.36206939816474915], [0.3639093339443207], [0.367186576128006], [0.36879250407218933], [0.3709295690059662], [0.37263989448547363], [0.37477654218673706], [0.37785205245018005], [0.37997475266456604], [0.3815472424030304], [0.38404494524002075], [0.3856174647808075], [0.38795265555381775], [0.38942334055900574], [0.39153310656547546], [0.392936110496521], [0.39590051770210266], [0.3977690637111664], [0.40115466713905334], [0.40212592482566833], [0.40460166335105896], [0.40577030181884766], [0.4089440107345581], [0.41032150387763977], [0.4122287929058075], [0.4131036400794983], [0.41475245356559753], [0.421379029750824], [0.42231714725494385], [0.42377355694770813], [0.42523038387298584], [0.4302074611186981], [0.43138712644577026], [0.43338409066200256], [0.436815083026886], [0.43907883763313293], [0.4416813552379608], [0.44420984387397766], [0.4467662274837494], [0.4492080509662628], [0.4514710605144501], [0.4535418450832367], [0.4554285705089569], [0.45715218782424927], [0.45872679352760315], [0.3624058663845062], [0.3598364293575287], [0.36294686794281006], [0.36760392785072327], [0.36951664090156555], [0.36932238936424255], [0.37473827600479126], [0.3749607503414154], [0.3795270323753357], [0.38055911660194397], [0.3825663626194], [0.38429269194602966], [0.3848970830440521], [0.39002591371536255], [0.391561895608902], [0.3945247232913971], [0.39435234665870667], [0.3983355760574341], [0.4000718295574188], [0.4019036591053009], [0.4041286110877991], [0.4063403904438019], [0.4068472385406494], [0.4086669981479645], [0.3081260323524475], [0.31087446212768555], [0.31094253063201904], [0.3151853680610657], [0.31640103459358215], [0.3196408748626709], [0.32051903009414673], [0.3207017481327057], [0.3206554055213928], [0.32160720229148865], [0.32128673791885376], [0.3236500024795532], [0.32640400528907776], [0.32768064737319946], [0.3296550512313843], [0.3315393030643463], [0.33376216888427734], [0.3357153832912445], [0.3376915454864502], [0.33923962712287903], [0.34171468019485474], [0.34311220049858093], [0.34398868680000305], [0.3438711166381836], [0.24377545714378357], [0.24354775249958038], [0.247664213180542], [0.2428390085697174], [0.2444896101951599], [0.24794989824295044], [0.252079576253891], [0.253398597240448], [0.256132572889328], [0.25721198320388794], [0.2590743601322174], [0.26095741987228394], [0.2619827091693878], [0.26365214586257935], [0.2659450173377991], [0.26670798659324646], [0.272912859916687], [0.2719114422798157], [0.2746640145778656], [0.2737710177898407], [0.27498406171798706], [0.2765636146068573], [0.277280330657959], [0.2753174304962158], [0.18061956763267517], [0.17804722487926483], [0.18097227811813354], [0.18283426761627197], [0.18228337168693542], [0.18786604702472687], [0.18627473711967468], [0.19037151336669922], [0.19092807173728943], [0.19502060115337372], [0.19217774271965027], [0.1972043663263321], [0.1945396363735199], [0.19705936312675476], [0.1995798796415329], [0.20006179809570312], [0.2025298774242401], [0.20082390308380127], [0.2039659321308136], [0.20159980654716492], [0.20621679723262787], [0.20249560475349426], [0.20602375268936157], [0.2041739821434021], [0.10874505341053009], [0.10477979481220245], [0.10563167929649353], [0.10409105569124222], [0.10900917649269104], [0.10539950430393219], [0.10556815564632416], [0.10871957987546921], [0.11303628981113434], [0.12253601849079132], [0.1192307397723198], [0.11773952841758728], [0.1139780655503273], [0.12075628340244293], [0.11648207157850266], [0.11733920872211456], [0.12112151831388474], [0.12428562343120575], [0.1238156259059906], [0.12336084246635437], [0.12196110188961029], [0.12157738208770752], [0.12091215699911118], [0.12093661725521088], [0.022311285138130188], [0.020478524267673492], [0.02132469415664673], [0.020615309476852417], [0.021478064358234406], [0.023777298629283905], [0.021358653903007507], [0.02003529667854309], [0.02310900390148163], [0.02395153045654297], [0.022071368992328644], [0.02757972478866577], [0.02373945713043213], [0.020601123571395874], [0.024594582617282867], [0.021178364753723145], [0.02445005625486374], [0.02329724282026291], [0.02403399348258972], [0.022007480263710022], [0.02239556610584259], [0.02238839864730835], [0.022933021187782288], [0.022833697497844696], [0.019759416580200195]];
        var y_entropy = [[0.7359098196029663, 0.858969509601593], [0.8105987310409546, 0.8279026746749878], [0.8022058010101318, 0.7276775240898132], [0.4915865659713745, 0.03737616166472435], [0.6397601962089539, 0.3383094370365143], [0.5631347894668579, 0.1523289680480957], [0.6278440952301025, 0.11905411630868912], [0.03413328900933266, 0.01413891650736332], [0.21519604325294495, 0.12697213888168335], [0.2598694860935211, 0.14631521701812744], [0.2876853346824646, 0.151083841919899], [0.2717151939868927, 0.39751526713371277], [0.6920280456542969, 0.8796831965446472], [0.6859472990036011, 0.9083546996116638], [0.6905744075775146, 0.9141538143157959], [0.5356491804122925, 0.971316933631897], [0.9368987083435059, 0.7269708514213562], [0.9337565898895264, 0.7525337338447571], [0.9308971166610718, 0.7523709535598755], [0.3649701178073883, 0.9917346239089966], [0.9470697641372681, 0.8098533153533936], [0.9284583330154419, 0.8099563717842102], [0.9246659278869629, 0.8141049146652222], [0.22369758784770966, 0.7737537026405334], [0.9883756637573242, 0.7687665820121765], [1.0016825199127197, 0.7521382570266724], [1.002044916152954, 0.7533236742019653], [0.15964320302009583, 0.49330073595046997], [0.7737085223197937, 1.0804280042648315], [0.7551319599151611, 1.0751140117645264], [0.7587231397628784, 1.0765913724899292], [0.13420341908931732, 0.42283180356025696], [0.9906147718429565, 0.9813363552093506], [1.0145316123962402, 0.9365389347076416], [1.0160696506500244, 0.9307874441146851], [0.1022305116057396, 0.5945910215377808], [0.9286355972290039, 1.0121967792510986], [0.9656922221183777, 0.9945623874664307], [0.9657473564147949, 0.9971591234207153], [0.11811169981956482, 0.4663640260696411], [0.10531611740589142, 0.0026485100388526917], [0.495297908782959, 0.0008724044309929013], [0.5517891645431519, 0.040490828454494476], [0.7662684917449951, 0.17103198170661926], [1.0248241424560547, 0.7480309009552002], [0.43404823541641235, 0.5986531972885132], [0.37700355052948, 0.5081690549850464], [0.8791588544845581, 0.2880772352218628], [0.810408353805542, 0.2778196334838867], [0.7898975610733032, 0.28059184551239014], [0.7833020687103271, 0.2887032926082611], [0.7855393886566162, 0.3010862469673157], [0.7906230688095093, 0.3170147240161896], [0.7985019087791443, 0.3331759572029114], [0.8065431714057922, 0.34905537962913513], [0.8126652240753174, 0.36427751183509827], [0.8182233572006226, 0.3778775930404663], [0.8231154680252075, 0.3902931213378906], [0.4705352783203125, 0.623681366443634], [0.6937556266784668, 0.6876991391181946], [0.45232367515563965, 0.05742984637618065], [0.5792111158370972, 0.9425007104873657], [0.6662673950195312, 1.0536811351776123], [0.7033648490905762, 0.9224051237106323], [0.6608216166496277, 0.6795836091041565], [0.4575701057910919, 0.6981992721557617], [0.5809803605079651, 0.6185721158981323], [1.0245238542556763, 0.5190820097923279], [0.8741975426673889, 0.5270326137542725], [0.6599191427230835, 0.5902284383773804], [1.0265405178070068, 0.2940540909767151], [0.2807609736919403, 0.5950876474380493], [1.0054326057434082, 0.7417261600494385], [0.9320738315582275, 0.7897896766662598], [0.014252673834562302, 0.5631159543991089], [0.8690276145935059, 0.8817905187606812], [0.17590171098709106, 0.7375805377960205], [0.24976138770580292, 0.7411584854125977], [0.6781572103500366, 0.9533244371414185], [0.6487738490104675, 0.9084922075271606], [0.09355846047401428, 0.8362724781036377], [0.5728031396865845, 0.7838143706321716], [0.5304098725318909, 0.1867501139640808], [0.43729808926582336, 0.21900153160095215], [0.341963529586792, 0.45298099517822266], [0.206411212682724, 0.8046783208847046], [0.05051790550351143, 0.0873880535364151], [0.005254438612610102, 0.06902118772268295], [5.1853876357199624e-05, 0.2581735849380493], [0.1922444999217987, 0.00784432515501976], [0.3292396664619446, 0.7559000849723816], [0.95404052734375, 0.32157114148139954], [1.005570411682129, 0.9027752876281738], [0.26106783747673035, 0.6657981872558594], [0.9861017465591431, 0.684574544429779], [0.21655111014842987, 0.32866016030311584], [1.0741374492645264, 0.5198792219161987], [0.9769498109817505, 0.19866138696670532], [0.9827637672424316, 0.16203778982162476], [0.6425056457519531, 0.131072998046875], [0.6945415735244751, 0.16075611114501953], [0.8703266382217407, 0.23188279569149017], [0.5861603021621704, 0.0842849612236023], [0.736882209777832, 0.28206536173820496], [0.5845768451690674, 0.09940190613269806], [0.6017078757286072, 0.35511642694473267], [0.7074985504150391, 0.023864034563302994], [0.25146594643592834, 0.054529622197151184], [0.5688523054122925, 0.012470817193388939], [0.6871655583381653, 0.0006321789114736021], [0.00032449295395053923, 0.00014681837637908757], [6.350044714054093e-05, 0.002624643500894308], [2.1907544578425586e-07, 0.03776262328028679], [1.0179601162008112e-07, 0.39626577496528625], [0.01918650232255459, 0.0009453975362703204], [0.4854046404361725, 0.17640677094459534], [0.3842902183532715, 0.4558556079864502], [0.3668898344039917, 0.40060532093048096], [0.5422520637512207, 0.2901972532272339], [0.751178503036499, 0.5937871336936951], [0.33753788471221924, 0.5536874532699585], [0.6865562796592712, 0.7667878866195679], [0.02559310384094715, 0.3457180857658386], [0.37922003865242004, 0.5298214554786682], [0.029515113681554794, 0.3234134912490845], [0.38237905502319336, 0.4789400100708008], [0.3184337615966797, 0.3829207718372345], [0.46179255843162537, 0.421087384223938], [0.020614469423890114, 0.40395447611808777], [0.48066502809524536, 0.4268835186958313], [0.0015373138012364507, 0.2652451992034912], [0.29327043890953064, 0.011671589687466621], [0.6491986513137817, 0.02591974288225174], [0.006856805179268122, 0.2261429727077484], [0.011942287907004356, 0.6858395934104919], [1.8878326955018565e-05, 0.0018908539786934853], [1.0473825362566913e-08, 0.17393052577972412], [0.00021896098041906953, 0.002328510396182537], [0.34693801403045654, 0.6344946026802063], [0.7495646476745605, 0.11268340796232224], [0.6980701684951782, 0.13656118512153625], [0.5930356979370117, 0.5834001302719116], [0.6107041239738464, 0.2298273891210556], [0.46116405725479126, 0.275308758020401], [0.7810289263725281, 0.932641863822937], [0.4635191857814789, 0.611685037612915], [0.6529605388641357, 0.694729745388031], [0.4191882610321045, 0.6335614919662476], [0.6566678285598755, 0.7021763920783997], [0.3709828853607178, 0.6520569920539856], [0.6803931593894958, 0.7124102115631104], [0.3408018946647644, 0.6667512059211731], [1.01664137840271, 0.8584365844726562], [0.39238882064819336, 0.53847736120224], [0.1335424929857254, 0.045507777482271194], [0.5405713319778442, 0.2885999381542206], [0.11719445139169693, 0.6043347120285034], [0.2996571660041809, 0.042817071080207825], [0.08041907101869583, 0.6940914392471313], [0.004612606484442949, 0.0016115002799779177], [7.019044687694986e-07, 0.03541668504476547], [8.279595931526273e-05, 0.6831490993499756], [0.0058810836635529995, 0.5013287663459778], [0.3273327052593231, 0.628504753112793], [0.5159797668457031, 0.2077014446258545], [0.0797799676656723, 0.6674891114234924], [0.5795403122901917, 0.20260930061340332], [0.10236917436122894, 0.6906445026397705], [0.6061990261077881, 0.4244087338447571], [0.6025120615959167, 0.6813331842422485], [0.7295149564743042, 0.7435332536697388], [0.9479886293411255, 0.34934934973716736], [0.8496191501617432, 0.20417505502700806], [0.858350932598114, 0.1877235770225525], [0.8053876161575317, 0.20939965546131134], [0.8160017728805542, 0.19784413278102875], [0.7936477661132812, 0.20124419033527374], [0.7878339290618896, 0.19913211464881897], [0.4264346957206726, 0.007026654202491045], [4.513729436439462e-05, 0.7982852458953857], [1.575722535562818e-06, 0.006073586642742157], [2.51939468398632e-07, 0.4177699685096741], [0.005701096728444099, 0.0044661327265203], [0.002893892116844654, 1.1209904187126085e-05], [0.00017674209084361792, 0.2691511809825897], [0.030971210449934006, 0.00100726040545851], [2.243169910798315e-05, 0.11137683689594269], [0.000470428669359535, 0.021666549146175385], [0.0030464360024780035, 0.6829526424407959], [5.061259855665412e-09, 0.00018554511188995093], [4.836437361710466e-10, 8.504354627802968e-05], [1.030257590173278e-05, 0.00015193785657174885], [1.9390224679227686e-06, 5.5076299076972646e-08], [4.14155731931487e-09, 7.136037538657547e-07], [0.0005502833519130945, 5.5228188244882404e-08], [0.15638890862464905, 0.001620755298063159], [0.0006069022929295897, 9.73885107669048e-07], [1.8342057956033386e-05, 0.007964986376464367], [0.015046411193907261, 8.480545830025221e-07], [8.101971360474636e-08, 0.0013980239164084196], [0.001880469499155879, 1.8534611001541634e-07], [9.920963202603161e-05, 0.007390703074634075], [6.395580176565829e-10, 2.2258270782060663e-09]];
        var y_attention_weights = [];
        var y_action = [[[0.046523161232471466, 0.704262912273407, 0.24921390414237976], [0.6053673624992371, 0.3221581280231476, 0.07247457653284073]], [[0.0312868170440197, 0.48924538493156433, 0.47946780920028687], [0.37554389238357544, 0.5777345299720764, 0.04672153666615486]], [[0.028262769803404808, 0.48678305745124817, 0.48495420813560486], [0.2605755031108856, 0.6999676823616028, 0.039456769824028015]], [[0.8633922934532166, 0.07955006510019302, 0.0570576936006546], [0.0032376316376030445, 0.9945738911628723, 0.002188523532822728]], [[0.012724798172712326, 0.26233381032943726, 0.7249414324760437], [0.08367830514907837, 0.9073036909103394, 0.009017995558679104]], [[0.015972407534718513, 0.18887540698051453, 0.7951522469520569], [0.029071908444166183, 0.9678424596786499, 0.0030856579542160034]], [[0.019668521359562874, 0.22749561071395874, 0.7528358697891235], [0.02110104262828827, 0.9765094518661499, 0.002389522735029459]], [[0.9951110482215881, 0.003037566551938653, 0.0018513617105782032], [0.0013706651516258717, 0.9982030391693115, 0.00042618453153409064]], [[0.023028764873743057, 0.022102762013673782, 0.9548684358596802], [0.024133892729878426, 0.9740464687347412, 0.001819634111598134]], [[0.05283309891819954, 0.009483116678893566, 0.9376837611198425], [0.028160057961940765, 0.969234824180603, 0.002605089917778969]], [[0.05846621096134186, 0.012157649733126163, 0.9293761849403381], [0.029876329004764557, 0.9677286744117737, 0.002395019866526127]], [[0.9307115077972412, 0.06349530071020126, 0.005793254356831312], [0.031302399933338165, 0.8959542512893677, 0.07274332642555237]], [[0.12106597423553467, 0.10571398586034775, 0.7732200026512146], [0.3359394669532776, 0.5855141282081604, 0.07854638993740082]], [[0.14940181374549866, 0.0795811340212822, 0.7710170149803162], [0.3523263931274414, 0.5585358142852783, 0.08913778513669968]], [[0.14832104742527008, 0.08242440968751907, 0.7692545056343079], [0.3546822965145111, 0.5535743832588196, 0.09174332022666931]], [[0.14094415307044983, 0.8293967843055725, 0.029659096151590347], [0.1427636742591858, 0.310771107673645, 0.5464652180671692]], [[0.10064426809549332, 0.37345317006111145, 0.525902509689331], [0.7190407514572144, 0.22994215786457062, 0.05101708322763443]], [[0.10929177701473236, 0.33297300338745117, 0.5577351450920105], [0.6969490647315979, 0.2509306073188782, 0.052120327949523926]], [[0.10897761583328247, 0.32852011919021606, 0.5625023245811462], [0.6966800093650818, 0.2514772117137909, 0.05184273421764374]], [[0.06693825125694275, 0.906892716884613, 0.026169033721089363], [0.1487535834312439, 0.3363950848579407, 0.5148512721061707]], [[0.11012204736471176, 0.35947856307029724, 0.5303993821144104], [0.6703196167945862, 0.2553991675376892, 0.0742812305688858]], [[0.10840919613838196, 0.32576268911361694, 0.5658280849456787], [0.6725708246231079, 0.251255601644516, 0.07617352902889252]], [[0.10776304453611374, 0.32094359397888184, 0.5712933540344238], [0.6708264350891113, 0.25093793869018555, 0.07823564112186432]], [[0.03556189686059952, 0.9511517882347107, 0.013286387547850609], [0.10323435068130493, 0.1742807775735855, 0.722484827041626]], [[0.1347871720790863, 0.4864973723888397, 0.37871548533439636], [0.7141112685203552, 0.20496618747711182, 0.08092252910137177]], [[0.14174287021160126, 0.4530181586742401, 0.4052389860153198], [0.7250328660011292, 0.19695128500461578, 0.07801586389541626]], [[0.14166606962680817, 0.44863322377204895, 0.4097007215023041], [0.7247668504714966, 0.19630472362041473, 0.07892847061157227]], [[0.025625349953770638, 0.9675915837287903, 0.006783058401197195], [0.050538547337055206, 0.08804382383823395, 0.8614176511764526]], [[0.20456521213054657, 0.08344130963087082, 0.7119934558868408], [0.3992506265640259, 0.3513311743736267, 0.2494181990623474]], [[0.20549321174621582, 0.07449109852313995, 0.7200157046318054], [0.407736599445343, 0.354137659072876, 0.2381257563829422]], [[0.20754650235176086, 0.07494622468948364, 0.7175073027610779], [0.4066656231880188, 0.3517810106277466, 0.2415533810853958]], [[0.020577769726514816, 0.9739342927932739, 0.005487894639372826], [0.03905416652560234, 0.07283860445022583, 0.8881072402000427]], [[0.13581520318984985, 0.48160526156425476, 0.3825795650482178], [0.5507032871246338, 0.28796371817588806, 0.16133296489715576]], [[0.15378020703792572, 0.4459531605243683, 0.4002666473388672], [0.5756529569625854, 0.3019963800907135, 0.12235064059495926]], [[0.15479536354541779, 0.44003385305404663, 0.4051707983016968], [0.5783538222312927, 0.3036348223686218, 0.11801134049892426]], [[0.015761369839310646, 0.9810988306999207, 0.0031397687271237373], [0.04259348288178444, 0.15171122550964355, 0.8056952953338623]], [[0.1742924451828003, 0.6177411675453186, 0.2079664021730423], [0.3444891571998596, 0.49198615550994873, 0.16352465748786926]], [[0.18709644675254822, 0.583487331867218, 0.22941617667675018], [0.3659377992153168, 0.49160411953926086, 0.14245809614658356]], [[0.18747271597385406, 0.5835099220275879, 0.22901736199855804], [0.3673948347568512, 0.48837828636169434, 0.14422695338726044]], [[0.017522502690553665, 0.9777626395225525, 0.004714868031442165], [0.0468946136534214, 0.08097998797893524, 0.8721253871917725]], [[0.018980463966727257, 0.979512095451355, 0.0015074544353410602], [0.0002752988657448441, 0.9997153878211975, 9.240437975677196e-06]], [[0.8065692186355591, 0.0006128039676696062, 0.19281798601150513], [5.489449540618807e-05, 0.9999210834503174, 2.3991007765289396e-05]], [[0.20578201115131378, 0.007724652532488108, 0.7864934206008911], [0.005898033268749714, 0.9935970306396484, 0.0005049461615271866]], [[0.4934680759906769, 0.016641324386000633, 0.48989057540893555], [0.04090028256177902, 2.015277095779311e-05, 0.9590796232223511]], [[0.5090389847755432, 0.29094186425209045, 0.20001916587352753], [0.5712780356407166, 0.015016195364296436, 0.4137057065963745]], [[0.14836671948432922, 0.002012749668210745, 0.8496205806732178], [0.8186144232749939, 0.08355879038572311, 0.09782683849334717]], [[0.12307332456111908, 0.00046866058255545795, 0.8764580488204956], [0.854734480381012, 0.05037893354892731, 0.09488657116889954]], [[0.47814884781837463, 0.060380056500434875, 0.4614711105823517], [0.9336433410644531, 0.02501591667532921, 0.04134077578783035]], [[0.41930657625198364, 0.03431348130106926, 0.5463799238204956], [0.9372490644454956, 0.03351880982518196, 0.029232071712613106]], [[0.41876620054244995, 0.027256039902567863, 0.5539777874946594], [0.9364311099052429, 0.03394734114408493, 0.029621547088027]], [[0.419903427362442, 0.024993520230054855, 0.5551030039787292], [0.9340174794197083, 0.035237282514572144, 0.0307452492415905]], [[0.42724674940109253, 0.02509082295000553, 0.5476623773574829], [0.9302792549133301, 0.037195272743701935, 0.03252547234296799]], [[0.43646737933158875, 0.026066217571496964, 0.5374663472175598], [0.92535799741745, 0.04010215774178505, 0.03453988581895828]], [[0.4507371783256531, 0.027864692732691765, 0.5213980674743652], [0.9202319383621216, 0.04344024881720543, 0.0363277904689312]], [[0.46637600660324097, 0.030057992786169052, 0.5035660862922668], [0.9150800108909607, 0.04673367738723755, 0.03818630054593086]], [[0.4789774715900421, 0.032045379281044006, 0.48897725343704224], [0.9100462794303894, 0.04973578825592995, 0.040217965841293335]], [[0.4908802807331085, 0.03414763882756233, 0.4749720096588135], [0.9054573774337769, 0.052492935210466385, 0.042049650102853775]], [[0.5024573802947998, 0.03630375117063522, 0.46123892068862915], [0.9011805057525635, 0.05521971359848976, 0.04359981790184975]], [[0.8405129313468933, 0.007993442937731743, 0.15149372816085815], [0.3145785629749298, 0.6853234171867371, 9.80748372967355e-05]], [[0.5189303755760193, 0.00014557328540831804, 0.4809240698814392], [0.5529224276542664, 1.446198166377144e-05, 0.4470631778240204]], [[0.8324640393257141, 3.909941733581945e-05, 0.16749681532382965], [0.010311764664947987, 2.189830006216198e-08, 0.9896882176399231]], [[0.25911110639572144, 0.00092159683117643, 0.7399672865867615], [0.5981374979019165, 0.15671822428703308, 0.24514427781105042]], [[0.7672088146209717, 0.05199494585394859, 0.1807962954044342], [0.22515226900577545, 0.467699259519577, 0.3071485161781311]], [[0.6876646876335144, 0.02311043068766594, 0.28922492265701294], [0.5322325229644775, 0.37616822123527527, 0.0915992483496666]], [[0.3677506744861603, 0.0003632612933870405, 0.6318860054016113], [0.746236264705658, 0.04156247526407242, 0.2122012972831726]], [[0.16442430019378662, 0.0014453371986746788, 0.8341303467750549], [0.746043860912323, 0.054119087755680084, 0.19983699917793274]], [[0.23813824355602264, 0.005389598663896322, 0.756472110748291], [0.304890513420105, 0.0004319135914556682, 0.6946775317192078]], [[0.4130314588546753, 0.42415687441825867, 0.16281165182590485], [0.8122459650039673, 0.00900339800864458, 0.1787506341934204]], [[0.30910831689834595, 0.6068223118782043, 0.08406937122344971], [0.8251102566719055, 0.020639995113015175, 0.15424971282482147]], [[0.19702453911304474, 0.7613683342933655, 0.04160712659358978], [0.8031837940216064, 0.03642312437295914, 0.16039308905601501]], [[0.5141674876213074, 0.2161356657743454, 0.26969677209854126], [0.08614853769540787, 0.9138036370277405, 4.777604408445768e-05]], [[0.07193736732006073, 0.9247207641601562, 0.0033418869134038687], [0.8199160099029541, 0.10067269951105118, 0.0794113278388977]], [[0.541766881942749, 0.2496611624956131, 0.20857205986976624], [0.7355468273162842, 0.18204611539840698, 0.08240701258182526]], [[0.5286638140678406, 0.37361258268356323, 0.09772363305091858], [0.6971346139907837, 0.22122427821159363, 0.08164114505052567]], [[0.0019715067464858294, 1.6009985870368837e-07, 0.9980283379554749], [0.8317814469337463, 0.10740015655755997, 0.06081842631101608]], [[0.5784795880317688, 0.3522995710372925, 0.06922081112861633], [0.5828296542167664, 0.33818989992141724, 0.07898037135601044]], [[0.04248431324958801, 1.1442760296631604e-05, 0.9575042724609375], [0.48551395535469055, 0.008880743756890297, 0.5056052803993225]], [[0.06835301220417023, 3.6186414945404977e-05, 0.9316108822822571], [0.44073012471199036, 0.011242834851145744, 0.5480270385742188]], [[0.3680698573589325, 0.0032247966155409813, 0.6287053227424622], [0.5960612297058105, 0.18614605069160461, 0.21779273450374603]], [[0.329064279794693, 0.0022840616293251514, 0.6686516404151917], [0.6353384256362915, 0.17463189363479614, 0.19002968072891235]], [[0.0180787555873394, 0.981575608253479, 0.0003456050471868366], [0.6289103627204895, 0.30309104919433594, 0.06799860298633575]], [[0.19399037957191467, 0.7894186973571777, 0.016590939834713936], [0.3595340847969055, 0.6072382926940918, 0.033227622509002686]], [[0.7856391072273254, 0.0018707354320213199, 0.21249018609523773], [0.9622822403907776, 0.0183150265365839, 0.01940268464386463]], [[0.15854409337043762, 3.771964202314848e-06, 0.8414521217346191], [0.943648099899292, 0.0003627920232247561, 0.05598913133144379]], [[0.10755129903554916, 5.6067659897962585e-05, 0.8923925757408142], [0.16813695430755615, 4.682955022872193e-06, 0.8318583965301514]], [[0.051085732877254486, 0.9483559131622314, 0.0005583655438385904], [0.6889914870262146, 0.22354422509670258, 0.08746427297592163]], [[0.008822506293654442, 0.991177499294281, 6.998694512816428e-09], [0.011332201771438122, 0.9847912192344666, 0.0038766071666032076]], [[0.0006275349296629429, 0.9993725419044495, 2.7127373680713163e-09], [0.012487687170505524, 0.9873149394989014, 0.0001973265752894804]], [[3.851214387395885e-06, 0.9999961853027344, 1.2503483803882887e-09], [0.07175836712121964, 0.928240954875946, 6.528380254167132e-07]], [[0.047874294221401215, 0.9521231055259705, 2.6594987048156327e-06], [0.000990737578831613, 5.827992666240789e-08, 0.9990091323852539]], [[0.05283794924616814, 0.9202232360839844, 0.02693883515894413], [0.4640091359615326, 0.014138220809400082, 0.5218527317047119]], [[0.11109805107116699, 0.5139245986938477, 0.3749774098396301], [0.09298867732286453, 0.9053433537483215, 0.0016680324915796518]], [[0.16468243300914764, 0.32488366961479187, 0.5104339122772217], [0.5954787731170654, 0.30293774604797363, 0.10158343613147736]], [[0.02433222532272339, 0.941942572593689, 0.03372519835829735], [0.7858920693397522, 0.09259527921676636, 0.12151257693767548]], [[0.1565776765346527, 0.3054600954055786, 0.5379621982574463], [0.6912333965301514, 0.29153677821159363, 0.017229842022061348]], [[0.021590977907180786, 0.9544929265975952, 0.02391614019870758], [0.91911780834198, 0.05846420302987099, 0.022417999804019928]], [[0.3390381932258606, 0.41972529888153076, 0.24123646318912506], [0.7854893207550049, 5.235995104158064e-07, 0.21451012790203094]], [[0.36238589882850647, 0.5078315734863281, 0.1297825127840042], [0.9499525427818298, 5.074613795841287e-07, 0.050047021359205246]], [[0.42618563771247864, 0.4489842355251312, 0.12483004480600357], [0.9618454575538635, 2.845802669071418e-07, 0.03815431892871857]], [[0.3296043872833252, 0.0011712710838764906, 0.6692242622375488], [0.9710511565208435, 3.395510930204182e-07, 0.028948452323675156]], [[0.4433385133743286, 0.001080911373719573, 0.5555804967880249], [0.9622414112091064, 1.5064851766055654e-07, 0.03775842860341072]], [[0.5992110967636108, 0.32316234707832336, 0.07762657850980759], [0.9382032752037048, 7.530079670914347e-09, 0.061796706169843674]], [[0.2718751132488251, 0.0001063134623109363, 0.7280185222625732], [0.9834514856338501, 8.479921831394677e-08, 0.016548434272408485]], [[0.7389274835586548, 0.17877379059791565, 0.082298643887043], [0.9186455607414246, 3.2374438685423e-09, 0.0813545286655426]], [[0.2709154784679413, 3.7666082789655775e-05, 0.7290468215942383], [0.9796492457389832, 3.792506575450716e-08, 0.020350798964500427]], [[0.8163828253746033, 0.10662026703357697, 0.07699685543775558], [0.8858442902565002, 1.686971562442352e-09, 0.11415567249059677]], [[0.5681412816047668, 0.004206170327961445, 0.42765262722969055], [0.9963975548744202, 1.5192367364136317e-09, 0.0036024353466928005]], [[0.06915954500436783, 4.236118229528074e-07, 0.9308399558067322], [0.9903192520141602, 1.135421878045717e-11, 0.009680816903710365]], [[0.2560194432735443, 0.7439805269241333, 2.1432291705258955e-11], [0.9983108043670654, 1.344273824199771e-11, 0.0016891628038138151]], [[0.4276701807975769, 0.5717585682868958, 0.0005712892161682248], [0.9999411106109619, 3.8979736105559937e-11, 5.882987898075953e-05]], [[2.824754119501449e-05, 0.9999717473983765, 2.038002960835783e-10], [0.9999880790710449, 6.257859563874035e-09, 1.1885069397976622e-05]], [[4.761373475048458e-06, 0.999995231628418, 2.1620314427650555e-08], [0.9997133612632751, 2.426359024809699e-08, 0.00028657252551056445]], [[2.1309587427964516e-09, 1.0, 9.559734337472037e-09], [0.9937870502471924, 1.2217213019027895e-08, 0.00621297862380743]], [[3.9219361092079907e-10, 1.0, 4.874892489681315e-09], [0.8647409677505493, 1.782061502808574e-07, 0.13525888323783875]], [[0.002774847438558936, 0.9972189664840698, 6.127721007942455e-06], [9.185897943098098e-05, 2.1180253731434284e-11, 0.9999080896377563]], [[0.18009817600250244, 0.8179295659065247, 0.0019722161814570427], [0.9573303461074829, 7.149672910600202e-06, 0.04266246035695076]], [[0.8829072713851929, 0.005838758312165737, 0.11125399172306061], [0.8300499320030212, 4.171549790044082e-06, 0.16994595527648926]], [[0.9065941572189331, 0.027423564344644547, 0.06598221510648727], [0.8624359369277954, 8.24367998575326e-06, 0.13755586743354797]], [[0.8434740304946899, 0.0753636509180069, 0.08116229623556137], [0.9152882695198059, 6.5334852479281835e-06, 0.0847051590681076]], [[0.7316609025001526, 0.08771824836730957, 0.18062083423137665], [0.2692483365535736, 0.7291711568832397, 0.0015805151779204607]], [[0.07886970043182373, 0.9096982479095459, 0.011431971564888954], [0.22603094577789307, 0.7710412740707397, 0.0029278250876814127]], [[0.15231093764305115, 0.7699201703071594, 0.07776898145675659], [0.659153401851654, 0.29988110065460205, 0.040965486317873]], [[0.003912280313670635, 5.731362939798146e-09, 0.9960876703262329], [0.915746808052063, 0.050604868680238724, 0.033648353070020676]], [[0.09227858483791351, 0.8939269781112671, 0.013794411905109882], [0.8484045267105103, 0.0684003159403801, 0.08319512009620667]], [[0.004631560295820236, 7.1426438097432765e-09, 0.995368480682373], [0.9218198657035828, 0.05302528291940689, 0.02515484020113945]], [[0.08947781473398209, 0.8943904638290405, 0.016131777316331863], [0.8675639033317566, 0.050330646336078644, 0.08210545778274536]], [[0.09699557721614838, 1.7607095514904358e-07, 0.9030042886734009], [0.8718268275260925, 1.7801875173972803e-06, 0.1281714141368866]], [[0.10707178711891174, 0.8658151030540466, 0.027113044634461403], [0.887086808681488, 0.07956364750862122, 0.033349502831697464]], [[0.00303303892724216, 4.821053334325143e-09, 0.9969670176506042], [0.8866381645202637, 0.09484361857175827, 0.01851818338036537]], [[0.10877647995948792, 0.8595762252807617, 0.03164731338620186], [0.8828791975975037, 0.029165327548980713, 0.08795545995235443]], [[0.000157615912030451, 6.99832173548659e-14, 0.9998424053192139], [0.9257403016090393, 0.07416506111621857, 9.453789971303195e-05]], [[0.08587662875652313, 3.371584534761496e-05, 0.9140896201133728], [0.9984858632087708, 8.508154132869095e-05, 0.0014290098333731294]], [[0.6471477150917053, 2.7788144052465213e-07, 0.3528520166873932], [0.9960454106330872, 1.3933609807281755e-05, 0.003940660506486893]], [[0.9992190599441528, 0.0005324932863004506, 0.0002484518045093864], [0.9418607950210571, 0.057314928621053696, 0.0008242604089900851]], [[0.0016032223356887698, 1.5679568150517298e-06, 0.9983951449394226], [0.5604848265647888, 0.43951305747032166, 2.0537920590868453e-06]], [[1.3231640423327917e-06, 7.116194300493817e-10, 0.9999986886978149], [0.9998034834861755, 3.344030801599729e-06, 0.00019320903811603785]], [[4.875094772316402e-10, 7.44394942821941e-13, 1.0], [0.9581905007362366, 3.425207978580147e-05, 0.041775286197662354]], [[1.8422288121655583e-05, 1.1616314160578511e-10, 0.9999815225601196], [0.0002505818265490234, 4.480096502113007e-11, 0.9997493624687195]], [[0.11018451303243637, 2.7175553896086058e-06, 0.8898128271102905], [0.3303365409374237, 6.180598575156182e-06, 0.669657289981842]], [[0.683670699596405, 0.2734655439853668, 0.04286372661590576], [0.977828860282898, 0.020343851298093796, 0.0018273115856572986]], [[0.6894127130508423, 0.2889530062675476, 0.021634306758642197], [0.9735123515129089, 0.020424364134669304, 0.006063196808099747]], [[0.7374974489212036, 0.25928109884262085, 0.0032214480452239513], [0.7298589944839478, 7.813655855670731e-08, 0.2701409161090851]], [[0.26374030113220215, 0.7304802536964417, 0.005779431201517582], [0.948386013507843, 0.04073015972971916, 0.010883880779147148]], [[0.1592453420162201, 0.8372420072555542, 0.003512698458507657], [0.9379454255104065, 0.03401322290301323, 0.028041286394000053]], [[0.43245476484298706, 0.023244693875312805, 0.5443005561828613], [0.5365453958511353, 0.36308562755584717, 0.10036896169185638]], [[0.15316127240657806, 0.8409016728401184, 0.005936993286013603], [0.7159333825111389, 0.002629948779940605, 0.2814366817474365]], [[0.34780070185661316, 0.0009090303210541606, 0.651290237903595], [0.5626614689826965, 0.001402885071001947, 0.4359356760978699]], [[0.13745993375778198, 0.8597362041473389, 0.0028039286844432354], [0.6730865240097046, 0.000187948506209068, 0.3267255425453186]], [[0.3499312698841095, 0.001281661563552916, 0.6487870812416077], [0.5668767690658569, 0.0030189973767846823, 0.4301042854785919]], [[0.1148136779665947, 0.8831308484077454, 0.002055503660812974], [0.6451945304870605, 0.00019868044182658195, 0.3546068072319031]], [[0.38365238904953003, 0.002195643959566951, 0.6141520142555237], [0.4681013226509094, 0.003545532701537013, 0.5283531546592712]], [[0.10064874589443207, 0.8973379731178284, 0.002013284480199218], [0.6175872087478638, 0.00017468931037001312, 0.38223811984062195]], [[0.46202442049980164, 0.15877442061901093, 0.37920114398002625], [0.3019822835922241, 0.6192960739135742, 0.07872167229652405]], [[0.8971056342124939, 0.07410398125648499, 0.028790298849344254], [0.2293386459350586, 9.256708466409691e-08, 0.7706612944602966]], [[0.029654914513230324, 1.1016527423635125e-07, 0.9703449606895447], [0.0077428207732737064, 0.992244303226471, 1.2838285329053178e-05]], [[0.22819176316261292, 0.00040838695713318884, 0.7713998556137085], [0.915961503982544, 7.362241376540624e-06, 0.08403122425079346]], [[0.9750316739082336, 0.02491135522723198, 5.7004170230356976e-05], [0.7075811624526978, 2.47637262873468e-06, 0.29241642355918884]], [[0.9120507836341858, 0.08766909688711166, 0.00028009028756059706], [0.002865294460207224, 0.9936518669128418, 0.003482840722426772]], [[0.006622535176575184, 0.006784389726817608, 0.9865930676460266], [0.5006535053253174, 0.4992472529411316, 9.922576282406226e-05]], [[0.0005181137821637094, 1.4403252862393856e-05, 0.9994675517082214], [0.9998360872268677, 3.952018687414238e-06, 0.00015998359594959766]], [[7.0296528598134955e-09, 3.308954177327905e-08, 1.0], [0.9942758679389954, 2.3899510779301636e-05, 0.0057002464309334755]], [[1.0507013712413027e-06, 5.098491328681121e-06, 0.9999938011169434], [0.4265872538089752, 8.334719314007089e-05, 0.5733293890953064]], [[0.0007122899405658245, 4.6180861090761027e-07, 0.9992873072624207], [0.7996243238449097, 4.29728243034333e-05, 0.20033270120620728]], [[0.9011359810829163, 0.0008214342524297535, 0.0980425551533699], [0.3219574987888336, 1.4323190043796785e-05, 0.6780281662940979]], [[0.8403511643409729, 0.029831813648343086, 0.12981699407100677], [0.9542908668518066, 0.008544374257326126, 0.037164658308029175]], [[0.9855798482894897, 0.0012860717251896858, 0.013134066015481949], [0.38721442222595215, 2.257766169577735e-07, 0.6127853393554688]], [[0.7613753080368042, 0.006561681162565947, 0.2320629358291626], [0.9559723734855652, 0.008833258412778378, 0.03519434109330177]], [[0.9820066094398499, 0.007573356851935387, 0.010419962927699089], [0.5354178547859192, 5.729547751798236e-07, 0.46458157896995544]], [[0.7728893160820007, 0.02119329944252968, 0.20591746270656586], [0.8764991760253906, 0.017596349120140076, 0.10590456426143646]], [[0.7844995856285095, 0.027022046968340874, 0.18847839534282684], [0.6832619905471802, 0.0138683607801795, 0.30286967754364014]], [[0.7199254631996155, 0.05343008041381836, 0.22664448618888855], [0.4598315358161926, 0.010972999967634678, 0.5291954278945923]], [[0.5530561208724976, 0.12047206610441208, 0.3264717757701874], [0.903244137763977, 0.08708041161298752, 0.009675481356680393]], [[0.6617242097854614, 0.10525067150592804, 0.23302507400512695], [0.9517780542373657, 0.04533438757061958, 0.00288752350024879]], [[0.6381947994232178, 0.09085772931575775, 0.2709474563598633], [0.9581012725830078, 0.03763078153133392, 0.004267956130206585]], [[0.6943531632423401, 0.09549089521169662, 0.21015600860118866], [0.9506000280380249, 0.04589322954416275, 0.003506653243675828]], [[0.690829336643219, 0.10418816655874252, 0.2049824446439743], [0.9546235203742981, 0.04152863100171089, 0.0038478756323456764]], [[0.7084193229675293, 0.1042165458202362, 0.18736408650875092], [0.9531392455101013, 0.043505970388650894, 0.0033548721112310886]], [[0.7126228213310242, 0.10392796993255615, 0.18344920873641968], [0.9538080096244812, 0.04285355657339096, 0.0033384019043296576]], [[0.020542705431580544, 0.1015683263540268, 0.8778889179229736], [0.0008737063617445529, 0.9991262555122375, 3.37327432653467e-09]], [[7.160604695855e-07, 2.451255113555817e-06, 0.9999967813491821], [0.219076469540596, 0.6940881013870239, 0.08683536946773529]], [[9.567417436073811e-08, 1.4446368545861787e-09, 0.9999998807907104], [0.0006295332568697631, 7.680350972805172e-05, 0.9992936849594116]], [[1.0677451145468808e-09, 1.2640361646276688e-08, 1.0], [0.0003222011146135628, 0.8541299700737, 0.1455478072166443]], [[2.899876335504814e-06, 0.9993141889572144, 0.0006830039201304317], [3.3146659461635863e-06, 0.9994807839393616, 0.0005159227875992656]], [[1.1435997748776572e-07, 0.9996802806854248, 0.00031958965701051056], [5.312135158419551e-07, 0.9999992847442627, 1.9813232654541935e-07]], [[5.675205638766556e-09, 0.9999854564666748, 1.4576900866813958e-05], [0.00010838023445103317, 0.9242226481437683, 0.07566896080970764]], [[1.6281959114294864e-09, 0.004904249217361212, 0.9950957298278809], [1.169226652564248e-05, 0.9999053478240967, 8.301759953610599e-05]], [[1.9161851272375685e-10, 1.532663191028405e-06, 0.9999984502792358], [3.443382183832e-07, 0.023501886054873466, 0.9764977693557739]], [[1.887295724145588e-07, 4.219840047881007e-05, 0.9999575614929199], [4.1851400567338715e-08, 0.003215372795239091, 0.9967845678329468]], [[5.683069570494581e-09, 0.9996612071990967, 0.00033885231823660433], [9.434037195887868e-08, 0.5712794661521912, 0.42872050404548645]], [[1.837550389627296e-10, 1.0, 3.931423242509169e-11], [2.1525037752212484e-08, 1.5326309949159622e-05, 0.999984622001648]], [[1.1265735740118021e-11, 7.805824563111852e-12, 1.0], [4.414328941493295e-06, 1.8493883544579148e-06, 0.9999936819076538]], [[1.1091806584317965e-08, 0.9999994039535522, 6.41371173060179e-07], [4.16610603792833e-08, 0.9999877214431763, 1.2277642781555187e-05]], [[2.528174469773603e-08, 0.9999998807907104, 9.240977760782698e-08], [2.796074705102569e-09, 2.57697021274067e-13, 1.0]], [[1.3525703994321514e-13, 1.846065800226171e-10, 1.0], [8.566871656512376e-09, 1.0, 3.2137187133685075e-08]], [[2.2154854661948775e-07, 0.99994957447052, 5.0131660827901214e-05], [2.803636656167896e-09, 6.410895035321995e-13, 1.0]], [[5.804443389934022e-06, 0.03639508783817291, 0.9635990858078003], [8.924629219109192e-05, 0.9998449087142944, 6.580973422387615e-05]], [[7.805471824440247e-09, 5.625536141451448e-05, 0.999943733215332], [5.6715794727324464e-08, 1.3499339424072332e-09, 1.0]], [[1.2335787005213206e-06, 0.9999988079071045, 3.524375102870181e-08], [0.0008325946400873363, 0.9990445971488953, 0.00012284661352168769]], [[2.7856519864144502e-06, 0.9979034662246704, 0.0020938387606292963], [5.0472849011384824e-08, 6.551419020998928e-13, 1.0]], [[1.0455208747373046e-12, 4.198934533405918e-09, 1.0], [1.1478161923150765e-06, 0.9998589754104614, 0.0001398551103193313]], [[1.3423747304841527e-06, 0.9998037219047546, 0.00019501472706906497], [1.0065038580364671e-08, 2.2271423529181267e-13, 1.0]], [[2.8503100324428488e-08, 7.739276043139398e-06, 0.9999922513961792], [0.0006235110340639949, 0.9991453886032104, 0.00023109203903004527]], [[6.355293353209335e-13, 2.548738477214929e-11, 1.0], [9.651292959267366e-11, 3.272313586007332e-15, 1.0]]]; // action probs
        var action =  [[1, 0], [1, 1], [2, 1], [0, 1], [1, 1], [2, 1], [1, 1], [0, 1], [2, 1], [2, 1], [2, 1], [0, 1], [2, 1], [2, 1], [2, 1], [1, 1], [1, 2], [2, 0], [0, 1], [1, 1], [0, 1], [2, 0], [1, 0], [1, 2], [1, 0], [1, 0], [1, 0], [1, 2], [2, 2], [2, 1], [2, 0], [1, 2], [1, 2], [0, 1], [2, 0], [1, 2], [1, 1], [2, 0], [1, 2], [1, 2], [1, 1], [0, 1], [2, 1], [2, 2], [1, 2], [0, 0], [2, 0], [0, 0], [0, 0], [2, 0], [2, 0], [2, 0], [2, 0], [0, 0], [2, 0], [2, 0], [0, 0], [2, 0], [0, 1], [0, 0], [0, 2], [0, 0], [0, 1], [0, 0], [2, 2], [2, 0], [2, 2], [0, 0], [0, 0], [1, 2], [2, 1], [1, 0], [0, 0], [1, 0], [2, 0], [1, 1], [0, 0], [2, 2], [0, 0], [2, 0], [1, 0], [0, 1], [0, 0], [2, 0], [2, 2], [1, 0], [1, 1], [1, 1], [1, 1], [1, 2], [1, 2], [1, 1], [2, 0], [1, 0], [2, 0], [1, 1], [0, 0], [0, 0], [1, 0], [0, 0], [2, 0], [1, 0], [2, 0], [1, 0], [2, 0], [0, 0], [0, 0], [2, 0], [1, 0], [0, 0], [1, 0], [1, 0], [1, 0], [1, 0], [1, 2], [1, 0], [0, 0], [0, 0], [0, 2], [2, 0], [1, 1], [1, 0], [2, 0], [1, 0], [2, 0], [1, 1], [2, 2], [1, 0], [2, 0], [1, 0], [2, 0], [0, 0], [2, 0], [0, 0], [2, 1], [2, 0], [2, 0], [2, 2], [2, 2], [0, 0], [0, 1], [0, 2], [0, 0], [1, 0], [2, 1], [1, 0], [2, 0], [1, 0], [2, 0], [1, 0], [2, 0], [1, 2], [0, 1], [0, 2], [2, 1], [2, 0], [0, 2], [0, 1], [2, 1], [2, 0], [2, 0], [2, 2], [2, 0], [2, 2], [0, 1], [0, 2], [0, 1], [0, 2], [0, 0], [0, 0], [0, 2], [0, 0], [0, 0], [2, 0], [2, 0], [0, 0], [0, 0], [0, 0], [2, 1], [2, 1], [2, 2], [2, 1], [1, 1], [1, 1], [1, 1], [2, 1], [2, 2], [2, 2], [1, 1], [1, 2], [2, 2], [1, 1], [1, 2], [2, 1], [1, 2], [2, 1], [2, 2], [1, 1], [1, 2], [2, 1], [1, 2], [2, 1], [2, 2]];
        var action_names = [['no-op', 'left', 'right'], ['no-op', 'up', 'down']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Transformer") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step;
        visualizeAttentionScores(y_attention_weights[step], top_n);
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>