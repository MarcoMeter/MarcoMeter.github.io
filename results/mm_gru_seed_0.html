<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row wrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MortarMayhem-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>arena_size</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>allowed_commands</b>: 9<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_count</b>: [10]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_duration</b>: [6]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_delay</b>: [18]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_failure</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_success</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_episode_success</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 0<br><b>reward_normalization</b>: 0<br><b>positional_endocing</b>: False<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: -1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 512<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_layers</b>: 1<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 30000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: {'initial': 0.0}<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <br>
      <center>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Transformer</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Top Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_0_28.webm', '', '', '', '', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.3447994589805603], [0.34711024165153503], [0.34938696026802063], [0.3522270619869232], [0.3549940288066864], [0.355172336101532], [0.35557621717453003], [0.358573853969574], [0.36021190881729126], [0.362416535615921], [0.36289525032043457], [0.36477696895599365], [0.3678240478038788], [0.3684958517551422], [0.3705878257751465], [0.3725232183933258], [0.37136054039001465], [0.37389063835144043], [0.37487152218818665], [0.38024240732192993], [0.36378490924835205], [0.36182641983032227], [0.3624023199081421], [0.3636745810508728], [0.3692778944969177], [0.3682519197463989], [0.3702196478843689], [0.3685142695903778], [0.3725864589214325], [0.3764297366142273], [0.3790145814418793], [0.3796045482158661], [0.37967413663864136], [0.3825472295284271], [0.3849574625492096], [0.3883284628391266], [0.390685111284256], [0.39282500743865967], [0.3941075801849365], [0.39719435572624207], [0.3997371792793274], [0.40065836906433105], [0.4034341871738434], [0.3991904854774475], [0.40398305654525757], [0.40926045179367065], [0.41144970059394836], [0.4109576940536499], [0.4119386076927185], [0.41182658076286316], [0.4156109690666199], [0.4181603193283081], [0.416886568069458], [0.42252716422080994], [0.42008501291275024], [0.42558854818344116], [0.42918509244918823], [0.42513221502304077], [0.3357609212398529], [0.3397958278656006], [0.3376203775405884], [0.339415967464447], [0.3380935490131378], [0.3405042886734009], [0.34336069226264954], [0.3412036895751953], [0.34591448307037354], [0.35106131434440613], [0.3553743362426758], [0.3592797517776489], [0.36202186346054077], [0.36496877670288086], [0.3701808750629425], [0.3716456890106201], [0.3793366551399231], [0.3825107514858246], [0.38741186261177063], [0.3896322250366211], [0.3925866484642029], [0.394806832075119], [0.39625850319862366], [0.394603431224823], [0.2922767400741577], [0.2951534390449524], [0.29404544830322266], [0.2931661009788513], [0.29630330204963684], [0.2922227084636688], [0.2930409014225006], [0.297004759311676], [0.29887309670448303], [0.2983708083629608], [0.3012690842151642], [0.3044380843639374], [0.30622705817222595], [0.30791595578193665], [0.3087829053401947], [0.30545395612716675], [0.30960795283317566], [0.3131297528743744], [0.3120172619819641], [0.3161619007587433], [0.3109074532985687], [0.3175134062767029], [0.3179101347923279], [0.32050150632858276], [0.21506080031394958], [0.22198906540870667], [0.22086191177368164], [0.22355324029922485], [0.21965429186820984], [0.2218976616859436], [0.2155681699514389], [0.20883119106292725], [0.2143954485654831], [0.21991029381752014], [0.22167423367500305], [0.22186970710754395], [0.21555116772651672], [0.21895217895507812], [0.2135026454925537], [0.21220028400421143], [0.22071290016174316], [0.22123736143112183], [0.21954035758972168], [0.21999886631965637], [0.22175824642181396], [0.2231704592704773], [0.22015473246574402], [0.22001969814300537], [0.1272425353527069], [0.11627466976642609], [0.12336474657058716], [0.12453863024711609], [0.1177942231297493], [0.1314018815755844], [0.13294029235839844], [0.13351063430309296], [0.12052155286073685], [0.11651623994112015], [0.12267520278692245], [0.12639391422271729], [0.12762197852134705], [0.12758547067642212], [0.12663117051124573], [0.12531450390815735], [0.12483391910791397], [0.1246093213558197], [0.12413930147886276], [0.12380577623844147], [0.12342119961977005], [0.12339609861373901], [0.1309358775615692], [0.12325789779424667], [0.023112669587135315], [0.022874027490615845], [0.025505661964416504], [0.018467865884304047], [0.01794160157442093], [0.03059399500489235], [0.04820329695940018], [0.036593418568372726], [0.03911326080560684], [0.03043524920940399], [0.01855088770389557], [0.0120292529463768], [0.010143831372261047], [0.0025805458426475525], [0.003841318190097809], [-0.006274878978729248], [0.0009971708059310913], [0.0004490092396736145], [0.010537959635257721], [0.012525416910648346], [0.012197211384773254], [0.01971067488193512], [0.024136163294315338], [0.028506062924861908], [0.00017542392015457153]];
        var y_entropy = [[0.6132362484931946, 0.8620424270629883], [0.9679747819900513, 0.7973018288612366], [0.9755716919898987, 0.6099342107772827], [0.9086809754371643, 0.8069106340408325], [0.20024225115776062, 0.8735636472702026], [0.2093544602394104, 0.8825030326843262], [0.1865062117576599, 0.8215662240982056], [0.7303323745727539, 0.5182204246520996], [0.1092073991894722, 0.7395928502082825], [0.1784072369337082, 0.8298850059509277], [0.23358523845672607, 0.8096719980239868], [0.732111930847168, 0.7969931960105896], [0.4843255877494812, 0.638102650642395], [0.9320940971374512, 0.6320614814758301], [0.9648147821426392, 0.521117627620697], [1.0429904460906982, 0.9474325180053711], [0.9337968826293945, 0.5000149011611938], [1.0731799602508545, 0.5110262632369995], [1.076245903968811, 0.5200939178466797], [1.0173826217651367, 1.0734002590179443], [1.0697484016418457, 0.6157751083374023], [1.0959898233413696, 0.5949066877365112], [1.0944641828536987, 0.6767521500587463], [0.2917080223560333, 0.9814559817314148], [1.0615859031677246, 0.7097771763801575], [1.0177507400512695, 0.7744761109352112], [1.041627287864685, 0.8117366433143616], [0.11216557770967484, 0.9143126010894775], [1.0416702032089233, 0.7395181655883789], [1.017505168914795, 0.716109037399292], [1.035010576248169, 0.7525993585586548], [0.09366028755903244, 0.887020468711853], [0.9526479244232178, 0.8384686708450317], [1.0220048427581787, 0.8249555826187134], [1.0553715229034424, 0.8570054173469543], [0.05634278059005737, 0.889726996421814], [0.9978082180023193, 0.9610269069671631], [0.9779585599899292, 0.9534937143325806], [1.0147656202316284, 0.9351258277893066], [0.05657624080777168, 0.8747717142105103], [0.005641808267682791, 0.6707086563110352], [0.008409000001847744, 0.6580914258956909], [0.060937464237213135, 0.30849677324295044], [0.8453853726387024, 0.008814406581223011], [0.4059502184391022, 0.9150263667106628], [0.20149923861026764, 0.8369776010513306], [0.5108811259269714, 0.5077270269393921], [0.438664972782135, 0.4197946786880493], [1.0537998676300049, 0.7794820070266724], [0.6843217611312866, 0.1465933471918106], [0.9546633958816528, 0.8467901945114136], [0.5953887701034546, 0.8371781706809998], [0.5648192763328552, 0.09822581708431244], [0.918725311756134, 0.9145395159721375], [0.5941274762153625, 0.5159927606582642], [0.9816913604736328, 0.9922133684158325], [0.8160320520401001, 0.9467864036560059], [0.17191556096076965, 0.6140589714050293], [0.610321581363678, 0.22696951031684875], [0.6548699140548706, 0.23767411708831787], [0.0007660231785848737, 0.10302314162254333], [0.02086746133863926, 0.34372228384017944], [0.21883182227611542, 0.12264568358659744], [0.1521218866109848, 0.07474728673696518], [0.5199277400970459, 0.4444058835506439], [0.6617280840873718, 0.6666709184646606], [0.6943528652191162, 0.21073032915592194], [0.36122623085975647, 0.6687383651733398], [0.683099627494812, 0.18824005126953125], [0.4253727197647095, 0.11733745038509369], [0.8648755550384521, 0.5126113295555115], [0.3479917645454407, 0.09539569914340973], [1.0541365146636963, 1.075010061264038], [0.586589515209198, 0.16519764065742493], [0.9679433107376099, 1.0764710903167725], [0.4421285092830658, 0.37874218821525574], [0.863958477973938, 1.065991759300232], [0.6897680759429932, 0.24976709485054016], [0.6667609214782715, 0.58360755443573], [0.6922842860221863, 0.3456723093986511], [0.8284427523612976, 0.6729633808135986], [0.6545352935791016, 0.6643697619438171], [0.636340856552124, 0.015263676643371582], [0.1381426751613617, 0.013180043548345566], [8.507001621183008e-05, 0.02241763472557068], [0.4089934825897217, 0.33878612518310547], [0.017333002761006355, 0.2959807813167572], [0.047340311110019684, 0.43172210454940796], [3.148483074255637e-06, 0.0029452783055603504], [7.773734544969102e-09, 0.02883140556514263], [0.003966876305639744, 0.5815680027008057], [0.4106501042842865, 0.26367539167404175], [0.31886667013168335, 0.28815558552742004], [0.2690761983394623, 0.8123254179954529], [0.17860747873783112, 0.9254840612411499], [0.24956461787223816, 1.0633865594863892], [0.33104056119918823, 1.0589672327041626], [0.40720298886299133, 0.34601518511772156], [0.621965765953064, 0.9379085302352905], [0.657343327999115, 0.011853404343128204], [0.5649333000183105, 1.0969877243041992], [0.6948487162590027, 0.016546713188290596], [0.2945835292339325, 0.735400915145874], [0.33967912197113037, 0.6527199745178223], [0.29104477167129517, 0.7013344764709473], [0.2665036916732788, 0.7091532945632935], [0.473824679851532, 0.478359192609787], [0.0005201518069952726, 0.004134671296924353], [0.001855920534580946, 0.0013087792322039604], [0.3272096812725067, 0.07926537841558456], [0.5192213654518127, 0.00027360572130419314], [0.017468085512518883, 0.002823985880240798], [3.957672106480459e-06, 0.11941501498222351], [0.00011576513497857377, 0.0212301854044199], [0.10293107479810715, 0.4836070239543915], [0.2100968211889267, 0.1747172623872757], [0.6665583252906799, 0.43918585777282715], [0.7067835330963135, 0.6961417198181152], [0.4636417031288147, 0.8603487014770508], [0.6575983166694641, 0.6899833679199219], [0.663155198097229, 0.5613081455230713], [0.7832796573638916, 0.6393447518348694], [1.0159509181976318, 0.7869544625282288], [0.9675394296646118, 0.6463363170623779], [0.7193914651870728, 0.8891968727111816], [0.7659530639648438, 0.8638484477996826], [0.9139223694801331, 0.5873135328292847], [0.3356074094772339, 0.6376389265060425], [0.4641335606575012, 0.6050131320953369], [0.3403739333152771, 0.5402790904045105], [0.6358761787414551, 0.0028907526284456253], [0.23921257257461548, 0.026866817846894264], [0.1886511743068695, 0.10771964490413666], [0.0011999033158645034, 0.646873414516449], [0.002985624596476555, 0.011624359525740147], [1.2610114936251193e-05, 4.332619596425502e-07], [4.323823930008075e-07, 0.11013998836278915], [0.00011389915744075552, 0.4358478784561157], [0.11540692299604416, 0.3879025876522064], [0.18298764526844025, 0.22613970935344696], [0.11086072772741318, 0.16665183007717133], [0.06918373703956604, 0.08117412775754929], [0.04737406596541405, 0.03613999858498573], [0.03904055431485176, 0.029789786785840988], [0.029657594859600067, 0.03682946786284447], [0.0253203883767128, 0.05552726984024048], [0.02673005312681198, 0.09003466367721558], [0.03594135120511055, 0.13796408474445343], [0.05702808126807213, 0.1998388022184372], [0.08760865777730942, 0.2987111210823059], [0.13678768277168274, 0.4010716676712036], [0.20515482127666473, 0.4904722571372986], [0.6168773770332336, 0.3252251446247101], [0.4944961667060852, 0.7937917113304138], [0.39568716287612915, 0.03847017511725426], [0.618389904499054, 0.2118569016456604], [0.005930877290666103, 0.13019400835037231], [0.5087090730667114, 4.133803699346572e-08], [0.603553056716919, 5.2167326041645604e-14], [0.7407843470573425, 7.340342797566152e-14], [0.29522690176963806, 1.0412599493747621e-07], [0.7133246064186096, 0.021233774721622467], [0.5208825469017029, 0.4908778965473175], [0.16741137206554413, 0.3573238253593445], [0.10705626010894775, 0.1895209550857544], [0.2065722793340683, 0.07303135842084885], [0.5363632440567017, 0.054698213934898376], [0.6960561871528625, 0.05886019393801689], [0.6926297545433044, 0.3235394060611725], [0.2170841097831726, 0.12865953147411346], [1.039731502532959, 0.6447378396987915], [0.9258404970169067, 0.8330633044242859], [0.5765033960342407, 0.39136838912963867], [0.5037024021148682, 0.7184074521064758], [0.24104705452919006, 1.0497004985809326], [0.8234854936599731, 0.9532520771026611], [0.8943367004394531, 0.8202877640724182], [0.7990474700927734, 0.9498950242996216], [0.004084750544279814, 0.00042111019138246775]];
        var y_attention_weights = [];
        var y_action = [[[0.7818968296051025, 0.030764002352952957, 0.187339186668396], [0.25166261196136475, 0.10194852948188782, 0.646388828754425]], [[0.3261059522628784, 0.1343250721693039, 0.5395690202713013], [0.16546742618083954, 0.12283775210380554, 0.7116948962211609]], [[0.5027367472648621, 0.12690705060958862, 0.37035617232322693], [0.17916789650917053, 0.03344900906085968, 0.7873831391334534]], [[0.0899747684597969, 0.5602887272834778, 0.3497365117073059], [0.3619155287742615, 0.597008466720581, 0.04107610136270523]], [[0.9587497711181641, 0.018368488177657127, 0.022881677374243736], [0.6262651681900024, 0.09573055803775787, 0.2780042886734009]], [[0.9552163481712341, 0.03230727091431618, 0.012476382777094841], [0.6082199215888977, 0.09151795506477356, 0.30026212334632874]], [[0.9613026976585388, 0.02809271030128002, 0.010604605078697205], [0.6145668625831604, 0.053312256932258606, 0.3321209251880646]], [[0.40264809131622314, 0.5859925746917725, 0.01135930698364973], [0.8525112867355347, 0.08684331178665161, 0.06064539775252342]], [[0.980585515499115, 0.009604846127331257, 0.00980959553271532], [0.6690330505371094, 0.031807854771614075, 0.29915907979011536]], [[0.9642546772956848, 0.02099369280040264, 0.014751597307622433], [0.5181052088737488, 0.039811912924051285, 0.44208288192749023]], [[0.9496193528175354, 0.03011905401945114, 0.020261602476239204], [0.6211585402488708, 0.04914349690079689, 0.32969793677330017]], [[0.36552152037620544, 0.618230938911438, 0.016247574239969254], [0.687896192073822, 0.2334260195493698, 0.07867781072854996]], [[0.8659514784812927, 0.08018399775028229, 0.053864531219005585], [0.7813761234283447, 0.04634982347488403, 0.17227408289909363]], [[0.6153088808059692, 0.1794329732656479, 0.20525811612606049], [0.7879961133003235, 0.04970857873558998, 0.1622953712940216]], [[0.584456741809845, 0.18724840879440308, 0.22829484939575195], [0.8466708064079285, 0.04485851526260376, 0.10847066342830658]], [[0.28866562247276306, 0.4887402057647705, 0.22259417176246643], [0.5890107750892639, 0.26005274057388306, 0.150936558842659]], [[0.5566174387931824, 0.3345668613910675, 0.10881567746400833], [0.8605497479438782, 0.07623708248138428, 0.06321318447589874]], [[0.41718265414237976, 0.34567439556121826, 0.237142875790596], [0.8548288941383362, 0.08920498192310333, 0.0559660941362381]], [[0.37557509541511536, 0.3876899778842926, 0.23673489689826965], [0.8520498275756836, 0.08481550961732864, 0.06313470751047134]], [[0.20816871523857117, 0.26664337515830994, 0.5251878499984741], [0.4083556830883026, 0.35749176144599915, 0.23415257036685944]], [[0.41266658902168274, 0.36013251543045044, 0.22720086574554443], [0.8109310269355774, 0.09079883247613907, 0.09827010333538055]], [[0.3459884524345398, 0.35420113801956177, 0.29981040954589844], [0.8184145092964172, 0.11146415024995804, 0.07012134790420532]], [[0.30364853143692017, 0.37541985511779785, 0.320931613445282], [0.7792351841926575, 0.1317041516304016, 0.08906066417694092]], [[0.07497269660234451, 0.003931474406272173, 0.9210958480834961], [0.51134192943573, 0.3530804514884949, 0.13557764887809753]], [[0.25995689630508423, 0.2755582928657532, 0.4644847810268402], [0.7625242471694946, 0.09996314346790314, 0.13751256465911865]], [[0.1627640426158905, 0.3653290867805481, 0.4719068109989166], [0.7254395484924316, 0.15939129889011383, 0.11516912281513214]], [[0.18259315192699432, 0.3984191417694092, 0.4189876914024353], [0.7015930414199829, 0.17536699771881104, 0.12303995341062546]], [[0.02278839610517025, 0.0003928377409465611, 0.9768187999725342], [0.4356299638748169, 0.48484697937965393, 0.07952310144901276]], [[0.2333560734987259, 0.2716214656829834, 0.4950225055217743], [0.7470928430557251, 0.1136913076043129, 0.1392158716917038]], [[0.17072533071041107, 0.3377543091773987, 0.49152037501335144], [0.7588865160942078, 0.14068984985351562, 0.10042361915111542]], [[0.18394961953163147, 0.35111963748931885, 0.4649307429790497], [0.7369124889373779, 0.15957820415496826, 0.1035093292593956]], [[0.017854642122983932, 0.0004738576535601169, 0.9816715121269226], [0.5762695670127869, 0.34354838728904724, 0.0801820382475853]], [[0.26179277896881104, 0.15375876426696777, 0.584448516368866], [0.6701772809028625, 0.10252349823713303, 0.22729924321174622]], [[0.17003966867923737, 0.35320934653282166, 0.4767509400844574], [0.6959663033485413, 0.1540776789188385, 0.14995603263378143]], [[0.20182974636554718, 0.38114726543426514, 0.4170229136943817], [0.6741317510604858, 0.16661424934864044, 0.1592540144920349]], [[0.009639077819883823, 0.00021240267960820347, 0.9901485443115234], [0.5258949398994446, 0.4044134020805359, 0.0696917176246643]], [[0.18637055158615112, 0.26978155970573425, 0.5438478589057922], [0.5577474236488342, 0.1380607634782791, 0.3041918873786926]], [[0.1222287267446518, 0.4107249081134796, 0.4670463800430298], [0.5970460176467896, 0.20057658851146698, 0.20237743854522705]], [[0.15344513952732086, 0.40656304359436035, 0.4399918019771576], [0.6128219962120056, 0.20534709095954895, 0.18183095753192902]], [[0.009725834242999554, 0.0001926182594615966, 0.9900814890861511], [0.4756886065006256, 0.4660976231098175, 0.058213718235492706]], [[0.0006789100589230657, 6.784514425817179e-07, 0.999320387840271], [0.7198668122291565, 0.022221436724066734, 0.2579117715358734]], [[0.0010694259544834495, 1.706730017758673e-06, 0.9989288449287415], [0.3616439700126648, 0.0004524244286585599, 0.63790363073349]], [[0.01063454058021307, 0.00021638692123815417, 0.9891490340232849], [0.9235332608222961, 0.015422886237502098, 0.061043739318847656]], [[0.5755988359451294, 0.05502999946475029, 0.3693711459636688], [0.001132116187363863, 0.9988676309585571, 1.8206016250132961e-07]], [[0.02296922355890274, 0.08835745602846146, 0.8886733651161194], [0.3781391382217407, 0.5347729325294495, 0.08708786964416504]], [[0.013880736194550991, 0.028289534151554108, 0.9578297734260559], [0.27067628502845764, 0.08038129657506943, 0.6489424109458923]], [[0.09659967571496964, 0.05001305416226387, 0.8533872365951538], [0.1302659809589386, 0.027146922424435616, 0.8425870537757874]], [[0.15714362263679504, 0.00043957630987279117, 0.8424168229103088], [0.14829063415527344, 0.8517045974731445, 4.743259523820598e-06]], [[0.20863303542137146, 0.3436073064804077, 0.44775962829589844], [0.23020190000534058, 0.07236931473016739, 0.697428822517395]], [[0.41999098658561707, 0.0005006813444197178, 0.579508364200592], [0.03346642106771469, 0.9665336012840271, 5.6292964956128344e-08]], [[0.4139663577079773, 0.10557924956083298, 0.4804544150829315], [0.6196224689483643, 0.3097495138645172, 0.07062803208827972]], [[0.24886994063854218, 0.005864208564162254, 0.7452658414840698], [0.6629993915557861, 0.24438834190368652, 0.09261228144168854]], [[0.7493444681167603, 0.00021953490795567632, 0.2504359185695648], [0.02004794217646122, 0.9799520373344421, 3.231778400447638e-09]], [[0.5033435225486755, 0.08391667157411575, 0.4127398133277893], [0.6255223155021667, 0.22155356407165527, 0.15292412042617798]], [[0.27917301654815674, 0.00021459412528201938, 0.7206123471260071], [0.21152997016906738, 0.7884688973426819, 1.08609117432934e-06]], [[0.43441182374954224, 0.12376724183559418, 0.4418209195137024], [0.5522708296775818, 0.18790404498577118, 0.2598252296447754]], [[0.3717542290687561, 0.04274801164865494, 0.5854977369308472], [0.6026004552841187, 0.1876639872789383, 0.20973560214042664]], [[0.04125570133328438, 5.969932459493066e-08, 0.9587441682815552], [0.6981542110443115, 0.30164918303489685, 0.00019660282123368233]], [[0.2778140604496002, 0.0029999876860529184, 0.7191859483718872], [0.057541366666555405, 0.0008517777314409614, 0.941606879234314]], [[0.36158743500709534, 5.224777851253748e-05, 0.638360321521759], [0.06388518959283829, 1.2031488040520344e-05, 0.9361028075218201]], [[0.9999305009841919, 1.1473472113721073e-05, 5.8011388318846e-05], [0.021291246637701988, 0.978708803653717, 4.5461808349431775e-15]], [[0.9969242215156555, 0.0030750080477446318, 6.563964234373998e-07], [0.8915654420852661, 0.10837692022323608, 5.767208494944498e-05]], [[0.9429565072059631, 7.879608347138856e-06, 0.057035624980926514], [0.9736030697822571, 0.026296379044651985, 0.0001005540689220652]], [[0.03499145060777664, 3.923363328794949e-05, 0.9649693369865417], [0.9857536554336548, 4.2098317862837575e-06, 0.014242039062082767]], [[0.7940258383750916, 0.002020476618781686, 0.20395369827747345], [0.8371255993843079, 1.1701743574121792e-08, 0.16287443041801453]], [[0.6264420747756958, 9.798551764106378e-05, 0.37345999479293823], [0.3854474723339081, 1.808643617096095e-07, 0.6145522594451904]], [[0.5033251643180847, 0.0001330999657511711, 0.49654173851013184], [0.05420796945691109, 4.1088105717790313e-07, 0.9457916021347046]], [[0.9094443917274475, 0.029850253835320473, 0.060705315321683884], [0.3835753798484802, 0.6160765886306763, 0.0003480407758615911]], [[0.2550997734069824, 0.02674313634634018, 0.7181571125984192], [0.04517081379890442, 0.000489455065689981, 0.9543397426605225]], [[0.12851586937904358, 0.007223994471132755, 0.864260196685791], [0.024576418101787567, 0.00021036900579929352, 0.9752132892608643]], [[0.48230957984924316, 0.05363457277417183, 0.4640558660030365], [0.19509609043598175, 0.8020265102386475, 0.002877345774322748]], [[0.07672174274921417, 0.015153040178120136, 0.9081252217292786], [0.018469516187906265, 0.000381120276870206, 0.9811493158340454]], [[0.45349326729774475, 0.21279439330101013, 0.33371230959892273], [0.32497888803482056, 0.2490755319595337, 0.42594558000564575]], [[0.19099506735801697, 0.02142186276614666, 0.78758305311203], [0.03767285868525505, 0.0005586350453086197, 0.9617684483528137]], [[0.5804800391197205, 0.2347421497106552, 0.18477782607078552], [0.40462726354599, 0.24050262570381165, 0.35487014055252075]], [[0.1540500372648239, 0.0017327861860394478, 0.8442171812057495], [0.11760269850492477, 0.0024079694412648678, 0.8799893260002136]], [[0.6016896963119507, 0.32402029633522034, 0.07429000735282898], [0.4512283205986023, 0.24684007465839386, 0.3019316494464874]], [[0.5571608543395996, 0.00039519392885267735, 0.4424439072608948], [0.06850943714380264, 0.931490421295166, 6.523362827692836e-08]], [[0.23730482161045074, 0.7350624203681946, 0.02763277478516102], [0.09710609167814255, 0.07774019241333008, 0.825153648853302]], [[0.4671671688556671, 0.00014004365948494524, 0.5326927304267883], [0.10959690809249878, 0.8904030919075012, 4.7047045370618434e-08]], [[0.5258111357688904, 0.039772264659404755, 0.43441662192344666], [0.19792839884757996, 0.04574937745928764, 0.7563222050666809]], [[0.7920532822608948, 0.09471304714679718, 0.11323367804288864], [0.33304300904273987, 0.6622400283813477, 0.004717044532299042]], [[0.33285772800445557, 1.326290839642752e-05, 0.6671290397644043], [0.0021351538598537445, 6.376197347890411e-08, 0.9978647828102112]], [[0.9690176844596863, 2.0761683572345646e-07, 0.030982034280896187], [0.998307466506958, 0.00023833884915802628, 0.0014542078133672476]], [[0.9999938011169434, 3.8456082620541565e-06, 2.388762595728622e-06], [0.9966541528701782, 0.0033451037015765905, 6.820295084253303e-07]], [[0.8577687740325928, 0.14223125576972961, 1.7217612058306742e-10], [0.10633613169193268, 0.8936638236045837, 5.080547441083105e-11]], [[0.002476006280630827, 0.997523844242096, 7.846295346780607e-08], [0.08718699216842651, 2.484591421492155e-09, 0.9128130078315735]], [[0.007006230764091015, 0.9923183917999268, 0.0006754350033588707], [0.8447431921958923, 1.2275036453957e-07, 0.1552567034959793]], [[2.0440486991901707e-07, 0.9999997615814209, 5.0331842914395214e-14], [0.9996750354766846, 1.5947800875437679e-06, 0.0003233786264900118]], [[3.57376378490315e-10, 1.0, 1.8863117678526624e-17], [0.9955282807350159, 2.9526652724598534e-05, 0.0044422089122235775]], [[0.0004563929105643183, 0.9995436072349548, 5.5714841629139755e-09], [0.26826581358909607, 3.1221306926454417e-06, 0.7317310571670532]], [[0.14279185235500336, 0.8571463823318481, 6.174393638502806e-05], [0.9413716793060303, 0.02729424275457859, 0.03133410960435867]], [[0.0971892699599266, 2.437958528389572e-07, 0.9028104543685913], [0.9176467657089233, 0.08172767609357834, 0.0006255760090425611]], [[0.9321753978729248, 0.061466630548238754, 0.006357999052852392], [0.3887799084186554, 0.5725643634796143, 0.038655780255794525]], [[0.9642839431762695, 0.019886957481503487, 0.015829093754291534], [0.593859851360321, 0.28194111585617065, 0.12419905513525009]], [[0.9447594285011292, 0.03568704426288605, 0.019553417339920998], [0.46157434582710266, 0.2710683047771454, 0.26735734939575195]], [[0.916465163230896, 0.06538770347833633, 0.018147194758057594], [0.36806008219718933, 0.20894961059093475, 0.4229903817176819]], [[0.8739864230155945, 0.11850207298994064, 0.007511498406529427], [0.10309335589408875, 0.0019965011160820723, 0.8949102163314819]], [[0.7230547070503235, 0.27014580368995667, 0.0067994664423167706], [0.3405090868473053, 0.10953966528177261, 0.5499511957168579]], [[0.647520124912262, 0.351216584444046, 0.0012633117148652673], [0.00159219850320369, 0.9984075427055359, 2.9190570671744354e-07]], [[0.7809304594993591, 0.2095363289117813, 0.009533188305795193], [0.3583107888698578, 0.3295736312866211, 0.3121156394481659]], [[0.4707123041152954, 0.5288676619529724, 0.0004199959512334317], [0.00234520947560668, 0.9976546168327332, 2.0365166619740194e-07]], [[0.9261379837989807, 0.010990348644554615, 0.06287171691656113], [0.3693210482597351, 0.6140658259391785, 0.01661306992173195]], [[0.8936283588409424, 0.0001029684572131373, 0.10626867413520813], [0.7252020239830017, 0.25743746757507324, 0.01736050844192505]], [[0.9155122637748718, 0.00020668683282565325, 0.08428103476762772], [0.6676210165023804, 0.31592896580696106, 0.01644996553659439]], [[0.9255614876747131, 0.00022535037714987993, 0.07421325147151947], [0.6385279893875122, 0.3488047420978546, 0.012667262926697731]], [[0.18160900473594666, 2.6748749881733147e-09, 0.818390965461731], [0.8162646293640137, 0.00016871879051905125, 0.18356667459011078]], [[4.7457371692871675e-05, 9.484769300117317e-19, 0.9999525547027588], [0.9995222091674805, 0.00047716149128973484, 5.510880214387726e-07]], [[0.999819815158844, 0.00010655130608938634, 7.367688522208482e-05], [0.00013175698404666036, 0.9998682737350464, 2.4828745910620285e-17]], [[0.10096979141235352, 0.8990300893783569, 6.73291182806679e-08], [0.98466956615448, 0.015330062247812748, 3.4207016597065376e-07]], [[0.2139173150062561, 0.786072850227356, 9.816089004743844e-06], [0.9999765157699585, 8.892429903539778e-09, 2.3458738724002615e-05]], [[0.0024974262341856956, 0.9975021481513977, 5.188695126889797e-07], [0.9996932744979858, 7.701810318394564e-06, 0.00029905440169386566]], [[2.61087222952483e-07, 0.9999997615814209, 1.6016888878568614e-13], [0.9745868444442749, 0.025247735902667046, 0.0001654720981605351]], [[9.156826308753807e-06, 0.9999908208847046, 1.4404476960175328e-12], [0.9970595240592957, 0.0025490287225693464, 0.00039145685150288045]], [[0.9799647331237793, 0.018756777048110962, 0.001278460375033319], [0.18267039954662323, 0.8162571787834167, 0.0010724039748311043]], [[0.9531294703483582, 0.03919249400496483, 0.007678033784031868], [0.03846064954996109, 0.9599611759185791, 0.0015781406546011567]], [[0.2987200617790222, 0.6902402639389038, 0.011039641685783863], [0.09905197471380234, 0.8754045367240906, 0.02554345317184925]], [[0.5947720408439636, 0.006114007905125618, 0.3991139531135559], [0.49145185947418213, 0.00038350248360075057, 0.508164644241333]], [[0.14154766499996185, 0.848133385181427, 0.010319041088223457], [0.5201793909072876, 0.4261993169784546, 0.0536213144659996]], [[0.6679884195327759, 0.004080277401953936, 0.32793131470680237], [0.5494632124900818, 0.0001991494937101379, 0.45033758878707886]], [[0.7159773111343384, 0.017766354605555534, 0.26625630259513855], [0.15069833397865295, 0.8169670104980469, 0.03233462944626808]], [[0.36106395721435547, 0.6061659455299377, 0.032770123332738876], [0.13905146718025208, 0.7936609387397766, 0.0672876238822937]], [[0.5298477411270142, 0.2525371015071869, 0.21761518716812134], [0.7011649012565613, 0.08355233073234558, 0.21528272330760956]], [[0.5836142301559448, 0.2142402082681656, 0.2021455317735672], [0.776103675365448, 0.04661823809146881, 0.17727810144424438]], [[0.5520534515380859, 0.005961895454674959, 0.4419846832752228], [0.35892969369888306, 0.5635522603988647, 0.07751800864934921]], [[0.5305156111717224, 0.017479905858635902, 0.4520045220851898], [0.2981509268283844, 0.6191088557243347, 0.08274023234844208]], [[0.6184791922569275, 0.13704624772071838, 0.24447451531887054], [0.7561907172203064, 0.0070370943285524845, 0.23677223920822144]], [[0.10481555014848709, 5.421615242084954e-06, 0.895179033279419], [0.677037239074707, 0.0013162249233573675, 0.3216465711593628]], [[0.8562770485877991, 0.017113270238041878, 0.1266096979379654], [0.7070649862289429, 2.4480852516717277e-05, 0.29291054606437683]], [[0.9107787013053894, 0.014526363462209702, 0.07469495385885239], [0.7692631483078003, 1.0348649084335193e-05, 0.2307264506816864]], [[0.3324155807495117, 3.698157891030007e-10, 0.6675844192504883], [0.00031947120442055166, 1.389953537873521e-15, 0.9996805191040039]], [[0.06451448798179626, 4.870529760753195e-12, 0.9354854822158813], [0.004143409430980682, 2.857140522435908e-13, 0.9958565831184387]], [[0.9615996479988098, 0.015312425792217255, 0.023087987676262856], [0.9774762392044067, 0.022522402927279472, 1.3627222870127298e-06]], [[0.0001170052564702928, 1.6445479786852957e-06, 0.999881386756897], [0.6764549612998962, 0.0030713456217199564, 0.32047370076179504]], [[0.0001331287930952385, 0.000172205560375005, 0.9996947050094604], [0.9985625147819519, 0.0003339488466735929, 0.001103617250919342]], [[2.2277781841495425e-09, 8.292718121083453e-07, 0.9999991655349731], [1.0, 2.564330081611388e-09, 2.1677070805026233e-08]], [[1.337509569765416e-08, 1.0326743904442992e-08, 1.0], [0.97682785987854, 0.023172147572040558, 1.7529720730546927e-10]], [[9.070695341506507e-06, 5.13720697925546e-11, 0.9999909400939941], [0.8422931432723999, 0.1577068418264389, 1.8261930634366763e-08]], [[0.9790664315223694, 0.013257832266390324, 0.00767565006390214], [0.13078808784484863, 0.8692104816436768, 1.4411525626201183e-06]], [[0.9552149772644043, 0.04477150738239288, 1.3592579307442065e-05], [0.9433116316795349, 0.05476951599121094, 0.001918907044455409]], [[0.9766412377357483, 0.023356391116976738, 2.2862145669932943e-06], [0.9610782265663147, 0.038539156317710876, 0.0003826514002867043]], [[0.987046480178833, 0.012952066957950592, 1.3554916904467973e-06], [0.9844224452972412, 0.01541893556714058, 0.00015869348135311157]], [[0.9918432831764221, 0.008153779432177544, 2.898259936046088e-06], [0.9942806959152222, 0.0055083781480789185, 0.00021094537805765867]], [[0.9935466647148132, 0.00644502229988575, 8.266106306109577e-06], [0.9955306649208069, 0.00415056711062789, 0.00031878979643806815]], [[0.9953762292861938, 0.004592998418956995, 3.075331915169954e-05], [0.9943230152130127, 0.005125017836689949, 0.0005520159029401839]], [[0.9962258338928223, 0.0036647943779826164, 0.00010937403567368165], [0.9908391833305359, 0.008032577112317085, 0.0011282381601631641]], [[0.996095597743988, 0.003553222632035613, 0.00035120508982799947], [0.9839605689048767, 0.01296465378254652, 0.0030747915152460337]], [[0.9946505427360535, 0.004316303879022598, 0.0010330608347430825], [0.9735855460166931, 0.018742956221103668, 0.007671479135751724]], [[0.9909233450889587, 0.006605947390198708, 0.002470717066898942], [0.9587599635124207, 0.024162421002984047, 0.017077552154660225]], [[0.9849963188171387, 0.00975753366947174, 0.0052461037412285805], [0.9310362935066223, 0.0332910418510437, 0.035672739148139954]], [[0.9743652939796448, 0.014434578828513622, 0.011200034990906715], [0.8974056839942932, 0.04494931176304817, 0.057645030319690704]], [[0.9575055837631226, 0.0198492631316185, 0.022645141929388046], [0.8643565773963928, 0.06186297535896301, 0.07378047704696655]], [[0.8104128837585449, 0.09092181921005249, 0.09866537898778915], [0.09763608127832413, 0.0006520153838209808, 0.9017119407653809]], [[0.8531297445297241, 0.03220681846141815, 0.1146635040640831], [0.7133384943008423, 0.16734422743320465, 0.11931729316711426]], [[0.8658153414726257, 0.00018791337788570672, 0.1339966356754303], [0.006352725904434919, 5.856979790053174e-09, 0.9936472773551941]], [[0.30840933322906494, 0.6915363669395447, 5.433969636214897e-05], [0.05460479110479355, 0.9453952312469482, 1.9230908640706368e-13]], [[0.0005255202995613217, 0.9993283748626709, 0.00014622211165260524], [0.028700033202767372, 0.9713000059127808, 3.3090834516968926e-09]], [[0.000314692675601691, 0.20402252674102783, 0.7956628203392029], [1.8496653098054594e-09, 1.0, 1.8493045983447587e-10]], [[0.00025641516549512744, 0.7107325792312622, 0.2890110909938812], [9.245701314877222e-16, 1.0, 5.745102079310371e-16]], [[0.10720977187156677, 0.1474892497062683, 0.7453010082244873], [6.094738751091225e-16, 1.0, 1.5256964969016535e-15]], [[0.083207868039608, 0.0011289840331301093, 0.9156631231307983], [5.473592246119097e-09, 1.0, 1.1596131981421996e-15]], [[0.5335408449172974, 0.0038763796910643578, 0.4625827372074127], [0.003140197368338704, 0.9968597888946533, 1.1049480774794063e-11]], [[0.21498163044452667, 0.784981906414032, 3.643777745310217e-05], [0.8067734241485596, 0.19322586059570312, 7.458423851858242e-07]], [[0.960252583026886, 3.3480118872830644e-05, 0.039714012295007706], [0.8861306309700012, 0.11344529688358307, 0.00042396652861498296]], [[0.9780157208442688, 0.0002554764796514064, 0.02172880619764328], [0.9543118476867676, 0.04491936415433884, 0.0007688342593610287]], [[0.9483586549758911, 0.0005960629205219448, 0.05104532465338707], [0.9874841570854187, 0.010350422002375126, 0.002165453741326928]], [[0.7760593891143799, 0.000661380123347044, 0.22327925264835358], [0.9914006590843201, 0.006037984509021044, 0.0025612825993448496]], [[0.4799249768257141, 0.00046306318836286664, 0.5196119546890259], [0.9903637766838074, 0.007905294187366962, 0.001730944262817502]], [[0.6784429550170898, 0.30522090196609497, 0.016336118802428246], [0.9112510085105896, 0.08198724687099457, 0.0067617204040288925]], [[0.05580765753984451, 0.00019048820831812918, 0.9440018534660339], [0.9750374555587769, 0.020387709140777588, 0.0045748488046228886]], [[0.3834116458892822, 0.43467289209365845, 0.1819155067205429], [0.7145559191703796, 0.27440884709358215, 0.011035165749490261]], [[0.17615953087806702, 0.203292578458786, 0.6205478310585022], [0.5524060726165771, 0.4028736352920532, 0.04472026601433754]], [[0.14692556858062744, 0.039245039224624634, 0.8138293623924255], [0.13228026032447815, 0.8676560521125793, 6.367411697283387e-05]], [[0.04296981543302536, 0.854225218296051, 0.1028050109744072], [0.242983877658844, 0.7144333720207214, 0.042582739144563675]], [[0.04338354989886284, 0.01155045349150896, 0.945065975189209], [0.4701148569583893, 0.21639083325862885, 0.31349435448646545]], [[0.0790444165468216, 0.6620551943778992, 0.25890037417411804], [0.12720812857151031, 0.31757232546806335, 0.5552195310592651]], [[0.06801916658878326, 0.47429463267326355, 0.457686185836792], [0.29319101572036743, 0.642560601234436, 0.06424842774868011]], [[0.11945022642612457, 0.7097132205963135, 0.17083650827407837], [0.10809691250324249, 0.5153474807739258, 0.37655559182167053]], [[0.00014842038217466325, 0.9995644688606262, 0.00028699118411168456], [3.757354716071859e-05, 0.9999624490737915, 3.4742640764307e-08]]]; // action probs
        var action =  [[0, 2], [2, 1], [0, 0], [1, 1], [0, 0], [0, 0], [0, 2], [0, 0], [0, 0], [0, 2], [0, 0], [0, 0], [0, 0], [0, 0], [1, 0], [0, 2], [1, 0], [0, 0], [1, 0], [2, 2], [1, 1], [1, 0], [1, 2], [2, 0], [0, 2], [2, 2], [1, 0], [2, 0], [2, 0], [1, 0], [0, 0], [2, 0], [2, 0], [0, 2], [2, 0], [0, 0], [1, 0], [0, 0], [2, 0], [2, 0], [2, 0], [2, 2], [2, 2], [0, 1], [2, 0], [2, 0], [2, 2], [2, 1], [0, 2], [2, 1], [2, 0], [2, 2], [0, 1], [2, 2], [2, 1], [0, 0], [1, 0], [2, 0], [2, 0], [2, 2], [0, 1], [0, 0], [0, 0], [2, 0], [0, 0], [0, 0], [0, 2], [0, 1], [2, 0], [2, 2], [0, 1], [2, 2], [2, 1], [2, 2], [1, 1], [2, 2], [1, 2], [2, 1], [1, 2], [0, 1], [2, 2], [0, 1], [2, 2], [0, 0], [0, 0], [0, 1], [1, 0], [1, 0], [1, 0], [1, 0], [1, 2], [1, 0], [2, 0], [0, 0], [0, 0], [0, 0], [0, 1], [0, 2], [0, 2], [0, 1], [0, 2], [1, 1], [1, 1], [0, 0], [0, 0], [0, 0], [0, 2], [2, 0], [0, 1], [1, 0], [1, 0], [1, 0], [1, 0], [1, 0], [0, 0], [0, 1], [1, 1], [2, 2], [1, 1], [0, 2], [2, 0], [1, 1], [0, 0], [1, 2], [0, 0], [2, 1], [1, 0], [2, 0], [0, 0], [0, 0], [0, 2], [2, 2], [0, 0], [2, 2], [2, 0], [2, 0], [2, 0], [2, 0], [0, 1], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 1], [0, 2], [0, 0], [0, 2], [0, 1], [1, 1], [2, 1], [1, 1], [0, 1], [2, 1], [2, 1], [1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2, 0], [1, 0], [2, 0], [0, 0], [1, 2], [2, 1], [1, 1], [2, 0], [1, 2], [2, 1], [0, 2], [1, 1]];
        var action_names = [['no-op', 'left', 'right'], ['no-op', 'up', 'down']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Transformer") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step;
        visualizeAttentionScores(y_attention_weights[step], top_n);
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>