<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
        min-width: 1737px;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row nowrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="location.href='../index.html'">Back</button>
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MortarMayhem-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 200001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>arena_size</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>allowed_commands</b>: 9<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_count</b>: [10]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_duration</b>: [6]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_delay</b>: [18]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_failure</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_success</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_episode_success</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 200001<br><b>reward_normalization</b>: 0<br><b>positional_endocing</b>: False<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: -1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 512<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_layers</b>: 1<br><b>obs_decoder</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>attach_to</b>: memory<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>detach_gradient</b>: False<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 30000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 1000<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <br>
      <center>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Transformer</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Top Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_200001_67.webm', '', 'videos/video_seed_200001_68.webm', '', 'videos/video_seed_200001_69.webm', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.335846483707428], [0.33848732709884644], [0.34052860736846924], [0.3425283133983612], [0.34548184275627136], [0.34635069966316223], [0.34894779324531555], [0.3499689996242523], [0.35199102759361267], [0.3546203076839447], [0.3553468883037567], [0.35668453574180603], [0.36017510294914246], [0.3620053827762604], [0.36404949426651], [0.367138147354126], [0.3728197515010834], [0.3757146894931793], [0.37771204113960266], [0.37852025032043457], [0.3811526596546173], [0.3841763138771057], [0.386082261800766], [0.38926830887794495], [0.38869547843933105], [0.3916012942790985], [0.3938097655773163], [0.39802882075309753], [0.39972734451293945], [0.40260589122772217], [0.40428781509399414], [0.40786221623420715], [0.4068896472454071], [0.40908700227737427], [0.41023683547973633], [0.4139491319656372], [0.41427066922187805], [0.41557958722114563], [0.41639453172683716], [0.41814079880714417], [0.4223751127719879], [0.4241878390312195], [0.42768803238868713], [0.4291136562824249], [0.4342925250530243], [0.435124009847641], [0.4364166855812073], [0.4372333288192749], [0.4406740367412567], [0.4424723982810974], [0.4449663460254669], [0.44817331433296204], [0.44886788725852966], [0.45121291279792786], [0.4533558189868927], [0.4550744593143463], [0.4567451775074005], [0.45818284153938293], [0.3595031797885895], [0.36050674319267273], [0.3633933961391449], [0.36476632952690125], [0.3712656795978546], [0.3706941306591034], [0.37441059947013855], [0.3782537579536438], [0.3770228922367096], [0.37836840748786926], [0.3811158239841461], [0.38263094425201416], [0.38567352294921875], [0.38782402873039246], [0.38921159505844116], [0.3905719816684723], [0.39351990818977356], [0.39803919196128845], [0.3996545076370239], [0.3998991847038269], [0.40178367495536804], [0.40271666646003723], [0.4047842025756836], [0.40623247623443604], [0.30640214681625366], [0.3098296523094177], [0.3125818967819214], [0.31137511134147644], [0.31475311517715454], [0.31772303581237793], [0.3167259693145752], [0.3191641569137573], [0.3192487955093384], [0.32072943449020386], [0.32077258825302124], [0.32342734932899475], [0.3269103765487671], [0.3281093239784241], [0.33171018958091736], [0.3318379819393158], [0.3329218029975891], [0.33428841829299927], [0.33624500036239624], [0.339213490486145], [0.341739684343338], [0.34331536293029785], [0.34419283270835876], [0.34439200162887573], [0.24593646824359894], [0.2457154542207718], [0.24870236217975616], [0.2527896761894226], [0.2534997761249542], [0.25078558921813965], [0.25458064675331116], [0.25608837604522705], [0.2542857229709625], [0.2593158483505249], [0.259217768907547], [0.2588980793952942], [0.2588339149951935], [0.26004844903945923], [0.26247212290763855], [0.26473405957221985], [0.2677709460258484], [0.267866313457489], [0.2701505124568939], [0.27028483152389526], [0.27193793654441833], [0.2714110016822815], [0.2731199860572815], [0.2716425359249115], [0.17581765353679657], [0.17359498143196106], [0.17359796166419983], [0.1752014458179474], [0.18208229541778564], [0.17809124290943146], [0.17688557505607605], [0.18504548072814941], [0.18561232089996338], [0.18449723720550537], [0.1841810941696167], [0.1886780560016632], [0.19258317351341248], [0.1921747624874115], [0.1915242075920105], [0.19225330650806427], [0.19353339076042175], [0.19039249420166016], [0.19331970810890198], [0.19245439767837524], [0.19362425804138184], [0.19781902432441711], [0.1946331262588501], [0.19589674472808838], [0.09456834197044373], [0.09503105282783508], [0.09516536444425583], [0.09460365027189255], [0.09696350246667862], [0.09578637778759003], [0.10599715262651443], [0.093690887093544], [0.10670699924230576], [0.11115230619907379], [0.1128200888633728], [0.1120174378156662], [0.11121145635843277], [0.11085110902786255], [0.10552290081977844], [0.10807596147060394], [0.10593590885400772], [0.10784101486206055], [0.10740183293819427], [0.10737378895282745], [0.10872691869735718], [0.10725341737270355], [0.10632987320423126], [0.11290369182825089], [0.01283930242061615], [0.013199776411056519], [0.013187795877456665], [0.011723078787326813], [0.012551084160804749], [0.011524282395839691], [0.013834759593009949], [0.01444946974515915], [0.018651500344276428], [0.018137529492378235], [0.01831352710723877], [0.017302125692367554], [0.018266521394252777], [0.019053295254707336], [0.018955029547214508], [0.02050657570362091], [0.017715558409690857], [0.017362885177135468], [0.0192238911986351], [0.015854880213737488], [0.016086116433143616], [0.015229679644107819], [0.013851597905158997], [0.013397246599197388], [0.017988011240959167]];
        var y_entropy = [[0.7379072904586792, 0.7823086977005005], [0.9332041144371033, 0.7399329543113708], [0.9742950201034546, 0.771149754524231], [0.6181448101997375, 0.09678355604410172], [0.527397871017456, 0.4012201428413391], [0.4227478504180908, 0.16059276461601257], [0.5436695218086243, 0.11690321564674377], [0.09707225859165192, 0.0767015665769577], [0.269359290599823, 0.16765634715557098], [0.17358076572418213, 0.20934034883975983], [0.19406437873840332, 0.2306947261095047], [0.422023206949234, 0.52919602394104], [0.7436139583587646, 0.8854116201400757], [0.7098268270492554, 0.9038238525390625], [0.7138844728469849, 0.9167166352272034], [0.5505079627037048, 1.0677025318145752], [0.8577931523323059, 0.7586894035339355], [0.9224413633346558, 0.742636501789093], [0.9334112405776978, 0.745741605758667], [0.3569987416267395, 0.7736271023750305], [0.7827518582344055, 1.085618257522583], [0.7280933856964111, 1.083632469177246], [0.7217487692832947, 1.0869193077087402], [0.181395024061203, 0.6644871234893799], [0.9671754837036133, 0.9694002866744995], [1.0060405731201172, 0.9249638319015503], [1.0073808431625366, 0.919999361038208], [0.11844107508659363, 0.4663436710834503], [0.7852292060852051, 1.0955231189727783], [0.7438905835151672, 1.0920504331588745], [0.7459935545921326, 1.092467188835144], [0.09826202690601349, 0.5814962983131409], [0.9604604840278625, 0.9401392936706543], [0.9518486261367798, 0.9082748293876648], [0.9519374966621399, 0.90636146068573], [0.09180744737386703, 0.4955422878265381], [0.9802548885345459, 0.9925453662872314], [1.0524933338165283, 0.9305486679077148], [1.055809736251831, 0.9217280745506287], [0.08577549457550049, 0.5038903951644897], [0.011738508008420467, 0.06504690647125244], [0.17715483903884888, 0.0013448863755911589], [0.644619882106781, 0.0008876971551217139], [0.2933126986026764, 1.6242040146607906e-05], [0.16459530591964722, 0.0001809976965887472], [0.7423381805419922, 0.08656928688287735], [1.0072753429412842, 0.6944908499717712], [0.39295893907546997, 0.6150642037391663], [0.8294742107391357, 0.570257306098938], [0.8244802355766296, 0.5351877808570862], [0.8055990934371948, 0.5352996587753296], [0.7244315147399902, 0.5954696536064148], [0.6861501336097717, 0.7074412107467651], [0.7147229909896851, 0.7079009413719177], [0.686854898929596, 0.6835289001464844], [0.6864153146743774, 0.6740278601646423], [0.6840201020240784, 0.6734455227851868], [0.6860021948814392, 0.6802000403404236], [0.10579600185155869, 0.3462557792663574], [0.13970239460468292, 0.6824153065681458], [0.08728499710559845, 0.3607897162437439], [0.20143920183181763, 0.235566183924675], [0.9816961288452148, 0.0233728289604187], [0.7971272468566895, 0.001894547138363123], [0.6636014580726624, 0.1164829283952713], [0.2740975320339203, 0.706243097782135], [0.9969449043273926, 0.20036447048187256], [0.27983513474464417, 0.7162004709243774], [0.956592321395874, 0.17615139484405518], [0.047163885086774826, 0.25919684767723083], [0.9531770944595337, 0.020583409816026688], [0.9687542915344238, 0.8040670156478882], [0.7788721323013306, 0.48606017231941223], [0.33161699771881104, 0.46385204792022705], [0.9742828607559204, 0.2949908971786499], [0.8301939964294434, 0.02846173569560051], [0.5741614103317261, 0.8829954862594604], [0.6946671009063721, 0.21138900518417358], [0.6679600477218628, 0.15471550822257996], [0.560651421546936, 0.33620789647102356], [0.29668188095092773, 0.8336654901504517], [0.5794987678527832, 0.23151075839996338], [0.6574283838272095, 0.03277461603283882], [0.2949056625366211, 0.6780781149864197], [0.6644890904426575, 0.009592916816473007], [0.5270615220069885, 0.3103737533092499], [0.017987271770834923, 0.1968449205160141], [0.5873595476150513, 0.15147417783737183], [0.0012157197343185544, 0.3662460744380951], [5.062299169367179e-05, 0.47443056106567383], [1.4090078366280068e-06, 0.11660730838775635], [0.006125088781118393, 0.019641876220703125], [0.3967043459415436, 0.09902417659759521], [0.8447610139846802, 0.1520974040031433], [0.9835637807846069, 0.6950321793556213], [1.0498011112213135, 0.08556213974952698], [0.6840268969535828, 0.5491923093795776], [0.9085230827331543, 0.22914162278175354], [0.20688864588737488, 0.2906686067581177], [0.9596849679946899, 0.1797524243593216], [0.18027397990226746, 0.04275384545326233], [0.9304304122924805, 0.057004597038030624], [0.2765485942363739, 0.029455747455358505], [0.9698644876480103, 0.04698660224676132], [0.2912966012954712, 0.02867182530462742], [1.0386830568313599, 0.04872291162610054], [0.7602592706680298, 0.0023959637619554996], [0.7210663557052612, 0.010389902628958225], [0.12385314702987671, 0.0015238679479807615], [0.0004383223131299019, 0.00022743061708752066], [7.332753284572391e-07, 0.012333293445408344], [6.997702683975149e-08, 0.003697460750117898], [4.378099987580042e-13, 0.0009805458830669522], [1.8720942534855567e-05, 0.106025829911232], [0.4208603799343109, 0.6883925199508667], [0.7378215193748474, 0.6684314608573914], [0.013826537877321243, 0.25468316674232483], [0.8138027191162109, 0.8457253575325012], [0.20561297237873077, 0.6006422638893127], [0.3993232250213623, 0.4370691180229187], [0.4452635645866394, 0.6735252737998962], [1.0408294200897217, 0.7790110111236572], [0.03932204842567444, 0.42230039834976196], [0.8569153547286987, 0.8394262790679932], [0.6520329117774963, 0.7368139624595642], [1.0015971660614014, 0.8073862791061401], [0.021771619096398354, 0.3635665476322174], [0.8047688603401184, 0.723443329334259], [0.02766302600502968, 0.32604217529296875], [0.801147997379303, 0.6773244142532349], [0.2241939902305603, 0.39105141162872314], [0.6905932426452637, 0.6097737550735474], [0.15446309745311737, 0.561861515045166], [0.25840309262275696, 0.0016535730101168156], [0.1446426808834076, 0.0006282767280936241], [0.12114617973566055, 0.23323194682598114], [0.19755996763706207, 0.029958320781588554], [0.9457734823226929, 0.1819918155670166], [0.4284464120864868, 0.6904101371765137], [0.40844911336898804, 0.6268132925033569], [0.7941380739212036, 0.29761773347854614], [0.9080625772476196, 0.4922008514404297], [0.9407726526260376, 0.5046944618225098], [1.0199671983718872, 0.6293104887008667], [0.6949111819267273, 0.825433075428009], [0.9791833162307739, 0.6561174392700195], [0.8592796921730042, 0.6717512607574463], [0.8908966779708862, 0.456441730260849], [1.033696174621582, 0.6542964577674866], [1.0137859582901, 0.6820345520973206], [1.0571073293685913, 0.9256201982498169], [0.7496368288993835, 0.8132345676422119], [1.0125813484191895, 0.7024863958358765], [1.0235180854797363, 0.6821725964546204], [0.717380166053772, 0.08197645843029022], [0.17523229122161865, 0.683832585811615], [0.0955440104007721, 0.17490115761756897], [0.6935715675354004, 0.061394259333610535], [0.0001273938687518239, 0.003949415870010853], [0.0005096591776236892, 0.17618414759635925], [4.277973744137853e-07, 0.5999677777290344], [0.00018121555331163108, 0.5349632501602173], [0.37640973925590515, 0.171196848154068], [0.33376413583755493, 0.16560916602611542], [0.3075651228427887, 0.1701570451259613], [0.3011833727359772, 0.23073631525039673], [0.31763574481010437, 0.2977599501609802], [0.33586809039115906, 0.37992215156555176], [0.7987416982650757, 0.5321557521820068], [0.4785713255405426, 0.49992936849594116], [0.9771755933761597, 0.6145542860031128], [0.235112264752388, 0.5567965507507324], [0.8808976411819458, 0.7596638202667236], [0.4933781325817108, 0.601643443107605], [1.0267622470855713, 0.6560940742492676], [0.7672569155693054, 0.7733051776885986], [0.8076174259185791, 0.7466937303543091], [0.9872158765792847, 0.6213873028755188], [0.7705844640731812, 0.03888928145170212], [0.00012286403216421604, 0.0010964225511997938], [1.3267778740555514e-05, 0.15641869604587555], [0.9087496399879456, 0.027560345828533173], [8.135499228956178e-05, 0.055058933794498444], [0.02636703848838806, 0.0003111059486400336], [1.1891959729837254e-05, 7.366501813521609e-05], [0.043511223047971725, 0.0013800614979118109], [0.035304538905620575, 0.0956786498427391], [4.827504085369583e-07, 0.0049424804747104645], [1.6214240531553514e-05, 0.23746797442436218], [3.035582381016866e-07, 0.015124489553272724], [0.602846622467041, 0.248557448387146], [0.023443354293704033, 3.878412826452404e-07], [0.6557432413101196, 0.007212847005575895], [0.002414379734545946, 1.3109645813358384e-08], [8.488825642416487e-08, 0.005316772498190403], [4.331068481633338e-08, 2.7117599529447034e-05], [0.0010573400650173426, 4.165930931776529e-06], [1.5166475009209535e-07, 0.018355904147028923], [2.5209062641806668e-06, 0.00027539863367564976], [0.07014481723308563, 0.018229080364108086], [1.9657231860037427e-06, 3.4765780583256856e-05], [0.059879906475543976, 0.0006578643806278706], [5.055062138126232e-05, 5.112425469633308e-07]];
        var y_attention_weights = [];
        var y_action = [[[0.05590777099132538, 0.7156962752342224, 0.22839593887329102], [0.6732043027877808, 0.2703261077404022, 0.0564696304500103]], [[0.10823541134595871, 0.5564969778060913, 0.3352675437927246], [0.654907763004303, 0.31773972511291504, 0.027352508157491684]], [[0.14231082797050476, 0.5403825044631958, 0.3173066973686218], [0.604180634021759, 0.3683148920536041, 0.027504481375217438]], [[0.8098623156547546, 0.09246820956468582, 0.09766948223114014], [0.015547381713986397, 0.9820885062217712, 0.002364051528275013]], [[0.0142391761764884, 0.16968587040901184, 0.8160749077796936], [0.09657097607851028, 0.8865912556648254, 0.01683776266872883]], [[0.021517302840948105, 0.09820038080215454, 0.8802822828292847], [0.028853772208094597, 0.966424822807312, 0.00472139660269022]], [[0.033818185329437256, 0.13783006370067596, 0.8283517360687256], [0.01895976811647415, 0.9775896668434143, 0.003450594376772642]], [[0.9825442433357239, 0.013685839250683784, 0.0037698529195040464], [0.010690929368138313, 0.9867923259735107, 0.002516754437237978]], [[0.005154667887836695, 0.06383989751338959, 0.9310054779052734], [0.03670273721218109, 0.9619293808937073, 0.0013679199619218707]], [[0.009162524715065956, 0.026320554316043854, 0.9645168781280518], [0.050992608070373535, 0.9479990005493164, 0.0010084348032251]], [[0.01097465492784977, 0.02977645955979824, 0.9592488408088684], [0.058621518313884735, 0.9404235482215881, 0.000954904593527317]], [[0.8691874742507935, 0.12129894644021988, 0.009513655677437782], [0.12720170617103577, 0.8373873233795166, 0.03541096672415733]], [[0.1273389607667923, 0.12715142965316772, 0.7455095648765564], [0.3418838679790497, 0.5783089995384216, 0.07980714738368988]], [[0.14913533627986908, 0.0906466394662857, 0.76021808385849], [0.3376481235027313, 0.5717377066612244, 0.0906141996383667]], [[0.1471777707338333, 0.09409104287624359, 0.7587311863899231], [0.340194433927536, 0.5627553462982178, 0.09705022722482681]], [[0.11854466795921326, 0.8334110975265503, 0.04804420471191406], [0.2726105749607086, 0.4533357322216034, 0.2740536630153656]], [[0.09649650007486343, 0.645426869392395, 0.25807663798332214], [0.7261596322059631, 0.18622997403144836, 0.08761036396026611]], [[0.11527813225984573, 0.587055504322052, 0.29766637086868286], [0.7264584898948669, 0.20324422419071198, 0.0702972486615181]], [[0.1198481097817421, 0.5769507884979248, 0.30320116877555847], [0.7233607172966003, 0.20708994567394257, 0.06954935938119888]], [[0.04814886301755905, 0.9124757647514343, 0.039375364780426025], [0.19543927907943726, 0.7156663537025452, 0.08889438211917877]], [[0.1707824170589447, 0.11057014018297195, 0.7186474800109863], [0.4103209376335144, 0.289651483297348, 0.3000275790691376]], [[0.16608719527721405, 0.08678233623504639, 0.7471305131912231], [0.4162592589855194, 0.2953585088253021, 0.28838223218917847]], [[0.16623304784297943, 0.08376067131757736, 0.7500061988830566], [0.4065183699131012, 0.2944796681404114, 0.2990019917488098]], [[0.018297361209988594, 0.9636412858963013, 0.018061283975839615], [0.1355312317609787, 0.78397136926651, 0.0804973840713501]], [[0.1401788741350174, 0.5501732230186462, 0.3096478581428528], [0.5778790712356567, 0.24064020812511444, 0.1814807951450348]], [[0.1569286584854126, 0.49501335620880127, 0.3480580449104309], [0.6152949333190918, 0.23147784173488617, 0.1532272845506668]], [[0.1581195443868637, 0.49388521909713745, 0.34799522161483765], [0.619977593421936, 0.22760479152202606, 0.1524176001548767]], [[0.01044694148004055, 0.9785610437393188, 0.010992041788995266], [0.07933162897825241, 0.8724280595779419, 0.04824023321270943]], [[0.19042609632015228, 0.09782081842422485, 0.7117530703544617], [0.3566352128982544, 0.2970956265926361, 0.3462691307067871]], [[0.18660858273506165, 0.08052335679531097, 0.7328680157661438], [0.38800203800201416, 0.30579379200935364, 0.3062041401863098]], [[0.18780487775802612, 0.08073712140321732, 0.7314579486846924], [0.3861100375652313, 0.3041691482067108, 0.30972084403038025]], [[0.008461905643343925, 0.98292475938797, 0.008613361977040768], [0.10389406234025955, 0.8251798152923584, 0.07092607021331787]], [[0.11494190245866776, 0.37699955701828003, 0.508058488368988], [0.572226881980896, 0.30385512113571167, 0.12391795963048935]], [[0.11897506564855576, 0.33877646923065186, 0.5422484874725342], [0.5953430533409119, 0.2979715168476105, 0.10668544471263885]], [[0.11900803446769714, 0.3388592004776001, 0.5421326756477356], [0.5973449349403381, 0.2964754104614258, 0.10617966204881668]], [[0.007446836214512587, 0.9842685461044312, 0.008284625597298145], [0.09315253049135208, 0.8595380187034607, 0.04730944335460663]], [[0.1596221625804901, 0.5508216023445129, 0.2895561754703522], [0.5342335104942322, 0.3024490475654602, 0.1633175164461136]], [[0.19865702092647552, 0.42510008811950684, 0.37624287605285645], [0.5942158699035645, 0.27474498748779297, 0.13103912770748138]], [[0.2030160129070282, 0.4201034605503082, 0.3768805265426636], [0.6014995574951172, 0.2716123163700104, 0.12688812613487244]], [[0.006956263445317745, 0.9855092167854309, 0.007534551899880171], [0.09106945246458054, 0.8570629954338074, 0.0518675334751606]], [[0.0008024778217077255, 0.9985750913619995, 0.0006224593380466104], [0.009229697287082672, 0.989055871963501, 0.0017144453013315797]], [[0.040864091366529465, 0.9583353996276855, 0.0008004400879144669], [9.820298873819411e-05, 0.9998719692230225, 2.9831917345291004e-05]], [[0.6558831930160522, 9.718936053104699e-05, 0.34401965141296387], [2.798860259645153e-05, 0.9999198913574219, 5.2138617320451885e-05]], [[0.08600695431232452, 8.922798770072404e-06, 0.9139840602874756], [1.0092229558722465e-06, 0.999998927116394, 8.309375942872066e-08]], [[0.03895053267478943, 4.1437953512968306e-08, 0.9610493779182434], [1.4910926438460592e-05, 0.9999850988388062, 1.362116419656445e-09]], [[0.5473220348358154, 0.011523635126650333, 0.4411543309688568], [0.017105156555771828, 0.9828934073448181, 1.4443158988797222e-06]], [[0.539125919342041, 0.2532423138618469, 0.20763172209262848], [0.6208099126815796, 0.37319135665893555, 0.00599873811006546]], [[0.132077157497406, 0.8676289319992065, 0.00029394798912107944], [0.7705914974212646, 0.20558229088783264, 0.02382628805935383]], [[0.5517590045928955, 0.04301287606358528, 0.4052281677722931], [0.7563942670822144, 0.24085773527622223, 0.002748050494119525]], [[0.5266766548156738, 0.03819778189063072, 0.4351254999637604], [0.7887532114982605, 0.20730872452259064, 0.0039380681701004505]], [[0.5214930176734924, 0.030464541167020798, 0.4480424225330353], [0.7886104583740234, 0.20747126638889313, 0.0039182198233902454]], [[0.38538527488708496, 0.011663521640002728, 0.6029512286186218], [0.7317326664924622, 0.265817791223526, 0.002449573017656803]], [[0.39189204573631287, 0.6055470705032349, 0.0025608364958316088], [0.5801462531089783, 0.4148370623588562, 0.005016743205487728]], [[0.4725446403026581, 0.5235428810119629, 0.003912453074008226], [0.4694666266441345, 0.5278960466384888, 0.0026373399887233973]], [[0.6001128554344177, 0.39763909578323364, 0.0022480313200503588], [0.6447244882583618, 0.3486672043800354, 0.006608273833990097]], [[0.5901187062263489, 0.40843695402145386, 0.0014443714171648026], [0.6613914370536804, 0.3316500186920166, 0.006958530284464359]], [[0.5951210260391235, 0.403523325920105, 0.0013556579360738397], [0.662437379360199, 0.33056727051734924, 0.006995391566306353]], [[0.5881625413894653, 0.4105897545814514, 0.0012477367417886853], [0.6529625058174133, 0.3399464190006256, 0.007091068662703037]], [[0.9813218712806702, 0.009350684471428394, 0.009327491745352745], [0.10983394831418991, 0.8901591300964355, 6.874867722217459e-06]], [[0.9714171886444092, 0.0031523555517196655, 0.025430409237742424], [0.4256175458431244, 0.5743474364280701, 3.499893136904575e-05]], [[0.9850473403930664, 0.005107809789478779, 0.009844777174293995], [0.8845242857933044, 0.1150200217962265, 0.0004556924104690552]], [[0.9579020738601685, 0.014161329716444016, 0.027936527505517006], [0.06308645009994507, 1.579730633238796e-05, 0.9368977546691895]], [[0.16994339227676392, 0.5568485260009766, 0.2732081413269043], [0.0035079889930784702, 3.019093128386885e-06, 0.9964890480041504]], [[0.46609121561050415, 0.5071139931678772, 0.0267948005348444], [0.00019891231204383075, 2.7965066706769903e-08, 0.9998010993003845]], [[0.3602743148803711, 0.0014086151495575905, 0.6383171081542969], [0.024882853031158447, 3.5254365116088593e-07, 0.9751167893409729]], [[0.07535114884376526, 0.0008555749664083123, 0.9237932562828064], [0.6113772392272949, 0.007776273880153894, 0.3808465003967285]], [[0.16264808177947998, 0.311969518661499, 0.5253824591636658], [0.04917100444436073, 0.0005029717576690018, 0.9503260850906372]], [[0.05367371812462807, 0.013468099758028984, 0.9328582286834717], [0.38818493485450745, 0.009326068684458733, 0.6024889945983887]], [[0.11772998422384262, 0.3539917469024658, 0.5282782316207886], [0.04209466651082039, 0.957738995552063, 0.00016632732877042145]], [[0.008118294179439545, 0.9918816685676575, 1.009534011942037e-09], [0.07181397080421448, 0.9280993938446045, 8.66702976054512e-05]], [[0.1291937381029129, 0.31232360005378723, 0.5584826469421387], [0.003027218859642744, 0.9969726800918579, 1.7013640274399222e-07]], [[0.11404696106910706, 0.4531850814819336, 0.43276795744895935], [0.39825090765953064, 0.5673747658729553, 0.03437433019280434]], [[0.10007443279027939, 0.717545211315155, 0.18238039314746857], [0.16467565298080444, 0.006640354637056589, 0.8286839723587036]], [[0.0489492304623127, 0.920172393321991, 0.03087834268808365], [0.12703734636306763, 0.016833167523145676, 0.8561294674873352]], [[0.11975865811109543, 0.47190842032432556, 0.4083329141139984], [0.08576841652393341, 0.9139751195907593, 0.00025649642338976264]], [[0.41582855582237244, 0.04210386425256729, 0.5420675277709961], [0.004436228424310684, 0.9955637454986572, 8.862075517868107e-09]], [[0.14687693119049072, 0.8146205544471741, 0.0385025329887867], [0.38490116596221924, 0.5457808971405029, 0.06931789964437485]], [[0.45768827199935913, 0.0006623505032621324, 0.541649341583252], [0.053051240742206573, 0.9464866518974304, 0.00046212237793952227]], [[0.6132546663284302, 7.196031947387382e-05, 0.3866734206676483], [0.034837592393159866, 0.0004031718126498163, 0.9647592902183533]], [[0.8019534349441528, 0.019167063757777214, 0.17887942492961884], [0.09045371413230896, 0.9042331576347351, 0.005313079338520765]], [[0.08748519420623779, 6.12569337476998e-08, 0.9125148057937622], [0.4325403571128845, 0.04195836931467056, 0.5255012512207031]], [[0.2158786803483963, 0.7731210589408875, 0.01100022904574871], [0.05923484265804291, 0.000828128308057785, 0.9399369955062866]], [[0.6764048337936401, 0.005503565073013306, 0.31809157133102417], [0.0052459160797297955, 0.9947540760040283, 1.7134508256688719e-09]], [[0.08670464158058167, 4.48906394012738e-06, 0.9132909178733826], [0.6173495054244995, 0.38060685992240906, 0.0020436514168977737]], [[0.37679654359817505, 0.00022583191457670182, 0.622977614402771], [0.0012482187012210488, 7.970072518626026e-11, 0.9987517595291138]], [[0.8000465631484985, 0.005935835186392069, 0.19401763379573822], [0.09309036284685135, 7.114028267096728e-05, 0.9068384766578674]], [[0.002562768990173936, 1.0982464118569624e-05, 0.9974262118339539], [0.0489235445857048, 0.9509209394454956, 0.00015553667617496103]], [[0.2740253806114197, 1.1440150956332218e-05, 0.7259632349014282], [0.03456489369273186, 0.9653143882751465, 0.00012072506069671363]], [[0.00012139120372012258, 4.96551066930806e-09, 0.9998786449432373], [0.11964664608240128, 0.8803516030311584, 1.8213493149232818e-06]], [[3.7431450436997693e-06, 1.7624468551247219e-09, 0.9999963045120239], [0.8270797729492188, 0.17021185159683228, 0.002708310494199395]], [[8.662934192216198e-08, 1.0842751176076693e-11, 0.9999998807907104], [0.976008415222168, 0.0007730413926765323, 0.023218538612127304]], [[0.0007455742452293634, 6.888503207846952e-07, 0.9992536902427673], [0.002865927992388606, 2.2919811826227487e-08, 0.9971340894699097]], [[0.07096917182207108, 0.032401010394096375, 0.8966297507286072], [0.01783907413482666, 0.9809204339981079, 0.001240397454239428]], [[0.05759921669960022, 0.5870387554168701, 0.3553619980812073], [0.03127698600292206, 0.966950535774231, 0.001772492309100926]], [[0.14058561623096466, 0.3416774868965149, 0.5177369713783264], [0.48137521743774414, 0.00030571065144613385, 0.5183190107345581]], [[0.19476793706417084, 0.37882813811302185, 0.4264039397239685], [0.01623297482728958, 0.983486533164978, 0.0002805194235406816]], [[0.03496316075325012, 0.7328876256942749, 0.23214927315711975], [0.8300913572311401, 0.12928839027881622, 0.040620267391204834]], [[0.08536800742149353, 0.36906009912490845, 0.5455718636512756], [0.9502480030059814, 0.016148515045642853, 0.033603422343730927]], [[0.05232547968626022, 0.00016374264669138938, 0.947510838508606], [0.9251028895378113, 0.007578625343739986, 0.06731855124235153]], [[0.21286240220069885, 0.5909662246704102, 0.19617144763469696], [0.9575343728065491, 0.0008203607867471874, 0.04164525121450424]], [[0.019693076610565186, 0.9638863205909729, 0.01642063818871975], [0.9935758709907532, 0.0019257084932178259, 0.0044984896667301655]], [[0.15192560851573944, 0.239085853099823, 0.6089885830879211], [0.9907735586166382, 0.0018249235581606627, 0.007401556242257357]], [[0.03765535354614258, 0.9372910857200623, 0.02505352720618248], [0.995678722858429, 0.0005348610575310886, 0.0037864428013563156]], [[0.20237967371940613, 0.21632733941078186, 0.581292986869812], [0.9922409057617188, 0.00039372764877043664, 0.0073653231374919415]], [[0.05034865438938141, 0.9310035109519958, 0.018647747114300728], [0.9956678152084351, 0.00018827251915354282, 0.004143939819186926]], [[0.2590058147907257, 0.2400210052728653, 0.5009732246398926], [0.9917239546775818, 0.0001633299543755129, 0.008112638257443905]], [[0.4215901494026184, 0.017792072147130966, 0.5606178045272827], [0.9997462630271912, 9.680860785010736e-06, 0.00024412383208982646]], [[0.5877586007118225, 0.009021537378430367, 0.40321987867355347], [0.99863201379776, 1.683933419371897e-07, 0.0013678218238055706]], [[0.9763185381889343, 0.004709610715508461, 0.01897185854613781], [0.9998440742492676, 1.318325217880556e-07, 0.00015579861064907163]], [[3.936011125915684e-05, 0.9999606609344482, 1.38683467487688e-10], [0.9999810457229614, 1.8643117073224857e-05, 3.594181521293649e-07]], [[4.32445688147709e-08, 1.0, 1.1305719408620865e-13], [0.998332679271698, 0.001667270204052329, 1.4880423293561762e-07]], [[3.597496966989411e-09, 1.0, 1.1191712704153312e-12], [0.99958735704422, 0.0003962665796279907, 1.638675712456461e-05]], [[1.3698557330241341e-14, 1.0, 1.3692840976195563e-17], [0.9999064207077026, 4.965258085576352e-06, 8.856321801431477e-05]], [[1.3117983144184109e-06, 0.9999986886978149, 4.902385355304295e-12], [0.9779819846153259, 3.08313756249845e-05, 0.02198725752532482]], [[0.11463979631662369, 0.8730744123458862, 0.012285742908716202], [0.5490682721138, 5.555136795010185e-06, 0.45092615485191345]], [[0.7321394681930542, 0.19506323337554932, 0.0727972686290741], [0.37692245841026306, 0.6223122477531433, 0.0007653169450350106]], [[0.0019036941230297089, 3.193040720717022e-09, 0.9980962872505188], [0.9439835548400879, 0.028457647189497948, 0.02755872905254364]], [[0.36401593685150146, 0.5926957726478577, 0.04328833892941475], [0.5870348811149597, 0.35483551025390625, 0.05812964588403702]], [[0.0524284690618515, 5.401006433203293e-07, 0.9475709795951843], [0.28826093673706055, 4.231122602504911e-06, 0.7117348313331604]], [[0.11506889015436172, 0.8776212930679321, 0.0073098354041576385], [0.841704249382019, 2.4112192477332428e-05, 0.15827172994613647]], [[0.16307084262371063, 5.002539910492487e-05, 0.8368791341781616], [0.5988349318504333, 3.4839952149923192e-06, 0.4011615216732025]], [[0.4416739046573639, 0.37347909808158875, 0.18484699726104736], [0.4905776381492615, 0.4888921082019806, 0.020530300214886665]], [[0.006521730218082666, 1.1046496162236963e-08, 0.9934782981872559], [0.8900013566017151, 0.06001218408346176, 0.04998653009533882]], [[0.4071875214576721, 0.054111406207084656, 0.5387009978294373], [0.4595557451248169, 0.4976600706577301, 0.04278409481048584]], [[0.1417151391506195, 0.7876837253570557, 0.07060111314058304], [0.44955873489379883, 0.5407472848892212, 0.009693954139947891]], [[0.22912220656871796, 0.2226620316505432, 0.5482157468795776], [0.581169068813324, 0.3808059096336365, 0.03802492097020149]], [[0.0032337938901036978, 2.222948936037028e-09, 0.996766209602356], [0.909912109375, 0.053557585924863815, 0.03653033450245857]], [[0.20428065955638885, 0.6969283819198608, 0.09879089891910553], [0.7512344121932983, 0.15934816002845764, 0.08941750228404999]], [[0.0042891837656497955, 4.502303418973952e-09, 0.9957108497619629], [0.9224387407302856, 0.04314256086945534, 0.0344187431037426]], [[0.20954468846321106, 0.6967224478721619, 0.09373287856578827], [0.7735859751701355, 0.15331150591373444, 0.0731024295091629]], [[0.9501389861106873, 0.010825082659721375, 0.03903590887784958], [0.867531955242157, 6.45625705675279e-11, 0.1324680894613266]], [[0.5364301800727844, 8.637256541987881e-06, 0.46356117725372314], [0.7012824416160583, 3.40510741348235e-13, 0.29871758818626404]], [[0.9641715884208679, 9.540468681734637e-07, 0.03582751750946045], [0.7504308819770813, 3.6679741275552624e-13, 0.2495691329240799]], [[0.9346884489059448, 0.060545314103364944, 0.004766246769577265], [0.9998290538787842, 5.182217766019903e-09, 0.00017094367649406195]], [[0.032826267182826996, 0.967156171798706, 1.757177960826084e-05], [0.9999418258666992, 5.71522036807437e-07, 5.755433448939584e-05]], [[0.02396603859961033, 0.0010242339922115207, 0.9750096797943115], [0.9379256367683411, 7.735424878774211e-05, 0.06199697032570839]], [[0.0496048778295517, 1.764572152751498e-05, 0.9503774046897888], [0.004714253358542919, 5.761963350892074e-09, 0.9952858090400696]], [[0.41732850670814514, 0.48315829038619995, 0.09951316565275192], [0.9555284380912781, 9.321494871983305e-06, 0.04446227848529816]], [[0.8484395146369934, 0.00044515778427012265, 0.15111534297466278], [0.4629562497138977, 6.851318516964966e-07, 0.5370430946350098]], [[0.8661906123161316, 0.0031399179715663195, 0.13066956400871277], [0.3199094831943512, 8.298911211568338e-07, 0.6800897121429443]], [[0.6067935824394226, 0.03758909925818443, 0.35561734437942505], [0.9311992526054382, 0.029875556007027626, 0.038925107568502426]], [[0.5745004415512085, 0.09509001672267914, 0.33040955662727356], [0.8591595888137817, 0.04187750443816185, 0.09896295517683029]], [[0.34031036496162415, 0.5483047962188721, 0.11138489097356796], [0.8568937182426453, 0.052635181695222855, 0.09047110378742218]], [[0.35583898425102234, 0.47683218121528625, 0.1673288345336914], [0.803992748260498, 0.08643604815006256, 0.10957110673189163]], [[0.4662608504295349, 0.5332310795783997, 0.0005080593400634825], [0.6134876608848572, 0.331432580947876, 0.055079780519008636]], [[0.30734896659851074, 0.15023140609264374, 0.5424196124076843], [0.6866286993026733, 0.3061549663543701, 0.007216361816972494]], [[0.23272839188575745, 0.6565094590187073, 0.11076214909553528], [0.7660136222839355, 0.05509050190448761, 0.17889586091041565]], [[0.456920862197876, 0.06627729535102844, 0.4768018126487732], [0.169090136885643, 0.00021626528177876025, 0.8306936025619507]], [[0.3842792212963104, 0.440660685300827, 0.17506007850170135], [0.3493633270263672, 0.0009642337099649012, 0.6496724486351013]], [[0.36309418082237244, 0.47726574540138245, 0.15964002907276154], [0.4010191857814789, 0.00119314924813807, 0.5977877378463745]], [[0.43409696221351624, 0.3569553792476654, 0.2089475840330124], [0.5424762964248657, 0.09679089486598969, 0.3607327342033386]], [[0.17669746279716492, 0.7336925268173218, 0.08960996568202972], [0.63167405128479, 0.054950300604104996, 0.3133756220340729]], [[0.41447529196739197, 0.15090201795101166, 0.4346226751804352], [0.47614750266075134, 0.5223188996315002, 0.0015335730277001858]], [[0.5198765993118286, 0.2598607540130615, 0.22026260197162628], [0.585012674331665, 0.41453319787979126, 0.0004541548260021955]], [[0.5755923390388489, 0.4174002707004547, 0.007007339503616095], [0.015986012294888496, 0.9840139746665955, 4.215698901077758e-09]], [[0.0422513484954834, 0.9577321410179138, 1.6556467016926035e-05], [0.42994290590286255, 0.5700052976608276, 5.177785351406783e-05]], [[0.9811944365501404, 0.0004679855774156749, 0.018337588757276535], [0.9651942849159241, 0.015145783312618732, 0.019659865647554398]], [[0.5019452571868896, 0.49801310896873474, 4.157186049269512e-05], [0.009985377080738544, 0.9893583059310913, 0.0006563612842001021]], [[1.016705937217921e-05, 0.9999898672103882, 9.328713357348306e-10], [0.9995514750480652, 8.693031304574106e-06, 0.00043984685908071697]], [[4.6203593228710815e-05, 0.9999536275863647, 1.3820923072671576e-07], [0.9646154046058655, 0.022513510659337044, 0.012871114537119865]], [[2.045239533288168e-08, 1.0, 3.366822598493968e-09], [0.721955418586731, 0.0014125752495601773, 0.2766319811344147]], [[1.4930833458492998e-05, 0.9999850988388062, 2.2257675702519464e-09], [0.7767390608787537, 0.0005677516455762088, 0.22269317507743835]], [[0.879318118095398, 0.1191689744591713, 0.001512878923676908], [0.961498498916626, 0.0020631460938602686, 0.03643835708498955]], [[0.903919517993927, 0.09183958172798157, 0.004240973386913538], [0.9614399671554565, 0.000409530068282038, 0.038150522857904434]], [[0.9178674221038818, 0.07526343315839767, 0.006869147997349501], [0.9625512361526489, 0.002982726087793708, 0.03446606546640396]], [[0.9220557808876038, 0.06915140897035599, 0.00879290234297514], [0.9451763033866882, 0.005681394133716822, 0.04914238676428795]], [[0.9153388142585754, 0.07614704221487045, 0.008514143526554108], [0.9207716584205627, 0.005852462258189917, 0.07337597757577896]], [[0.9056258797645569, 0.08800261467695236, 0.006371496710926294], [0.8845015168190002, 0.0054838405922055244, 0.11001457273960114]], [[0.2591627240180969, 0.06773000955581665, 0.6731073260307312], [0.8062933087348938, 0.010424954816699028, 0.18328173458576202]], [[0.8342825174331665, 0.1585436314344406, 0.007173839025199413], [0.8109422326087952, 0.0029200962744653225, 0.18613766133785248]], [[0.30818384885787964, 0.14830957353115082, 0.5435065627098083], [0.745893120765686, 0.011802800931036472, 0.24230408668518066]], [[0.9400757551193237, 0.05804571881890297, 0.0018785159336403012], [0.7549821138381958, 8.592158451392606e-08, 0.24501776695251465]], [[0.6567109823226929, 0.16515794396400452, 0.17813105881214142], [0.6954254508018494, 0.055752210319042206, 0.24882230162620544]], [[0.8050102591514587, 0.19498971104621887, 1.4137476966880058e-08], [0.7240493297576904, 0.0021450845524668694, 0.2738056182861328]], [[0.45684391260147095, 0.169733464717865, 0.37342268228530884], [0.7020003199577332, 0.010953613556921482, 0.2870461046695709]], [[0.7112254500389099, 0.21299895644187927, 0.07577560842037201], [0.4799572825431824, 0.018826983869075775, 0.5012157559394836]], [[0.6845328211784363, 0.23007656633853912, 0.0853905975818634], [0.4615524113178253, 0.011735093779861927, 0.5267124772071838]], [[0.38937318325042725, 0.13199229538440704, 0.4786345362663269], [0.771299421787262, 0.027328751981258392, 0.20137174427509308]], [[0.18506638705730438, 0.7208278179168701, 0.09410574287176132], [0.0064358459785580635, 0.9935641884803772, 9.071218776135481e-11]], [[9.398289876116905e-06, 3.026043771114928e-07, 0.9999903440475464], [0.00010827833466464654, 0.9998917579650879, 2.226652889847358e-11]], [[3.804345283242583e-07, 4.58396499425362e-07, 0.9999991655349731], [0.032212212681770325, 0.9658350944519043, 0.0019526997348293662]], [[0.38478392362594604, 0.532752513885498, 0.08246354013681412], [0.0042596012353897095, 4.377683126222109e-06, 0.9957360029220581]], [[2.67937321041245e-06, 3.2660766464687185e-06, 0.9999940395355225], [0.004046312067657709, 0.9914652705192566, 0.004488462582230568]], [[2.466576006554533e-06, 0.9959512948989868, 0.004046247340738773], [2.4794879209366627e-05, 0.9999735355377197, 1.647135718485515e-06]], [[4.825098471883393e-07, 0.9999992847442627, 2.922698740803753e-07], [5.614926521957386e-06, 0.9999943971633911, 2.957178057982901e-09]], [[1.1980118870269507e-05, 0.9926522970199585, 0.00733567588031292], [1.7757103705662303e-05, 0.9998661279678345, 0.00011608254135353491]], [[5.2240167747186206e-08, 0.00573225412517786, 0.9942677021026611], [2.455826972891373e-07, 0.019394906237721443, 0.980604887008667]], [[2.66698130246823e-08, 1.0, 8.441196075459345e-10], [3.580078455911462e-08, 0.9994146823883057, 0.000585306144785136]], [[4.070604298078706e-09, 1.1070540040236665e-06, 0.999998927116394], [9.937495804024365e-08, 0.06386270374059677, 0.9361372590065002]], [[1.1505881802875706e-09, 1.0, 1.5567612976497003e-08], [4.2985260506611667e-07, 0.997887909412384, 0.0021116482093930244]], [[2.6350209125780566e-08, 0.2907772362232208, 0.709222674369812], [8.998113365521476e-09, 0.9319531321525574, 0.06804691255092621]], [[7.589102679617099e-10, 0.9964722394943237, 0.0035278412979096174], [1.6187075551482577e-12, 2.1993292520505747e-08, 1.0]], [[1.0883972208830528e-05, 0.6361180543899536, 0.3638710081577301], [1.702635188394197e-07, 0.9991000890731812, 0.0008998222183436155]], [[1.701996737990541e-10, 0.00026101458934135735, 0.9997389912605286], [3.5746310967678385e-13, 6.177525158079789e-10, 1.0]], [[1.7406280410081632e-13, 4.412052057034543e-09, 1.0], [7.604300122920904e-08, 0.9993640780448914, 0.0006357911042869091]], [[1.0167305365682555e-11, 1.0, 2.1575998765399618e-09], [2.2543984457001898e-08, 0.9999980926513672, 1.8822107676896849e-06]], [[1.939371152559488e-08, 0.9998960494995117, 0.0001039093840518035], [1.4521273072887197e-11, 2.757998913693882e-07, 0.9999997615814209]], [[2.314523627009596e-13, 8.142184704240663e-09, 1.0], [5.187346996393671e-09, 0.9973523616790771, 0.0026476976927369833]], [[7.272071833597238e-11, 1.6105934719234938e-07, 0.9999998807907104], [2.6445432510513456e-09, 2.3656077246414497e-05, 0.999976396560669]], [[0.0009768442250788212, 0.011415452696383, 0.9876076579093933], [0.9973737001419067, 0.0026263564359396696, 2.943840171631962e-10]], [[1.2089967071915453e-07, 0.9999998807907104, 1.9966488462586085e-09], [1.1775738357755472e-06, 0.999997615814209, 1.1956844900851138e-06]], [[0.9891632795333862, 0.010828318074345589, 8.357378646906e-06], [4.117466232855804e-05, 0.9999420642852783, 1.6770000001997687e-05]], [[1.998954303417122e-06, 1.5698832385169226e-06, 0.9999964237213135], [2.9350339048050955e-08, 1.0, 9.495756958521895e-11]]]; // action probs
        var action =  [[1, 1], [2, 0], [2, 1], [0, 1], [2, 1], [1, 1], [2, 1], [0, 1], [2, 1], [2, 1], [2, 1], [1, 1], [2, 1], [2, 2], [2, 1], [1, 1], [1, 0], [1, 0], [1, 2], [1, 2], [0, 2], [2, 1], [2, 0], [1, 1], [1, 2], [2, 0], [2, 1], [1, 1], [2, 2], [0, 0], [1, 0], [1, 0], [2, 1], [2, 1], [0, 1], [1, 1], [1, 0], [1, 0], [0, 0], [1, 1], [1, 1], [1, 1], [0, 1], [2, 1], [2, 1], [2, 1], [2, 0], [1, 0], [0, 0], [0, 0], [0, 1], [2, 1], [0, 0], [0, 1], [0, 1], [0, 0], [0, 0], [1, 1], [0, 0], [0, 0], [0, 0], [0, 2], [0, 2], [0, 2], [0, 2], [2, 2], [1, 2], [2, 2], [2, 0], [1, 0], [1, 1], [0, 1], [2, 2], [1, 2], [1, 0], [2, 1], [1, 0], [0, 1], [0, 2], [1, 1], [2, 0], [0, 2], [0, 1], [2, 1], [2, 2], [0, 2], [2, 1], [0, 1], [2, 1], [2, 0], [2, 0], [2, 2], [2, 0], [1, 1], [0, 2], [2, 1], [1, 0], [1, 0], [2, 0], [2, 0], [1, 0], [2, 0], [1, 0], [2, 0], [1, 0], [0, 0], [2, 0], [0, 0], [0, 0], [1, 0], [1, 0], [1, 0], [1, 0], [1, 0], [1, 2], [1, 0], [2, 0], [1, 1], [2, 0], [1, 0], [2, 2], [1, 0], [2, 2], [2, 0], [1, 1], [1, 0], [2, 0], [1, 0], [2, 0], [0, 1], [0, 0], [0, 0], [0, 0], [0, 0], [1, 0], [2, 0], [2, 2], [1, 0], [0, 0], [0, 2], [0, 0], [2, 0], [0, 0], [2, 2], [1, 0], [0, 1], [1, 1], [0, 0], [0, 0], [0, 2], [2, 0], [0, 2], [0, 0], [0, 0], [0, 1], [1, 1], [0, 0], [0, 1], [1, 0], [1, 0], [1, 2], [1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1, 0], [2, 0], [1, 0], [2, 1], [0, 2], [2, 0], [1, 0], [0, 0], [0, 0], [1, 2], [0, 2], [1, 1], [2, 1], [2, 1], [1, 2], [2, 1], [1, 1], [1, 1], [1, 1], [2, 2], [1, 1], [2, 2], [1, 1], [1, 1], [1, 2], [2, 1], [2, 2], [2, 1], [1, 1], [1, 2], [2, 1], [2, 2], [2, 0], [1, 1], [0, 1], [2, 1]];
        var action_names = [['no-op', 'left', 'right'], ['no-op', 'up', 'down']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Transformer") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step;
        visualizeAttentionScores(y_attention_weights[step], top_n);
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
        // Add event handler for clicking on a marker
        document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);

          // Add event handler for clicking on a marker
          document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>