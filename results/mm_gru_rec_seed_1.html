<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row wrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MortarMayhem-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>arena_size</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>allowed_commands</b>: 9<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_count</b>: [10]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_duration</b>: [6]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_delay</b>: [18]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_failure</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_success</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_episode_success</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 1<br><b>reward_normalization</b>: 0<br><b>positional_endocing</b>: False<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: -1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 512<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_layers</b>: 1<br><b>obs_decoder</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>attach_to</b>: memory<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>detach_gradient</b>: False<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 30000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 1000<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <br>
      <center>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Transformer</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Top Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_1_32.webm', '', '', '', '', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.3348264694213867], [0.33781570196151733], [0.33932915329933167], [0.3410084545612335], [0.345621258020401], [0.3453434705734253], [0.3482557237148285], [0.34932851791381836], [0.35095900297164917], [0.35545238852500916], [0.35776394605636597], [0.3571796715259552], [0.3584291338920593], [0.3588367700576782], [0.36092081665992737], [0.36242854595184326], [0.36329934000968933], [0.36512526869773865], [0.3663688898086548], [0.37122729420661926], [0.36871111392974854], [0.3704974949359894], [0.3715256154537201], [0.37400853633880615], [0.37472981214523315], [0.3771915137767792], [0.3790614902973175], [0.38013553619384766], [0.38305380940437317], [0.38604775071144104], [0.3880859315395355], [0.3905734121799469], [0.39192643761634827], [0.39430972933769226], [0.39575180411338806], [0.39874160289764404], [0.3991411626338959], [0.40158751606941223], [0.40297001600265503], [0.40453675389289856], [0.40698787569999695], [0.40951910614967346], [0.4125077426433563], [0.4143165051937103], [0.4175209403038025], [0.4174131453037262], [0.4189569652080536], [0.42073628306388855], [0.42333999276161194], [0.42523160576820374], [0.428590327501297], [0.43005409836769104], [0.43360114097595215], [0.4349086582660675], [0.4383648633956909], [0.4398861229419708], [0.44168078899383545], [0.44333627820014954], [0.34772539138793945], [0.3459949791431427], [0.34746038913726807], [0.35144999623298645], [0.35333770513534546], [0.35385861992836], [0.36227428913116455], [0.36316239833831787], [0.36225083470344543], [0.36411812901496887], [0.36494699120521545], [0.3667910695075989], [0.3683682680130005], [0.3703708350658417], [0.3735334575176239], [0.3750276267528534], [0.3776719272136688], [0.3780048191547394], [0.3795974552631378], [0.3815798759460449], [0.38392412662506104], [0.38602396845817566], [0.3858777582645416], [0.3872542679309845], [0.28971970081329346], [0.2936941683292389], [0.2968398332595825], [0.29429036378860474], [0.29766178131103516], [0.2998616099357605], [0.30195170640945435], [0.3014424741268158], [0.3039742112159729], [0.3095940947532654], [0.31206658482551575], [0.31336650252342224], [0.3151659369468689], [0.3148365020751953], [0.3136686384677887], [0.316488116979599], [0.3157796263694763], [0.3178621232509613], [0.3214234709739685], [0.3213338553905487], [0.32259637117385864], [0.3241441249847412], [0.3250720798969269], [0.32599183917045593], [0.22898919880390167], [0.22966964542865753], [0.2298440933227539], [0.22415685653686523], [0.22934800386428833], [0.22309204936027527], [0.23094972968101501], [0.2274836152791977], [0.23575611412525177], [0.23069047927856445], [0.24305273592472076], [0.24272435903549194], [0.24672922492027283], [0.24652671813964844], [0.24981200695037842], [0.24950221180915833], [0.251642644405365], [0.25465670228004456], [0.2544574737548828], [0.25367191433906555], [0.2544557452201843], [0.25565674901008606], [0.259657084941864], [0.2567882537841797], [0.1671232134103775], [0.1655459851026535], [0.1677977740764618], [0.16672128438949585], [0.1666307896375656], [0.16173672676086426], [0.15941815078258514], [0.16052788496017456], [0.17053690552711487], [0.17346429824829102], [0.1760171353816986], [0.17689256370067596], [0.1789570152759552], [0.1798216700553894], [0.18157072365283966], [0.1831388622522354], [0.18170228600502014], [0.18216292560100555], [0.18332795798778534], [0.18428225815296173], [0.18389563262462616], [0.18467988073825836], [0.1882786750793457], [0.18872660398483276], [0.09079540520906448], [0.09036263823509216], [0.08742956817150116], [0.08341772854328156], [0.09026121348142624], [0.09232115000486374], [0.07524024695158005], [0.08069352060556412], [0.08535359054803848], [0.06892617791891098], [0.0673711821436882], [0.06432653963565826], [0.07932933419942856], [0.06721854954957962], [0.08301965147256851], [0.08439343422651291], [0.08279094099998474], [0.08317074179649353], [0.08259585499763489], [0.07856796681880951], [0.08889328688383102], [0.08754287660121918], [0.07842955738306046], [0.08077822625637054], [0.014753684401512146], [0.01358620822429657], [0.012544415891170502], [0.011381544172763824], [0.014814421534538269], [0.013507142663002014], [0.012474164366722107], [0.012098550796508789], [0.015951037406921387], [0.009881369769573212], [0.014216750860214233], [0.01375696063041687], [0.014711722731590271], [0.01485193520784378], [0.014363065361976624], [0.01485944539308548], [0.014998912811279297], [0.016488060355186462], [0.013229191303253174], [0.016774527728557587], [0.015717610716819763], [0.017172671854496002], [0.015631012618541718], [0.014047786593437195], [0.01456473022699356]];
        var y_entropy = [[0.7891255617141724, 0.8320547342300415], [0.7899025082588196, 0.8215117454528809], [0.7977698445320129, 0.7425060868263245], [0.6268203258514404, 0.08467117697000504], [0.318813681602478, 0.17190666496753693], [0.22964155673980713, 0.09645895659923553], [0.28750479221343994, 0.07645154744386673], [0.06604215502738953, 0.0314495675265789], [0.6360565423965454, 0.25136831402778625], [0.6144585609436035, 0.19357338547706604], [0.6772804260253906, 0.2069593071937561], [0.4209330081939697, 0.5544977784156799], [0.7375584244728088, 0.6806039214134216], [0.6969984769821167, 0.7152193784713745], [0.692046046257019, 0.7072044014930725], [0.5312967896461487, 1.073039174079895], [0.9102014899253845, 0.6693732738494873], [0.9236937165260315, 0.7263352870941162], [0.9206313490867615, 0.7388150095939636], [0.4232053756713867, 1.0874890089035034], [1.007123589515686, 0.8293660879135132], [1.010780930519104, 0.8212524652481079], [1.004402995109558, 0.8227791786193848], [0.2645527720451355, 0.9260030388832092], [0.9861627221107483, 0.8866265416145325], [0.953171968460083, 0.8706396818161011], [0.9565681219100952, 0.8704451322555542], [0.24213436245918274, 0.8219560384750366], [0.6115514039993286, 1.0638623237609863], [0.5952860713005066, 1.0562268495559692], [0.5993362665176392, 1.0585695505142212], [0.20007726550102234, 0.8975907564163208], [1.0107290744781494, 0.7662259340286255], [1.0082783699035645, 0.7442055940628052], [1.0087476968765259, 0.7402259111404419], [0.18421047925949097, 0.9073929786682129], [0.8157557249069214, 0.8279447555541992], [0.7797543406486511, 0.7866507172584534], [0.7808582782745361, 0.7845976948738098], [0.17989113926887512, 1.0591497421264648], [0.02052256464958191, 0.680914044380188], [0.1259663999080658, 0.1026148796081543], [0.4318970739841461, 0.020604247227311134], [0.617997407913208, 0.7037659883499146], [0.6897448897361755, 0.21469876170158386], [0.6941618919372559, 0.5037753582000732], [0.5871591567993164, 0.6238744258880615], [0.8211352825164795, 0.5032476186752319], [0.7890921831130981, 0.5029755234718323], [0.9728229641914368, 0.7137809991836548], [0.8629499077796936, 0.7277562022209167], [0.8982150554656982, 0.7986690998077393], [0.4400184452533722, 0.2902013957500458], [0.5862132906913757, 0.8125408291816711], [0.531611442565918, 0.7869959473609924], [0.5992276072502136, 0.7822996377944946], [0.5933918952941895, 0.7941303253173828], [0.5965428948402405, 0.8048982620239258], [0.2801286578178406, 0.15786686539649963], [0.6376433372497559, 0.7022585272789001], [0.036463361233472824, 0.266658216714859], [0.6907703876495361, 0.1989634931087494], [0.006892273668199778, 0.6694555878639221], [0.23668664693832397, 0.08483866602182388], [0.0001350343954982236, 0.02623046189546585], [0.0020243492908775806, 0.00038359255995601416], [0.030294325202703476, 0.000835563289001584], [0.0010220662225037813, 0.4749186635017395], [0.782636284828186, 0.7536503076553345], [0.0004273921949788928, 0.08151537925004959], [0.8258181810379028, 0.4144810438156128], [0.9909515380859375, 0.7676559686660767], [0.33305060863494873, 0.6121366024017334], [0.8567237257957458, 0.685427188873291], [0.41460350155830383, 0.5157970190048218], [0.9085824489593506, 0.6824547648429871], [0.06385227292776108, 0.6932691335678101], [0.9143551588058472, 0.5806755423545837], [0.5599017143249512, 0.80032879114151], [0.8517103791236877, 0.49343520402908325], [0.6691210269927979, 0.6998727917671204], [0.7843000888824463, 0.5895549058914185], [0.815845251083374, 0.6838845610618591], [0.651883602142334, 0.6271401643753052], [0.601726233959198, 0.06048450991511345], [0.67186039686203, 0.017931262031197548], [0.000479226466268301, 0.028260499238967896], [0.00909249484539032, 4.4311844249023125e-05], [2.3032534954836592e-05, 0.017879510298371315], [2.5867547037705663e-07, 0.005504510831087828], [0.00021878848201595247, 0.5839532613754272], [0.3766746520996094, 0.0438106507062912], [0.38709551095962524, 0.7376089692115784], [0.1481715738773346, 0.48694470524787903], [0.23216992616653442, 0.7565380334854126], [0.9777191877365112, 0.9928016662597656], [0.14800065755844116, 0.6408339142799377], [0.6443237662315369, 0.7369830012321472], [0.10866937041282654, 0.36506137251853943], [0.592593252658844, 0.6259395480155945], [0.7256768941879272, 0.582976222038269], [0.15662837028503418, 0.1919509917497635], [0.08603465557098389, 0.2547881603240967], [0.17453470826148987, 0.2529875636100769], [0.10890913009643555, 0.1853269338607788], [0.2205313891172409, 0.22076842188835144], [0.9985148906707764, 0.024008676409721375], [0.7970290184020996, 0.29376357793807983], [0.4460824131965637, 0.6926447153091431], [0.5602163672447205, 0.5063311457633972], [0.00385139393620193, 0.004236897453665733], [8.24347443995066e-05, 0.0001852490531746298], [3.9009435681691684e-09, 0.1423892080783844], [1.351127423276921e-07, 0.11946913599967957], [0.49705320596694946, 0.0034904128406196833], [0.4944486618041992, 0.5326282382011414], [0.4877845048904419, 0.06410705298185349], [1.0251482725143433, 0.572019100189209], [1.0206916332244873, 0.6280680298805237], [1.0459470748901367, 0.5235996246337891], [0.9080241322517395, 0.5700972676277161], [1.025192141532898, 0.6233485341072083], [0.9055764675140381, 0.1355457305908203], [0.959851861000061, 0.9547808170318604], [0.4565082788467407, 0.8650794625282288], [1.0577260255813599, 0.6167992353439331], [0.7347755432128906, 0.491192102432251], [0.9370174407958984, 0.6293185353279114], [0.12563884258270264, 0.24425660073757172], [0.827411413192749, 0.7421737909317017], [0.2779048681259155, 0.0651487410068512], [0.20026452839374542, 0.15994812548160553], [0.2494194507598877, 8.742381032789126e-05], [0.6371476650238037, 4.5959134276074565e-09], [0.0053387852385640144, 5.405329517316204e-10], [0.03770889341831207, 6.16014905752138e-10], [0.9495862722396851, 0.005861393176019192], [0.225403293967247, 0.01741386391222477], [0.639323353767395, 0.015037549659609795], [0.3776901662349701, 0.05235353857278824], [0.4186960756778717, 0.1417011022567749], [0.6636452674865723, 0.15954799950122833], [0.759952187538147, 0.19643080234527588], [0.8094102144241333, 0.30840811133384705], [0.5918737649917603, 0.41274476051330566], [0.737354040145874, 0.9679415225982666], [0.7727847695350647, 0.5732593536376953], [0.836423933506012, 0.2934543788433075], [0.8810415863990784, 0.41059234738349915], [0.553205132484436, 0.5661206841468811], [0.5497296452522278, 0.8647146224975586], [0.5692647099494934, 0.9304071664810181], [0.9868922233581543, 0.7231371402740479], [0.9533315896987915, 0.733588457107544], [0.013575177639722824, 0.22118444740772247], [0.11090747267007828, 0.461614727973938], [0.6530411243438721, 0.0506158322095871], [0.16269439458847046, 0.7553281188011169], [0.00047391728730872273, 0.019489627331495285], [0.008453511632978916, 0.014037325978279114], [0.31691300868988037, 0.0004570842138491571], [0.6384025812149048, 0.1890474110841751], [0.08282137662172318, 0.3036081790924072], [0.42082667350769043, 0.14127397537231445], [0.6175234317779541, 0.4292951822280884], [0.556171715259552, 0.6332927942276001], [0.40978220105171204, 0.47346943616867065], [0.5015438199043274, 0.6525586843490601], [0.592732846736908, 0.44253024458885193], [0.5611748099327087, 0.4385484457015991], [0.5825569033622742, 0.5085760951042175], [0.6048339009284973, 0.46475517749786377], [0.5804299712181091, 0.5242902040481567], [0.41975319385528564, 0.6604558825492859], [0.8600361943244934, 0.8426627516746521], [0.8621072769165039, 0.8051846623420715], [1.0201972723007202, 0.7344998717308044], [0.9580776691436768, 0.44426974654197693], [0.1636224389076233, 0.007276095449924469], [0.0005957310204394162, 0.004082587547600269], [6.1020789871690795e-05, 0.056012727320194244], [0.3058130145072937, 0.0030394955538213253], [1.9089502245606127e-07, 0.07248224318027496], [0.27488237619400024, 0.05254284292459488], [0.0004771289532072842, 0.000697126321028918], [0.005792766343802214, 0.18288767337799072], [2.3585839414863585e-07, 0.6217081546783447], [0.6553440093994141, 2.9710304261243436e-07], [0.00018781634571496397, 1.7877692926049349e-06], [0.00011821803491329774, 0.08571474999189377], [3.972049398726085e-06, 0.003007836639881134], [0.03970542922616005, 0.5789164304733276], [0.0034535862505435944, 3.5090738492726814e-07], [0.005794135853648186, 0.016321711242198944], [0.49748122692108154, 0.011876782402396202], [0.6816734671592712, 0.4682982563972473], [1.4939354286980233e-06, 1.691610975740332e-07], [9.682086954398983e-08, 0.041336871683597565], [0.0005181104643270373, 0.00018032980733551085], [0.2345695048570633, 0.6829118132591248], [9.413801294044788e-09, 0.10763347148895264], [0.0008259390597231686, 1.5524914488196373e-05], [0.0057112229987978935, 0.00010501297947485]];
        var y_attention_weights = [];
        var y_action = [[[0.04934873804450035, 0.6508923172950745, 0.2997589111328125], [0.6402755379676819, 0.2886488735675812, 0.07107558846473694]], [[0.026490258052945137, 0.4276082515716553, 0.5459014773368835], [0.42080527544021606, 0.5409225821495056, 0.03827216103672981]], [[0.02671837992966175, 0.48711299896240234, 0.48616862297058105], [0.2921755313873291, 0.6731426119804382, 0.034681934863328934]], [[0.8057885766029358, 0.0945158302783966, 0.09969556331634521], [0.011963708326220512, 0.9851322770118713, 0.002904085908085108]], [[0.012092912569642067, 0.0702514499425888, 0.9176556468009949], [0.03892524167895317, 0.9601434469223022, 0.0009313002228736877]], [[0.020479004830121994, 0.02874370478093624, 0.9507772922515869], [0.0187540203332901, 0.9808730483055115, 0.0003728941665031016]], [[0.028798937797546387, 0.036930304020643234, 0.9342707991600037], [0.014049368910491467, 0.9856692552566528, 0.0002814499894157052]], [[0.989149272441864, 0.0027727726846933365, 0.008077982813119888], [0.004710115026682615, 0.9951350092887878, 0.00015493962564505637]], [[0.04998932406306267, 0.16434352099895477, 0.7856671214103699], [0.06004161387681961, 0.9362394213676453, 0.003718933556228876]], [[0.09099246561527252, 0.09744733572006226, 0.8115602135658264], [0.04178258031606674, 0.9552677273750305, 0.0029497912619262934]], [[0.10782638937234879, 0.1111055538058281, 0.7810680270195007], [0.04502971097826958, 0.9514305591583252, 0.0035397312603890896]], [[0.8720835447311401, 0.11647888273000717, 0.01143763680011034], [0.09859360009431839, 0.836798906326294, 0.06460750848054886]], [[0.09072191268205643, 0.16681070625782013, 0.7424674034118652], [0.7361099123954773, 0.22876110672950745, 0.03512899950146675]], [[0.09656473994255066, 0.13415907323360443, 0.7692761421203613], [0.7097231149673462, 0.25219225883483887, 0.038084596395492554]], [[0.09689702838659286, 0.13095402717590332, 0.7721489667892456], [0.7176874876022339, 0.24401363730430603, 0.0382988266646862]], [[0.11537739634513855, 0.8410440683364868, 0.04357849061489105], [0.2837851941585541, 0.4421231746673584, 0.2740916609764099]], [[0.138725146651268, 0.23786868155002594, 0.623406171798706], [0.779580295085907, 0.144501194357872, 0.07591856271028519]], [[0.15995821356773376, 0.22101359069347382, 0.6190281510353088], [0.7417984008789062, 0.18366673588752747, 0.07453491538763046]], [[0.1626821905374527, 0.2145857959985733, 0.6227320432662964], [0.7331308722496033, 0.19166268408298492, 0.07520648837089539]], [[0.06753133237361908, 0.8889025449752808, 0.04356611520051956], [0.2722691595554352, 0.3936343491077423, 0.33409643173217773]], [[0.19651982188224792, 0.26805379986763, 0.5354263186454773], [0.6562082171440125, 0.2643474042415619, 0.07944440841674805]], [[0.21516425907611847, 0.24861498177051544, 0.5362207293510437], [0.6437019109725952, 0.29080942273139954, 0.06548869609832764]], [[0.21335570514202118, 0.2426430583000183, 0.5440012216567993], [0.6424487829208374, 0.2917039096355438, 0.06584732234477997]], [[0.03521885350346565, 0.9408460855484009, 0.02393508143723011], [0.15140534937381744, 0.23517578840255737, 0.6134189367294312]], [[0.26429396867752075, 0.1793968379497528, 0.556309163570404], [0.6512219309806824, 0.19216443598270416, 0.15661363303661346]], [[0.26433682441711426, 0.15263451635837555, 0.5830286741256714], [0.6614087224006653, 0.19574899971485138, 0.14284223318099976]], [[0.26752617955207825, 0.15331120789051056, 0.5791625380516052], [0.6614876985549927, 0.19598068296909332, 0.14253157377243042]], [[0.028875887393951416, 0.9474470615386963, 0.023677140474319458], [0.1401454210281372, 0.16244196891784668, 0.6974125504493713]], [[0.1834130883216858, 0.03199887275695801, 0.7845880389213562], [0.45336809754371643, 0.3056144118309021, 0.2410174459218979]], [[0.18323567509651184, 0.027123261243104935, 0.7896410226821899], [0.4629661738872528, 0.3099483847618103, 0.22708550095558167]], [[0.18528452515602112, 0.02744187042117119, 0.7872735857963562], [0.4601825475692749, 0.30863747000694275, 0.23117995262145996]], [[0.023291971534490585, 0.958766520023346, 0.017941519618034363], [0.16412606835365295, 0.1925613433122635, 0.6433126330375671]], [[0.18436917662620544, 0.29332640767097473, 0.5223044753074646], [0.7224353551864624, 0.18658271431922913, 0.09098194539546967]], [[0.19983293116092682, 0.26498883962631226, 0.5351781845092773], [0.7339257001876831, 0.18338586390018463, 0.0826883465051651]], [[0.20180177688598633, 0.26292240619659424, 0.5352758169174194], [0.7361363172531128, 0.18230515718460083, 0.08155858516693115]], [[0.02150183729827404, 0.9628148078918457, 0.01568327471613884], [0.1598648577928543, 0.20599398016929626, 0.634141206741333]], [[0.2480749487876892, 0.08033483475446701, 0.6715902090072632], [0.6693775653839111, 0.24086225032806396, 0.08976025134325027]], [[0.2627820670604706, 0.058280687779188156, 0.6789372563362122], [0.6844842433929443, 0.24846331775188446, 0.06705246865749359]], [[0.26481354236602783, 0.05794934183359146, 0.6772370934486389], [0.6858549118041992, 0.24759578704833984, 0.06654926389455795]], [[0.020488908514380455, 0.9639354944229126, 0.015575648285448551], [0.2071681171655655, 0.38125717639923096, 0.41157475113868713]], [[0.001622071024030447, 0.997294008731842, 0.0010839019669219851], [0.06027670204639435, 0.7637320160865784, 0.1759912520647049]], [[0.02635088749229908, 0.9731675386428833, 0.0004816042201127857], [0.0027822297997772694, 0.9808582663536072, 0.016359388828277588]], [[0.8473959565162659, 0.0007429623510688543, 0.1518610715866089], [0.0013621024554595351, 0.0013480769703164697, 0.9972898960113525]], [[0.3085959255695343, 1.7747287301972392e-06, 0.6914022564888], [0.0757596343755722, 0.7580114006996155, 0.16622892022132874]], [[0.5485105514526367, 0.00014504525461234152, 0.45134440064430237], [0.05498502776026726, 0.00018436202662996948, 0.9448306560516357]], [[0.43109333515167236, 0.0015229322016239166, 0.5673837065696716], [0.19308632612228394, 0.0018526115454733372, 0.8050610423088074]], [[0.27150842547416687, 0.00027035234961658716, 0.7282211780548096], [0.29454177618026733, 0.0026971520856022835, 0.7027609944343567]], [[0.5533060431480408, 0.03957382217049599, 0.40712013840675354], [0.8486903309822083, 0.11914975196123123, 0.032159823924303055]], [[0.45745664834976196, 0.024414805695414543, 0.5181285738945007], [0.8429352045059204, 0.13244429230690002, 0.0246205423027277]], [[0.5276493430137634, 0.33889466524124146, 0.13345597684383392], [0.6319594383239746, 0.3551473021507263, 0.012893280945718288]], [[0.6386372447013855, 0.26579374074935913, 0.09556901454925537], [0.516556978225708, 0.47678154706954956, 0.006661540828645229]], [[0.6332379579544067, 0.23231075704097748, 0.1344512552022934], [0.6901399493217468, 0.0826173648238182, 0.22724270820617676]], [[0.16020603477954865, 0.8397935032844543, 4.63125132910136e-07], [0.08472125232219696, 3.7317593069019495e-06, 0.915274977684021]], [[0.2726571261882782, 0.727313220500946, 2.9668770366697572e-05], [0.6647338271141052, 0.07222692668437958, 0.263039231300354]], [[0.8027799129486084, 0.1887049376964569, 0.008515117689967155], [0.6228266954421997, 0.3386690318584442, 0.03850426897406578]], [[0.743628740310669, 0.2499539703130722, 0.006417239084839821], [0.663529098033905, 0.2851867377758026, 0.05128416419029236]], [[0.7467828392982483, 0.2474401444196701, 0.005777027923613787], [0.6319181323051453, 0.3233352303504944, 0.04474661126732826]], [[0.742250919342041, 0.25244346261024475, 0.0053056394681334496], [0.6074873208999634, 0.34979984164237976, 0.042712826281785965]], [[0.928912341594696, 0.007373319938778877, 0.06371434032917023], [0.036868445575237274, 0.9631311893463135, 3.765367750929727e-07]], [[0.3315768539905548, 0.0002666528453119099, 0.6681565642356873], [0.4334245026111603, 0.5637110471725464, 0.002864477224647999]], [[0.9947136044502258, 0.0019430473912507296, 0.003343344433233142], [0.9335148930549622, 0.006921848747879267, 0.0595632866024971]], [[0.4623776376247406, 4.386561704450287e-05, 0.5375784635543823], [0.9571750164031982, 0.033730875700712204, 0.00909408088773489]], [[0.0008546138415113091, 1.7201557511725696e-08, 0.9991453886032104], [0.38925737142562866, 0.6106346845626831, 0.00010796153947012499]], [[0.0635717511177063, 1.3429998091396556e-07, 0.9364280700683594], [0.016684139147400856, 0.9833157658576965, 9.399650480190758e-08]], [[1.0899283552134875e-05, 4.1820561770544717e-13, 0.9999891519546509], [0.0040276432409882545, 0.9959723353385925, 1.447704622847823e-09]], [[0.00021421717246994376, 7.84039326517938e-12, 0.999785840511322], [3.397848195163533e-05, 0.999966025352478, 5.635218514044027e-09]], [[0.004777094349265099, 2.1508352432419997e-08, 0.9952228665351868], [8.00919733592309e-05, 0.9999198913574219, 3.0760033409293897e-10]], [[0.00010009415564127266, 7.111613964383423e-09, 0.9998998641967773], [0.1823188066482544, 0.817679226398468, 1.955328116309829e-06]], [[0.44223469495773315, 0.023103168234229088, 0.534662127494812], [0.7394976019859314, 0.12220060080289841, 0.1383017748594284]], [[3.827040200121701e-05, 2.1429241714443492e-10, 0.9999617338180542], [0.9860214591026306, 0.003571252105757594, 0.01040719822049141]], [[0.4499073326587677, 0.03780293092131615, 0.5122897028923035], [0.8911759257316589, 0.07077787071466446, 0.03804609924554825]], [[0.24583548307418823, 0.557066023349762, 0.1970984935760498], [0.4661737084388733, 0.017433907836675644, 0.5163924098014832]], [[0.10277067869901657, 0.00020480660896282643, 0.8970245122909546], [0.7251636981964111, 0.0047852471470832825, 0.27005109190940857]], [[0.23032936453819275, 0.6589372158050537, 0.11073343455791473], [0.6967639327049255, 0.01930501125752926, 0.28393110632896423]], [[0.14404840767383575, 0.0002591022348497063, 0.8556925058364868], [0.817631721496582, 0.010739173740148544, 0.17162911593914032]], [[0.2094915509223938, 0.6326029300689697, 0.1579054892063141], [0.5950486063957214, 0.40387019515037537, 0.0010811942629516125]], [[0.011739763431251049, 5.8273510461503975e-08, 0.9882601499557495], [0.4988841116428375, 0.5011053085327148, 1.0581496098893695e-05]], [[0.334731787443161, 0.5679581761360168, 0.09730999171733856], [0.2647857964038849, 0.734910249710083, 0.00030397032969631255]], [[0.0970318540930748, 0.8349056243896484, 0.06806255877017975], [0.6972964406013489, 0.09357283264398575, 0.20913073420524597]], [[0.4494968354701996, 0.04830996319651604, 0.5021932721138], [0.8492799997329712, 0.026110388338565826, 0.12460950762033463]], [[0.12351684272289276, 0.7840749025344849, 0.09240826964378357], [0.5626618266105652, 0.43499308824539185, 0.0023450010921806097]], [[0.6566510200500488, 0.04919247329235077, 0.2941564619541168], [0.7499173283576965, 0.005684272386133671, 0.24439842998981476]], [[0.698336124420166, 0.12206684052944183, 0.17959696054458618], [0.42732954025268555, 0.5725264549255371, 0.000143938057590276]], [[0.2825944423675537, 0.01091028656810522, 0.7064952850341797], [0.6802964806556702, 0.3196527659893036, 5.072818385087885e-05]], [[0.2895253598690033, 0.7104746103286743, 2.6542472646856607e-12], [0.9893101453781128, 0.00029120841645635664, 0.010398661717772484]], [[0.39286065101623535, 0.6069335341453552, 0.00020578458497766405], [0.0025760598946362734, 6.344804148739058e-08, 0.9974238872528076]], [[4.3430682126199827e-05, 0.9999566078186035, 4.1596859290393695e-09], [0.004398577380925417, 1.7795498763462092e-07, 0.9956012964248657]], [[0.0011736511951312423, 0.9988263249397278, 2.6273019315681267e-09], [3.282757688793936e-06, 7.838931869071086e-13, 0.9999966621398926]], [[1.5815473943803227e-06, 0.9999984502792358, 1.153553901706017e-11], [0.002567565068602562, 1.6508063633517006e-13, 0.9974324107170105]], [[1.8123541556391842e-09, 1.0, 1.2193550169570244e-08], [0.9993385672569275, 8.842057752644905e-08, 0.0006613134173676372]], [[1.7589727576705627e-05, 0.9999817609786987, 5.623775791718799e-07], [0.730324387550354, 0.00011629107757471502, 0.26955926418304443]], [[0.05719993636012077, 0.9053571224212646, 0.037443045526742935], [0.007421080023050308, 2.0312718334025703e-06, 0.9925768971443176]], [[0.03258468210697174, 0.9004267454147339, 0.06698863953351974], [0.5478309988975525, 0.44189316034317017, 0.01027578953653574]], [[0.021348992362618446, 0.9709609150886536, 0.0076901051215827465], [0.1881607174873352, 0.00039391807513311505, 0.8114452958106995]], [[0.016290700063109398, 0.9493703842163086, 0.03433891758322716], [0.4048714339733124, 0.5768672227859497, 0.018261302262544632]], [[0.18367984890937805, 0.24743270874023438, 0.5688874125480652], [0.2428288757801056, 0.5558629035949707, 0.20130828022956848]], [[0.028870757669210434, 0.9686620831489563, 0.002467126352712512], [0.6603659987449646, 3.3027995414158795e-06, 0.33963075280189514]], [[0.17498111724853516, 0.04711560532450676, 0.7779031991958618], [0.20296907424926758, 0.7289867401123047, 0.06804416328668594]], [[0.020244872197508812, 0.9784901738166809, 0.0012649319833144546], [0.8809484839439392, 2.5864794679364422e-06, 0.11904895305633545]], [[0.1824793517589569, 0.026654185727238655, 0.7908664345741272], [0.1836194396018982, 0.7798792123794556, 0.03650129213929176]], [[0.48375168442726135, 0.00608200766146183, 0.5101662874221802], [0.7303029894828796, 1.4433985597861465e-06, 0.26969555020332336]], [[0.03093164600431919, 0.9663543701171875, 0.002713912632316351], [0.9553986191749573, 0.0025061490014195442, 0.04209516942501068]], [[0.016977865248918533, 1.6250726275757188e-07, 0.9830219745635986], [0.9345765709877014, 0.003327106824144721, 0.06209621950984001]], [[0.037451181560754776, 0.9604796171188354, 0.00206925836391747], [0.9308556914329529, 0.0002345099055673927, 0.06890982389450073]], [[0.022843150421977043, 1.499205666277703e-07, 0.9771566987037659], [0.9565849304199219, 0.0015469505451619625, 0.04186812788248062]], [[0.052079979330301285, 0.9456548094749451, 0.0022652163170278072], [0.9425541758537292, 0.00012439115380402654, 0.05732142925262451]], [[0.33391088247299194, 0.5108925104141235, 0.15519659221172333], [0.003625124227255583, 0.99637371301651, 1.180496269626019e-06]], [[0.08604259043931961, 0.6945378184318542, 0.2194196730852127], [0.08605240285396576, 0.9139062166213989, 4.139863085583784e-05]], [[0.16390037536621094, 6.289389631319864e-08, 0.8360995650291443], [0.48415300250053406, 3.4091979239647685e-11, 0.5158470273017883]], [[0.7523841857910156, 5.476671503856778e-05, 0.2475610375404358], [0.1264159232378006, 0.8447180986404419, 0.028865912929177284]], [[0.0004413953283801675, 3.3171185243041634e-10, 0.9995586276054382], [0.9995083808898926, 9.546000434568214e-09, 0.0004916621255688369]], [[6.328850759018678e-06, 9.329060093876684e-12, 0.9999936819076538], [0.9999854564666748, 3.8615694393229205e-06, 1.0733275303209666e-05]], [[1.7340000268983857e-10, 1.247161418192408e-13, 1.0], [0.9678710699081421, 0.03208662569522858, 4.2295654566260055e-05]], [[7.205434915391606e-09, 7.954267669876836e-13, 1.0], [0.974302351474762, 1.5197535958577646e-06, 0.025696108117699623]], [[0.8028712868690491, 7.393828855128959e-05, 0.1970546692609787], [0.0003949707606807351, 1.891282408461592e-10, 0.9996050000190735]], [[0.8612263202667236, 0.08690867573022842, 0.05186496302485466], [0.21764974296092987, 0.7811909317970276, 0.0011593513190746307]], [[0.8218168020248413, 0.004004290793091059, 0.17417897284030914], [0.011797554790973663, 8.260356287870252e-10, 0.9882023930549622]], [[0.51953125, 0.24830622971057892, 0.2321625053882599], [0.22242487967014313, 0.7701213955879211, 0.00745381461456418]], [[0.3101450502872467, 0.5044848918914795, 0.1853700429201126], [0.32152247428894043, 4.345522484072717e-06, 0.6784731149673462]], [[0.3517507314682007, 0.19617612659931183, 0.4520731568336487], [0.17044061422348022, 0.8165374994277954, 0.013021863996982574]], [[0.17607875168323517, 0.635814368724823, 0.1881069391965866], [0.2571311891078949, 4.834057563130045e-06, 0.7428640723228455]], [[0.2839154601097107, 0.20477819442749023, 0.5113063454627991], [0.19433148205280304, 0.7748171091079712, 0.030851442366838455]], [[0.5857639908790588, 0.09849852323532104, 0.31573745608329773], [0.030231399461627007, 4.53847315284861e-09, 0.9697685837745667]], [[0.12643861770629883, 0.3323439359664917, 0.5412173867225647], [0.5945532917976379, 0.18581509590148926, 0.219631627202034]], [[0.11471009254455566, 0.021253028884530067, 0.8640368580818176], [0.5150006413459778, 0.055439166724681854, 0.42956018447875977]], [[0.23578576743602753, 0.46507716178894043, 0.29913708567619324], [0.18062381446361542, 0.7844219207763672, 0.0349542461335659]], [[0.17157864570617676, 0.08610068261623383, 0.7423206567764282], [0.17102400958538055, 0.005623915232717991, 0.823352038860321]], [[0.1603093445301056, 0.6056983470916748, 0.23399238288402557], [0.19877755641937256, 0.7704070806503296, 0.03081541508436203]], [[0.027406906709074974, 2.106489773723297e-06, 0.972590982913971], [0.060713429003953934, 0.9371182322502136, 0.0021683915983885527]], [[0.11833294481039047, 0.6882811784744263, 0.19338585436344147], [0.26193997263908386, 0.04413172975182533, 0.6939283013343811]], [[0.06796541810035706, 0.9273325800895691, 0.004702002741396427], [0.011967393569648266, 0.9880075454711914, 2.5109073249041103e-05]], [[0.0504770390689373, 3.058438596781343e-05, 0.949492335319519], [0.03750864788889885, 2.5784098056647053e-07, 0.9624910354614258]], [[0.94166499376297, 0.010212862864136696, 0.04812212660908699], [6.779296654713107e-06, 3.2436175967376357e-09, 0.9999932050704956]], [[0.1322612762451172, 0.07130809128284454, 0.7964306473731995], [2.035104446074243e-10, 2.024679686060682e-12, 1.0]], [[0.0002838836226146668, 0.9994157552719116, 0.0003003912279382348], [2.2011345870986965e-11, 1.2054488402477373e-14, 1.0]], [[0.006002130452543497, 0.9938978552818298, 9.99451513052918e-05], [2.5243210299841223e-11, 5.214856807351218e-16, 1.0]], [[0.5520378947257996, 0.32642027735710144, 0.12154187262058258], [0.0007105975528247654, 8.391993350231886e-11, 0.9992893934249878]], [[0.03848269209265709, 0.011495407670736313, 0.9500219225883484], [0.9976080656051636, 0.00016037643945310265, 0.002231511753052473]], [[0.7631412148475647, 0.20587094128131866, 0.030987858772277832], [0.9980477094650269, 0.000343327788868919, 0.0016088718548417091]], [[0.8872577548027039, 0.10601730644702911, 0.00672491267323494], [0.9910173416137695, 0.0002330260322196409, 0.008749638684093952]], [[0.8811561465263367, 0.09870249778032303, 0.02014143392443657], [0.9685990214347839, 0.0003952929109800607, 0.0310057420283556]], [[0.7383729815483093, 0.23368552327156067, 0.02794157713651657], [0.963720440864563, 0.0007401813054457307, 0.03553932532668114]], [[0.6428531408309937, 0.3249419033527374, 0.03220495209097862], [0.954725980758667, 0.003400648245587945, 0.041873499751091]], [[0.5731641054153442, 0.3893345594406128, 0.037501320242881775], [0.9181520342826843, 0.0075342184863984585, 0.07431372255086899]], [[0.7799390554428101, 0.01908222958445549, 0.20097869634628296], [0.8558844327926636, 4.153919144300744e-05, 0.14407403767108917]], [[0.31008628010749817, 0.6615848541259766, 0.02832886390388012], [0.3924650251865387, 0.49022403359413147, 0.11731094866991043]], [[0.5377681851387024, 0.4421912431716919, 0.020040562376379967], [0.7400435209274292, 2.4101884264382534e-05, 0.25993233919143677]], [[0.4481964409351349, 0.5097545981407166, 0.04204896092414856], [0.9142844080924988, 0.00012523066834546626, 0.08559036999940872]], [[0.542227029800415, 0.3902761936187744, 0.06749671697616577], [0.8575260639190674, 0.00014779447519686073, 0.14232617616653442]], [[0.7628058791160583, 0.0008050732431001961, 0.23638907074928284], [0.7465405464172363, 1.2787907053279923e-06, 0.2534582018852234]], [[0.20336098968982697, 0.007985991425812244, 0.7886530160903931], [0.1785600781440735, 0.6680306196212769, 0.15340933203697205]], [[0.2166668325662613, 0.7748985886573792, 0.008434574119746685], [0.5561663508415222, 0.10565207153558731, 0.3381815254688263]], [[0.4492487609386444, 0.4224970042705536, 0.12825427949428558], [0.6543921232223511, 0.020740149542689323, 0.32486775517463684]], [[0.4439372420310974, 0.45306283235549927, 0.10299993306398392], [0.6360383629798889, 0.020161399617791176, 0.3438003361225128]], [[0.0018636147724464536, 2.793812958756803e-10, 0.9981364011764526], [0.057550106197595596, 0.9423502683639526, 9.965169010683894e-05]], [[0.023374076932668686, 8.42074314277852e-07, 0.9766250848770142], [0.17363430559635162, 8.384802754335396e-07, 0.8263648152351379]], [[0.3340912461280823, 0.002418797928839922, 0.6634899973869324], [0.008728351444005966, 4.9822698201751336e-05, 0.9912217855453491]], [[0.021878644824028015, 0.9677585959434509, 0.010362714529037476], [0.013828790746629238, 0.5170742273330688, 0.46909698843955994]], [[2.64806531049544e-05, 0.9999597072601318, 1.3834234778187238e-05], [0.00020123180001974106, 0.0025168168358504772, 0.9972819089889526]], [[0.0005273279966786504, 0.9990189075469971, 0.00045372717431746423], [0.0003151963755954057, 0.0014890875900164247, 0.9981957077980042]], [[0.00033100045402534306, 0.904666006565094, 0.09500304609537125], [3.150587508571334e-05, 7.770018783048727e-06, 0.9999607801437378]], [[2.7928443159908056e-05, 0.6643435955047607, 0.3356284201145172], [0.04660246893763542, 6.205104727996513e-05, 0.9533355236053467]], [[0.015107108280062675, 0.9843667149543762, 0.0005262363702058792], [0.9103139638900757, 0.00026316900039091706, 0.08942282199859619]], [[0.8595863580703735, 0.13725365698337555, 0.0031599411740899086], [0.9733719229698181, 0.01316994708031416, 0.013458138331770897]], [[0.727898895740509, 0.2651958465576172, 0.0069052292965352535], [0.8771734833717346, 0.10144907236099243, 0.021377533674240112]], [[0.7851812839508057, 0.20628181099891663, 0.008536980487406254], [0.763373613357544, 0.2085769772529602, 0.0280494075268507]], [[0.8596580624580383, 0.1396813988685608, 0.0006605116650462151], [0.8186581134796143, 4.032985998492222e-06, 0.1813378930091858]], [[0.810107946395874, 0.18687798082828522, 0.003013996174558997], [0.7455074787139893, 0.22784103453159332, 0.026651443913578987]], [[0.7236136198043823, 0.27595406770706177, 0.0004323101311456412], [0.8382768630981445, 1.0879062983804033e-06, 0.16172203421592712]], [[0.756397008895874, 0.2426961064338684, 0.0009068167419172823], [0.840788722038269, 1.8778733647195622e-05, 0.1591925323009491]], [[0.7374200820922852, 0.26153478026390076, 0.001045101322233677], [0.7940561771392822, 3.6284307043388253e-06, 0.20594024658203125]], [[0.7143764495849609, 0.2846246063709259, 0.0009990290272980928], [0.8243653774261475, 3.934841060981853e-06, 0.17563067376613617]], [[0.7403548955917358, 0.2584274113178253, 0.0012177116004750133], [0.7821015119552612, 4.677711331169121e-06, 0.21789385378360748]], [[0.8689074516296387, 0.12265925854444504, 0.008433360606431961], [0.6271677613258362, 7.03164573678805e-07, 0.3728315830230713]], [[0.6498910784721375, 0.24664610624313354, 0.10346287488937378], [0.6715502142906189, 0.11024559289216995, 0.21820417046546936]], [[0.5082632899284363, 0.438264399766922, 0.05347230285406113], [0.6232107281684875, 0.32930347323417664, 0.04748573899269104]], [[0.4620155394077301, 0.375038743019104, 0.16294574737548828], [0.7480294108390808, 0.10187523812055588, 0.1500953733921051]], [[0.592214047908783, 0.21513798832893372, 0.19264790415763855], [0.8449195623397827, 0.1525684893131256, 0.0025120258796960115]], [[0.00548662431538105, 0.9659392833709717, 0.028574064373970032], [0.0009091867250390351, 0.9990907907485962, 6.279780251361444e-09]], [[1.1120852832391392e-05, 4.1247287299484015e-05, 0.9999476671218872], [0.00042425698484294116, 0.9995436072349548, 3.209005080861971e-05]], [[3.102799439602677e-07, 4.207179244986037e-06, 0.9999954700469971], [0.006127448752522469, 0.9911664128303528, 0.002706079976633191]], [[0.008769126608967781, 0.9202393889427185, 0.07099146395921707], [0.000337914185365662, 3.988056107573357e-08, 0.9996620416641235]], [[1.8835006887485406e-09, 8.221475944480972e-09, 1.0], [9.127601515501738e-05, 0.9864050149917603, 0.013503815047442913]], [[2.117923941113986e-06, 0.9215943813323975, 0.0784035474061966], [0.003081932896748185, 0.9918836355209351, 0.005034354515373707]], [[4.6690562527373913e-08, 0.9999568462371826, 4.3120624468429014e-05], [6.338661478366703e-05, 0.9999351501464844, 1.4560723684553523e-06]], [[4.6233813577600813e-07, 0.9992994070053101, 0.0007000736659392715], [0.00027495058020576835, 0.9557522535324097, 0.043972861021757126]], [[1.1067879251980273e-10, 1.284054462757922e-08, 1.0], [1.5499248320338666e-06, 0.6867356300354004, 0.31326282024383545]], [[0.3633888065814972, 0.6366111636161804, 4.785783502825325e-08], [1.4043044949119121e-08, 1.0, 2.1647474923724985e-09]], [[5.5767832236597314e-06, 0.9999853372573853, 9.095001587411389e-06], [2.533354775957619e-11, 0.9999998807907104, 1.1164130597762778e-07]], [[2.1810020456314305e-09, 9.38437460717978e-06, 0.9999905824661255], [1.0949355866429755e-09, 0.9831002950668335, 0.016899751499295235]], [[2.614582399473875e-07, 4.229556149759617e-10, 0.9999997615814209], [9.63581214818987e-09, 0.9996659755706787, 0.0003340068506076932]], [[8.902747504180297e-05, 0.9934954643249512, 0.006415424402803183], [0.265290230512619, 3.6528439522953704e-05, 0.734673261642456]], [[1.1166497948522647e-08, 0.00039025588193908334, 0.9996097683906555], [1.8472105789424376e-10, 1.0, 1.953502781759653e-08]], [[2.7924019718739146e-07, 0.9992990493774414, 0.0007006962550804019], [0.0009424301097169518, 0.0011326252715662122, 0.9979249238967896]], [[7.337428542086855e-06, 0.1978367120027542, 0.8021559715270996], [2.4597881065346883e-07, 0.9984038472175598, 0.0015959149459376931]], [[3.201200161129236e-05, 0.4232773780822754, 0.5766905546188354], [0.176067054271698, 0.00033124469337053597, 0.8236016631126404]], [[8.251485184018748e-08, 0.9999998807907104, 7.940155200003574e-09], [8.890162384034284e-09, 1.0, 1.946538208397186e-10]], [[4.137283404759273e-09, 1.0, 8.10071232315579e-10], [0.0039127301424741745, 0.002214751671999693, 0.9938725233078003]], [[6.935045348654967e-06, 3.8400212361011654e-05, 0.9999547004699707], [1.1202316727576545e-06, 0.9999854564666748, 1.343171334156068e-05]], [[6.9897550929454155e-06, 0.06275434792041779, 0.9372386336326599], [0.572503387928009, 2.9828846891177818e-05, 0.42746683955192566]], [[4.2720660342610017e-10, 1.0, 7.712589247810264e-12], [0.006615503691136837, 0.012667055241763592, 0.9807174801826477]], [[7.90519843576476e-05, 0.9999209642410278, 5.9271823005246915e-09], [1.0202121529800934e-06, 0.999998927116394, 2.8607754387621753e-08]], [[1.383188390491341e-07, 0.0006895454716868699, 0.9993103742599487], [8.280609108624049e-06, 4.892688476587637e-10, 0.999991774559021]]]; // action probs
        var action =  [[2, 0], [2, 1], [1, 0], [0, 1], [2, 1], [2, 1], [2, 1], [0, 1], [2, 1], [2, 1], [0, 1], [0, 1], [0, 1], [2, 0], [0, 0], [1, 1], [2, 0], [2, 2], [0, 0], [1, 1], [2, 1], [2, 1], [0, 0], [1, 1], [1, 1], [1, 0], [0, 0], [1, 2], [2, 0], [2, 0], [2, 2], [1, 0], [2, 0], [1, 2], [2, 0], [1, 2], [2, 0], [2, 0], [2, 0], [1, 1], [1, 1], [1, 1], [0, 2], [2, 1], [0, 2], [0, 0], [2, 2], [0, 0], [2, 0], [0, 0], [0, 1], [2, 1], [0, 2], [1, 2], [0, 0], [0, 0], [0, 0], [1, 0], [0, 1], [2, 0], [0, 0], [0, 0], [2, 0], [2, 1], [2, 1], [2, 1], [0, 1], [2, 1], [1, 0], [2, 0], [2, 1], [1, 0], [2, 0], [1, 0], [2, 2], [1, 0], [2, 0], [2, 1], [1, 0], [2, 2], [1, 1], [2, 1], [0, 1], [2, 0], [1, 0], [0, 2], [1, 2], [1, 2], [1, 2], [1, 0], [1, 0], [1, 2], [2, 1], [1, 2], [1, 0], [2, 1], [1, 2], [2, 1], [1, 2], [0, 1], [2, 2], [1, 0], [2, 0], [1, 0], [2, 0], [1, 2], [2, 0], [1, 1], [2, 2], [0, 1], [2, 0], [2, 0], [2, 0], [2, 0], [0, 2], [0, 1], [0, 2], [2, 1], [1, 2], [2, 1], [1, 2], [0, 1], [2, 2], [1, 0], [2, 2], [1, 1], [2, 2], [1, 0], [2, 1], [2, 2], [1, 1], [2, 2], [0, 2], [2, 2], [1, 2], [1, 2], [0, 2], [2, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1, 0], [2, 2], [0, 1], [0, 0], [0, 0], [1, 0], [0, 2], [2, 0], [1, 1], [0, 0], [1, 2], [2, 1], [2, 2], [0, 2], [1, 2], [1, 2], [1, 2], [1, 2], [1, 2], [1, 0], [0, 0], [0, 0], [0, 1], [0, 2], [0, 1], [0, 0], [0, 0], [0, 0], [0, 0], [1, 0], [0, 2], [0, 2], [2, 0], [1, 2], [0, 0], [1, 1], [2, 1], [2, 1], [1, 2], [2, 1], [1, 1], [1, 1], [1, 1], [2, 1], [1, 1], [1, 1], [2, 1], [2, 1], [1, 2], [2, 1], [1, 2], [2, 1], [2, 2], [1, 1], [1, 2], [2, 1], [2, 0], [1, 2], [1, 1], [2, 2]];
        var action_names = [['no-op', 'left', 'right'], ['no-op', 'up', 'down']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Transformer") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step;
        visualizeAttentionScores(y_attention_weights[step], top_n);
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>