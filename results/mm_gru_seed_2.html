<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row wrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MortarMayhem-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 2<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>arena_size</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>allowed_commands</b>: 9<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_count</b>: [10]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_duration</b>: [6]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_delay</b>: [18]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_failure</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_success</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_episode_success</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 2<br><b>reward_normalization</b>: 0<br><b>positional_endocing</b>: False<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: -1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 512<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_layers</b>: 1<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 30000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: {'initial': 0.0}<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <br>
      <center>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Transformer</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Top Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_2_30.webm', '', '', '', '', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.34566423296928406], [0.3450985848903656], [0.3474869132041931], [0.35033750534057617], [0.353736937046051], [0.3554534912109375], [0.3575037121772766], [0.35747313499450684], [0.3633098304271698], [0.3628062307834625], [0.3636356592178345], [0.36670634150505066], [0.36836689710617065], [0.3690372407436371], [0.3706256151199341], [0.37462544441223145], [0.37978595495224], [0.3818916082382202], [0.38373231887817383], [0.3836234211921692], [0.3891203999519348], [0.38994747400283813], [0.3919391632080078], [0.3932625651359558], [0.3959518074989319], [0.3971397280693054], [0.3987886905670166], [0.39908140897750854], [0.4016265273094177], [0.40518587827682495], [0.4070613384246826], [0.40762943029403687], [0.4111844301223755], [0.41248226165771484], [0.4159335494041443], [0.4161123037338257], [0.41886210441589355], [0.4224408268928528], [0.42254137992858887], [0.42373761534690857], [0.4264778196811676], [0.430210143327713], [0.4265536069869995], [0.4301105737686157], [0.43532776832580566], [0.4364974796772003], [0.4386611580848694], [0.44458404183387756], [0.4468469023704529], [0.44904327392578125], [0.4513486623764038], [0.4537348747253418], [0.4545356035232544], [0.45712631940841675], [0.45913463830947876], [0.46005943417549133], [0.4618229269981384], [0.4637928903102875], [0.3684755265712738], [0.370154470205307], [0.36912399530410767], [0.3677555322647095], [0.3681933283805847], [0.3699246942996979], [0.3748033344745636], [0.3725997805595398], [0.36943310499191284], [0.3801799416542053], [0.38041549921035767], [0.3831968903541565], [0.3855418562889099], [0.3876093029975891], [0.39085882902145386], [0.392564058303833], [0.39165395498275757], [0.3947688639163971], [0.396711528301239], [0.398922324180603], [0.4004959762096405], [0.40191933512687683], [0.4031299352645874], [0.40419209003448486], [0.3053579032421112], [0.3118628263473511], [0.3149217963218689], [0.3141423761844635], [0.31563103199005127], [0.3163398802280426], [0.31715190410614014], [0.317562997341156], [0.3170168697834015], [0.32199227809906006], [0.3259452283382416], [0.3250897526741028], [0.32727205753326416], [0.32772114872932434], [0.32961100339889526], [0.33138829469680786], [0.33357203006744385], [0.33553698658943176], [0.3373584747314453], [0.3391086757183075], [0.3406645953655243], [0.3420202434062958], [0.3431752026081085], [0.3441754877567291], [0.24879896640777588], [0.2545032501220703], [0.2519453763961792], [0.2493646740913391], [0.251079797744751], [0.2526381313800812], [0.25181567668914795], [0.25446459650993347], [0.2565801441669464], [0.2568865716457367], [0.25924479961395264], [0.2612709105014801], [0.26214131712913513], [0.26510921120643616], [0.267336368560791], [0.26971378922462463], [0.27168160676956177], [0.2733215391635895], [0.27237555384635925], [0.27298504114151], [0.27311214804649353], [0.2745353579521179], [0.27427199482917786], [0.2771732211112976], [0.17938104271888733], [0.183180034160614], [0.17974138259887695], [0.18044206500053406], [0.18575817346572876], [0.18504947423934937], [0.18474280834197998], [0.18432074785232544], [0.17882002890110016], [0.18073713779449463], [0.1779930293560028], [0.18122103810310364], [0.1831642985343933], [0.18508321046829224], [0.18704792857170105], [0.18821898102760315], [0.18946164846420288], [0.1900632381439209], [0.19054055213928223], [0.19204851984977722], [0.19318318367004395], [0.19201695919036865], [0.19501864910125732], [0.19531384110450745], [0.09539471566677094], [0.09862004220485687], [0.09515097737312317], [0.09772662818431854], [0.09715622663497925], [0.09905613958835602], [0.10030825436115265], [0.10119941085577011], [0.10522131621837616], [0.10672251135110855], [0.10793686658143997], [0.10894142091274261], [0.11028903722763062], [0.11073769629001617], [0.11199378967285156], [0.11120238155126572], [0.11255855858325958], [0.1154249906539917], [0.11534833163022995], [0.11433544009923935], [0.1153666153550148], [0.11640782654285431], [0.11682994663715363], [0.1163288801908493], [0.012754648923873901], [0.011680610477924347], [0.009131968021392822], [0.01142321527004242], [0.013612546026706696], [0.015425525605678558], [0.015355035662651062], [0.012500002980232239], [0.014843136072158813], [0.013768486678600311], [0.013458304107189178], [0.014097906649112701], [0.013687297701835632], [0.013751886785030365], [0.012785360217094421], [0.015119180083274841], [0.01386590301990509], [0.01560203731060028], [0.01571696251630783], [0.015599876642227173], [0.016901947557926178], [0.015618212521076202], [0.01580028235912323], [0.01632578670978546], [0.022015713155269623]];
        var y_entropy = [[0.6241806149482727, 0.9285329580307007], [0.6898359060287476, 0.9380662441253662], [0.890137255191803, 0.6268172264099121], [0.9774985909461975, 0.8298875093460083], [0.2387571632862091, 0.8041054010391235], [0.35647696256637573, 0.9085565805435181], [0.36583411693573, 0.8646872043609619], [0.6544318795204163, 0.691876232624054], [0.12313777208328247, 0.760502815246582], [0.17124274373054504, 0.8473748564720154], [0.22689366340637207, 0.8092061281204224], [0.5922644734382629, 0.8200095891952515], [0.49827563762664795, 0.6057389974594116], [0.9663621187210083, 0.6642082929611206], [1.0278385877609253, 0.5732742547988892], [0.8118550181388855, 0.8959875106811523], [1.0267341136932373, 0.3850975036621094], [1.0946766138076782, 0.5766196846961975], [1.075835943222046, 0.5901095867156982], [0.8801805973052979, 1.006746768951416], [1.0963363647460938, 0.5736274719238281], [1.0867509841918945, 0.6349192261695862], [1.070378303527832, 0.6443537473678589], [0.942101240158081, 0.659669816493988], [1.0777921676635742, 0.703264057636261], [0.9846897721290588, 0.6228034496307373], [0.9901393055915833, 0.6383517384529114], [0.9378514289855957, 0.7400014996528625], [1.0207327604293823, 0.7756874561309814], [0.9754601120948792, 0.7397193908691406], [0.9983949661254883, 0.6940182447433472], [0.8815759420394897, 0.7405153512954712], [1.0006020069122314, 0.7521201372146606], [0.9012752771377563, 0.6918516159057617], [0.9301780462265015, 0.7159225344657898], [0.7286266088485718, 0.7329219579696655], [1.0395166873931885, 0.8188620805740356], [0.9570335149765015, 0.8300644159317017], [0.97412109375, 0.7881251573562622], [0.7548708319664001, 0.7184346914291382], [0.028685376048088074, 0.10282591730356216], [0.000283589557511732, 0.07151584327220917], [1.6144332448675414e-06, 0.10791540145874023], [0.0006465629558078945, 0.6342948079109192], [0.012462781742215157, 0.9022599458694458], [0.6308473348617554, 0.7138071060180664], [0.4557803273200989, 0.7949531078338623], [0.7536322474479675, 0.656708836555481], [0.6503012180328369, 0.6326315999031067], [0.5655713081359863, 0.6349863409996033], [0.513923168182373, 0.6324745416641235], [0.47582322359085083, 0.6280143857002258], [0.6853201389312744, 0.558993935585022], [0.23916789889335632, 0.7995465993881226], [0.3286892771720886, 0.6039345264434814], [0.44791632890701294, 0.49137812852859497], [0.4258807301521301, 0.42002415657043457], [0.4028138220310211, 0.38945266604423523], [0.698095440864563, 0.07367399334907532], [0.12411072850227356, 0.019787587225437164], [0.0044137462973594666, 0.11212486773729324], [0.0005008143489249051, 0.33650749921798706], [0.10433653742074966, 0.04778054729104042], [0.0013078494230285287, 0.48451709747314453], [4.6017208660487086e-05, 0.0959823876619339], [8.800176942713733e-07, 0.008976893499493599], [5.681555990122433e-07, 0.019762929528951645], [0.2819341719150543, 0.07853306084871292], [0.22542709112167358, 0.04447461664676666], [0.44492870569229126, 0.14316384494304657], [0.5415980815887451, 0.2900078296661377], [0.6711082458496094, 0.42233699560165405], [0.08850578963756561, 0.0560593456029892], [0.6505627036094666, 0.48807966709136963], [0.45859456062316895, 0.23893970251083374], [0.43721675872802734, 0.2640001177787781], [0.41158175468444824, 0.24441584944725037], [0.3955806493759155, 0.23854279518127441], [0.3753834068775177, 0.2344653606414795], [0.35940021276474, 0.23347333073616028], [0.34368467330932617, 0.23230433464050293], [0.32718026638031006, 0.23141831159591675], [0.09614364802837372, 0.15585477650165558], [0.00047958490904420614, 0.027158061042428017], [2.1188143364270218e-05, 0.5698352456092834], [0.14431054890155792, 0.020361552014946938], [0.1726839691400528, 0.012179329060018063], [0.3008610010147095, 0.02681254781782627], [1.2574740139825735e-05, 0.07630788534879684], [7.033461035810262e-10, 0.3180009722709656], [0.00010199849202763289, 0.06706215441226959], [0.521994411945343, 0.6518346071243286], [0.05497092753648758, 0.14469251036643982], [0.6851569414138794, 0.0026226085610687733], [0.4623783230781555, 0.08629384636878967], [0.5339250564575195, 0.012813808396458626], [0.5905998349189758, 0.030010312795639038], [0.46822333335876465, 0.047067828476428986], [0.42245736718177795, 0.06283660978078842], [0.3649528920650482, 0.08226773887872696], [0.3189845681190491, 0.10660813003778458], [0.30428075790405273, 0.13296498358249664], [0.2932775616645813, 0.15837982296943665], [0.2855212092399597, 0.18249568343162537], [0.27533435821533203, 0.20376522839069366], [0.2672252058982849, 0.22249068319797516], [0.6588577628135681, 0.14144957065582275], [0.007711899932473898, 0.012699706479907036], [0.021178757771849632, 0.13609112799167633], [0.03350848704576492, 0.029768966138362885], [0.6605507135391235, 0.0006480944575741887], [0.06150299310684204, 0.00032668368658050895], [0.006944058462977409, 0.6747135519981384], [3.863411848215037e-07, 0.03737296164035797], [1.3482027725331136e-06, 0.19997595250606537], [0.004949170630425215, 0.03822701424360275], [0.08956408500671387, 0.006137522868812084], [0.1187983825802803, 0.01782594434916973], [0.17788928747177124, 0.06644755601882935], [0.18089739978313446, 0.14225517213344574], [0.22098368406295776, 0.22196784615516663], [0.25600314140319824, 0.2726658880710602], [0.30113768577575684, 0.3576226830482483], [0.3503882884979248, 0.4195418953895569], [0.16017423570156097, 0.6679819822311401], [0.5140194296836853, 0.7018195390701294], [0.7231472730636597, 0.479891300201416], [0.7806634902954102, 0.648531973361969], [0.4086390733718872, 0.6380894780158997], [0.807264506816864, 0.6845390796661377], [0.4745274782180786, 0.6854537725448608], [0.6266574859619141, 0.4723694622516632], [0.01041619386523962, 0.00012774181959684938], [5.8592864661477506e-05, 0.000192174207768403], [0.0051747579127550125, 0.005686317104846239], [8.317395258927718e-05, 0.445196270942688], [1.1370962056389544e-06, 0.6393250226974487], [0.001021735486574471, 0.05303395166993141], [0.2539670467376709, 0.028194675222039223], [7.534764790761983e-06, 2.976817548017152e-08], [0.0011888336157426238, 6.29476232916204e-07], [0.5708833932876587, 0.34289753437042236], [0.35366925597190857, 0.04324205964803696], [0.09042569249868393, 0.03439079970121384], [0.09909068793058395, 0.028518149629235268], [0.07758152484893799, 0.017851054668426514], [0.06948459893465042, 0.01733248308300972], [0.4994015693664551, 0.07340670377016068], [0.5074806213378906, 0.16298437118530273], [0.5910700559616089, 0.2612794041633606], [0.663144052028656, 0.40673959255218506], [0.6941931843757629, 0.5425094366073608], [0.5725696682929993, 0.6432947516441345], [0.7527507543563843, 0.3299916386604309], [0.10215003788471222, 0.1761762648820877], [0.27713102102279663, 0.0076125673949718475], [0.003157854313030839, 0.0028685845900326967], [0.06022832915186882, 0.010189581662416458], [0.21052752435207367, 0.0003830558271147311], [0.027631036937236786, 0.00650729751214385], [0.6022976636886597, 0.18188470602035522], [0.4493890702724457, 0.4662889838218689], [0.18748092651367188, 0.21576672792434692], [0.21698784828186035, 0.22556418180465698], [0.35499316453933716, 0.43234819173812866], [0.5693212747573853, 0.6629149913787842], [0.7462550401687622, 0.7223755121231079], [0.48576998710632324, 0.7695930004119873], [0.8657989501953125, 0.10317106544971466], [0.5701800584793091, 0.9918956756591797], [0.06054818630218506, 0.055040642619132996], [0.8069448471069336, 0.5252610445022583], [0.15895706415176392, 0.546684205532074], [0.8619674444198608, 0.6832804083824158], [0.6137599945068359, 0.5745998620986938], [0.6832402944564819, 0.7216410636901855], [0.5242375135421753, 0.8849861025810242], [0.888044536113739, 0.6753237843513489], [3.0016508389962837e-05, 0.0007437184685841203], [0.6630616188049316, 0.33635398745536804], [0.00020722890621982515, 1.8937140050523382e-11], [1.9179479338049532e-08, 5.368303024333443e-10], [0.009118546731770039, 1.5685418475186452e-07], [0.0005375341279432178, 4.4827509759759465e-11], [8.063356631282659e-07, 5.152107581708754e-13], [2.4691720890146485e-10, 1.328724863469688e-07], [6.414032327484165e-08, 4.889048150699682e-13], [1.2141198741771322e-15, 2.6270628950442187e-05], [9.816768908876838e-08, 2.102615173985023e-12], [5.6481196224922314e-05, 1.2922557289130054e-05], [0.007862149737775326, 0.0001604979479452595], [0.0846313089132309, 1.3923140613769647e-06], [1.2099175705770904e-07, 8.812094803856141e-11], [9.614739155949792e-07, 3.631009728999324e-11], [2.4515653951340255e-09, 0.023951219394803047], [6.788002337998478e-07, 6.3486318140348885e-06], [7.896503451121362e-10, 1.5917235941742547e-05], [0.0025219523813575506, 8.082049612889719e-11], [7.488970332758527e-09, 3.3373710266459966e-06], [1.0024830743304847e-08, 5.499690303167881e-08], [0.21330201625823975, 0.06717881560325623], [2.8286806230681805e-09, 2.377897345695601e-08], [0.11830262839794159, 2.6514499040786177e-05]];
        var y_attention_weights = [];
        var y_action = [[[0.7718909382820129, 0.029162656515836716, 0.1989464908838272], [0.3107670545578003, 0.11380607634782791, 0.5754268169403076]], [[0.1818477064371109, 0.060452476143836975, 0.7576997876167297], [0.197160542011261, 0.1919860690832138, 0.6108534336090088]], [[0.40436503291130066, 0.06990114599466324, 0.5257338285446167], [0.18597351014614105, 0.03568439185619354, 0.7783421277999878]], [[0.18038834631443024, 0.5678934454917908, 0.2517182230949402], [0.4585421681404114, 0.5024483799934387, 0.03900939226150513]], [[0.9483944773674011, 0.023375360295176506, 0.02823013626039028], [0.7030941247940063, 0.11030461639165878, 0.18660129606723785]], [[0.9119560718536377, 0.054543714970350266, 0.03350025787949562], [0.579212486743927, 0.09768850356340408, 0.3230990171432495]], [[0.9095823764801025, 0.04913480579853058, 0.0412827730178833], [0.5969952940940857, 0.07287275046110153, 0.3301319181919098]], [[0.29299700260162354, 0.6976795196533203, 0.00932351779192686], [0.7477472424507141, 0.20118437707424164, 0.05106838420033455]], [[0.977471113204956, 0.009756401181221008, 0.012772507965564728], [0.6666463017463684, 0.040839944034814835, 0.29251375794410706]], [[0.9660205841064453, 0.020235300064086914, 0.01374408882111311], [0.5350152850151062, 0.04904688149690628, 0.4159378707408905]], [[0.9515625238418579, 0.02792501263320446, 0.020512524992227554], [0.6466753482818604, 0.059218212962150574, 0.29410645365715027]], [[0.2143554389476776, 0.7710590362548828, 0.014585519209504128], [0.5424824357032776, 0.4197058379650116, 0.03781168535351753]], [[0.8614276051521301, 0.07238643616437912, 0.06618592143058777], [0.8015497922897339, 0.04603683575987816, 0.15241338312625885]], [[0.5828529000282288, 0.18748070299625397, 0.22966642677783966], [0.7752179503440857, 0.06090084835886955, 0.16388119757175446]], [[0.5129531621932983, 0.21853722631931305, 0.2685096561908722], [0.824050784111023, 0.053498588502407074, 0.12245060503482819]], [[0.1426214873790741, 0.7043657898902893, 0.1530127376317978], [0.6122092604637146, 0.28099167346954346, 0.10679902881383896]], [[0.5052701234817505, 0.2951216399669647, 0.1996082216501236], [0.902605414390564, 0.05785229057073593, 0.039542265236377716]], [[0.30804815888404846, 0.3752378225326538, 0.31671401858329773], [0.827172040939331, 0.1037890613079071, 0.06903886049985886]], [[0.29642221331596375, 0.43454036116600037, 0.2690373957157135], [0.8216271996498108, 0.10392288118600845, 0.07444988936185837]], [[0.08196406811475754, 0.5930178761482239, 0.3250179886817932], [0.5253453850746155, 0.29492801427841187, 0.17972664535045624]], [[0.3196409046649933, 0.3150971233844757, 0.3652619421482086], [0.8243400454521179, 0.12104480713605881, 0.05461513623595238]], [[0.2767155170440674, 0.32171985507011414, 0.40156471729278564], [0.7907320857048035, 0.1528892070055008, 0.05637866258621216]], [[0.22510497272014618, 0.39095044136047363, 0.3839446008205414], [0.7882124185562134, 0.1497955024242401, 0.0619921013712883]], [[0.1347954273223877, 0.28272929787635803, 0.5824752449989319], [0.3115912675857544, 0.6813610792160034, 0.007047686725854874]], [[0.26390478014945984, 0.4271494746208191, 0.30894583463668823], [0.7671686410903931, 0.1260444074869156, 0.10678695887327194]], [[0.17389798164367676, 0.5551997423171997, 0.2709023356437683], [0.8045173287391663, 0.12331676483154297, 0.072165846824646]], [[0.17166532576084137, 0.5457467436790466, 0.2825878858566284], [0.7978687286376953, 0.12366833537817001, 0.07846298813819885]], [[0.11466081440448761, 0.5609093308448792, 0.32442986965179443], [0.4086065888404846, 0.5780841708183289, 0.013309289701282978]], [[0.17365987598896027, 0.3381845951080322, 0.4881555736064911], [0.7267604470252991, 0.13191431760787964, 0.1413252055644989]], [[0.12740737199783325, 0.5048090815544128, 0.3677835762500763], [0.7432316541671753, 0.16008368134498596, 0.09668468683958054]], [[0.14778192341327667, 0.4949162006378174, 0.3573018014431], [0.7668477296829224, 0.15153703093528748, 0.08161517977714539]], [[0.0954720750451088, 0.6156928539276123, 0.2888351082801819], [0.443090558052063, 0.5459608435630798, 0.010948652401566505]], [[0.15548060834407806, 0.33813267946243286, 0.5063866376876831], [0.738086998462677, 0.10682420432567596, 0.15508879721164703]], [[0.09397795051336288, 0.5839250087738037, 0.3220970034599304], [0.7718994617462158, 0.1331883817911148, 0.09491220861673355]], [[0.11594833433628082, 0.576194167137146, 0.307857483625412], [0.759158730506897, 0.13958735764026642, 0.10125396400690079]], [[0.0767844021320343, 0.7415780425071716, 0.18163751065731049], [0.47721126675605774, 0.5149235129356384, 0.00786519143730402]], [[0.19014808535575867, 0.3471653461456299, 0.46268659830093384], [0.6770832538604736, 0.088682621717453, 0.23423410952091217]], [[0.11691028624773026, 0.5248225927352905, 0.3582671582698822], [0.692457914352417, 0.14785762131214142, 0.1596844643354416]], [[0.14523278176784515, 0.5448558330535889, 0.3099113702774048], [0.7193322777748108, 0.14083333313465118, 0.13983440399169922]], [[0.06047450378537178, 0.7062110900878906, 0.23331435024738312], [0.4308930039405823, 0.5627552270889282, 0.00635178480297327]], [[0.0033382431138306856, 0.9958875775337219, 0.0007741473382338881], [0.9813066720962524, 0.014527515508234501, 0.004165789112448692]], [[2.372406561335083e-05, 0.9999758005142212, 4.5419398020385415e-07], [0.9881932139396667, 0.0037339874543249607, 0.008072827011346817]], [[1.0017258489369851e-07, 0.9999998807907104, 5.194840326135097e-13], [0.9787939786911011, 0.019782692193984985, 0.0014232955873012543]], [[6.030662916600704e-05, 0.9999396800994873, 3.1355231300267405e-08], [0.8019877076148987, 0.09135908633470535, 0.10665316879749298]], [[0.0016678388928994536, 0.9983218312263489, 1.0302460395905655e-05], [0.3833068013191223, 0.5374049544334412, 0.07928827404975891]], [[0.25512146949768066, 0.012369271367788315, 0.7325092554092407], [0.42950236797332764, 0.5650773048400879, 0.005420224275439978]], [[0.16452769935131073, 0.001142802881076932, 0.8343294858932495], [0.37761908769607544, 0.034059006720781326, 0.5883219242095947]], [[0.705894410610199, 0.2347961962223053, 0.05930936709046364], [0.6867681741714478, 0.30582699179649353, 0.007404932286590338]], [[0.7932549715042114, 0.11978046596050262, 0.08696452528238297], [0.6924787759780884, 0.3048095703125, 0.0027116730343550444]], [[0.8325662016868591, 0.09749703854322433, 0.06993672251701355], [0.6803033351898193, 0.3184163570404053, 0.001280349213629961]], [[0.8544761538505554, 0.08421963453292847, 0.061304233968257904], [0.6793108582496643, 0.31997305154800415, 0.0007160880486480892]], [[0.8695191144943237, 0.07640258222818375, 0.05407837778329849], [0.6830426454544067, 0.3164982199668884, 0.0004590603057295084]], [[0.4180727005004883, 0.0007376864086836576, 0.5811895728111267], [0.8363528251647949, 0.08477332442998886, 0.0788738876581192]], [[0.06411337107419968, 0.9357849955558777, 0.00010161762475036085], [0.5181647539138794, 0.02807833068072796, 0.4537568986415863]], [[0.9102380275726318, 0.007883547805249691, 0.0818784236907959], [0.7082439064979553, 0.2917354106903076, 2.0654082618420944e-05]], [[0.8778301477432251, 0.0392349511384964, 0.08293493837118149], [0.8628138303756714, 0.08409664779901505, 0.05308956652879715]], [[0.8810429573059082, 0.024905633181333542, 0.09405149519443512], [0.8884071111679077, 0.07556585967540741, 0.03602706268429756]], [[0.8887705206871033, 0.020895609632134438, 0.09033393114805222], [0.8983210325241089, 0.072774738073349, 0.028904186561703682]], [[0.5107205510139465, 0.0006838430417701602, 0.488595575094223], [0.013973233290016651, 9.958576811186504e-06, 0.9860168099403381]], [[0.9730675220489502, 2.4932163796620443e-05, 0.026907479390501976], [0.9971221089363098, 0.0028661489486694336, 1.1731339327525347e-05]], [[0.9994901418685913, 0.0005026271683163941, 7.3128680924128275e-06], [0.9762957096099854, 0.023704303428530693, 5.190584628778083e-10]], [[0.9999549388885498, 4.386392538435757e-05, 1.1592787814151961e-06], [0.10526859015226364, 0.8947314023971558, 2.55995125406994e-15]], [[0.02163521759212017, 4.069665049399873e-09, 0.9783647656440735], [0.9918376803398132, 0.008091716095805168, 7.055747846607119e-05]], [[0.0001316346606472507, 2.04270045323085e-09, 0.9998683929443359], [0.8112731575965881, 1.3823210792907048e-05, 0.18871299922466278]], [[3.2654468213877408e-06, 8.801425366300464e-08, 0.9999966621398926], [0.9805271625518799, 1.8318839067887893e-07, 0.019472623243927956]], [[5.1832447667266024e-08, 4.905633121943254e-10, 1.0], [0.9988467693328857, 3.339843260619091e-06, 0.0011498217936605215]], [[3.2979588837633855e-08, 1.2821422526107518e-13, 1.0], [0.9971133470535278, 2.3127748605134002e-08, 0.0028866780921816826]], [[0.9254665970802307, 0.004402050748467445, 0.0701313316822052], [0.9856759309768677, 0.0009498372673988342, 0.013374174013733864]], [[0.950314462184906, 0.03735577315092087, 0.012329795397818089], [0.9930857419967651, 0.0057141403667628765, 0.0012002427829429507]], [[0.8755400776863098, 0.09404297173023224, 0.03041692264378071], [0.9724655151367188, 0.0189324039965868, 0.008602069690823555]], [[0.8432886004447937, 0.06866222620010376, 0.08804921805858612], [0.9284472465515137, 0.059545308351516724, 0.012007514014840126]], [[0.7837480306625366, 0.11803455650806427, 0.09821739047765732], [0.8863779306411743, 0.03283615782856941, 0.08078592270612717]], [[0.017585592344403267, 1.255083475371066e-06, 0.9824131727218628], [0.9902572631835938, 0.009470210410654545, 0.00027253260486759245]], [[0.721444845199585, 0.2633568048477173, 0.015198317356407642], [0.855169415473938, 0.03041938506066799, 0.11441118270158768]], [[0.8740339279174805, 0.0416591502726078, 0.08430690318346024], [0.9481330513954163, 0.020888676866889, 0.03097819723188877]], [[0.8833202719688416, 0.07337035983800888, 0.04330939054489136], [0.9406843185424805, 0.021639807149767876, 0.037675898522138596]], [[0.8928542137145996, 0.06658466905355453, 0.040561139583587646], [0.9464898705482483, 0.020665472373366356, 0.03284464776515961]], [[0.8969234824180603, 0.07115370780229568, 0.03192281723022461], [0.9483493566513062, 0.02187730185687542, 0.029773367568850517]], [[0.9038755893707275, 0.06707131862640381, 0.029053017497062683], [0.9495339393615723, 0.022058572620153427, 0.02840752713382244]], [[0.9091172218322754, 0.06441529840230942, 0.02646747976541519], [0.949871301651001, 0.0230182483792305, 0.027110431343317032]], [[0.9144536256790161, 0.06066864728927612, 0.024877749383449554], [0.9502114057540894, 0.023325981572270393, 0.026462635025382042]], [[0.9200118184089661, 0.05648180469870567, 0.02350645698606968], [0.9504680633544922, 0.02366083674132824, 0.02587110362946987]], [[0.9804977178573608, 5.1817542043863796e-06, 0.01949710212647915], [0.03624938055872917, 1.3415327657639864e-06, 0.9637492895126343]], [[0.9999566078186035, 1.95423879745249e-07, 4.309282303438522e-05], [0.9958035349845886, 0.004196541383862495, 4.324441960079639e-08]], [[0.9999985694885254, 1.4415489886232535e-06, 2.087075401391303e-08], [0.7430568337440491, 0.2569431960582733, 4.5377240159849563e-11]], [[0.9672099351882935, 0.03279004991054535, 1.4503737620630286e-11], [0.002989501226693392, 0.9970104694366455, 5.540737910730733e-16]], [[0.04149727523326874, 0.9585021138191223, 6.853809395579447e-07], [0.9984721541404724, 0.00029255266417749226, 0.0012353194179013371]], [[0.06276268512010574, 0.9247426986694336, 0.012494715861976147], [0.9958775043487549, 8.367773261852562e-06, 0.004114220384508371]], [[8.29961720683059e-07, 0.9999991655349731, 1.369845426327232e-12], [0.9859536290168762, 0.0005899005918763578, 0.013456448912620544]], [[2.898700376952057e-11, 1.0, 9.695096100880869e-18], [0.9032918810844421, 0.09668552875518799, 2.2629981685895473e-05]], [[8.044709829846397e-06, 0.9999920129776001, 2.977730562125913e-11], [0.9889901876449585, 0.007987335324287415, 0.0030224230140447617]], [[0.7845560312271118, 0.21533793210983276, 0.00010602111433399841], [0.35497531294822693, 0.6448797583580017, 0.00014490722969640046]], [[0.009776103310286999, 4.1761357039149516e-08, 0.9902238249778748], [0.03290281817317009, 0.9670972228050232, 1.5876786108037777e-08]], [[0.563897967338562, 0.43608424067497253, 1.7838270650827326e-05], [0.0002863381814677268, 0.9997135996818542, 3.5133957965172158e-09]], [[0.17411378026008606, 2.083275603581569e-06, 0.8258841633796692], [0.01704227365553379, 0.982957661151886, 3.7057883872648745e-08]], [[0.7744655609130859, 0.22552546858787537, 9.081663847609889e-06], [0.0017422025557607412, 0.9982574582099915, 3.391906489014218e-07]], [[0.722536027431488, 0.27745911478996277, 4.828783858101815e-06], [0.004721314646303654, 0.9952777624130249, 9.606598041500547e-07]], [[0.8221392035484314, 0.177852600812912, 8.110801900329534e-06], [0.00809069350361824, 0.9919067621231079, 2.6593802431307267e-06]], [[0.8501914739608765, 0.1498011350631714, 7.3787155088211875e-06], [0.011493027210235596, 0.9885005950927734, 6.319658041320508e-06]], [[0.8810255527496338, 0.11896734684705734, 7.102978088369127e-06], [0.016021007671952248, 0.9839670062065125, 1.1953596185776405e-05]], [[0.9027882218360901, 0.09720504283905029, 6.761779786756961e-06], [0.022161081433296204, 0.9778153896331787, 2.350644899706822e-05]], [[0.9092748761177063, 0.0907185897231102, 6.503442364191869e-06], [0.02936437353491783, 0.9705960154533386, 3.953638588427566e-05]], [[0.9139891266822815, 0.08600445836782455, 6.4422524701512884e-06], [0.0368383452296257, 0.9631041288375854, 5.753309960709885e-05]], [[0.9172416925430298, 0.08275194466114044, 6.323765774141066e-06], [0.04440523684024811, 0.9555185437202454, 7.623522833455354e-05]], [[0.9214261174201965, 0.0785679966211319, 5.90444460613071e-06], [0.051475487649440765, 0.948434054851532, 9.049830259755254e-05]], [[0.9246881604194641, 0.07530634850263596, 5.522883839148562e-06], [0.05801043659448624, 0.9418875575065613, 0.00010196729272138327]], [[0.3698152005672455, 2.1474111377983718e-08, 0.6301847100257874], [0.971863329410553, 0.02308429405093193, 0.005052489694207907]], [[0.9990376234054565, 0.0009501220774836838, 1.2222983059473336e-05], [0.9984102249145508, 0.0003739012172445655, 0.0012157546589151025]], [[0.9968699812889099, 0.003129638498649001, 3.87805727086743e-07], [0.9696114659309387, 0.030388446524739265, 6.444953015716237e-08]], [[0.005386169068515301, 0.9946138262748718, 4.89370783479659e-12], [0.004678872413933277, 0.9953210949897766, 1.9107248945483997e-14]], [[0.6277458071708679, 0.37221407890319824, 4.007871393696405e-05], [0.9999401569366455, 5.846844578627497e-05, 1.378330921397719e-06]], [[0.011212742887437344, 0.9887872338294983, 3.86308673938629e-09], [0.9999731779098511, 1.073522162187146e-05, 1.6046065866248682e-05]], [[0.0008620305452495813, 0.9991379976272583, 1.4881926246879118e-10], [0.5962331891059875, 0.4037482440471649, 1.857359711721074e-05]], [[2.1903622027252823e-08, 1.0, 1.295337751991421e-12], [0.994569718837738, 0.002124621532857418, 0.003305647289380431]], [[8.26690751409842e-08, 0.9999998807907104, 2.7143453703768437e-14], [0.9513782262802124, 0.04744571074843407, 0.001176080317236483]], [[0.0005862918915227056, 0.9994137287139893, 1.0064976629919897e-11], [0.006302466616034508, 0.9936968684196472, 7.500558467654628e-07]], [[0.9823030829429626, 0.01759469136595726, 0.00010223076242255047], [0.0007480432977899909, 0.9992515444755554, 3.3512344543851214e-07]], [[0.9752655625343323, 0.024123122915625572, 0.0006113459821790457], [0.0025365727487951517, 0.9974527955055237, 1.0549531907599885e-05]], [[0.9589206576347351, 0.039550866931676865, 0.001528436318039894], [0.012157844379544258, 0.9877709150314331, 7.121162343537435e-05]], [[0.9604454040527344, 0.034878991544246674, 0.004675565753132105], [0.031655505299568176, 0.9681553244590759, 0.0001891471038106829]], [[0.9506558179855347, 0.039680831134319305, 0.00966325681656599], [0.0571809858083725, 0.9425049424171448, 0.0003140241897199303]], [[0.9423720836639404, 0.03984345868229866, 0.01778445765376091], [0.07621069997549057, 0.9234210252761841, 0.0003682007372844964]], [[0.9297811985015869, 0.04288937523961067, 0.027329297736287117], [0.11305857449769974, 0.8863712549209595, 0.0005701156333088875]], [[0.9145852327346802, 0.047828368842601776, 0.037586357444524765], [0.14458388090133667, 0.8546212911605835, 0.0007949064020067453]], [[0.03757951408624649, 1.764380819224698e-08, 0.9624204635620117], [0.678652822971344, 0.3126135766506195, 0.008733546361327171]], [[0.7918369174003601, 0.0003376860695425421, 0.20782539248466492], [0.4280390441417694, 0.5688994526863098, 0.0030614580027759075]], [[0.6411670446395874, 0.3411724865436554, 0.01766050048172474], [0.1803971529006958, 0.8185747861862183, 0.0010280674323439598]], [[0.613621711730957, 0.35302987694740295, 0.03334840014576912], [0.3098677694797516, 0.6851488947868347, 0.004983371123671532]], [[0.14202027022838593, 1.7905905451698345e-06, 0.8579779267311096], [0.7163999676704407, 0.27405112981796265, 0.009548929519951344]], [[0.4689902365207672, 0.5007614493370056, 0.03024834580719471], [0.3666522204875946, 0.6287170052528381, 0.004630751442164183]], [[0.18207630515098572, 4.76934498838677e-11, 0.8179236650466919], [0.5619856715202332, 7.762785116938176e-07, 0.4380135238170624]], [[0.3197192847728729, 4.3936179694448185e-10, 0.6802806854248047], [0.8193556070327759, 0.18064440786838531, 1.262183135786188e-10]], [[0.9986322522163391, 4.476463345781667e-06, 0.001363221905194223], [1.0202063094766345e-05, 0.9999897480010986, 2.1673398265305513e-21]], [[4.360130333225243e-06, 3.3888528094827564e-10, 0.9999955892562866], [0.9999843835830688, 1.4258276678447146e-05, 1.2779835287801689e-06]], [[0.0006166152888908982, 3.1474360895344944e-08, 0.9993833303451538], [0.000686284271068871, 6.644257410926002e-08, 0.9993137121200562]], [[1.5787856000315514e-06, 4.542708666122053e-06, 0.9999939203262329], [0.8366423845291138, 2.3437776164314528e-08, 0.16335761547088623]], [[8.395430184382491e-11, 6.883192327222787e-08, 0.9999998807907104], [0.6641116142272949, 0.00011774212907766923, 0.3357705771923065]], [[0.00010006095544667915, 3.883754207123502e-09, 0.9998999834060669], [0.00927043054252863, 3.683062459458597e-05, 0.9906927943229675]], [[0.929874062538147, 1.6346515963050479e-07, 0.07012581080198288], [4.382070073916111e-06, 0.0043761879205703735, 0.9956193566322327]], [[0.9999995231628418, 3.598727573717042e-07, 1.3903417084293324e-07], [9.175392650523362e-13, 1.4620312738244934e-09, 1.0]], [[0.9998821020126343, 7.269233037732192e-07, 0.0001171929543488659], [3.13041184085705e-08, 4.613686321874866e-09, 1.0]], [[0.7427145838737488, 7.495319005101919e-05, 0.2572103440761566], [0.8921403288841248, 0.00011187223572051153, 0.10774780064821243]], [[0.8866839408874512, 0.11328621208667755, 2.992485315189697e-05], [0.9929297566413879, 0.0067881192080676556, 0.0002822360838763416]], [[0.9820074439048767, 0.017949098721146584, 4.3471212848089635e-05], [0.9946528673171997, 0.005071476101875305, 0.0002756878675427288]], [[0.9798021912574768, 0.020158788189291954, 3.9035880035953596e-05], [0.9957072734832764, 0.004083507228642702, 0.0002091534115606919]], [[0.9852178692817688, 0.014679611660540104, 0.00010257118265144527], [0.997566819190979, 0.0021964285988360643, 0.00023676949786022305]], [[0.9874922037124634, 0.011958619579672813, 0.0005492144846357405], [0.9977399110794067, 0.0016622631810605526, 0.0005978317349217832]], [[0.8010631203651428, 5.144846727489494e-05, 0.1988854557275772], [0.9870166182518005, 0.0012471401132643223, 0.011736233718693256]], [[0.7960307002067566, 0.00020566926104947925, 0.2037637084722519], [0.9633474349975586, 0.0013644068967550993, 0.03528812527656555]], [[0.7252059578895569, 0.00041356505244039, 0.27438053488731384], [0.9300342798233032, 0.001627430785447359, 0.0683382973074913]], [[0.6321533918380737, 0.0007417286396957934, 0.36710482835769653], [0.8638622760772705, 0.0016337187262251973, 0.1345040649175644]], [[0.5611394643783569, 0.0012442638399079442, 0.4376162588596344], [0.7749859094619751, 0.001563628320582211, 0.2234504371881485]], [[0.2593759298324585, 1.4043462215340696e-05, 0.7406100630760193], [0.6572495102882385, 0.34270501136779785, 4.550723679130897e-05]], [[0.5381653308868408, 0.4478958547115326, 0.013938807882368565], [0.9020388126373291, 0.09605138748884201, 0.0019099018536508083]], [[0.021063486114144325, 1.691447676366309e-11, 0.9789365530014038], [0.9573869109153748, 1.3138720760252909e-06, 0.04261167347431183]], [[0.07932861149311066, 0.9206711053848267, 2.85232573560279e-07], [0.9990425705909729, 0.0009574353462085128, 7.707289029212916e-09]], [[0.9996535778045654, 1.1569291018531658e-05, 0.0003349059843458235], [0.0003167336108162999, 0.9996832609176636, 7.60820716272896e-16]], [[0.002790123224258423, 0.006867542862892151, 0.990342378616333], [0.0006724380073137581, 0.0005404113326221704, 0.9987872242927551]], [[0.9549639821052551, 0.032220061868429184, 0.012815955094993114], [3.386971729923971e-05, 3.3766458074069305e-08, 0.9999661445617676]], [[0.9961649179458618, 0.001316453330218792, 0.0025186389684677124], [0.999264657497406, 0.00024327688151970506, 0.0004920536885038018]], [[0.731003999710083, 0.0038188945036381483, 0.26517704129219055], [0.044461656361818314, 0.9555375576019287, 7.729923936494743e-07]], [[0.16409896314144135, 0.8355623483657837, 0.0003386958851478994], [0.17644329369068146, 0.8235271573066711, 2.9522014301619492e-05]], [[0.9570995569229126, 0.002829240169376135, 0.04007120430469513], [0.9468021988868713, 0.001823017024435103, 0.05137471854686737]], [[0.9533230662345886, 0.013842521235346794, 0.03283439204096794], [0.9418171644210815, 0.0006630686111748219, 0.05751977115869522]], [[0.9079962968826294, 0.019746270030736923, 0.07225744426250458], [0.8467035889625549, 0.000606966728810221, 0.15268951654434204]], [[0.7930029630661011, 0.0172482468187809, 0.18974880874156952], [0.641586184501648, 0.0016296141548082232, 0.3567841649055481]], [[0.4214547276496887, 0.013883356004953384, 0.5646618604660034], [0.5255785584449768, 0.0056249466724693775, 0.4687964916229248]], [[0.14675194025039673, 0.01334724947810173, 0.8399008512496948], [0.3893239200115204, 0.023984365165233612, 0.5866917371749878]], [[0.14884358644485474, 0.6665534973144531, 0.18460282683372498], [0.012536604888737202, 0.005845863372087479, 0.9816175103187561]], [[0.048937126994132996, 0.12752996385097504, 0.8235328793525696], [0.22822657227516174, 0.558668851852417, 0.21310463547706604]], [[0.007930939085781574, 0.9900890588760376, 0.001979970373213291], [0.009781205095350742, 0.9902154207229614, 3.4591619169077603e-06]], [[0.02998746745288372, 0.4924829602241516, 0.4775296151638031], [0.0514228492975235, 0.847138524055481, 0.10143861919641495]], [[0.022884827107191086, 0.008733432739973068, 0.9683817625045776], [0.06058431416749954, 0.09982391446828842, 0.8395917415618896]], [[0.07830438762903214, 0.30822595953941345, 0.6134696006774902], [0.05209781974554062, 0.1927064210176468, 0.7551957368850708]], [[0.026179606094956398, 0.7752299904823303, 0.19859039783477783], [0.08551853895187378, 0.8296135663986206, 0.08486780524253845]], [[0.04151300713419914, 0.21524491906166077, 0.743242084980011], [0.047643352299928665, 0.23321692645549774, 0.7191396951675415]], [[0.024047939106822014, 0.8305407762527466, 0.14541131258010864], [0.06580514460802078, 0.5163301229476929, 0.41786468029022217]], [[0.07351819425821304, 0.37531790137290955, 0.551163911819458], [0.031927138566970825, 0.23273660242557526, 0.735336184501648]], [[2.154280082322657e-06, 0.9999978542327881, 4.877362077583547e-14], [6.975230644457042e-05, 4.1217410284843936e-07, 0.9999297857284546]], [[0.0005402882816269994, 0.629927933216095, 0.3695317506790161], [0.0008929466130211949, 0.10192312300205231, 0.8971839547157288]], [[1.7337330064037815e-05, 0.9999827146530151, 2.5513509897432882e-14], [6.757732936603367e-13, 1.0, 3.2086972786647054e-26]], [[9.218857899284671e-10, 1.0, 4.0709668700506635e-16], [2.1870482855290696e-11, 1.0, 1.2967669103963187e-19]], [[5.625779841977874e-09, 0.9988225102424622, 0.0011775133898481727], [9.387025878826449e-11, 1.0, 8.314120947261472e-09]], [[3.265617160366774e-12, 0.9999507665634155, 4.9188816774403676e-05], [8.416870173923174e-14, 1.0, 1.5555264324881857e-12]], [[1.2054368787872694e-11, 4.7819192161568935e-08, 1.0], [1.6194500845586116e-14, 1.0, 2.5355034612273473e-17]], [[1.461739580153323e-15, 9.736375768121253e-12, 1.0], [3.975016760193739e-09, 1.0, 2.8449860245416403e-09]], [[4.616357091106723e-15, 3.2834523988611863e-09, 1.0], [1.5007692490002014e-14, 3.139385740979399e-16, 1.0]], [[6.288653014643581e-19, 3.125332207069919e-17, 1.0], [7.172656912857178e-11, 0.9999982118606567, 1.8451651158102322e-06]], [[2.8278226982259014e-11, 5.105599498733682e-09, 1.0], [1.4237671778312075e-14, 5.396576672404667e-14, 1.0]], [[2.0574785253302252e-07, 3.93923073715996e-06, 0.9999958276748657], [1.1933856125523334e-09, 0.9999991655349731, 8.548583991796477e-07]], [[3.687333389734704e-07, 0.0009926696075126529, 0.9990070462226868], [7.0727046441732e-09, 1.3073836271360051e-05, 0.9999868869781494]], [[6.750862091564613e-10, 0.01663356088101864, 0.9833663702011108], [5.830743443624442e-09, 0.9999998807907104, 7.833656212596907e-08]], [[1.768320732897788e-11, 6.3891065771315425e-09, 1.0], [2.0510460666564416e-14, 3.309124025144272e-12, 1.0]], [[7.925550406934212e-14, 5.768260535887748e-08, 1.0], [1.307610486903088e-12, 1.0, 1.6713191635232653e-14]], [[3.346317797511822e-12, 1.0275119644020947e-10, 1.0], [1.5202905601086059e-10, 0.9963819980621338, 0.0036180205643177032]], [[1.1339701747048458e-11, 3.9821593134092836e-08, 1.0], [4.396806529971542e-11, 4.3322256715327967e-07, 0.9999995231628418]], [[1.5276031307964733e-12, 3.0912938875360396e-11, 1.0], [1.0821630397339632e-10, 1.0896942512772512e-06, 0.999998927116394]], [[2.604457795263304e-11, 0.00027412071358412504, 0.999725878238678], [2.8638081489562595e-12, 1.0, 1.5963246620832178e-13]], [[1.2748906748002997e-12, 3.4198796572404433e-10, 1.0], [5.116855827935751e-10, 0.9999997615814209, 2.1678481232356717e-07]], [[1.7168443056103655e-10, 2.8026192477881295e-10, 1.0], [1.5219138341064642e-13, 2.791987308015109e-09, 1.0]], [[3.096923606449309e-09, 0.9448874592781067, 0.05511254817247391], [1.8508107757497783e-07, 0.012495132163167, 0.9875046610832214]], [[1.232055152344813e-10, 6.219272601255821e-13, 1.0], [9.241030683726503e-12, 1.0, 1.1435237201595783e-09]], [[0.014870857819914818, 0.9782588481903076, 0.006870279088616371], [1.0288651181022956e-10, 0.9999980926513672, 1.8651018081072834e-06]]]; // action probs
        var action =  [[0, 2], [2, 1], [0, 2], [1, 1], [0, 0], [0, 1], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1, 0], [0, 0], [1, 2], [1, 0], [0, 0], [0, 0], [1, 0], [1, 0], [1, 0], [1, 0], [0, 0], [1, 0], [2, 0], [0, 0], [0, 0], [1, 1], [2, 1], [2, 0], [1, 0], [2, 1], [1, 1], [2, 0], [2, 0], [1, 0], [1, 0], [1, 0], [1, 1], [2, 0], [1, 1], [1, 0], [1, 0], [1, 0], [1, 1], [1, 2], [0, 1], [2, 2], [0, 0], [0, 0], [0, 0], [0, 0], [1, 1], [2, 0], [1, 2], [0, 1], [0, 0], [0, 0], [0, 0], [0, 2], [0, 0], [0, 0], [0, 1], [2, 0], [2, 0], [2, 0], [2, 0], [2, 0], [0, 0], [0, 0], [0, 1], [2, 0], [1, 0], [2, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 2], [0, 0], [0, 0], [0, 1], [1, 0], [1, 0], [1, 0], [1, 0], [1, 0], [1, 1], [2, 1], [1, 1], [2, 1], [0, 1], [0, 1], [0, 1], [0, 1], [0, 1], [0, 1], [0, 1], [0, 1], [0, 1], [0, 1], [1, 1], [2, 0], [0, 0], [0, 0], [1, 1], [0, 0], [1, 0], [1, 0], [1, 0], [1, 0], [1, 1], [0, 1], [0, 1], [0, 1], [0, 1], [0, 1], [0, 1], [0, 1], [1, 0], [2, 1], [2, 1], [0, 1], [1, 0], [2, 0], [1, 0], [2, 2], [0, 0], [0, 1], [2, 0], [2, 2], [2, 0], [2, 0], [2, 2], [0, 2], [0, 2], [0, 2], [2, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 2], [2, 0], [1, 0], [2, 0], [1, 0], [0, 1], [2, 2], [0, 2], [0, 0], [2, 1], [1, 1], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2, 0], [1, 2], [2, 2], [1, 1], [1, 1], [2, 0], [0, 2], [1, 1], [2, 2], [0, 1], [2, 0], [1, 2], [2, 2], [1, 1], [1, 1], [1, 1], [1, 1], [2, 1], [2, 1], [2, 2], [2, 1], [2, 2], [2, 1], [2, 2], [2, 1], [2, 2], [2, 1], [2, 1], [2, 2], [2, 2], [2, 1], [2, 1], [2, 2], [1, 2], [2, 1], [1, 1]];
        var action_names = [['no-op', 'left', 'right'], ['no-op', 'up', 'down']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Transformer") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step;
        visualizeAttentionScores(y_attention_weights[step], top_n);
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>