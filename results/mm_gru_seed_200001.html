<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
        min-width: 1737px;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row nowrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="location.href='../index.html'">Back</button>
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MortarMayhem-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 200001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>arena_size</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>allowed_commands</b>: 9<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_count</b>: [10]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_duration</b>: [6]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_delay</b>: [18]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_failure</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_success</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_episode_success</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 200001<br><b>reward_normalization</b>: 0<br><b>positional_endocing</b>: False<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: -1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 512<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_layers</b>: 1<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 30000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: {'initial': 0.0}<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <center>
        <h1> Mortar Mayhem <br> + Gated Recurrent Unit</h1>
        <br>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Attention Scores</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Number of Top Attention Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_200001_61.webm', '', '', '', 'videos/video_seed_200001_62.webm', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.3442848026752472], [0.3479142487049103], [0.3485024571418762], [0.3499990701675415], [0.35225969552993774], [0.35281115770339966], [0.35465943813323975], [0.35469987988471985], [0.3618639409542084], [0.36116206645965576], [0.362436443567276], [0.36244842410087585], [0.36580848693847656], [0.3658507466316223], [0.3686198592185974], [0.3721832036972046], [0.37329035997390747], [0.3748015761375427], [0.37729567289352417], [0.3779802918434143], [0.3835684061050415], [0.3882516622543335], [0.3900506794452667], [0.39161962270736694], [0.39509493112564087], [0.3969919979572296], [0.3996388912200928], [0.399705171585083], [0.4029895067214966], [0.4061816930770874], [0.40857523679733276], [0.4083942174911499], [0.4122994542121887], [0.4137394428253174], [0.4161551594734192], [0.4161830544471741], [0.4176335334777832], [0.4191073179244995], [0.42110341787338257], [0.42336201667785645], [0.4283388555049896], [0.4292581379413605], [0.42991870641708374], [0.43219488859176636], [0.4356611967086792], [0.4371379017829895], [0.4371163249015808], [0.44075411558151245], [0.44266554713249207], [0.44584453105926514], [0.44871872663497925], [0.45072415471076965], [0.45452117919921875], [0.4551350474357605], [0.45803302526474], [0.46010518074035645], [0.461952269077301], [0.4632384181022644], [0.36576029658317566], [0.36973443627357483], [0.3706602156162262], [0.36987370252609253], [0.3723808825016022], [0.3718562126159668], [0.37816324830055237], [0.3752950131893158], [0.37994706630706787], [0.38306617736816406], [0.3858221173286438], [0.38494330644607544], [0.3881319463253021], [0.38931727409362793], [0.39099326729774475], [0.3927781283855438], [0.3949013650417328], [0.4028678834438324], [0.39960169792175293], [0.4014418125152588], [0.402965247631073], [0.40419071912765503], [0.4064493477344513], [0.40686604380607605], [0.30871403217315674], [0.3074869215488434], [0.310281902551651], [0.3129056692123413], [0.31435978412628174], [0.3184755742549896], [0.3191151022911072], [0.31565234065055847], [0.32053080201148987], [0.32291659712791443], [0.31919556856155396], [0.32273736596107483], [0.3259959816932678], [0.327524334192276], [0.3289209008216858], [0.33066198229789734], [0.33226117491722107], [0.3340453803539276], [0.33824649453163147], [0.3404846787452698], [0.3404654562473297], [0.3413529098033905], [0.3427371680736542], [0.3425754904747009], [0.24867954850196838], [0.2522905766963959], [0.2537451684474945], [0.2502095401287079], [0.2541806101799011], [0.25372159481048584], [0.2561129927635193], [0.2565564513206482], [0.2535083591938019], [0.2595880925655365], [0.2654886543750763], [0.2635497748851776], [0.2642494738101959], [0.2653830349445343], [0.26657092571258545], [0.267735093832016], [0.26890143752098083], [0.2700536549091339], [0.27115800976753235], [0.2732851505279541], [0.27314338088035583], [0.2753406763076782], [0.2785201370716095], [0.27939796447753906], [0.18144667148590088], [0.183166041970253], [0.18276414275169373], [0.18458247184753418], [0.18804386258125305], [0.18718960881233215], [0.18942691385746002], [0.1859477162361145], [0.18428288400173187], [0.1870429366827011], [0.18825554847717285], [0.18919995427131653], [0.19036909937858582], [0.19160693883895874], [0.19274869561195374], [0.19366419315338135], [0.1944064199924469], [0.19585809111595154], [0.1968536376953125], [0.19725236296653748], [0.19517318904399872], [0.19592046737670898], [0.19646471738815308], [0.1977473497390747], [0.09694917500019073], [0.09861014038324356], [0.0980694517493248], [0.10061429440975189], [0.10326767712831497], [0.09961476176977158], [0.1052764430642128], [0.10550114512443542], [0.09891562163829803], [0.09947701543569565], [0.1012943834066391], [0.10402025282382965], [0.10631468892097473], [0.10744611918926239], [0.10972566902637482], [0.10966427624225616], [0.10980668663978577], [0.11173320561647415], [0.11183875054121017], [0.11210977286100388], [0.11386775970458984], [0.1153351292014122], [0.11403153836727142], [0.11343099176883698], [0.014521166682243347], [0.013166159391403198], [0.012969359755516052], [0.011990301311016083], [0.011785298585891724], [0.01171480119228363], [0.011955305933952332], [0.011066175997257233], [0.01272391527891159], [0.0131196528673172], [0.012966364622116089], [0.013446994125843048], [0.011579185724258423], [0.01228303462266922], [0.011083975434303284], [0.013110071420669556], [0.012898057699203491], [0.013740725815296173], [0.012413524091243744], [0.012185931205749512], [0.013365454971790314], [0.011836513876914978], [0.012450627982616425], [0.01260007917881012], [0.014679759740829468]];
        var y_entropy = [[0.3372901678085327, 0.7245143055915833], [0.9378969669342041, 0.7282309532165527], [0.9653536081314087, 0.7067716717720032], [0.9227339029312134, 0.4093686640262604], [0.23604348301887512, 0.6595749855041504], [0.15426786243915558, 0.6401697993278503], [0.121657595038414, 0.5386368036270142], [0.7632415890693665, 0.49321290850639343], [0.14591696858406067, 0.4288727343082428], [0.23719576001167297, 0.7322865724563599], [0.30402088165283203, 0.6947240829467773], [0.49956759810447693, 0.5609297156333923], [0.48978185653686523, 0.4940398633480072], [0.9394952654838562, 0.4651731848716736], [0.9799238443374634, 0.4052131175994873], [0.7867426872253418, 0.8488885164260864], [0.8954930305480957, 0.29977965354919434], [1.0535776615142822, 0.38607344031333923], [1.0626471042633057, 0.39397144317626953], [1.0865979194641113, 0.798008382320404], [1.0182223320007324, 0.45039379596710205], [1.05344820022583, 0.5453571081161499], [1.0779653787612915, 0.5592411756515503], [0.4819985628128052, 0.07095497846603394], [1.0758661031723022, 0.7082833051681519], [1.0934776067733765, 0.7486414909362793], [1.0933939218521118, 0.7688120603561401], [0.37138983607292175, 0.01258439477533102], [1.0878947973251343, 0.7162054777145386], [1.0554530620574951, 0.7602426409721375], [1.0692148208618164, 0.7733191251754761], [0.26641592383384705, 0.01715756393969059], [1.0057352781295776, 0.8047006130218506], [1.0528590679168701, 0.781343400478363], [1.0537452697753906, 0.7850314378738403], [0.1873314380645752, 0.01984941028058529], [0.8801748752593994, 0.8055217862129211], [1.0163884162902832, 0.8509524464607239], [1.0290628671646118, 0.8596644997596741], [0.20094914734363556, 0.02286982536315918], [0.26996615529060364, 0.057051703333854675], [0.17258742451667786, 0.009635752066969872], [0.39195218682289124, 0.011766533367335796], [0.1682731807231903, 0.0024632548447698355], [0.0024138165172189474, 0.7594751715660095], [0.9443507790565491, 0.15927687287330627], [0.054896894842386246, 0.28311887383461], [0.685085654258728, 0.6881682276725769], [0.7268063426017761, 0.7568575739860535], [0.7123494148254395, 0.5834822058677673], [0.057500164955854416, 0.806738555431366], [0.6499124765396118, 0.5107380151748657], [0.05302486941218376, 0.7221631407737732], [0.5432825088500977, 0.3711654543876648], [0.46138322353363037, 0.4560962915420532], [0.23967882990837097, 0.3879212737083435], [0.6220764517784119, 0.21613013744354248], [0.6939921379089355, 0.2551339566707611], [0.23700642585754395, 0.03409499675035477], [0.01137792319059372, 0.027285980060696602], [0.007239711936563253, 0.04523827135562897], [0.03442880138754845, 0.31757622957229614], [0.0017153762746602297, 0.0009026177576743066], [0.6021513938903809, 0.42476505041122437], [0.6280646324157715, 3.3649180295469705e-06], [0.021284468472003937, 1.5611569779139245e-06], [0.0006549690733663738, 1.2911179902985737e-09], [0.40625277161598206, 2.847023949925642e-07], [0.05393846705555916, 0.003278651274740696], [0.5897827744483948, 0.4883403480052948], [0.3313416540622711, 0.00032615664531476796], [0.557415246963501, 0.6366370916366577], [0.5279739499092102, 0.6205946803092957], [0.6399312019348145, 0.444735050201416], [0.5034568309783936, 0.4489309787750244], [0.3592261075973511, 0.003906171303242445], [0.6057156324386597, 0.5539911985397339], [0.30157023668289185, 0.1370031237602234], [0.6785869002342224, 0.4573467969894409], [0.5305551886558533, 0.12360087782144547], [0.6741777658462524, 0.4348791241645813], [0.3245675265789032, 0.3562159240245819], [0.21918392181396484, 0.38316017389297485], [0.08218193054199219, 0.009066173806786537], [0.010326329618692398, 0.0008878288208507001], [0.04244955629110336, 0.20400746166706085], [2.158397364837583e-06, 0.0034659679513424635], [7.076510399883773e-08, 0.000383789069019258], [0.0001657603424973786, 0.004154364578425884], [1.9170784071320668e-08, 0.21217390894889832], [0.00018797883240040392, 0.49419012665748596], [0.2879425883293152, 0.569724440574646], [0.6784413456916809, 0.5658701062202454], [0.5362622141838074, 0.3303340673446655], [0.5411799550056458, 0.4178897440433502], [0.40279045701026917, 0.4710553288459778], [0.29873302578926086, 0.5407731533050537], [0.24596214294433594, 0.6153855919837952], [0.215553879737854, 0.65629643201828], [0.19731421768665314, 0.6746749877929688], [0.34264999628067017, 0.3949645459651947], [0.2521430552005768, 0.3218839466571808], [0.44541412591934204, 0.53397136926651], [0.23869937658309937, 0.6242415308952332], [0.1932966262102127, 0.6233918070793152], [0.05347698926925659, 0.3430633246898651], [0.6020206212997437, 0.0729711726307869], [0.4609355926513672, 0.5338132381439209], [0.6617292761802673, 0.07360563427209854], [0.003997864667326212, 0.06386327743530273], [0.6564393043518066, 0.000599431514274329], [0.1020745187997818, 0.0001995544007513672], [0.028580350801348686, 0.0003411129582673311], [0.001560361124575138, 0.0016132451128214598], [5.908435127821576e-07, 0.03674786537885666], [0.009907144121825695, 0.024453001096844673], [0.08620050549507141, 0.1482827365398407], [0.15031547844409943, 0.3782879412174225], [0.2174806296825409, 0.34502217173576355], [0.3378415107727051, 0.32171010971069336], [0.4351288676261902, 0.3121172785758972], [0.5266076922416687, 0.30180537700653076], [0.6014026403427124, 0.3054215908050537], [0.6554609537124634, 0.31857141852378845], [0.6909670829772949, 0.33252114057540894], [0.5218502283096313, 0.6940749883651733], [0.33842599391937256, 0.6968814134597778], [0.34399017691612244, 0.6979551315307617], [0.18824739754199982, 0.40613269805908203], [0.3144306540489197, 0.27728527784347534], [0.3439916670322418, 0.05049028992652893], [0.034680791199207306, 0.02657766081392765], [0.6929222345352173, 0.014368001371622086], [0.03502262011170387, 0.5853598117828369], [0.029294200241565704, 0.019720807671546936], [0.11930573731660843, 0.00030397778027690947], [0.07175935059785843, 0.6690285205841064], [0.11366377025842667, 0.22989141941070557], [0.14695964753627777, 0.5295013189315796], [0.0226194579154253, 0.2008751630783081], [0.012172438204288483, 0.06608490645885468], [0.013295897282660007, 0.04230671748518944], [0.021002374589443207, 0.05205336958169937], [0.02967788651585579, 0.10216320306062698], [0.04341087490320206, 0.21930928528308868], [0.08306466042995453, 0.41620659828186035], [0.1571047008037567, 0.6217951774597168], [0.1460413783788681, 0.18689507246017456], [0.2302321344614029, 0.5445361137390137], [0.3645656108856201, 0.6472792029380798], [0.3195655047893524, 0.542260468006134], [0.4069499373435974, 0.2730002999305725], [0.43916910886764526, 0.3019268810749054], [0.4984804391860962, 0.31929871439933777], [0.13550369441509247, 0.20353499054908752], [0.11761409789323807, 0.006782454904168844], [0.024520546197891235, 0.6784080266952515], [4.896959580946714e-05, 3.648046185844578e-05], [0.002229427918791771, 0.00012721920211333781], [0.0003838265547528863, 0.007448393851518631], [4.1029379644896835e-06, 0.013302288949489594], [0.00038557391962967813, 0.43017399311065674], [0.5568163394927979, 0.06521415710449219], [0.010523149743676186, 0.006554214283823967], [0.2683759033679962, 0.03462836891412735], [0.15863044559955597, 0.1447117030620575], [0.02321552485227585, 0.3478841483592987], [0.49623820185661316, 0.2890903055667877], [0.7454091310501099, 0.5905773043632507], [0.5323981642723083, 0.7679938077926636], [0.061230067163705826, 0.7596662640571594], [0.3809633255004883, 0.4451276361942291], [0.6054791212081909, 0.1284017711877823], [0.280909925699234, 0.5198137760162354], [0.3882153034210205, 0.17868803441524506], [0.12520766258239746, 0.7497771978378296], [0.24978139996528625, 0.25451987981796265], [0.40272730588912964, 0.6685255169868469], [0.0008519546827301383, 0.0004576215287670493], [0.26855146884918213, 0.018024247139692307], [0.0049989051185548306, 0.09235130250453949], [2.327415371539132e-09, 0.1320957988500595], [2.114223605076404e-07, 3.479757992863597e-08], [2.8646660155118298e-08, 8.167799769864814e-10], [0.00021945970365777612, 3.453905998013207e-13], [2.0321799638622906e-06, 1.4801136671849235e-07], [2.91008817043803e-08, 1.7197224200238281e-10], [9.126087821928502e-17, 6.147870212913631e-09], [0.004185383208096027, 5.569505967528698e-10], [6.58789140288718e-05, 0.0026941196992993355], [5.1807030104100704e-05, 5.348588585918357e-11], [0.002892217366024852, 1.8124241250916384e-05], [1.1928823369089514e-06, 2.3116843725703995e-13], [4.5430624540099274e-11, 2.4612386781419637e-11], [0.0026612444780766964, 3.478616728003203e-09], [0.00022465467918664217, 0.005848421715199947], [0.06278844177722931, 2.1878681089049223e-09], [0.016608379781246185, 0.002215861575677991], [0.07302513718605042, 4.984667345553362e-09], [3.9601655288379334e-11, 0.00023823151423130184], [0.00015153791173361242, 1.4701448391996053e-10], [4.265661174979174e-13, 0.0009688903810456395], [0.00034313026117160916, 4.0075310607790016e-06]];
        var y_attention_weights = [];
        var y_action = [[[0.9088093042373657, 0.010226820595562458, 0.08096382766962051], [0.23023520410060883, 0.04996662959456444, 0.7197981476783752]], [[0.5246370434761047, 0.10107769072055817, 0.3742852807044983], [0.15359170734882355, 0.09602224826812744, 0.7503860592842102]], [[0.5805037021636963, 0.1757105141878128, 0.2437857687473297], [0.29010096192359924, 0.023895787075161934, 0.6860032081604004]], [[0.08660995215177536, 0.40893712639808655, 0.5044529438018799], [0.13621371984481812, 0.8622379899024963, 0.0015482710441574454]], [[0.9427051544189453, 0.0048377602361142635, 0.05245699733495712], [0.7859713435173035, 0.13613292574882507, 0.07789567857980728]], [[0.9702117443084717, 0.01728459820151329, 0.012503691017627716], [0.7994371056556702, 0.09850187599658966, 0.10206104069948196]], [[0.9776741862297058, 0.014087303541600704, 0.008238515816628933], [0.8393223285675049, 0.04784306883811951, 0.11283450573682785]], [[0.42450547218322754, 0.5570694208145142, 0.018425028771162033], [0.8632544875144958, 0.07468294352293015, 0.062062572687864304]], [[0.9722394943237305, 0.015520481392741203, 0.012240007519721985], [0.8852435946464539, 0.037521589547395706, 0.07723481208086014]], [[0.9483616948127747, 0.032794881612062454, 0.018843412399291992], [0.6854118704795837, 0.03487035632133484, 0.2797177731990814]], [[0.9286578297615051, 0.0451086200773716, 0.0262336153537035], [0.7203009128570557, 0.03327685594558716, 0.2464222013950348]], [[0.16709600389003754, 0.8242093324661255, 0.008694682270288467], [0.8157132267951965, 0.1535317301750183, 0.03075508587062359]], [[0.8648057579994202, 0.06977973133325577, 0.06541454046964645], [0.8510538339614868, 0.028815610334277153, 0.12013054639101028]], [[0.5929829478263855, 0.14281079173088074, 0.26420629024505615], [0.8629382252693176, 0.025317363440990448, 0.11174435168504715]], [[0.5571228265762329, 0.16672027111053467, 0.2761569619178772], [0.8902424573898315, 0.025256842374801636, 0.08450073003768921]], [[0.2118498533964157, 0.7027687430381775, 0.08538145571947098], [0.6417098641395569, 0.27315106987953186, 0.08513907343149185]], [[0.6313982009887695, 0.24175024032592773, 0.12685157358646393], [0.9306846857070923, 0.03678401932120323, 0.03253135457634926]], [[0.4643738567829132, 0.3148285150527954, 0.22079767286777496], [0.9027460813522339, 0.05271895229816437, 0.044534921646118164]], [[0.45881715416908264, 0.2951037883758545, 0.24607904255390167], [0.9001466631889343, 0.04957393929362297, 0.05027947947382927]], [[0.26217737793922424, 0.3616268038749695, 0.37619587779045105], [0.336893767118454, 0.6201648116111755, 0.0429413765668869]], [[0.4762858748435974, 0.3588677644729614, 0.1648462861776352], [0.8791884779930115, 0.07104940712451935, 0.04976212605834007]], [[0.39912399649620056, 0.40296658873558044, 0.1979093700647354], [0.8407567739486694, 0.09609878808259964, 0.06314437836408615]], [[0.3422844409942627, 0.4104712903499603, 0.24724426865577698], [0.8349076509475708, 0.09877263754606247, 0.06631973385810852]], [[0.14973542094230652, 0.011230343952775002, 0.8390341997146606], [0.013162951916456223, 0.9867522716522217, 8.483311103191227e-05]], [[0.43015995621681213, 0.2583736181259155, 0.31146642565727234], [0.7645918130874634, 0.1262321174144745, 0.10917609930038452]], [[0.3005064129829407, 0.38027000427246094, 0.3192236125469208], [0.73793625831604, 0.16366146504878998, 0.09840219467878342]], [[0.2858814299106598, 0.35452404618263245, 0.3595944941043854], [0.723684549331665, 0.1788337379693985, 0.09748177230358124]], [[0.10793401300907135, 0.004675607662647963, 0.8873904347419739], [0.001698559382930398, 0.998297393321991, 3.999473392468644e-06]], [[0.3631804287433624, 0.26577427983283997, 0.37104532122612], [0.7602681517601013, 0.11048665642738342, 0.12924520671367645]], [[0.21816208958625793, 0.45648086071014404, 0.3253571093082428], [0.7299121022224426, 0.172125905752182, 0.09796205163002014]], [[0.22820308804512024, 0.4190416932106018, 0.35275518894195557], [0.7235167622566223, 0.17118315398693085, 0.10530012100934982]], [[0.06685641407966614, 0.0031348199117928743, 0.9300087094306946], [0.00243822461925447, 0.9975578784942627, 3.917570666089887e-06]], [[0.32639357447624207, 0.1642298549413681, 0.509376585483551], [0.7070894837379456, 0.1676107496023178, 0.12529978156089783]], [[0.21125218272209167, 0.3333832323551178, 0.4553645849227905], [0.7092381715774536, 0.20246610045433044, 0.08829575031995773]], [[0.20473815500736237, 0.35589200258255005, 0.43936988711357117], [0.7088133692741394, 0.19894659519195557, 0.09223999828100204]], [[0.0419609434902668, 0.0018171523697674274, 0.9562219381332397], [0.0028913053683936596, 0.9971042275428772, 4.462603101273999e-06]], [[0.2531965374946594, 0.1112581193447113, 0.6355453133583069], [0.7083131670951843, 0.13906234502792358, 0.15262456238269806]], [[0.1709308624267578, 0.3342756927013397, 0.4947933554649353], [0.6713844537734985, 0.20467600226402283, 0.12393946945667267]], [[0.1822059005498886, 0.33755621314048767, 0.4802379310131073], [0.6619195938110352, 0.21807247400283813, 0.12000791728496552]], [[0.04458552971482277, 0.002726281527429819, 0.9526881575584412], [0.003417203901335597, 0.9965788722038269, 3.889221261488274e-06]], [[0.07323626428842545, 0.0010299711721017957, 0.9257338047027588], [0.009380393661558628, 0.9901691675186157, 0.00045046352897770703]], [[0.9591484665870667, 0.04051584005355835, 0.0003357314853928983], [0.0001437804603483528, 0.9988107681274414, 0.00104539527092129]], [[0.8672254085540771, 0.13273942470550537, 3.518496305332519e-05], [0.0006469936342909932, 0.9985718727111816, 0.0007810815586708486]], [[0.040094390511512756, 0.9599035978317261, 2.0828745164180873e-06], [0.00026686940691433847, 0.9997331500053406, 1.647850211838886e-08]], [[0.0002602644672151655, 0.9997393488883972, 3.2680688377695333e-07], [0.4429174065589905, 0.541000485420227, 0.016082147136330605]], [[0.5411021113395691, 0.3472788631916046, 0.11161894351243973], [0.03621856868267059, 0.9633778929710388, 0.0004035340098198503]], [[0.009757842868566513, 7.238280659294105e-07, 0.9902413487434387], [0.934363603591919, 0.020703662186861038, 0.044932782649993896]], [[0.41099801659584045, 0.0010770218214020133, 0.5879249572753906], [0.41375866532325745, 0.5848214030265808, 0.0014199643628671765]], [[0.5981903672218323, 0.011746775358915329, 0.3900628387928009], [0.727218508720398, 0.08709602057933807, 0.18568547070026398]], [[0.5704646706581116, 0.005438544321805239, 0.4240967929363251], [0.8244902491569519, 0.07243642956018448, 0.10307322442531586]], [[0.010325276292860508, 0.9896741509437561, 6.217834425115143e-07], [0.516789436340332, 0.030639374628663063, 0.45257115364074707]], [[0.7080853581428528, 0.010754303075373173, 0.2811603844165802], [0.8480841517448425, 0.037341296672821045, 0.11457459628582001]], [[0.009355980902910233, 0.9906437993049622, 2.4611071580693533e-07], [0.6957893967628479, 0.03460212051868439, 0.2696084976196289]], [[0.8020317554473877, 0.012161878868937492, 0.18580640852451324], [0.9075727462768555, 0.039366982877254486, 0.053060248494148254]], [[0.86113440990448, 0.020705901086330414, 0.11815974116325378], [0.8766580820083618, 0.04828488454222679, 0.07505695521831512]], [[0.06466107815504074, 0.9353331923484802, 5.7211186685890425e-06], [0.9022274613380432, 0.048170942813158035, 0.04960162192583084]], [[0.31334924697875977, 2.911492447310593e-05, 0.6866216659545898], [0.9534826874732971, 0.013478138484060764, 0.03303920850157738]], [[0.5067201852798462, 9.824561857385561e-05, 0.49318158626556396], [0.9431336522102356, 0.019999878481030464, 0.0368664376437664]], [[0.06369161605834961, 2.5033675132846156e-09, 0.9363083839416504], [0.9947307109832764, 0.004952451214194298, 0.00031682857661508024]], [[0.9985319375991821, 0.001379594556055963, 8.838658686727285e-05], [0.9957821369171143, 0.004216527100652456, 1.3319711342774099e-06]], [[0.9990960359573364, 0.0009038251009769738, 7.126246259758773e-08], [0.9922803640365601, 0.007719717919826508, 2.3723989439616844e-10]], [[0.9944368600845337, 0.00556308263912797, 2.5252622215532483e-10], [0.9033871293067932, 0.09661290794610977, 8.641923981977939e-13]], [[0.9998350143432617, 7.552686292910948e-05, 8.942031854530796e-05], [0.9999128580093384, 8.716937009012327e-05, 3.092987199693198e-08]], [[0.2862340211868286, 0.0004015593440271914, 0.7133643627166748], [0.8488113880157471, 1.0592229315875556e-09, 0.15118859708309174]], [[0.7555382251739502, 0.2233434021472931, 0.02111843414604664], [2.1946951278550841e-07, 1.3337087502308226e-15, 0.9999997615814209]], [[0.9971452355384827, 0.002038713777437806, 0.0008160615689121187], [9.664808686693505e-08, 2.9685657144257194e-12, 0.9999998807907104]], [[0.9999412298202515, 5.030446482123807e-05, 8.42471399664646e-06], [5.46382383781463e-11, 2.0711945756921446e-17, 1.0]], [[0.8592937588691711, 0.14070549607276917, 7.064400620038214e-07], [1.5852055668119647e-08, 1.1700854403547414e-17, 1.0]], [[0.00955314002931118, 0.990446925163269, 2.2738198879324045e-08], [0.00036810414167121053, 7.531764656398821e-10, 0.9996318817138672]], [[0.7485440373420715, 0.24611569941043854, 0.00534024415537715], [0.8128132224082947, 0.0009986432269215584, 0.186188206076622]], [[0.8977851271629333, 0.1020193099975586, 0.00019553217862267047], [2.8423673938959837e-05, 0.9999716281890869, 1.4632896673874574e-13]], [[0.2251899689435959, 0.7710064649581909, 0.0038035737816244364], [0.7743785977363586, 0.18736152350902557, 0.038259945809841156]], [[0.21967144310474396, 0.00015569778042845428, 0.7801728248596191], [0.3062182664871216, 0.0005607394850812852, 0.6932210326194763]], [[0.6956382989883423, 0.29938286542892456, 0.004978939890861511], [0.8795344233512878, 0.04045428708195686, 0.08001123368740082]], [[0.8350410461425781, 0.14752613008022308, 0.017432743683457375], [0.8723570704460144, 0.027918726205825806, 0.09972425550222397]], [[0.884107768535614, 0.1158253476023674, 6.694975309073925e-05], [0.00044855798478238285, 0.9995514750480652, 4.133865558891836e-13]], [[0.2879878580570221, 0.7113367319107056, 0.0006752911140210927], [0.8298434615135193, 0.1255820244550705, 0.04457449913024902]], [[0.0895681381225586, 2.3699433313595364e-06, 0.9104294776916504], [0.9742899537086487, 0.014866543002426624, 0.010843639262020588]], [[0.6079429388046265, 0.39072051644325256, 0.0013365385821089149], [0.8678662776947021, 0.10512131452560425, 0.02701243944466114]], [[0.22284503281116486, 5.4354632084141485e-06, 0.7771495580673218], [0.9768660664558411, 0.016775209456682205, 0.006358722224831581]], [[0.6113752722740173, 0.38777580857276917, 0.0008489095489494503], [0.8773003220558167, 0.09727248549461365, 0.025427259504795074]], [[0.9162542223930359, 0.07039251178503036, 0.013353165239095688], [0.8985954523086548, 0.09337829798460007, 0.008026286028325558]], [[0.9428065419197083, 7.800412049618899e-07, 0.05719270557165146], [0.8728541135787964, 0.0003201015933882445, 0.12682577967643738]], [[0.9839640259742737, 2.129253884319837e-09, 0.01603596843779087], [0.9988465309143066, 2.238368324469775e-05, 0.0011310778791084886]], [[0.998641312122345, 5.225804511344023e-11, 0.0013586332788690925], [0.9999151229858398, 8.33309386507608e-05, 1.5114673033167492e-06]], [[0.9928500652313232, 5.377403522466295e-10, 0.007149951532483101], [0.9481222033500671, 0.051877740770578384, 3.953196880956966e-09]], [[1.365506534511951e-07, 9.751032039135175e-17, 0.9999998807907104], [0.9996249675750732, 0.00033233777503483, 4.266091127647087e-05]], [[3.6419101068219106e-09, 8.463644265006799e-16, 1.0], [0.9999678134918213, 2.4352664695470594e-05, 7.908754923846573e-06]], [[1.353473726339871e-05, 3.9994830558498506e-08, 0.9999864101409912], [0.9995226860046387, 0.00047270534560084343, 4.68739608550095e-06]], [[9.214428109416417e-10, 2.775979595728861e-15, 1.0], [0.054715707898139954, 0.9452843070030212, 5.2102503644846365e-08]], [[1.560547752887942e-05, 2.4158409647756507e-11, 0.9999843835830688], [0.8053061366081238, 0.19454286992549896, 0.00015097401046659797]], [[0.9171936511993408, 0.0824362263083458, 0.00037014877307228744], [0.2554265260696411, 0.7444141507148743, 0.00015936938871163875]], [[0.5859533548355103, 0.41403403878211975, 1.26150944197434e-05], [0.7469823956489563, 2.3744176360196434e-05, 0.2529938519001007]], [[0.7726994156837463, 0.2272738665342331, 2.6686615456128493e-05], [0.8978239297866821, 5.861940735485405e-05, 0.10211740434169769]], [[0.7685317397117615, 0.23145565390586853, 1.2518731637101155e-05], [0.8532062768936157, 9.36883152462542e-05, 0.14670002460479736]], [[0.8612690567970276, 0.13871754705905914, 1.341715960734291e-05], [0.8207547664642334, 9.456797852180898e-05, 0.1791505664587021]], [[0.9117038249969482, 0.08828011900186539, 1.6126479749800637e-05], [0.7692992687225342, 7.179647946031764e-05, 0.23062889277935028]], [[0.9330050349235535, 0.06697698682546616, 1.8048252968583256e-05], [0.6951245665550232, 4.555625855573453e-05, 0.304829865694046]], [[0.9441595077514648, 0.055819321423769, 2.12089616979938e-05], [0.6354499459266663, 2.9243727112771012e-05, 0.3645208179950714]], [[0.9504784345626831, 0.04949719458818436, 2.4381150069530122e-05], [0.5963746905326843, 2.02431547222659e-05, 0.40360504388809204]], [[0.8919145464897156, 0.1080695390701294, 1.591625732544344e-05], [0.8797032237052917, 0.11302617192268372, 0.007270661648362875]], [[0.9306641221046448, 0.06931064277887344, 2.5279246983700432e-05], [0.9151857495307922, 0.07443945109844208, 0.010374829173088074]], [[0.83653324842453, 3.400126388442004e-06, 0.16346336901187897], [0.7756406664848328, 0.22415980696678162, 0.00019950680143665522]], [[0.9357247948646545, 1.3405267054622527e-05, 0.0642617866396904], [0.6893599033355713, 0.30999496579170227, 0.0006451559602282941]], [[0.9518113732337952, 1.670107121753972e-05, 0.04817194119095802], [0.6908808946609497, 0.3084132671356201, 0.0007058024639263749]], [[0.9907432198524475, 0.009068666025996208, 0.00018812049529515207], [0.8941264748573303, 0.0009160910849459469, 0.10495739430189133]], [[0.7101470828056335, 3.4808220306103976e-08, 0.28985288739204407], [0.9864014983177185, 0.00019509339472278953, 0.013403459452092648]], [[0.17320747673511505, 9.361429166576674e-12, 0.8267925381660461], [0.77447509765625, 5.292363169928649e-08, 0.22552475333213806]], [[0.6246747374534607, 0.3753252625465393, 3.9773942472898227e-10], [0.986013650894165, 0.013986327685415745, 4.407305453923982e-08]], [[0.0004604011483024806, 0.9995396137237549, 1.8600913401922584e-15], [0.011742426082491875, 0.9882575869560242, 2.53080548562963e-15]], [[0.365336537361145, 0.6346626877784729, 8.553065526939463e-07], [0.9999444484710693, 2.023424805486229e-08, 5.5489930673502386e-05]], [[0.021043961867690086, 0.9789560437202454, 3.5442362933402194e-10], [0.9999834299087524, 1.4281451576891868e-09, 1.6613481420790777e-05]], [[0.00445820577442646, 0.9955417513847351, 2.3930824336049206e-11], [0.999971866607666, 1.8378925233264454e-05, 9.75693365035113e-06]], [[0.00014718096645083278, 0.9998437166213989, 9.067456630873494e-06], [0.9998365640640259, 5.615496775135398e-06, 0.0001578535739099607]], [[3.437973106201753e-08, 1.0, 1.2044835615010463e-14], [0.9940306544303894, 3.740127431228757e-05, 0.005931872874498367]], [[0.0012953552650287747, 0.9987046718597412, 9.150539354019216e-11], [0.9963829517364502, 0.00011428554716985673, 0.0035027500707656145]], [[0.9834420084953308, 0.00039825146086513996, 0.01615970954298973], [0.9717211127281189, 0.013527154922485352, 0.014751794748008251]], [[0.966887891292572, 0.0011266900692135096, 0.03198547661304474], [0.9049803018569946, 0.03888377919793129, 0.056135907769203186]], [[0.9457851052284241, 0.0014655221020802855, 0.05274936556816101], [0.9091038703918457, 0.014817675575613976, 0.07607836276292801]], [[0.897638738155365, 0.0014473606133833528, 0.100913867354393], [0.9136642217636108, 0.008482522331178188, 0.07785332947969437]], [[0.8481723666191101, 0.001685624592937529, 0.15014204382896423], [0.9151529669761658, 0.005995837971568108, 0.07885121554136276]], [[0.7881322503089905, 0.0017605760367587209, 0.21010716259479523], [0.9183631539344788, 0.005091289523988962, 0.07654564827680588]], [[0.722854495048523, 0.0018608795944601297, 0.27528467774391174], [0.9162300825119019, 0.0045018321834504604, 0.07926801592111588]], [[0.6562715768814087, 0.0019410138484090567, 0.3417873978614807], [0.9101583957672119, 0.0040142349898815155, 0.0858273059129715]], [[0.5864349007606506, 0.0020336054731160402, 0.4115314781665802], [0.9037768244743347, 0.0037413984537124634, 0.09248173981904984]], [[0.793067991733551, 0.2047755867242813, 0.002156412461772561], [0.5543312430381775, 0.0009582976927049458, 0.4447104334831238]], [[0.9104686975479126, 0.07659801840782166, 0.012933336198329926], [0.5508178472518921, 0.0013019349426031113, 0.44788017868995667]], [[0.9123912453651428, 0.06764456629753113, 0.019964270293712616], [0.4696742296218872, 0.0009012622176669538, 0.5294244885444641]], [[0.9586242437362671, 0.036013685166835785, 0.0053621334955096245], [0.8660435080528259, 0.13149085640907288, 0.0024657133035361767]], [[0.9251513481140137, 0.048706669360399246, 0.026142043992877007], [0.9349077939987183, 0.04888547584414482, 0.016206638887524605]], [[0.8918663859367371, 0.10794337093830109, 0.00019018244347535074], [0.991332471370697, 0.00013738959387410432, 0.008530071936547756]], [[0.005611661821603775, 0.9943882822990417, 5.575178652073021e-10], [0.9959111213684082, 0.004087748937308788, 1.1357672065059887e-06]], [[0.514096200466156, 0.48588865995407104, 1.5167203855526168e-05], [0.001990516670048237, 0.9980095028877258, 7.208469762667435e-15]], [[0.005626339465379715, 2.2774584067519754e-05, 0.9943509101867676], [0.27107539772987366, 0.00010506265971343964, 0.7288195490837097]], [[0.9959200620651245, 0.0017158259870484471, 0.0023641034495085478], [0.002872352721169591, 3.0441206035902724e-06, 0.9971246123313904]], [[0.02153041772544384, 0.9763094782829285, 0.0021601649932563305], [0.9999736547470093, 2.6338846510043368e-05, 1.1359589935366898e-09]], [[0.013531978242099285, 7.4588979259715416e-06, 0.9864605665206909], [0.3906290531158447, 0.6093709468841553, 5.206657882617094e-10]], [[0.02411634474992752, 6.878731255710591e-07, 0.9758829474449158], [0.06106625869870186, 0.938933789730072, 1.1636775099077568e-08]], [[0.966988205909729, 0.00034116499591618776, 0.032670557498931885], [0.778139054775238, 0.22183649241924286, 2.4531600502086803e-05]], [[0.9969428181648254, 0.0021427825558930635, 0.0009143960196524858], [0.9495981931686401, 0.0001772547111613676, 0.050224579870700836]], [[0.9985095858573914, 0.000551494536921382, 0.0009389723418280482], [0.9878684282302856, 8.440181409241632e-05, 0.01204714272171259]], [[0.9983123540878296, 0.00033091308432631195, 0.00135671510361135], [0.992957353591919, 6.881727313157171e-05, 0.006973849143832922]], [[0.9970477223396301, 0.0002501500421203673, 0.002702130703255534], [0.9909524917602539, 8.386156696360558e-05, 0.008963614702224731]], [[0.9955207109451294, 0.00025680335238575935, 0.004222441464662552], [0.979101300239563, 0.00010242844291497022, 0.020796269178390503]], [[0.9929240942001343, 0.0003276519710198045, 0.00674829725176096], [0.9429959058761597, 8.931289630709216e-05, 0.05691466107964516]], [[0.9843504428863525, 0.0005793279269710183, 0.015070222318172455], [0.8541264533996582, 8.560598507756367e-05, 0.14578796923160553]], [[0.9648507237434387, 0.0011005607666447759, 0.03404880315065384], [0.68744295835495, 7.066922262310982e-05, 0.3124864399433136]], [[0.9705528020858765, 0.024565313011407852, 0.00488190958276391], [0.9580334424972534, 0.0038004915695637465, 0.03816605359315872]], [[0.9504233002662659, 0.030649088323116302, 0.01892765425145626], [0.773652970790863, 0.0016393077094107866, 0.2247076779603958]], [[0.11881744116544724, 0.8811824321746826, 2.1734130939421448e-07], [0.6828165054321289, 0.31293320655822754, 0.004250298719853163]], [[0.9201387763023376, 0.016838936135172844, 0.06302229315042496], [0.7742846608161926, 0.2243737429380417, 0.0013415297726169229]], [[0.8943282961845398, 0.03900063782930374, 0.06667105853557587], [0.9305276274681091, 0.06334437429904938, 0.006127947010099888]], [[0.883815348148346, 0.06407571583986282, 0.05210888758301735], [0.9196960926055908, 0.07386749237775803, 0.006436434108763933]], [[0.8610019683837891, 0.07785124331712723, 0.06114684417843819], [0.9172423481941223, 0.07098791748285294, 0.011769663542509079]], [[0.9747076630592346, 0.012435411103069782, 0.012856855988502502], [0.9483229517936707, 1.1870964954141527e-05, 0.051665112376213074]], [[0.025193242356181145, 0.9748067855834961, 2.1992412335691824e-09], [0.9991610050201416, 0.0008389208815060556, 9.38433615260692e-08]], [[0.9962827563285828, 0.0037158168852329254, 1.4677472108814982e-06], [0.414365291595459, 0.5856347680091858, 5.071897901665068e-10]], [[3.459460913290968e-06, 0.9999964237213135, 1.3470858561959176e-07], [2.5808240025071427e-06, 5.2991996568607647e-08, 0.9999973773956299]], [[0.0002386013075010851, 0.9997614026069641, 5.761771859624787e-08], [1.0151063179364428e-05, 5.956101722937035e-10, 0.9999898672103882]], [[3.396325701032765e-05, 0.999966025352478, 2.5610791265506805e-10], [0.9990662932395935, 1.0343154599468107e-07, 0.0009336423245258629]], [[2.713428273182217e-07, 0.9999997615814209, 1.0551210946618816e-11], [0.998190701007843, 0.001797844422981143, 1.1429831829445902e-05]], [[3.415163155295886e-05, 0.9999659061431885, 1.564299662026869e-10], [0.8457478284835815, 0.1542365401983261, 1.5631232599844225e-05]], [[0.8277060389518738, 0.043462056666612625, 0.12883183360099792], [0.01204777229577303, 0.9879521727561951, 8.468168744002469e-08]], [[0.001388462376780808, 5.637952327219864e-09, 0.9986114501953125], [0.9992005228996277, 9.913957001117524e-06, 0.0007896136376075447]], [[0.9257078170776367, 0.07363249361515045, 0.0006597255705855787], [0.9950371384620667, 0.0019989798311144114, 0.00296395062468946]], [[0.9649824500083923, 0.03329818695783615, 0.0017192624509334564], [0.9675438404083252, 0.00026388876722194254, 0.03219229727983475]], [[0.0034873622935265303, 4.59569626798384e-08, 0.9965125918388367], [0.8894191384315491, 1.583018820383586e-05, 0.11056508123874664]], [[0.8598359227180481, 0.04942948371171951, 0.09073461592197418], [0.9227088093757629, 0.004437339026480913, 0.07285385578870773]], [[0.5981535315513611, 0.01740295998752117, 0.3844435513019562], [0.7484837770462036, 0.005531057249754667, 0.24598513543605804]], [[0.17428241670131683, 0.013711312785744667, 0.8120062947273254], [0.4442596137523651, 0.01848161593079567, 0.5372588634490967]], [[0.01060212031006813, 0.9891286492347717, 0.00026925173006020486], [0.25825563073158264, 0.6897037625312805, 0.05204068496823311]], [[0.038152191787958145, 0.05793950334191322, 0.9039083123207092], [0.051867030560970306, 0.06662771105766296, 0.8815053105354309]], [[0.03357478603720665, 0.7905106544494629, 0.17591457068920135], [0.028166593983769417, 0.9718262553215027, 7.14459838491166e-06]], [[0.026181677356362343, 0.9360692501068115, 0.03774905204772949], [0.017664657905697823, 0.15663456916809082, 0.8257007598876953]], [[0.01597018726170063, 0.8917136192321777, 0.09231621026992798], [0.04293280839920044, 0.9569093585014343, 0.00015785118739586323]], [[0.01673850044608116, 0.006709440145641565, 0.9765521287918091], [0.08778680115938187, 0.17951810359954834, 0.7326951026916504]], [[0.011245246045291424, 0.9420572519302368, 0.04669749736785889], [0.06787920743227005, 0.9313273429870605, 0.0007934307213872671]], [[0.040970511734485626, 0.8962960839271545, 0.06273336708545685], [0.027699263766407967, 0.23867738246917725, 0.7336233258247375]], [[7.573574839625508e-05, 4.310334588808473e-06, 0.9999198913574219], [4.0823182644089684e-05, 2.6729736646302626e-07, 0.999958872795105]], [[0.0009483167086727917, 0.9261525273323059, 0.07289914041757584], [0.00031341041903942823, 0.997564435005188, 0.0021222515497356653]], [[1.8909112213805201e-06, 0.0005894062342122197, 0.9994087219238281], [0.0002119043201673776, 0.9817377924919128, 0.01805020123720169]], [[1.01024175136466e-10, 1.0, 7.536592877555037e-14], [0.000175676032085903, 0.028760336339473724, 0.9710639715194702]], [[1.4005146868611984e-11, 1.0, 1.1548717537834818e-08], [6.70579369810298e-10, 1.0, 9.954245205889833e-10]], [[1.6816812699327333e-12, 1.0, 1.4030722139679597e-09], [3.308526022594016e-11, 1.0, 6.547496377538875e-13]], [[3.39860528608682e-10, 1.8472181182005443e-05, 0.9999815225601196], [1.0662506644211651e-14, 1.0, 6.316163222019747e-17]], [[1.2184730221326268e-13, 1.2804426319235063e-07, 0.9999998807907104], [6.162136134690854e-09, 1.0, 1.55390966760649e-09]], [[1.245275228284803e-15, 1.4288662475436809e-09, 1.0], [5.670010468084019e-12, 9.067284683500487e-13, 1.0]], [[2.9403574684451094e-19, 1.9297840381502336e-18, 1.0], [8.502375778256244e-13, 2.7834728966169564e-10, 1.0]], [[4.792295449362882e-09, 0.00048490543849766254, 0.9995150566101074], [2.2155484044605878e-11, 1.0, 4.725601420590975e-13]], [[4.246658136253245e-06, 5.989675742057443e-07, 0.9999951124191284], [1.8494379361300162e-08, 0.0002951118513010442, 0.999704897403717]], [[1.0364049103372963e-06, 0.9999963045120239, 2.6231912215735065e-06], [6.06644658010351e-14, 1.0, 1.913863165170504e-12]], [[2.0391334842884135e-08, 0.9996803998947144, 0.00031962781213223934], [2.639000662441049e-08, 0.9999988079071045, 1.227748043675092e-06]], [[2.4973909162895325e-08, 4.465177383394803e-08, 0.9999998807907104], [3.8686466978518695e-16, 6.661236080280795e-15, 1.0]], [[3.907094374595854e-13, 1.0, 1.2502988011239835e-12], [5.189936208658402e-14, 8.276289809733273e-13, 1.0]], [[0.0002909467148128897, 9.015992219474356e-08, 0.9997089505195618], [1.7461022861972597e-12, 1.0, 1.5177128998011824e-10]], [[1.8901879229815677e-05, 0.9999810457229614, 3.474974350154217e-14], [4.79078998694149e-10, 0.0007087494595907629, 0.999291181564331]], [[8.644573767924157e-08, 0.9884997010231018, 0.011500215157866478], [6.251199557993914e-11, 1.0, 2.966484696775851e-11]], [[0.0001060695358319208, 0.9977148771286011, 0.0021790401078760624], [6.336958735531084e-11, 0.9997629523277283, 0.00023701436293777078]], [[3.053199637559345e-10, 0.986149787902832, 0.013850192539393902], [6.590726662342172e-12, 2.1636444025308066e-10, 1.0]], [[5.354113419980822e-13, 8.816973843736586e-13, 1.0], [4.922909649374141e-11, 2.0184208551654592e-05, 0.9999798536300659]], [[6.963336157683742e-13, 0.9999877214431763, 1.230752604897134e-05], [5.676318790004409e-12, 1.0, 7.999778318146006e-16]], [[1.1619961347568864e-14, 1.5763385851147384e-15, 1.0], [1.2929515236237421e-09, 0.9999055862426758, 9.434711682843044e-05]], [[5.091358801223578e-08, 0.9999700784683228, 2.9979393730172887e-05], [2.1909631227334803e-12, 0.9999997615814209, 2.646065979661216e-07]]]; // action probs
        var action =  [[0, 2], [2, 0], [1, 0], [1, 1], [0, 1], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1, 0], [0, 2], [0, 0], [0, 2], [0, 1], [0, 0], [2, 0], [0, 0], [0, 1], [0, 0], [1, 0], [2, 0], [2, 1], [0, 1], [0, 0], [0, 0], [2, 1], [0, 0], [2, 0], [1, 2], [2, 1], [0, 0], [2, 0], [0, 0], [2, 1], [2, 0], [1, 0], [2, 0], [2, 1], [0, 1], [0, 1], [0, 1], [0, 1], [1, 0], [1, 1], [2, 2], [0, 1], [0, 0], [2, 0], [1, 0], [2, 0], [1, 0], [0, 0], [2, 1], [1, 0], [0, 0], [0, 2], [2, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2, 0], [1, 2], [0, 2], [0, 2], [0, 2], [1, 2], [0, 2], [0, 1], [1, 1], [2, 2], [0, 0], [0, 2], [0, 1], [1, 0], [2, 0], [1, 0], [2, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2, 0], [2, 0], [2, 0], [2, 1], [2, 0], [0, 1], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 2], [0, 0], [1, 0], [0, 0], [0, 0], [2, 1], [0, 2], [0, 0], [2, 0], [0, 0], [1, 1], [0, 0], [1, 0], [1, 0], [1, 0], [1, 0], [1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2, 0], [0, 0], [0, 0], [0, 2], [0, 0], [0, 0], [0, 0], [1, 0], [1, 1], [2, 2], [0, 2], [1, 0], [2, 1], [2, 1], [0, 1], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2, 2], [0, 0], [2, 2], [1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1, 0], [0, 1], [1, 2], [1, 2], [1, 0], [1, 0], [1, 0], [1, 1], [2, 0], [0, 0], [1, 0], [2, 0], [0, 0], [0, 0], [2, 2], [1, 1], [0, 2], [2, 1], [1, 2], [1, 1], [2, 2], [2, 1], [1, 1], [2, 2], [1, 1], [2, 1], [1, 2], [1, 1], [1, 1], [2, 1], [2, 1], [2, 2], [2, 2], [2, 1], [2, 2], [1, 1], [1, 1], [2, 2], [1, 2], [2, 1], [1, 2], [1, 1], [1, 1], [1, 2], [2, 2], [1, 1], [2, 1], [1, 1]];
        var action_names = [['no-op', 'left', 'right'], ['no-op', 'up', 'down']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Attention Scores") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step + 1;
        visualizeAttentionScores(y_attention_weights[step], top_n);
          // Set action plot if statistic_plot_id is 0
          if(statistic_plot_id == 0){
            // Update action plot
            if(is_discrete) { // If action_space is discrete
              set_bar_action_plot(y_action[step][0], action[step][0], action_names);
            }
            else { // If action_space is multi discrete
                set_stacked_bar_action_plot(y_action[step], action[step], action_names);
            }
          }
          // Set value plot if statistic_plot_id is 1
          if (statistic_plot_id == 1) {
            set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
          }

        // Set entropy plot if statistic_plot_id is 2
        if (statistic_plot_id == 2) {
            if(is_discrete) { // If action_space is discrete
                set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
            }
            else { // If action_space is multi discrete
                set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
            }
        }
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth - 50;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
        // Add event handler for clicking on a marker
        document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);

          // Add event handler for clicking on a marker
          document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>