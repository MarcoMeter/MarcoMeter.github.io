<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row wrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MortarMayhem-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>arena_size</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>allowed_commands</b>: 9<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_count</b>: [10]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_duration</b>: [6]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_delay</b>: [18]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_failure</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_success</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_episode_success</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 1<br><b>reward_normalization</b>: 0<br><b>positional_endocing</b>: False<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: -1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 512<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_layers</b>: 1<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 30000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: {'initial': 0.0}<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <br>
      <center>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Transformer</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Top Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_1_29.webm', '', '', '', '', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.34505414962768555], [0.34732887148857117], [0.3492206931114197], [0.35052695870399475], [0.35390371084213257], [0.3553985357284546], [0.35547950863838196], [0.357799232006073], [0.3594498038291931], [0.36126816272735596], [0.3642156422138214], [0.36586010456085205], [0.3677377700805664], [0.37002015113830566], [0.37359732389450073], [0.3731096386909485], [0.3789415955543518], [0.37888282537460327], [0.37996986508369446], [0.38507479429244995], [0.3869113326072693], [0.3902382254600525], [0.3899995684623718], [0.39038658142089844], [0.3967042565345764], [0.39814358949661255], [0.4003087878227234], [0.39792710542678833], [0.40312328934669495], [0.4050665497779846], [0.40717923641204834], [0.4071502685546875], [0.4102485775947571], [0.4132618308067322], [0.41497674584388733], [0.41452378034591675], [0.4188925325870514], [0.42196449637413025], [0.4241807460784912], [0.42280811071395874], [0.4269500970840454], [0.42802467942237854], [0.42947542667388916], [0.4318593144416809], [0.4353105425834656], [0.4363810420036316], [0.44062644243240356], [0.44509565830230713], [0.44388872385025024], [0.4475683569908142], [0.4492594301700592], [0.454865038394928], [0.45381683111190796], [0.45637452602386475], [0.4584064483642578], [0.4596750736236572], [0.46031272411346436], [0.4621856212615967], [0.3677629232406616], [0.3701368272304535], [0.36427953839302063], [0.37057214975357056], [0.3722142279148102], [0.37483346462249756], [0.3797544240951538], [0.3824371099472046], [0.38292473554611206], [0.3812720775604248], [0.3816636800765991], [0.3856958746910095], [0.38859671354293823], [0.390585333108902], [0.3953946530818939], [0.39261308312416077], [0.39541345834732056], [0.3960178792476654], [0.39705419540405273], [0.39966729283332825], [0.3998902440071106], [0.40158066153526306], [0.40298861265182495], [0.4046405553817749], [0.31367337703704834], [0.3154086172580719], [0.32054269313812256], [0.31770217418670654], [0.31504926085472107], [0.32039064168930054], [0.3172817826271057], [0.31480079889297485], [0.3200182616710663], [0.32193297147750854], [0.3241203725337982], [0.32789790630340576], [0.32853320240974426], [0.32949569821357727], [0.3294629752635956], [0.33111369609832764], [0.3310965299606323], [0.3338942527770996], [0.3352956473827362], [0.33665603399276733], [0.33800551295280457], [0.3399384021759033], [0.3419605791568756], [0.34385886788368225], [0.24595490097999573], [0.24717840552330017], [0.2494497001171112], [0.24662426114082336], [0.2508656680583954], [0.25126734375953674], [0.2513887882232666], [0.2521103620529175], [0.2555240988731384], [0.25692135095596313], [0.2570270001888275], [0.25763434171676636], [0.2593221068382263], [0.26095011830329895], [0.2628082036972046], [0.26496443152427673], [0.26591724157333374], [0.2674570679664612], [0.26947930455207825], [0.2698093056678772], [0.2720538377761841], [0.27052971720695496], [0.27280211448669434], [0.2715326249599457], [0.17744027078151703], [0.1779414415359497], [0.17756274342536926], [0.18147309124469757], [0.18028956651687622], [0.1797197163105011], [0.1827770471572876], [0.17745792865753174], [0.18145997822284698], [0.18507984280586243], [0.18643197417259216], [0.18677173554897308], [0.1880568563938141], [0.18902310729026794], [0.1896669566631317], [0.19037723541259766], [0.1914873719215393], [0.1927192360162735], [0.19410477578639984], [0.19546741247177124], [0.19655221700668335], [0.19750452041625977], [0.19930601119995117], [0.2008954882621765], [0.09870598465204239], [0.09945738315582275], [0.10164424777030945], [0.10003595054149628], [0.10187380760908127], [0.10235653817653656], [0.10424958914518356], [0.10279209911823273], [0.10503673553466797], [0.10470260679721832], [0.10658673942089081], [0.1081426739692688], [0.1094050332903862], [0.10896989703178406], [0.10932117700576782], [0.1090283915400505], [0.10977736860513687], [0.11332590878009796], [0.11180457472801208], [0.11330214887857437], [0.11223968863487244], [0.1139163225889206], [0.1141275092959404], [0.11420641839504242], [0.016400299966335297], [0.013361938297748566], [0.01140613853931427], [0.010072693228721619], [0.010510213673114777], [0.009780235588550568], [0.008243151009082794], [0.010146111249923706], [0.009631648659706116], [0.00948341190814972], [0.011595070362091064], [0.00928538292646408], [0.008148618042469025], [0.009473644196987152], [0.010026834905147552], [0.0097104012966156], [0.00876057893037796], [0.010165929794311523], [0.01038610190153122], [0.009564384818077087], [0.0103888139128685], [0.008432872593402863], [0.011160850524902344], [0.010455891489982605], [0.010258801281452179]];
        var y_entropy = [[0.5947150588035583, 0.854876697063446], [0.965516209602356, 0.7907260656356812], [0.9460197687149048, 0.5966912508010864], [0.8683292865753174, 0.7225703597068787], [0.44876211881637573, 0.8276630640029907], [0.5887807607650757, 0.9910670518875122], [0.6257420778274536, 1.0087945461273193], [0.5963691473007202, 0.8187311291694641], [0.13325481116771698, 0.7861249446868896], [0.19550523161888123, 0.8106212019920349], [0.24744650721549988, 0.8338698148727417], [0.5564606189727783, 0.7445458769798279], [0.5043289661407471, 0.4994592070579529], [0.8772143125534058, 0.5758276581764221], [0.9620071649551392, 0.5887776613235474], [0.9600865244865417, 0.8079668283462524], [0.9197621941566467, 0.5608738660812378], [1.0583045482635498, 0.7412786483764648], [1.0572168827056885, 0.7672429084777832], [0.9338415861129761, 0.8849375247955322], [1.0025813579559326, 0.7679144144058228], [1.0834029912948608, 0.7813956141471863], [1.0906250476837158, 0.8364044427871704], [0.2190689593553543, 0.7370380163192749], [1.0333497524261475, 0.9020900726318359], [1.0837105512619019, 0.7979158759117126], [1.0751149654388428, 0.7859457731246948], [0.11107055097818375, 0.7360283136367798], [0.9905345439910889, 0.8567376136779785], [1.0630005598068237, 0.8082795739173889], [1.0745456218719482, 0.829497218132019], [0.0934455543756485, 0.7253013849258423], [0.9233666658401489, 0.8536052703857422], [0.9107536673545837, 0.8507574200630188], [1.0080634355545044, 0.9086825847625732], [0.07752294093370438, 0.7245669364929199], [0.8512011766433716, 0.9159151911735535], [0.9115859270095825, 0.7624781727790833], [1.0177202224731445, 0.8013895153999329], [0.1218075305223465, 0.6899938583374023], [0.10562212765216827, 0.7996867299079895], [0.656063437461853, 0.710479736328125], [0.09714630246162415, 0.4320000112056732], [0.18586856126785278, 0.4221132695674896], [0.3041854202747345, 0.8172187805175781], [0.20491884648799896, 0.7742902040481567], [0.8742308020591736, 0.5126389265060425], [0.09975449740886688, 0.6820517182350159], [0.8091881275177002, 0.9025430679321289], [0.44855237007141113, 0.7424145936965942], [0.7125749588012695, 0.42880144715309143], [0.3744727671146393, 0.6869526505470276], [0.8241471648216248, 0.6076884269714355], [0.8225799202919006, 0.485243558883667], [0.49819135665893555, 0.4841403067111969], [0.667018711566925, 0.4378957152366638], [0.7207661271095276, 0.4345068335533142], [0.7524299621582031, 0.4153851270675659], [0.267365038394928, 0.17305459082126617], [0.01625683531165123, 0.1250026375055313], [0.11968579143285751, 0.3697128891944885], [0.0007089839782565832, 0.17096103727817535], [0.05249975621700287, 0.01882421225309372], [0.0017910660244524479, 0.00010720288992160931], [0.0024975393898785114, 6.744756433363364e-07], [1.4478130196948769e-06, 3.979077882831916e-05], [8.176161414574779e-10, 0.5543420910835266], [2.2010860689647416e-08, 0.04245956614613533], [0.2072419673204422, 0.11927913129329681], [0.6761280298233032, 0.38674893975257874], [0.0012390513438731432, 0.015926921740174294], [0.6330358386039734, 0.42206692695617676], [0.02554568275809288, 0.06181942671537399], [0.6102792620658875, 0.49714407324790955], [0.6106444597244263, 0.18977411091327667], [0.19926056265830994, 0.30618923902511597], [0.6648191213607788, 0.19373589754104614], [0.2603030204772949, 0.2812871038913727], [0.6881918907165527, 0.17347975075244904], [0.29794299602508545, 0.2684900164604187], [0.2650180160999298, 0.242606982588768], [0.23060566186904907, 0.28116375207901], [0.08693341910839081, 0.15949265658855438], [0.021549591794610023, 0.5217053890228271], [0.0003807824105024338, 0.6847752332687378], [6.028543793945573e-05, 0.04627009853720665], [0.4248880445957184, 0.0003790461632888764], [0.004410369321703911, 5.277150876281667e-07], [2.953798805549468e-08, 1.4735663000919885e-07], [9.226447446053498e-07, 1.2554144745990925e-07], [0.002635526703670621, 7.287374046427431e-07], [0.6677428483963013, 1.0913907317444682e-05], [0.5426046848297119, 0.2567240595817566], [0.6272499561309814, 0.478730171918869], [0.1490757316350937, 0.1750195473432541], [0.26080673933029175, 0.48877301812171936], [0.6365528106689453, 0.10388518869876862], [0.5165739059448242, 0.4091690182685852], [0.5325678586959839, 0.07428605854511261], [0.6555761694908142, 0.3547903597354889], [0.6754197478294373, 0.2790347933769226], [0.3846915066242218, 0.06472020596265793], [0.26343604922294617, 0.6025627255439758], [0.23518113791942596, 0.621071994304657], [0.19040650129318237, 0.5687929391860962], [0.1844777762889862, 0.47150230407714844], [0.33150747418403625, 0.014708933420479298], [0.3527374863624573, 0.0015782967675477266], [0.5817911028862, 0.007107243873178959], [0.6063109040260315, 0.03773960843682289], [0.0004078238853253424, 0.0022013194393366575], [0.0035255826078355312, 0.003399925772100687], [9.538819722365588e-05, 0.16109856963157654], [3.6317513149697334e-05, 0.0024858994875103235], [0.26178181171417236, 0.36339542269706726], [0.16856206953525543, 0.6911066174507141], [0.7319726347923279, 0.5359793901443481], [0.5934571623802185, 0.6115672588348389], [0.724257230758667, 0.6194896697998047], [0.8139779567718506, 0.6280893683433533], [0.8922122120857239, 0.6207336187362671], [0.6666842103004456, 0.5620057582855225], [0.9271336197853088, 0.735019326210022], [0.5727167725563049, 0.702675461769104], [0.632541835308075, 0.7888118028640747], [0.6209881901741028, 0.40539273619651794], [1.0495257377624512, 0.89445960521698], [0.47999680042266846, 0.6731553077697754], [1.0266600847244263, 0.747749388217926], [0.5191411375999451, 0.6536160707473755], [0.5256970524787903, 0.012647725641727448], [0.0014182243030518293, 0.040428340435028076], [0.5363056659698486, 0.21962767839431763], [0.0046060960739851, 0.00022397194697987288], [0.11611224710941315, 0.00020228633366059512], [0.4097367525100708, 0.030392106622457504], [0.5485568046569824, 2.093275725201238e-05], [3.5059216315858066e-05, 1.6913841204349578e-12], [0.37556278705596924, 6.958796802791767e-06], [0.02256014011800289, 0.6927938461303711], [0.17116650938987732, 0.0739668682217598], [0.06047729030251503, 0.21071016788482666], [0.028083786368370056, 0.10637879371643066], [0.04366740211844444, 0.08112772554159164], [0.06858806312084198, 0.10459784418344498], [0.08213450759649277, 0.09911571443080902], [0.10171417891979218, 0.09712829440832138], [0.14887072145938873, 0.10153727233409882], [0.25219547748565674, 0.13062366843223572], [0.38265419006347656, 0.21145889163017273], [0.5203969478607178, 0.33413660526275635], [0.6369609236717224, 0.48676928877830505], [0.6477358341217041, 0.3239681124687195], [0.13267771899700165, 0.844135046005249], [0.2198767215013504, 0.6670305132865906], [0.007727029733359814, 0.09633564949035645], [0.06853961199522018, 0.07054634392261505], [0.5225034356117249, 0.011467991396784782], [0.4523659944534302, 2.4583654521848075e-05], [0.00017374228627886623, 0.0014530231710523367], [0.00014132793876342475, 1.5683141327826888e-06], [0.3555052578449249, 8.845181298511307e-08], [0.0936291366815567, 2.61545974353794e-05], [0.1241726279258728, 0.176151305437088], [0.4941064715385437, 0.6340615749359131], [0.6753799915313721, 0.06779541820287704], [0.352974534034729, 0.0282562468200922], [0.36735275387763977, 0.06605328619480133], [0.2402561902999878, 0.04968634247779846], [0.18319621682167053, 0.06809453666210175], [0.4945729374885559, 0.2002556324005127], [0.6886224150657654, 0.04225880652666092], [0.6796329021453857, 0.03344518691301346], [0.6782938241958618, 0.07082262635231018], [0.1841280311346054, 0.05535575747489929], [0.19614455103874207, 0.013940781354904175], [0.18224459886550903, 0.03061295673251152], [0.13025079667568207, 0.014806038700044155], [0.0019355008844286203, 0.0066038379445672035], [4.6446555643342435e-05, 2.0379218312882585e-06], [0.020900756120681763, 2.392522757601462e-13], [0.18462689220905304, 3.4178766587789067e-12], [0.283721387386322, 6.802043372999833e-09], [9.800890410360807e-08, 7.948342539698672e-10], [0.003011945402249694, 0.00041993687045760453], [2.567978924124248e-14, 7.754406591082919e-20], [1.3858798657284677e-11, 6.627917832624508e-12], [5.639463118711774e-09, 1.2619940434888122e-06], [3.4341839268148266e-12, 4.128394266444957e-07], [0.0005681808106601238, 0.0005137099069543183], [0.052632689476013184, 9.385877852707836e-09], [0.290083646774292, 1.1189108528597558e-09], [2.5350101395815727e-07, 1.1989981452131815e-08], [3.940187545269265e-14, 0.00820851232856512], [0.0007284602033905685, 6.017089049237256e-09], [0.0009221418877132237, 3.930608727387153e-09], [4.3406836458537157e-10, 0.07745717465877533], [0.08166950941085815, 3.766465004467756e-12], [9.630921837811002e-09, 0.0044968025758862495], [5.4719039326300845e-05, 1.2086029954616606e-09], [2.6125085168639913e-17, 0.0005363248055800796], [1.4586222278012428e-05, 1.2995674461654028e-16], [7.458899062839919e-07, 0.03233271837234497]];
        var y_attention_weights = [];
        var y_action = [[[0.7895174622535706, 0.026731722056865692, 0.18375085294246674], [0.24654333293437958, 0.10073243826627731, 0.6527242064476013]], [[0.3321078419685364, 0.13046620786190033, 0.5374259948730469], [0.16338735818862915, 0.12084538489580154, 0.7157672643661499]], [[0.5438845753669739, 0.11424712091684341, 0.3418683111667633], [0.17315220832824707, 0.03212740272283554, 0.7947204113006592]], [[0.08322473615407944, 0.6137381196022034, 0.30303719639778137], [0.2975194752216339, 0.6756787896156311, 0.026801764965057373]], [[0.8759571313858032, 0.03505945950746536, 0.08898337185382843], [0.41612905263900757, 0.5427837371826172, 0.041087258607149124]], [[0.8199775218963623, 0.06433180719614029, 0.1156906709074974], [0.49116918444633484, 0.37013500928878784, 0.13869576156139374]], [[0.8033247590065002, 0.07350066304206848, 0.12317464500665665], [0.5399776697158813, 0.23192669451236725, 0.22809557616710663]], [[0.20986326038837433, 0.7730016708374023, 0.01713506132364273], [0.6829565763473511, 0.2214088886976242, 0.09563450515270233]], [[0.9751542210578918, 0.010469532571732998, 0.014376290142536163], [0.5724455714225769, 0.028046810999512672, 0.399507611989975]], [[0.9600148797035217, 0.02145569585263729, 0.01852940022945404], [0.44521385431289673, 0.03240878880023956, 0.5223773717880249]], [[0.9460254311561584, 0.02775217592716217, 0.02622244320809841], [0.5182547569274902, 0.04149317741394043, 0.44025206565856934]], [[0.1948707401752472, 0.7929216027259827, 0.01220762450248003], [0.7387421131134033, 0.168119877576828, 0.09313802421092987]], [[0.8570305109024048, 0.09044156968593597, 0.052527979016304016], [0.859552800655365, 0.054249271750450134, 0.08619797229766846]], [[0.6592777371406555, 0.1614176481962204, 0.17930461466312408], [0.8290584087371826, 0.08371548354625702, 0.08722604066133499]], [[0.5864837765693665, 0.18301217257976532, 0.23050403594970703], [0.8232330083847046, 0.08414541929960251, 0.09262152761220932]], [[0.2588101327419281, 0.5799046754837036, 0.1612851917743683], [0.7069432735443115, 0.14441078901290894, 0.14864596724510193]], [[0.5917577147483826, 0.2923499345779419, 0.11589227616786957], [0.8345474600791931, 0.09681440889835358, 0.0686381459236145]], [[0.4574744403362274, 0.3155760169029236, 0.2269495725631714], [0.7307574152946472, 0.1947714388370514, 0.07447110116481781]], [[0.4519329071044922, 0.3292282521724701, 0.2188388556241989], [0.719883382320404, 0.19232232868671417, 0.08779434859752655]], [[0.1952415555715561, 0.1902354508638382, 0.6145229935646057], [0.6412597298622131, 0.23320937156677246, 0.1255308836698532]], [[0.5429442524909973, 0.2574879825115204, 0.19956780970096588], [0.7199985384941101, 0.19114400446414948, 0.08885738998651505]], [[0.41661301255226135, 0.298199862241745, 0.2851870357990265], [0.7091469168663025, 0.20263203978538513, 0.08822101354598999]], [[0.36451682448387146, 0.3607190251350403, 0.2747640907764435], [0.668963611125946, 0.23257385194301605, 0.09846250712871552]], [[0.04984554275870323, 0.0031289656180888414, 0.9470255374908447], [0.40012326836586, 0.5865328311920166, 0.013343824073672295]], [[0.3488599956035614, 0.18286682665348053, 0.4682732820510864], [0.6324134469032288, 0.22722353041172028, 0.14036305248737335]], [[0.28519949316978455, 0.29911237955093384, 0.4156881272792816], [0.6977639198303223, 0.21091964840888977, 0.09131641685962677]], [[0.26132041215896606, 0.3048109710216522, 0.4338685870170593], [0.6993321180343628, 0.2203366905450821, 0.0803312286734581]], [[0.02200908772647381, 0.000637271732557565, 0.9773536920547485], [0.4668487012386322, 0.5242928862571716, 0.00885830819606781]], [[0.24741119146347046, 0.19546779990196228, 0.5571210384368896], [0.6743743419647217, 0.16381913423538208, 0.16180650889873505]], [[0.22393257915973663, 0.3368586301803589, 0.4392088055610657], [0.6943050622940063, 0.20647893846035004, 0.0992160513997078]], [[0.24323520064353943, 0.33587926626205444, 0.4208855628967285], [0.6751986145973206, 0.2265865057706833, 0.09821485728025436]], [[0.017434725537896156, 0.0006714948103763163, 0.98189377784729], [0.4875258505344391, 0.5065156817436218, 0.005958484951406717]], [[0.210566908121109, 0.168003112077713, 0.6214300394058228], [0.6675652861595154, 0.12054872512817383, 0.21188604831695557]], [[0.12499650567770004, 0.26189088821411133, 0.6131126284599304], [0.675141453742981, 0.19055593013763428, 0.13430272042751312]], [[0.16334572434425354, 0.33419176936149597, 0.5024624466896057], [0.6291801333427429, 0.22316178679466248, 0.14765812456607819]], [[0.014003024436533451, 0.0004416105803102255, 0.9855554103851318], [0.4531528651714325, 0.5402238368988037, 0.006623285822570324]], [[0.15576650202274323, 0.1660984754562378, 0.6781350374221802], [0.6294228434562683, 0.1790313720703125, 0.19154572486877441]], [[0.14070403575897217, 0.2362397313117981, 0.6230562925338745], [0.728070080280304, 0.17468062043190002, 0.09724937379360199]], [[0.1744379848241806, 0.3284042179584503, 0.49715784192085266], [0.7004404664039612, 0.1993808150291443, 0.10017876327037811]], [[0.023795969784259796, 0.0012151047121733427, 0.9749889373779297], [0.3874157667160034, 0.6089189648628235, 0.003665229072794318]], [[0.02050931006669998, 0.0006775589426979423, 0.9788131713867188], [0.7104771733283997, 0.12495261430740356, 0.16457025706768036]], [[0.6395714282989502, 0.36013248562812805, 0.0002960351703222841], [0.3804631233215332, 0.008803523145616055, 0.6107334494590759]], [[0.019681161269545555, 0.980288028717041, 3.084806667175144e-05], [0.873687744140625, 0.10777124762535095, 0.018540985882282257]], [[0.036614593118429184, 0.9588484168052673, 0.004537065047770739], [0.14538078010082245, 0.8536560535430908, 0.0009632050641812384]], [[0.04899967834353447, 0.023081190884113312, 0.9279191493988037], [0.401470422744751, 0.038778338581323624, 0.5597512722015381]], [[0.04491634666919708, 0.9518444538116455, 0.003239214885979891], [0.30553072690963745, 0.042101625353097916, 0.6523676514625549]], [[0.47206488251686096, 0.057933077216148376, 0.47000205516815186], [0.824255645275116, 0.16218523681163788, 0.013559157960116863]], [[0.02041790448129177, 0.9795747399330139, 7.303602160391165e-06], [0.4161687195301056, 0.5834705233573914, 0.0003607857215683907]], [[0.29621773958206177, 0.645261824131012, 0.05852041766047478], [0.5437275767326355, 0.08091043680906296, 0.37536197900772095]], [[0.16394677758216858, 0.0002644095802679658, 0.8357887864112854], [0.7390092015266418, 0.0903053879737854, 0.17068541049957275]], [[0.49788597226142883, 0.0032136165536940098, 0.498900443315506], [0.8501644730567932, 0.14876070618629456, 0.0010748273925855756]], [[0.12371732294559479, 0.8762652277946472, 1.7427051716367714e-05], [0.4432883560657501, 0.5566889047622681, 2.2669253667118028e-05]], [[0.5719852447509766, 0.38417863845825195, 0.043836139142513275], [0.8146452307701111, 0.09705091267824173, 0.08830384165048599]], [[0.626979410648346, 0.3145168125629425, 0.05850383639335632], [0.8651935458183289, 0.08295254409313202, 0.05185391753911972]], [[0.19740715622901917, 0.00014612266386393458, 0.802446722984314], [0.8653407692909241, 0.08434499055147171, 0.05031421408057213]], [[0.37899646162986755, 0.00041488281567581, 0.6205886602401733], [0.8840816020965576, 0.0661662369966507, 0.049752216786146164]], [[0.7519327998161316, 0.16131766140460968, 0.08674952387809753], [0.885739803314209, 0.05598864331841469, 0.05827147141098976]], [[0.7357996702194214, 0.09954891353845596, 0.16465140879154205], [0.8923709392547607, 0.06014787033200264, 0.04748120531439781]], [[0.07539052516222, 0.9246094226837158, 2.6391914431656005e-08], [0.04160553961992264, 2.99661132885376e-06, 0.9583914875984192]], [[0.00229797326028347, 0.9977020621299744, 3.678516367379425e-14], [0.9727674126625061, 0.02723114937543869, 1.4647388297817088e-06]], [[0.9742386937141418, 0.025761257857084274, 9.168131498427101e-08], [0.12140414863824844, 0.8785958290100098, 3.11176907876712e-15]], [[0.9999376535415649, 3.569728141883388e-05, 2.6678264475776814e-05], [0.040952909737825394, 0.9590470194816589, 2.382121166988327e-09]], [[0.009244369342923164, 1.2850674968589715e-09, 0.9907556176185608], [0.0019877315498888493, 0.997489333152771, 0.000522951886523515]], [[0.00018685379473026842, 2.965801770837828e-10, 0.9998131394386292], [7.2175457717094105e-06, 0.999991774559021, 9.869539780993364e-07]], [[0.00027053066878579557, 2.871834396955819e-07, 0.9997292160987854], [3.953778460186186e-08, 1.0, 2.091111658830691e-11]], [[8.905457349328572e-08, 9.080515506187936e-11, 0.9999998807907104], [2.895953002735041e-06, 0.9999971389770508, 1.6813774764840028e-13]], [[3.39153011230664e-11, 4.153651579383668e-16, 1.0], [0.24284857511520386, 0.7571513652801514, 5.242145562078804e-08]], [[1.06538533550804e-09, 2.228716690705541e-15, 1.0], [0.9928481578826904, 0.0071518272161483765, 4.425808697305911e-08]], [[0.9568584561347961, 0.024730104953050613, 0.01841149665415287], [0.025649268180131912, 0.9743505716323853, 1.1871782845673806e-07]], [[0.5938374400138855, 0.40609028935432434, 7.231553900055587e-05], [0.87014240026474, 0.1297827661037445, 7.483525405405089e-05]], [[0.00012395143858157098, 3.5407436982382023e-09, 0.9998760223388672], [0.9977579712867737, 0.0022408461663872004, 1.1953025023103692e-06]], [[0.6760702133178711, 0.323505699634552, 0.00042418428347446024], [0.8543297052383423, 0.14447267353534698, 0.0011975941015407443]], [[0.0039033968932926655, 1.2925423220622179e-07, 0.9960965514183044], [0.9887216091156006, 0.0112759405747056, 2.419192242086865e-06]], [[0.7042161822319031, 0.2953856587409973, 0.00039811935857869685], [0.8094923496246338, 0.18870696425437927, 0.0018006464233621955]], [[0.29925185441970825, 3.841769648715854e-05, 0.7007097005844116], [0.9529748558998108, 0.047013022005558014, 1.2203241567476653e-05]], [[0.05025273188948631, 0.9497470855712891, 1.1046235215417255e-07], [0.9122613668441772, 0.08590297400951385, 0.0018356847576797009]], [[0.38081228733062744, 3.3113217796199024e-05, 0.6191546320915222], [0.9517284631729126, 0.04822904244065285, 4.254416126059368e-05]], [[0.07259530574083328, 0.9274045825004578, 1.0567747210643574e-07], [0.9227733612060547, 0.07520914822816849, 0.002017417224124074]], [[0.552104115486145, 4.771696330863051e-05, 0.4478481411933899], [0.958372950553894, 0.041575029492378235, 5.1928629545727745e-05]], [[0.9138302206993103, 0.0007612074259668589, 0.08540847897529602], [0.9245384335517883, 0.07533308118581772, 0.00012847148173023015]], [[0.9270192384719849, 0.0006543018971569836, 0.07232645153999329], [0.9344673752784729, 0.0654430240392685, 8.956182864494622e-05]], [[0.9397677183151245, 0.000522246235050261, 0.05970999598503113], [0.9191422462463379, 0.08082287013530731, 3.480670784483664e-05]], [[0.9828002452850342, 2.100333347243577e-07, 0.017199477180838585], [0.9638472199440002, 0.000835597631521523, 0.03531726077198982]], [[0.9968048334121704, 2.1127875005078067e-09, 0.003195150289684534], [0.7840721607208252, 0.215927854180336, 2.1912779923916048e-10]], [[0.9999662637710571, 2.1522332804835287e-09, 3.368302350281738e-05], [0.4353913366794586, 0.5646086931228638, 4.4026492521109795e-12]], [[0.9999955892562866, 1.1458281505838386e-06, 3.1855981887929374e-06], [0.9920752048492432, 4.543231170828221e-06, 0.007920298725366592]], [[0.15124386548995972, 0.8487542271614075, 1.953602804860566e-06], [3.35522236127872e-05, 7.223269969354809e-14, 0.9999665021896362]], [[0.0005142565933056176, 0.9994856119155884, 1.1053471382638236e-07], [3.049363073159839e-08, 4.224729025663533e-17, 1.0]], [[1.4514479618199516e-09, 1.0, 1.8794737966009315e-17], [7.89822607316637e-09, 7.884568920066976e-14, 1.0]], [[5.5207987514904744e-08, 1.0, 3.774521961533248e-15], [6.238175309647431e-09, 3.5316094493254013e-10, 1.0]], [[0.00028794928221032023, 0.9997120499610901, 1.3947739629927014e-09], [4.120629171211476e-08, 1.374030333956e-09, 1.0]], [[0.6133741736412048, 0.3865724503993988, 5.338827759260312e-05], [7.020067869234481e-07, 6.263395357919421e-10, 0.9999992847442627]], [[0.8258790373802185, 0.14397111535072327, 0.030149783939123154], [0.07116477191448212, 6.406876764231129e-06, 0.9288288354873657]], [[0.7167382836341858, 0.2766862213611603, 0.006575506646186113], [0.184579998254776, 0.815377414226532, 4.257553882780485e-05]], [[0.034199830144643784, 1.7495102611064794e-06, 0.9657983779907227], [0.9594059586524963, 0.039455246180295944, 0.0011387518607079983]], [[0.0727725550532341, 0.9272233247756958, 4.056658781337319e-06], [0.8181162476539612, 0.17906691133975983, 0.0028168940916657448]], [[0.669218122959137, 0.00021897326223552227, 0.3305628299713135], [0.9803345203399658, 0.017337869852781296, 0.002327542519196868]], [[0.21189454197883606, 0.7880958318710327, 9.574719115335029e-06], [0.8683222532272339, 0.12718068063259125, 0.004497013986110687]], [[0.7766515016555786, 0.0001789139350876212, 0.22316962480545044], [0.9871865510940552, 0.010708626359701157, 0.0021048220805823803]], [[0.36357244849205017, 0.6364167332649231, 1.087225155060878e-05], [0.8953388929367065, 0.09982729703187943, 0.004833829123526812]], [[0.5947245359420776, 0.40524426102638245, 3.122626003460027e-05], [0.9253819584846497, 0.07128725945949554, 0.003330729901790619]], [[0.8716139793395996, 0.00018332371837459505, 0.12820279598236084], [0.9888640642166138, 0.010048847645521164, 0.0010871115373447537]], [[0.9266487956047058, 0.0001720238506095484, 0.0731792151927948], [0.7095442414283752, 2.2558651835424826e-07, 0.29045549035072327]], [[0.9371751546859741, 6.486089841928333e-05, 0.0627598837018013], [0.6875199675559998, 8.953657015808858e-08, 0.3124799430370331]], [[0.9528629183769226, 5.239748497842811e-05, 0.04708467423915863], [0.7440367341041565, 5.719044082752589e-08, 0.25596314668655396]], [[0.9548137784004211, 4.96833526995033e-05, 0.04513655602931976], [0.8199286460876465, 4.375832318714856e-08, 0.1800713986158371]], [[0.1029457151889801, 4.3033060448394167e-10, 0.8970543146133423], [0.0020454260520637035, 1.5103252036605813e-13, 0.9979546070098877]], [[0.8870022892951965, 4.717009005617001e-09, 0.11299773305654526], [0.00016229460015892982, 4.0091128184730103e-16, 0.9998376369476318]], [[0.7314701676368713, 9.985635651688085e-10, 0.26852986216545105], [0.9991148114204407, 0.0008851260645315051, 1.6687559778461036e-08]], [[0.2947051525115967, 0.7052949070930481, 6.1001299497820405e-12], [0.006208549719303846, 0.9937915205955505, 3.270933345819781e-15]], [[3.635046959971078e-05, 6.559657873307645e-13, 0.999963641166687], [0.9997649788856506, 2.893004875659244e-07, 0.00023476837668567896]], [[0.0003994832222815603, 3.1155991120357385e-09, 0.9996005892753601], [0.9996165037155151, 2.996291570411813e-08, 0.000383427191991359]], [[6.690542704745894e-06, 5.942466145825165e-07, 0.9999927282333374], [0.9624201655387878, 0.03743979334831238, 0.00014013817417435348]], [[2.601728056106367e-06, 1.259015271594735e-13, 0.9999973773956299], [0.9997496008872986, 0.00016772825620137155, 8.271537808468565e-05]], [[0.9353197813034058, 0.05770179629325867, 0.006978435907512903], [0.8824025392532349, 0.11742697656154633, 0.00017048408335540444]], [[0.9659033417701721, 0.02492181397974491, 0.009174811653792858], [0.4570206105709076, 0.5427948832511902, 0.00018452726362738758]], [[0.7337509989738464, 0.1971154659986496, 0.06913357228040695], [0.778009295463562, 0.0010302618611603975, 0.22096054255962372]], [[0.8209829330444336, 0.08263879269361496, 0.09637828171253204], [0.7025208473205566, 0.00037134773447178304, 0.2971078157424927]], [[0.75627201795578, 0.12025551497936249, 0.12347249686717987], [0.6940029859542847, 0.000487790530314669, 0.30550917983055115]], [[0.7017384767532349, 0.13126572966575623, 0.1669957935810089], [0.6821535229682922, 0.00036767477286048234, 0.31747883558273315]], [[0.6443504095077515, 0.147550567984581, 0.20809905230998993], [0.6911785006523132, 0.00032878786441870034, 0.3084928095340729]], [[0.3723214566707611, 0.0008562690345570445, 0.6268223524093628], [0.8225513100624084, 0.039840348064899445, 0.13760830461978912]], [[0.3969130516052246, 0.512356698513031, 0.09073025733232498], [0.6402683854103088, 0.021623240783810616, 0.3381084203720093]], [[0.25027090311050415, 0.001382342423312366, 0.748346745967865], [0.7235976457595825, 0.03937174007296562, 0.23703067004680634]], [[0.2929035425186157, 0.004612785764038563, 0.7024837136268616], [0.6462413668632507, 0.04725198820233345, 0.30650660395622253]], [[0.3123139441013336, 3.6984401958761737e-06, 0.6876823306083679], [0.14022128283977509, 0.8597767353057861, 1.9876476926583564e-06]], [[0.4445967972278595, 0.19928695261478424, 0.35611623525619507], [0.6091829538345337, 0.10294961929321289, 0.2878674864768982]], [[0.18569543957710266, 5.92463084103656e-06, 0.8142986297607422], [0.39864832162857056, 0.6012825965881348, 6.906543421791866e-05]], [[0.47775110602378845, 0.345100462436676, 0.17714843153953552], [0.48926326632499695, 0.4992797076702118, 0.011457047425210476]], [[0.21382690966129303, 1.3168933037377428e-05, 0.7861599326133728], [0.6427433490753174, 0.3570438623428345, 0.00021277842461131513]], [[0.780958890914917, 3.684484113364306e-07, 0.21904078125953674], [0.0017169463681057096, 2.5384713862180996e-12, 0.9982830286026001]], [[0.0001440586056560278, 1.1165755659683864e-19, 0.9998558759689331], [0.9932576417922974, 9.293920300024183e-08, 0.0067422837018966675]], [[0.22751665115356445, 0.772479772567749, 3.5750449569604825e-06], [0.9426447749137878, 0.05735525116324425, 6.995632517714512e-09]], [[0.0005404127296060324, 1.656153769680202e-09, 0.9994595646858215], [0.9999814033508301, 8.190278890651825e-07, 1.772257382981479e-05]], [[0.975564181804657, 0.00022503644868265837, 0.024210814386606216], [1.684183553152252e-05, 4.253811539123298e-11, 0.9999831914901733]], [[0.14192628860473633, 0.8579415678977966, 0.00013211042096372694], [0.004795458633452654, 5.8022687349224e-11, 0.9952045679092407]], [[0.2323867380619049, 0.766795814037323, 0.0008174877148121595], [1.47882099099661e-06, 6.750445535885774e-09, 0.9999985694885254]], [[0.9999974966049194, 3.115071365300537e-07, 2.1063572148705134e-06], [1.573947982851879e-14, 3.8565240681898844e-14, 1.0]], [[0.8756321668624878, 2.0357190351205645e-06, 0.12436568737030029], [4.781112465934712e-07, 2.636724345805863e-11, 0.9999995231628418]], [[0.0033716396428644657, 9.380583065876635e-08, 0.9966282248497009], [0.48367083072662354, 1.580752359586768e-05, 0.5163132548332214]], [[0.9645168781280518, 0.007167331874370575, 0.028315700590610504], [0.9869679808616638, 0.011626651510596275, 0.0014053571503609419]], [[0.9903705716133118, 0.0032930043525993824, 0.006336460821330547], [0.9463824033737183, 0.05335136502981186, 0.0002662119222804904]], [[0.996109664440155, 0.00234832800924778, 0.0015420360723510385], [0.9781275987625122, 0.02167210541665554, 0.0002002922265091911]], [[0.9931990504264832, 0.0010630738688632846, 0.005737842991948128], [0.9844724535942078, 0.015332592651247978, 0.00019493314903229475]], [[0.9879099130630493, 0.0008943928987719119, 0.011195643804967403], [0.9786897301673889, 0.02102772518992424, 0.0002825622505042702]], [[0.9848029017448425, 0.0009042735327966511, 0.014292821288108826], [0.9804877638816833, 0.018823131918907166, 0.0006891546654514968]], [[0.9800088405609131, 0.0009128803503699601, 0.01907830685377121], [0.9819709062576294, 0.01573992148041725, 0.0022892248816788197]], [[0.9672935009002686, 0.0011089063482359052, 0.031597621738910675], [0.9821098446846008, 0.011197834275662899, 0.006692318245768547]], [[0.9335830807685852, 0.0017044051783159375, 0.06471244990825653], [0.9756134152412415, 0.008844421245157719, 0.015542158856987953]], [[0.8793222904205322, 0.003091740421950817, 0.11758600175380707], [0.9528952240943909, 0.008060767315328121, 0.0390440970659256]], [[0.8031592965126038, 0.005305470898747444, 0.19153523445129395], [0.9072197079658508, 0.007157839369028807, 0.08562248945236206]], [[0.7119302153587341, 0.00799678172916174, 0.28007301688194275], [0.8265420198440552, 0.005809321068227291, 0.16764865815639496]], [[0.7936343550682068, 0.12443147599697113, 0.0819341316819191], [0.9211347103118896, 0.023428700864315033, 0.0554366335272789]], [[0.029399054124951363, 0.9705986976623535, 2.1766836653114296e-06], [0.674523651599884, 0.20736616849899292, 0.11811016499996185]], [[0.056741271167993546, 0.9430492520332336, 0.00020946776203345507], [0.38615474104881287, 2.520362158975331e-06, 0.6138427257537842]], [[0.000973917602095753, 0.9990260601043701, 3.768472079529461e-12], [0.019563617184758186, 0.980436384677887, 3.457090064742154e-16]], [[0.012808196246623993, 0.9871917963027954, 7.799439982747458e-10], [0.013271939009428024, 0.9867280125617981, 5.515443601101589e-15]], [[0.21603861451148987, 0.7838985919952393, 6.281464447965845e-05], [0.0015331848990172148, 1.1956600154405805e-08, 0.9984667897224426]], [[0.16776719689369202, 0.8322300314903259, 2.7811220206785947e-06], [1.707487172097899e-06, 1.7620276982280303e-12, 0.9999983310699463]], [[1.4291853403847199e-05, 0.9999856948852539, 2.61671543808073e-13], [0.00014801492216065526, 3.2783699366323305e-11, 0.9998519420623779]], [[1.1412294043111615e-05, 0.9999885559082031, 1.1891643225681037e-10], [9.534662837040742e-08, 1.3187884118082138e-09, 0.9999998807907104]], [[0.11424136161804199, 0.8857405781745911, 1.806215186661575e-05], [2.4046731272875377e-09, 2.035159818447596e-09, 1.0]], [[0.018363023176789284, 0.9814214706420898, 0.00021553282567765564], [3.173705920289649e-07, 1.4503738157145563e-06, 0.9999982118606567]], [[0.02024148777127266, 0.0038548132870346308, 0.9759037494659424], [0.016460025683045387, 0.9649395942687988, 0.018600361421704292]], [[0.11723987013101578, 0.8522277474403381, 0.030532356351614], [0.29924842715263367, 0.003842351259663701, 0.6969091892242432]], [[0.74605393409729, 0.038908202201128006, 0.21503782272338867], [0.9887729287147522, 0.008496477268636227, 0.0027306347619742155]], [[0.9129395484924316, 0.03206681087613106, 0.054993633180856705], [0.9960554838180542, 0.0012781551340594888, 0.002666450571268797]], [[0.8975650668144226, 0.09045852720737457, 0.011976450681686401], [0.9893233180046082, 0.003823951119557023, 0.006852730643004179]], [[0.9476905465126038, 0.031876515597105026, 0.020432978868484497], [0.9919129610061646, 0.0008287027012556791, 0.007258415687829256]], [[0.9630545973777771, 0.02157691679894924, 0.015368462540209293], [0.9882825016975403, 0.0014274647692218423, 0.010290103033185005]], [[0.8041656613349915, 0.19583433866500854, 1.8395981352808954e-12], [0.949509859085083, 3.640688009909354e-05, 0.05045372620224953]], [[0.4524717926979065, 0.5475282669067383, 2.154969674927898e-10], [0.9929332733154297, 3.486859714030288e-05, 0.007031851448118687]], [[0.41798365116119385, 0.5820162892341614, 5.519545931420566e-10], [0.9947223663330078, 0.00010227806342300028, 0.005175275262445211]], [[0.73459392786026, 0.23240438103675842, 0.033001698553562164], [0.9883813261985779, 0.0040453760884702206, 0.007573226001113653]], [[0.9567425847053528, 0.04191979765892029, 0.0013375628041103482], [0.9912413358688354, 0.00239643850363791, 0.0063622016459703445]], [[0.9590702056884766, 0.012585224583745003, 0.028344586491584778], [0.9982119798660278, 0.00032151275081560016, 0.0014664860209450126]], [[0.9627133011817932, 0.011480532586574554, 0.025806201621890068], [0.9957103729248047, 0.0019082463113591075, 0.0023814074229449034]], [[0.9754344820976257, 0.017273787409067154, 0.00729172769933939], [0.9980921149253845, 0.00038061669329181314, 0.001527241664007306]], [[0.00015994944260455668, 3.3411230106139556e-05, 0.9998067021369934], [0.0008134862291626632, 2.114894783744603e-07, 0.9991863369941711]], [[2.611144509501173e-06, 6.711987907692674e-07, 0.9999966621398926], [1.1272844879783861e-08, 1.1460685556130557e-07, 0.9999998807907104]], [[0.0009090260718949139, 0.9972189664840698, 0.001872011343948543], [7.351690328553928e-15, 1.0, 1.0140947669401598e-22]], [[4.610416510786308e-07, 0.9546394944190979, 0.04536009952425957], [1.1377278784883982e-13, 1.0, 7.738817525613205e-16]], [[5.848570516775453e-10, 0.08203907310962677, 0.9179609417915344], [2.9370706170969707e-13, 1.0, 3.1030097935591527e-10]], [[2.0324216756188035e-16, 1.0, 5.134789926586336e-09], [3.5644505061308354e-14, 1.0, 3.2882935957490034e-11]], [[6.0059836742626035e-15, 0.0003345508885104209, 0.9996654987335205], [5.565473776281138e-11, 0.9999624490737915, 3.7562545912805945e-05]], [[2.535152705628352e-19, 7.36673395133452e-16, 1.0], [1.6194752462787365e-21, 2.8749098918454825e-25, 1.0]], [[1.5412837742136782e-18, 4.889027008757318e-13, 1.0], [7.474277680065075e-14, 1.4788390238947013e-13, 1.0]], [[2.5530894065539655e-10, 1.749860378260715e-15, 1.0], [2.5712196261018505e-10, 0.9999998807907104, 7.668130308502441e-08]], [[1.1091509519644757e-13, 1.0, 3.781713694771911e-15], [1.0231708813535079e-09, 1.0, 2.2225565388112045e-08]], [[3.5083363991716965e-10, 0.9999476671218872, 5.2313942433102056e-05], [7.645146737900177e-09, 4.6829056373098865e-05, 0.9999531507492065]], [[1.2395938497888892e-08, 0.009272790513932705, 0.9907271862030029], [2.0170323744572727e-12, 4.3280337647111367e-10, 1.0]], [[0.002347464906051755, 0.07794324308633804, 0.919709324836731], [4.702471398387864e-11, 1.0, 2.0524275773934134e-14]], [[1.401885185714491e-08, 1.0, 1.0047836221971124e-15], [9.422197397301879e-12, 1.0, 5.511892053888801e-10]], [[7.060587656834846e-16, 1.0, 4.1706721770631513e-16], [2.0321762050912184e-08, 0.0010436975862830877, 0.9989563226699829]], [[1.429098528404893e-08, 6.881653098389506e-05, 0.9999312162399292], [3.0401389413715896e-13, 2.728308412525138e-10, 1.0]], [[8.797967166174203e-05, 0.9999111890792847, 8.48990623580903e-07], [1.7483502146031782e-10, 1.0, 8.504042061470082e-14]], [[4.2144978099848546e-14, 1.0, 1.747122585493699e-11], [6.9914127820425165e-09, 0.014898453839123249, 0.985101580619812]], [[9.496526828800533e-12, 0.01591147482395172, 0.9840885400772095], [1.2646889015633517e-13, 1.0, 2.9339529873972415e-16]], [[5.837592909063716e-11, 3.806197024225355e-10, 1.0], [5.997580765360055e-10, 0.0005258822347968817, 0.9994741082191467]], [[0.9999960660934448, 2.816458390952903e-06, 1.0856767858058447e-06], [2.3026372475420942e-11, 1.0, 2.646611402257193e-11]], [[4.547500380753282e-19, 1.0, 1.5986445362429855e-19], [2.226121331716513e-08, 0.9999508857727051, 4.906274989480153e-05]], [[2.4734894688016595e-10, 9.853049505181843e-07, 0.9999990463256836], [2.0647956305505262e-18, 1.1096369423457443e-18, 1.0]], [[4.403579723089024e-08, 1.0, 9.471592726549653e-18], [3.724481416611525e-07, 0.005160639528185129, 0.9948390126228333]]]; // action probs
        var action =  [[0, 2], [0, 0], [0, 2], [1, 1], [0, 1], [0, 0], [0, 1], [0, 0], [0, 0], [0, 0], [0, 2], [1, 0], [0, 2], [0, 0], [1, 0], [0, 2], [1, 0], [1, 0], [1, 0], [1, 0], [0, 0], [1, 0], [0, 0], [2, 0], [2, 0], [2, 1], [2, 0], [2, 0], [2, 0], [2, 0], [2, 0], [2, 1], [2, 2], [1, 0], [2, 1], [2, 0], [2, 0], [2, 0], [0, 0], [2, 0], [2, 0], [1, 2], [1, 0], [1, 1], [2, 0], [1, 2], [2, 0], [1, 1], [1, 0], [2, 2], [2, 0], [1, 1], [0, 0], [1, 0], [0, 0], [2, 0], [0, 0], [2, 0], [0, 2], [1, 0], [0, 1], [0, 1], [2, 1], [2, 1], [2, 1], [2, 1], [2, 1], [2, 0], [0, 1], [1, 0], [2, 0], [1, 0], [2, 0], [1, 1], [2, 0], [1, 0], [2, 0], [1, 0], [0, 0], [0, 0], [0, 1], [0, 0], [0, 2], [0, 0], [0, 1], [0, 0], [1, 2], [1, 2], [1, 2], [1, 2], [1, 2], [1, 2], [0, 2], [1, 1], [2, 0], [1, 0], [2, 0], [1, 0], [2, 0], [0, 0], [1, 0], [0, 1], [0, 0], [0, 0], [0, 0], [0, 0], [2, 2], [0, 2], [2, 0], [1, 1], [2, 0], [2, 0], [2, 0], [2, 0], [0, 0], [0, 1], [0, 0], [0, 0], [0, 0], [0, 0], [1, 2], [2, 0], [1, 0], [0, 0], [0, 2], [2, 1], [1, 2], [2, 0], [1, 0], [0, 1], [0, 2], [2, 0], [1, 0], [2, 0], [0, 2], [1, 2], [1, 2], [0, 2], [0, 2], [2, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2, 2], [2, 0], [1, 0], [0, 2], [1, 1], [1, 1], [1, 2], [1, 2], [1, 2], [1, 2], [1, 2], [1, 2], [2, 1], [1, 2], [0, 0], [2, 0], [0, 0], [0, 0], [2, 0], [0, 0], [0, 0], [1, 0], [0, 0], [1, 0], [0, 0], [0, 0], [0, 0], [2, 2], [2, 2], [1, 1], [1, 1], [2, 1], [1, 1], [2, 1], [2, 2], [2, 2], [2, 1], [1, 1], [1, 2], [2, 2], [2, 1], [1, 1], [1, 2], [2, 2], [1, 1], [1, 2], [2, 1], [2, 2], [0, 1], [1, 1], [2, 2], [1, 2]];
        var action_names = [['no-op', 'left', 'right'], ['no-op', 'up', 'down']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Transformer") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step;
        visualizeAttentionScores(y_attention_weights[step], top_n);
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>