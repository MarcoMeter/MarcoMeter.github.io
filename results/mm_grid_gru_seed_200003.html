<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
        min-width: 1737px;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row nowrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="location.href='../index.html'">Back</button>
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MortarMayhem-Grid-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 200003<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>arena_size</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>allowed_commands</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_count</b>: [10]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_show_duration</b>: [3]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_show_delay</b>: [1]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_duration</b>: [2]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_delay</b>: [6]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_failure</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_success</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_episode_success</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 200003<br><b>reward_normalization</b>: 0<br><b>positional_endocing</b>: False<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: -1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 512<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_layers</b>: 1<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 10000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: {'initial': 0.0}<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <center>
        <h1> Mortar Mayhem Grid <br> + Gated Recurrent Unit</h1>
        <br>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Attention Scores</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Number of Top Attention Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_200003_107.webm', '', '', '', 'videos/video_seed_200003_108.webm', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.663158655166626], [0.6679714322090149], [0.6714277267456055], [0.6777342557907104], [0.685492992401123], [0.6906790137290955], [0.693401575088501], [0.6941192150115967], [0.6982638835906982], [0.7025847434997559], [0.7082052230834961], [0.7067896127700806], [0.7134133577346802], [0.7134751081466675], [0.7172143459320068], [0.7239893674850464], [0.7256817817687988], [0.7294937372207642], [0.73529052734375], [0.7406188249588013], [0.7395548820495605], [0.7448912858963013], [0.7504576444625854], [0.7522748708724976], [0.7576204538345337], [0.7591443061828613], [0.7633155584335327], [0.7691512107849121], [0.7737736701965332], [0.7754472494125366], [0.7782963514328003], [0.7855851650238037], [0.7876909971237183], [0.7904555797576904], [0.7945417165756226], [0.8000136613845825], [0.8017393350601196], [0.8059226274490356], [0.8101972341537476], [0.8128329515457153], [0.8164894580841064], [0.820137619972229], [0.8245277404785156], [0.8295735120773315], [0.8333451747894287], [0.8355185985565186], [0.7395799160003662], [0.7461742162704468], [0.7465535402297974], [0.7481646537780762], [0.7530328035354614], [0.7530367374420166], [0.7612760066986084], [0.7619118690490723], [0.6733560562133789], [0.6742684841156006], [0.6730810403823853], [0.6810305118560791], [0.6803351640701294], [0.6805657148361206], [0.6866970062255859], [0.6949548721313477], [0.5952730178833008], [0.6047210693359375], [0.6061235666275024], [0.6049404740333557], [0.6098721027374268], [0.6117075681686401], [0.6125087738037109], [0.6205810308456421], [0.5205910205841064], [0.5267429351806641], [0.5290453433990479], [0.5345413684844971], [0.5361800193786621], [0.5368613004684448], [0.5412647724151611], [0.5443074703216553], [0.44729435443878174], [0.44957149028778076], [0.4476175606250763], [0.45283544063568115], [0.4479164779186249], [0.45570123195648193], [0.45795726776123047], [0.46046072244644165], [0.3588782548904419], [0.36482393741607666], [0.3682616949081421], [0.3729017972946167], [0.374203085899353], [0.37306398153305054], [0.37227368354797363], [0.37081387639045715], [0.2757290303707123], [0.2741515040397644], [0.27756810188293457], [0.2809087336063385], [0.2791168987751007], [0.28076285123825073], [0.2869521379470825], [0.290914386510849], [0.1892874389886856], [0.19010262191295624], [0.1924566924571991], [0.19073660671710968], [0.19178619980812073], [0.19336161017417908], [0.1939459890127182], [0.1943628042936325], [0.095330610871315], [0.09512648731470108], [0.09761667996644974], [0.09645845741033554], [0.10090194642543793], [0.10323069244623184], [0.10193410515785217], [0.10194401443004608], [0.04601183533668518]];
        var y_entropy = [[1.1674952507019043], [0.9218698740005493], [0.8891987800598145], [1.292766809463501], [1.1888996362686157], [1.1905853748321533], [1.258359670639038], [1.2294023036956787], [1.2830954790115356], [1.2473870515823364], [1.1934659481048584], [1.1970213651657104], [1.337976098060608], [1.274556279182434], [1.2591601610183716], [1.1237927675247192], [1.3512228727340698], [1.3370743989944458], [1.2649061679840088], [1.300835371017456], [1.2912614345550537], [1.2386598587036133], [1.2229914665222168], [1.3297922611236572], [1.3135439157485962], [1.3608462810516357], [1.3547946214675903], [1.3378887176513672], [1.2960405349731445], [1.361338496208191], [1.3481650352478027], [1.1245415210723877], [1.2938337326049805], [1.288376808166504], [1.3008687496185303], [0.970028281211853], [1.3308392763137817], [1.3229115009307861], [1.3136414289474487], [0.7612024545669556], [0.40999481081962585], [0.2551751434803009], [0.11496567726135254], [0.08283992856740952], [0.07839983701705933], [0.07834704220294952], [0.2753504514694214], [0.8640601634979248], [0.0001270746870432049], [8.08822064879422e-10], [2.0566652892739512e-05], [0.001286910381168127], [0.22034969925880432], [0.9154998660087585], [0.739677369594574], [1.062483310699463], [2.1930165530648082e-05], [1.0388609417155692e-10], [7.316685213254459e-08], [3.1963413675839547e-06], [6.564296768374334e-07], [0.7252589464187622], [1.0714091062545776], [0.9698250889778137], [0.3555232286453247], [9.696415892435084e-11], [5.370975539320533e-11], [5.197324341732479e-12], [1.1967634350185108e-07], [5.55572682969796e-07], [0.9171133637428284], [1.0608558654785156], [0.8209178447723389], [1.0807450934180451e-08], [1.0549019435757145e-09], [4.019127697318936e-09], [4.1178896026394796e-06], [3.023510544153396e-07], [1.0849313735961914], [1.097264051437378], [0.9766924381256104], [0.0333605520427227], [0.003565331222489476], [0.0061802021227777], [0.4968412220478058], [0.09146074950695038], [1.0001344680786133], [1.098115086555481], [0.9854341745376587], [8.492448699826127e-08], [2.950452035466178e-11], [5.405163960858772e-07], [4.594362792431639e-07], [1.0734580755233765], [1.0124995708465576], [1.0768424272537231], [0.9952558279037476], [1.1079075648012804e-06], [1.2193691389938976e-08], [2.4713737730053253e-05], [2.8350573302304838e-06], [0.9158511161804199], [1.0836818218231201], [1.0874321460723877], [0.9371132850646973], [0.5029550790786743], [0.3493497669696808], [0.28038766980171204], [0.10244120657444], [0.29239365458488464], [1.0308911800384521], [1.0475530624389648], [1.0520837306976318], [0.620639979839325], [0.40117064118385315], [0.14886486530303955], [0.2554343044757843], [0.38209155201911926], [1.0165101289749146]];
        var y_attention_weights = [];
        var y_action = [[[0.19089017808437347, 0.06786279380321503, 0.21553564071655273, 0.5257114171981812]], [[0.12289461493492126, 0.06637366861104965, 0.10583355277776718, 0.7048981785774231]], [[0.1195218488574028, 0.06793547421693802, 0.09052208065986633, 0.7220206260681152]], [[0.2750031650066376, 0.2837924063205719, 0.08717290312051773, 0.35403144359588623]], [[0.180786594748497, 0.33192917704582214, 0.050981029868125916, 0.4363032579421997]], [[0.1550481766462326, 0.3664579689502716, 0.06017734110355377, 0.418316513299942]], [[0.16636909544467926, 0.37679553031921387, 0.0955614224076271, 0.36127397418022156]], [[0.13101164996623993, 0.4154095947742462, 0.10026611387729645, 0.353312611579895]], [[0.1042952612042427, 0.35360363125801086, 0.18476514518260956, 0.3573359251022339]], [[0.08791123330593109, 0.31938374042510986, 0.17435503005981445, 0.4183500111103058]], [[0.08648310601711273, 0.237304225564003, 0.1651095300912857, 0.5111031532287598]], [[0.08421987295150757, 0.2982945144176483, 0.13965147733688354, 0.4778341054916382]], [[0.2957476079463959, 0.15854407846927643, 0.19404856860637665, 0.3516598045825958]], [[0.44813889265060425, 0.12027815729379654, 0.1966838538646698, 0.2348991334438324]], [[0.4354754388332367, 0.08805462718009949, 0.22966942191123962, 0.24680054187774658]], [[0.0628029853105545, 0.19615209102630615, 0.1778530478477478, 0.5631918907165527]], [[0.2904800474643707, 0.17146839201450348, 0.20241016149520874, 0.33564135432243347]], [[0.2668944299221039, 0.14291733503341675, 0.23150022327899933, 0.35868802666664124]], [[0.21718227863311768, 0.12194662541151047, 0.19736197590827942, 0.46350908279418945]], [[0.11582286655902863, 0.3553979694843292, 0.19220580160617828, 0.33657342195510864]], [[0.15769848227500916, 0.3010709285736084, 0.13709981739521027, 0.4041307270526886]], [[0.11497063934803009, 0.3763332664966583, 0.1203865110874176, 0.3883095681667328]], [[0.10804916173219681, 0.3957991302013397, 0.11445948481559753, 0.38169220089912415]], [[0.13721558451652527, 0.24056395888328552, 0.25019827485084534, 0.37202221155166626]], [[0.40331724286079407, 0.20343253016471863, 0.14051680266857147, 0.25273340940475464]], [[0.27019068598747253, 0.16803249716758728, 0.24067147076129913, 0.32110536098480225]], [[0.2759188711643219, 0.15303577482700348, 0.25385111570358276, 0.31719422340393066]], [[0.16779543459415436, 0.33283427357673645, 0.3210517168045044, 0.17831853032112122]], [[0.43477699160575867, 0.23412588238716125, 0.1498202532529831, 0.18127690255641937]], [[0.31538912653923035, 0.18907767534255981, 0.200862318277359, 0.29467082023620605]], [[0.3418056070804596, 0.17124983668327332, 0.19708354771137238, 0.2898610830307007]], [[0.30768880248069763, 0.40778717398643494, 0.27595269680023193, 0.008571319282054901]], [[0.16972701251506805, 0.32316628098487854, 0.12520532310009003, 0.3819013237953186]], [[0.1672292947769165, 0.350986510515213, 0.11960192024707794, 0.3621823191642761]], [[0.18937814235687256, 0.3550339639186859, 0.11735367774963379, 0.3382342755794525]], [[0.5087621212005615, 0.3680996596813202, 0.12308910489082336, 4.91458413307555e-05]], [[0.3004399240016937, 0.2961157262325287, 0.11703888326883316, 0.28640544414520264]], [[0.271743506193161, 0.3297848701477051, 0.11168462038040161, 0.2867870032787323]], [[0.28230512142181396, 0.3507894277572632, 0.10674318671226501, 0.26016223430633545]], [[0.660295844078064, 0.30105969309806824, 0.03864407539367676, 3.906455674496101e-07]], [[0.8589812517166138, 0.14054235816001892, 0.00047638919204473495, 5.5947593780025784e-11]], [[0.9297250509262085, 0.07016406953334808, 0.00011079890100518242, 9.853696634684606e-13]], [[0.9758003354072571, 0.024031341075897217, 0.00016831784159876406, 4.486634154476921e-12]], [[0.9841104745864868, 0.015645544975996017, 0.00024405072326771915, 9.626623283243152e-12]], [[0.9851795434951782, 0.01456989161670208, 0.00025045021902769804, 9.327974156980723e-12]], [[0.9851701855659485, 0.014601843431591988, 0.00022794143296778202, 5.783867308706281e-12]], [[0.9359474778175354, 0.04674249887466431, 0.017309993505477905, 4.112951298984591e-12]], [[0.6559879779815674, 0.22723515331745148, 0.11677683144807816, 4.800588815356832e-10]], [[6.76539093547035e-06, 0.9999903440475464, 2.902347887356882e-06, 6.745314201825425e-18]], [[3.3535139942753034e-11, 1.0, 1.9912035965675311e-16, 1.483842054376314e-29]], [[1.3826429494656622e-06, 0.9999985694885254, 2.42121850346777e-10, 6.340240879310885e-26]], [[1.8551003449829295e-05, 0.00010497838957235217, 1.036292510137038e-10, 0.9998764991760254]], [[0.951066792011261, 0.010154206305742264, 0.03877899423241615, 2.359418616038056e-08]], [[0.5669995546340942, 0.33517369627952576, 0.09782663732767105, 1.275863752425721e-07]], [[0.7460403442382812, 0.1464507281780243, 0.10750889778137207, 1.026579776047809e-11]], [[0.44724297523498535, 0.22880813479423523, 0.3239488899707794, 1.710581537528455e-10]], [[7.055649007270404e-07, 7.809787234691612e-07, 0.9999985694885254, 2.6424074641679063e-21]], [[3.873121441622107e-12, 1.0, 6.972402527300608e-14, 1.043527823646229e-21]], [[3.771834844457089e-09, 1.0, 3.290379579044822e-13, 7.741519619381443e-27]], [[2.0767704711488477e-07, 0.9999997615814209, 3.085190783402858e-11, 3.318887319917613e-13]], [[1.939839044950986e-08, 1.55356971731635e-08, 1.6110436318328425e-09, 1.0]], [[0.07923939824104309, 0.7453631162643433, 0.17539750039577484, 5.118775625589933e-09]], [[0.4221619665622711, 0.34277546405792236, 0.2350625842809677, 1.4410181492507945e-08]], [[0.31576037406921387, 0.13961181044578552, 0.5446277856826782, 3.7788215223599764e-08]], [[0.09575240314006805, 0.006768681574612856, 0.8974789381027222, 5.203517061680429e-10]], [[3.680837318970065e-12, 1.6301845754508127e-15, 1.0, 3.059330472195391e-27]], [[1.9935598311038305e-12, 1.0, 2.78294296094401e-17, 9.898274116496235e-26]], [[4.376445427302193e-14, 1.7349257591989772e-22, 1.0, 1.297862099909619e-13]], [[6.339954339296128e-09, 1.0, 2.1387876685636728e-14, 6.2794368263388665e-15]], [[1.2391430992408914e-08, 2.915164998285036e-09, 1.5144035359071495e-08, 1.0]], [[0.2604953348636627, 0.609707236289978, 0.1297961175441742, 1.286679548684333e-06]], [[0.2252987176179886, 0.44840389490127563, 0.3262970745563507, 2.67818762722527e-07]], [[0.20622631907463074, 0.10600187629461288, 0.6877718567848206, 4.645165141425878e-09]], [[1.143699787653496e-10, 3.774301426950899e-10, 1.0, 1.6251948280132023e-27]], [[4.1940478867630304e-11, 1.0, 1.9563773344388746e-12, 4.1668077392015856e-31]], [[1.7841804422769059e-10, 1.0, 5.012829344328007e-13, 7.835360363272215e-41]], [[2.7136792368764873e-07, 0.9999997615814209, 7.05352776186885e-10, 4.712491469593018e-22]], [[1.132577764906273e-08, 3.136141346615773e-09, 1.6686765302864615e-09, 1.0]], [[0.39853236079216003, 0.26443204283714294, 0.33703505992889404, 4.288400816676585e-07]], [[0.34532430768013, 0.3456859290599823, 0.30898961424827576, 1.558024251835377e-07]], [[0.2184990644454956, 0.5745944976806641, 0.20690609514713287, 3.442078195803333e-07]], [[0.005275281146168709, 0.9946860074996948, 3.871259104926139e-05, 1.5980071432775134e-10]], [[0.00023883432731963694, 0.00013467256212607026, 0.9996265172958374, 4.503019593489477e-14]], [[0.0007326215854845941, 0.9992544054985046, 1.2999173122807406e-05, 1.3770788953593183e-09]], [[0.10642079263925552, 0.03822632133960724, 0.8553528785705566, 1.7303819488390104e-09]], [[0.016992658376693726, 0.9823629260063171, 0.0006444745231419802, 1.885516631716655e-08]], [[0.49094682931900024, 0.14832475781440735, 0.36072853207588196, 1.1909581654201418e-10]], [[0.3373120427131653, 0.3189758360385895, 0.34371206164360046, 7.857103412334254e-09]], [[0.37564268708229065, 0.1331305354833603, 0.4912267327308655, 2.348671430951743e-11]], [[4.344453241600377e-09, 1.0, 5.391708260416017e-11, 9.189904913785071e-22]], [[1.055022172055664e-12, 1.0, 1.280726521742711e-14, 4.203895392974451e-44]], [[3.126342207337984e-08, 1.0, 1.0232068664572935e-11, 4.014785145909849e-23]], [[1.322333176290158e-08, 2.300655221887382e-09, 9.402965517324446e-09, 1.0]], [[0.32903146743774414, 0.2442748248577118, 0.4266936779022217, 4.775130846290665e-10]], [[0.5353928208351135, 0.23879757523536682, 0.22580963373184204, 7.690015291217378e-10]], [[0.43235161900520325, 0.29674363136291504, 0.2709047496318817, 1.4695948458154362e-08]], [[0.29937487840652466, 0.1671314835548401, 0.5334935784339905, 3.295940464997926e-10]], [[8.614946978013904e-09, 5.681875592244978e-08, 0.9999998807907104, 1.5729665815572546e-25]], [[2.9121180467051033e-10, 1.0, 2.629088613481656e-10, 1.902318717259512e-40]], [[1.7089907942136051e-06, 0.9999983310699463, 5.892808019325457e-09, 4.328811436694021e-21]], [[6.076585634673393e-08, 1.853999975764964e-08, 9.231235509332691e-08, 0.9999998807907104]], [[0.4356556832790375, 0.08037558943033218, 0.48396873474121094, 1.4429222573719702e-11]], [[0.4139077067375183, 0.277589350938797, 0.3085029423236847, 2.622622258252605e-11]], [[0.3754802346229553, 0.2647395133972168, 0.3597802221775055, 9.659069100109718e-10]], [[0.6110453605651855, 0.2066931277513504, 0.18226151168346405, 1.0785100812427117e-08]], [[0.2001868188381195, 0.7995599508285522, 0.00025323498994112015, 1.722961703864989e-11]], [[0.8909621238708496, 0.1082129031419754, 0.0008249321836046875, 1.6883678483070597e-11]], [[0.9315183758735657, 0.05716797709465027, 0.011313701048493385, 5.913604050888921e-10]], [[0.018920961767435074, 0.0011087801540270448, 0.9799702167510986, 5.203523723018577e-11]], [[0.07556004077196121, 0.9206519722938538, 0.0037880369927734137, 1.258156068217886e-08]], [[0.47560733556747437, 0.34178921580314636, 0.18260344862937927, 4.973454426071555e-10]], [[0.27482643723487854, 0.48634132742881775, 0.23883211612701416, 1.8952420077766874e-08]], [[0.44394350051879883, 0.352512001991272, 0.20354406535625458, 3.7807896546837583e-07]], [[0.3057008683681488, 0.6936720609664917, 0.0006270860321819782, 3.1621510965251787e-10]], [[0.8631293177604675, 0.1366044282913208, 0.00026630479260347784, 2.0177633869300493e-11]], [[0.9700943827629089, 0.024285582825541496, 0.005620097275823355, 5.960090199153001e-10]], [[0.9437490701675415, 0.02661833167076111, 0.029632573947310448, 2.394226372715025e-09]], [[0.9036492705345154, 0.039195314049720764, 0.05715540423989296, 3.6911800282979357e-09]], [[0.5215721130371094, 0.2809721827507019, 0.19745570421218872, 2.1894948354361787e-10]]]; // action probs
        var action =  [[2], [3], [2], [1], [1], [1], [3], [1], [1], [3], [0], [3], [0], [0], [0], [2], [2], [0], [1], [3], [1], [1], [1], [2], [3], [1], [1], [1], [3], [3], [3], [1], [3], [1], [3], [0], [0], [1], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [1], [1], [1], [3], [0], [0], [0], [2], [2], [1], [1], [1], [3], [1], [2], [2], [2], [2], [1], [2], [1], [3], [1], [0], [2], [2], [1], [1], [1], [3], [0], [0], [1], [1], [2], [1], [2], [1], [0], [0], [2], [1], [1], [1], [3], [2], [1], [2], [0], [2], [1], [1], [3], [1], [0], [0], [0], [0], [0], [1], [2], [1], [2], [0], [2], [1], [0], [0], [0], [0], [0]];
        var action_names = [['no-op', 'rotate left', 'rotate right', 'move forward']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Attention Scores") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step + 1;
        visualizeAttentionScores(y_attention_weights[step], top_n);
          // Set action plot if statistic_plot_id is 0
          if(statistic_plot_id == 0){
            // Update action plot
            if(is_discrete) { // If action_space is discrete
              set_bar_action_plot(y_action[step][0], action[step][0], action_names);
            }
            else { // If action_space is multi discrete
                set_stacked_bar_action_plot(y_action[step], action[step], action_names);
            }
          }
          // Set value plot if statistic_plot_id is 1
          if (statistic_plot_id == 1) {
            set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
          }

        // Set entropy plot if statistic_plot_id is 2
        if (statistic_plot_id == 2) {
            if(is_discrete) { // If action_space is discrete
                set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
            }
            else { // If action_space is multi discrete
                set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
            }
        }
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth - 50;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
        // Add event handler for clicking on a marker
        document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);

          // Add event handler for clicking on a marker
          document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>