<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
        min-width: 1737px;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row nowrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="location.href='../index.html'">Back</button>
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MysteryPath-Grid-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 200001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>cardinal_origin_choice</b>: [0, 1, 2, 3]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>show_origin</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>show_goal</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>visual_feedback</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_goal</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_fall_off</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_path_progress</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 200001<br><b>reward_normalization</b>: 0<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 256<br><b>transformer</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_blocks</b>: 2<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>embed_dim</b>: 256<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_heads</b>: 4<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>memory_length</b>: 96<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>positional_encoding</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_norm</b>: pre<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>init_weights</b>: xavier<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>gtrxl</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>gtrxl_bias</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>gtrxl_swap</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>share_heads</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_episode_steps</b>: 129<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>add_positional_encoding_to_query</b>: False<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 10000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: {'initial': 0.0}<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <br>
      <center>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Attention Scores</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Number of Top Attention Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_200001_133.webm', '', '', '', 'videos/video_seed_200001_134.webm', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.8398450016975403], [0.8265500068664551], [0.8333495855331421], [0.8657726645469666], [0.8738893270492554], [0.8765479326248169], [0.8776081800460815], [0.863703727722168], [0.876468300819397], [0.8821132779121399], [0.8860103487968445], [0.8809593915939331], [0.8915489912033081], [0.900093138217926], [0.891408383846283], [0.8810254335403442], [0.8937273621559143], [0.880910336971283], [0.886266827583313], [0.9016342163085938], [0.8997406363487244], [0.9017863273620605], [0.9261611700057983], [0.9437106847763062], [0.9632254838943481], [0.9563983082771301], [0.9714035391807556], [0.9783517122268677], [0.9849987030029297], [0.9676724076271057]];
        var y_entropy = [[0.001664865529164672], [0.003642759285867214], [7.10782187525183e-05], [0.007069517858326435], [1.940077481776825e-06], [0.0001565447309985757], [0.002163129625841975], [0.02652730979025364], [0.0014735747827216983], [0.0032293039839714766], [2.5097420802921988e-05], [0.0023982629645615816], [9.257072815671563e-05], [6.755023787263781e-05], [0.8511292934417725], [0.12678781151771545], [0.00044630724005401134], [0.0002045863657258451], [2.8380120056681335e-05], [5.060151579527883e-06], [4.88655950903194e-06], [0.01437764335423708], [0.00040512208943255246], [3.3364979117322946e-06], [0.0006612680735997856], [0.003700297325849533], [0.00012396735837683082], [1.2967831253263284e-07], [0.0008129694033414125], [0.005706998519599438]];
        var y_attention_weights = [[[], []], [[1.0], [1.0]], [[0.36294007301330566, 0.6370599269866943], [0.6194279193878174, 0.38057202100753784]], [[0.24807892739772797, 0.5038421154022217, 0.24807892739772797], [0.46577513217926025, 0.23979873955249786, 0.2944261133670807]], [[0.14377135038375854, 0.39357829093933105, 0.14377135038375854, 0.31887903809547424], [0.4166491627693176, 0.17354807257652283, 0.23604221642017365, 0.1737605333328247]], [[0.14015430212020874, 0.271344393491745, 0.14015430212020874, 0.19819286465644836, 0.25015413761138916], [0.3238888680934906, 0.1432119607925415, 0.2089402973651886, 0.15921524167060852, 0.16474361717700958]], [[0.11008211970329285, 0.14901845157146454, 0.11008211970329285, 0.2516022324562073, 0.21199768781661987, 0.16721737384796143], [0.31682372093200684, 0.11852453649044037, 0.1667037457227707, 0.11846266686916351, 0.14002053439617157, 0.13946478068828583]], [[0.1226777583360672, 0.21729841828346252, 0.1226777583360672, 0.1378248929977417, 0.1509321630001068, 0.12021498382091522, 0.12837404012680054], [0.3439120650291443, 0.09564903378486633, 0.1187315359711647, 0.08938463777303696, 0.10632075369358063, 0.10079135000705719, 0.14521066844463348]], [[0.09457816183567047, 0.20626363158226013, 0.09457816183567047, 0.05237576737999916, 0.06279560923576355, 0.11292340606451035, 0.07519088685512543, 0.30129435658454895], [0.30656319856643677, 0.09684894979000092, 0.11751996725797653, 0.09001404792070389, 0.09552058577537537, 0.0811811164021492, 0.12222299724817276, 0.09012912213802338]], [[0.05009400099515915, 0.13143835961818695, 0.05009400099515915, 0.05253611505031586, 0.07115834951400757, 0.08468662202358246, 0.08884390443563461, 0.4210546314716339, 0.05009400099515915], [0.28027433156967163, 0.09063546359539032, 0.11046867817640305, 0.08223200589418411, 0.08683497458696365, 0.07239817827939987, 0.1302236020565033, 0.08380989730358124, 0.06312291324138641]], [[0.03661571443080902, 0.13213574886322021, 0.03661571443080902, 0.04528416693210602, 0.04567580670118332, 0.1485811024904251, 0.0611233115196228, 0.41206854581832886, 0.03661571443080902, 0.04528416693210602], [0.3045913875102997, 0.0736539289355278, 0.09845208376646042, 0.06644394993782043, 0.08667442947626114, 0.07580612599849701, 0.13294905424118042, 0.0756683349609375, 0.05164137855172157, 0.034119341522455215]], [[0.03672410920262337, 0.13240690529346466, 0.03672410920262337, 0.03585691377520561, 0.03540986031293869, 0.058136578649282455, 0.09152474254369736, 0.4652259349822998, 0.03672410920262337, 0.03585691377520561, 0.03540986031293869], [0.265034556388855, 0.08011811971664429, 0.10453261435031891, 0.07538949698209763, 0.07670490443706512, 0.07337285578250885, 0.12178955972194672, 0.07463231682777405, 0.05139034613966942, 0.037460245192050934, 0.03957495838403702]], [[0.03642639145255089, 0.11308921128511429, 0.03642639145255089, 0.05345389246940613, 0.023587115108966827, 0.06991548836231232, 0.040781766176223755, 0.44293683767318726, 0.03642639145255089, 0.05345389246940613, 0.023587115108966827, 0.06991548836231232], [0.25982412695884705, 0.07943316549062729, 0.10026111453771591, 0.07806465774774551, 0.0764581561088562, 0.06796261668205261, 0.09488637000322342, 0.06693091243505478, 0.0545734241604805, 0.0415274053812027, 0.03798389807343483, 0.04209413379430771]], [[0.0563594326376915, 0.08327537775039673, 0.0563594326376915, 0.07801243662834167, 0.036184415221214294, 0.01863687112927437, 0.04619266837835312, 0.369168221950531, 0.0563594326376915, 0.07801243662834167, 0.036184415221214294, 0.01863687112927437, 0.06661798059940338], [0.2622026801109314, 0.07786852866411209, 0.09318546950817108, 0.07042121142148972, 0.07750400900840759, 0.06356307864189148, 0.07425425201654434, 0.06201395392417908, 0.05546596646308899, 0.03942397981882095, 0.041208621114492416, 0.043230090290308, 0.039658159017562866]], [[0.054748885333538055, 0.09336011856794357, 0.054748885333538055, 0.058547355234622955, 0.06280376762151718, 0.03338363394141197, 0.07588865607976913, 0.22655126452445984, 0.054748885333538055, 0.058547355234622955, 0.06280376762151718, 0.03338363394141197, 0.031490497291088104, 0.09899326413869858], [0.2527318000793457, 0.07259799540042877, 0.086561419069767, 0.06518274545669556, 0.0754501223564148, 0.06382304430007935, 0.08334392309188843, 0.06364119052886963, 0.04454970359802246, 0.034026339650154114, 0.03514910489320755, 0.03508773073554039, 0.03440326452255249, 0.05345163494348526]], [[0.040895022451877594, 0.14625583589076996, 0.040895022451877594, 0.031285837292671204, 0.08569459617137909, 0.04067784547805786, 0.03758857771754265, 0.21412232518196106, 0.040895022451877594, 0.031285837292671204, 0.08569459617137909, 0.04067784547805786, 0.02612355537712574, 0.04374820366501808, 0.09415985643863678], [0.24509325623512268, 0.064969003200531, 0.08166466653347015, 0.061372291296720505, 0.06779783964157104, 0.04931376874446869, 0.08886091411113739, 0.05377412214875221, 0.04095819592475891, 0.03189260512590408, 0.03064568340778351, 0.03047533705830574, 0.028026167303323746, 0.0504927933216095, 0.07466336339712143]], [[0.06307569146156311, 0.13744956254959106, 0.06307569146156311, 0.0310308039188385, 0.03431996703147888, 0.04205378144979477, 0.033449091017246246, 0.2317206710577011, 0.06307569146156311, 0.0310308039188385, 0.03431996703147888, 0.04205378144979477, 0.025552093982696533, 0.07494033873081207, 0.0794399082660675, 0.013412142172455788], [0.22919921576976776, 0.0662163570523262, 0.07771717011928558, 0.05730293691158295, 0.06688740104436874, 0.05065878480672836, 0.07065596431493759, 0.055419180542230606, 0.046295762062072754, 0.03391670435667038, 0.03471742197871208, 0.03333728760480881, 0.029983611777424812, 0.046688344329595566, 0.06838259100914001, 0.03262128680944443]], [[0.030661268159747124, 0.08896726369857788, 0.030661268159747124, 0.031269822269678116, 0.03944036364555359, 0.03593515604734421, 0.042265474796295166, 0.33062654733657837, 0.030661268159747124, 0.031269822269678116, 0.03944036364555359, 0.03593515604734421, 0.022921482101082802, 0.06129103899002075, 0.09746809303760529, 0.020524386316537857, 0.030661268159747124], [0.21127724647521973, 0.06321753561496735, 0.0747457966208458, 0.0555291511118412, 0.0619487501680851, 0.04709043726325035, 0.07877504825592041, 0.05502740293741226, 0.041544653475284576, 0.03254367411136627, 0.03236273676156998, 0.031768109649419785, 0.030084416270256042, 0.045950330793857574, 0.07009735703468323, 0.029681632295250893, 0.03835568204522133]], [[0.024382732808589935, 0.08630499988794327, 0.024382732808589935, 0.023169472813606262, 0.023157691583037376, 0.04609411954879761, 0.026963016018271446, 0.26454684138298035, 0.024382732808589935, 0.023169472813606262, 0.023157691583037376, 0.04609411954879761, 0.030367743223905563, 0.10962005704641342, 0.16385094821453094, 0.012803386896848679, 0.024382732808589935, 0.023169472813606262], [0.2417231649160385, 0.056898973882198334, 0.0708765760064125, 0.0473390594124794, 0.06773260980844498, 0.05311926454305649, 0.0839177742600441, 0.052420638501644135, 0.035531993955373764, 0.024089723825454712, 0.030548181384801865, 0.026536742225289345, 0.023090515285730362, 0.040361035615205765, 0.06896857917308807, 0.02159232832491398, 0.03352887183427811, 0.021723954007029533]], [[0.018986353650689125, 0.09680745005607605, 0.018986353650689125, 0.018711760640144348, 0.01636705920100212, 0.014032955281436443, 0.03217967599630356, 0.29980599880218506, 0.018986353650689125, 0.018711760640144348, 0.01636705920100212, 0.014032955281436443, 0.08933202177286148, 0.11896511912345886, 0.1414290964603424, 0.012232860550284386, 0.018986353650689125, 0.018711760640144348, 0.01636705920100212], [0.2018568068742752, 0.06259754300117493, 0.07749062031507492, 0.05393345281481743, 0.060134850442409515, 0.048515431582927704, 0.07012880593538284, 0.053253479301929474, 0.038533784449100494, 0.0279966089874506, 0.028481943532824516, 0.030524447560310364, 0.02572450041770935, 0.040143683552742004, 0.07381848245859146, 0.02273740991950035, 0.035628460347652435, 0.02614694833755493, 0.022352751344442368]], [[0.021272404119372368, 0.06728897988796234, 0.021272404119372368, 0.023236311972141266, 0.011614251881837845, 0.01458997093141079, 0.017495574429631233, 0.18024736642837524, 0.021272404119372368, 0.023236311972141266, 0.011614251881837845, 0.01458997093141079, 0.026781266555190086, 0.13800625503063202, 0.32657957077026367, 0.01018971111625433, 0.021272404119372368, 0.023236311972141266, 0.011614251881837845, 0.01458997093141079], [0.1727914810180664, 0.06210307776927948, 0.07960554212331772, 0.0618487223982811, 0.06074235588312149, 0.048141151666641235, 0.06775891035795212, 0.05050665885210037, 0.04011474549770355, 0.032359424978494644, 0.02631903812289238, 0.027797352522611618, 0.026355762034654617, 0.040779273957014084, 0.0650508776307106, 0.02424984611570835, 0.03789747506380081, 0.03061714395880699, 0.020160935819149017, 0.024800222367048264]], [[0.026283685117959976, 0.046374496072530746, 0.026283685117959976, 0.02407994493842125, 0.01685362309217453, 0.007986849173903465, 0.018465977162122726, 0.13642260432243347, 0.026283685117959976, 0.02407994493842125, 0.01685362309217453, 0.007986849173903465, 0.02640552818775177, 0.05322270840406418, 0.43012937903404236, 0.010677815414965153, 0.026283685117959976, 0.02407994493842125, 0.01685362309217453, 0.007986849173903465, 0.02640552818775177], [0.18598712980747223, 0.0555688738822937, 0.06555231660604477, 0.05220373347401619, 0.04994954913854599, 0.04074675962328911, 0.06407389044761658, 0.04791993647813797, 0.04128171503543854, 0.030350759625434875, 0.028951536864042282, 0.029143186286091805, 0.028037454932928085, 0.045800551772117615, 0.06753634661436081, 0.026288054883480072, 0.039427053183317184, 0.028272509574890137, 0.02273859642446041, 0.02629508264362812, 0.023874960839748383]], [[0.022881969809532166, 0.07085665315389633, 0.022881969809532166, 0.03690642863512039, 0.016090979799628258, 0.032826073467731476, 0.023754257708787918, 0.2052944302558899, 0.022881969809532166, 0.03690642863512039, 0.016090979799628258, 0.032826073467731476, 0.04995831847190857, 0.026304597035050392, 0.1668734848499298, 0.03169703111052513, 0.022881969809532166, 0.03690642863512039, 0.016090979799628258, 0.032826073467731476, 0.04995831847190857, 0.026304597035050392], [0.16927503049373627, 0.05535794794559479, 0.06663309782743454, 0.04761949181556702, 0.050333671271800995, 0.03874300420284271, 0.060689281672239304, 0.04961160570383072, 0.039655957370996475, 0.02771509438753128, 0.02531576342880726, 0.027437426149845123, 0.025117985904216766, 0.041136909276247025, 0.06979499757289886, 0.023194734007120132, 0.03791465610265732, 0.02661018632352352, 0.021217187866568565, 0.02834336832165718, 0.02193513885140419, 0.04634743183851242]], [[0.041768841445446014, 0.046643853187561035, 0.041768841445446014, 0.030956007540225983, 0.03591648489236832, 0.027663610875606537, 0.03152095153927803, 0.20758354663848877, 0.041768841445446014, 0.030956007540225983, 0.03591648489236832, 0.027663610875606537, 0.017826683819293976, 0.014750117436051369, 0.16502614319324493, 0.017116611823439598, 0.041768841445446014, 0.030956007540225983, 0.03591648489236832, 0.027663610875606537, 0.017826683819293976, 0.014750117436051369, 0.016271652653813362], [0.1980801820755005, 0.05247258394956589, 0.05959371477365494, 0.04391472041606903, 0.05140038579702377, 0.043116532266139984, 0.07024975121021271, 0.043727435171604156, 0.03179293870925903, 0.024527933448553085, 0.022101402282714844, 0.024246755987405777, 0.021822599694132805, 0.033076051622629166, 0.05246515944600105, 0.022983893752098083, 0.029442816972732544, 0.022641953080892563, 0.017787735909223557, 0.021961653605103493, 0.01881471276283264, 0.03959473967552185, 0.05418434739112854]], [[0.03428489714860916, 0.024995308369398117, 0.03428489714860916, 0.021979516372084618, 0.033274658024311066, 0.019853703677654266, 0.03533818945288658, 0.07140025496482849, 0.03428489714860916, 0.021979516372084618, 0.033274658024311066, 0.019853703677654266, 0.03771980479359627, 0.028273364529013634, 0.2734534442424774, 0.023272672668099403, 0.03428489714860916, 0.021979516372084618, 0.033274658024311066, 0.019853703677654266, 0.03771980479359627, 0.028273364529013634, 0.03366285189986229, 0.043427687138319016], [0.1890181005001068, 0.053194738924503326, 0.060043901205062866, 0.04053511470556259, 0.05622401833534241, 0.042005717754364014, 0.06043359637260437, 0.03921985998749733, 0.029932664707303047, 0.020289892330765724, 0.022312335669994354, 0.02199888601899147, 0.02037608064711094, 0.035857729613780975, 0.05268742889165878, 0.018673432990908623, 0.027937132865190506, 0.018179399892687798, 0.017169708386063576, 0.020044317469000816, 0.015922900289297104, 0.03653629869222641, 0.05607742816209793, 0.04532930999994278]], [[0.026175063103437424, 0.024474279955029488, 0.026175063103437424, 0.02660924568772316, 0.03504638746380806, 0.025319112464785576, 0.02425980195403099, 0.049693215638399124, 0.026175063103437424, 0.02660924568772316, 0.03504638746380806, 0.025319112464785576, 0.03045828267931938, 0.02725963294506073, 0.23741182684898376, 0.015830079093575478, 0.026175063103437424, 0.02660924568772316, 0.03504638746380806, 0.025319112464785576, 0.03045828267931938, 0.02725963294506073, 0.03848496451973915, 0.06990522146224976, 0.05888034403324127], [0.19456392526626587, 0.04845896363258362, 0.056927360594272614, 0.03854374587535858, 0.0581456795334816, 0.04108213260769844, 0.05808424577116966, 0.03483666852116585, 0.026806041598320007, 0.019699661061167717, 0.020940644666552544, 0.019059181213378906, 0.020264597609639168, 0.03702988475561142, 0.03886376693844795, 0.018809812143445015, 0.024726763367652893, 0.017694219946861267, 0.017138086259365082, 0.018232150003314018, 0.01630854234099388, 0.03879861906170845, 0.050106581300497055, 0.039992667734622955, 0.04488605633378029]], [[0.0412878692150116, 0.058327894657850266, 0.0412878692150116, 0.027792321518063545, 0.03776202350854874, 0.020784031599760056, 0.015314780175685883, 0.07749947905540466, 0.0412878692150116, 0.027792321518063545, 0.03776202350854874, 0.020784031599760056, 0.012807597406208515, 0.012030172161757946, 0.22308698296546936, 0.018694058060646057, 0.0412878692150116, 0.027792321518063545, 0.03776202350854874, 0.020784031599760056, 0.012807597406208515, 0.012030172161757946, 0.019245769828557968, 0.048588305711746216, 0.0308892410248518, 0.034511324018239975], [0.19771474599838257, 0.04362994432449341, 0.05039653927087784, 0.037827540189027786, 0.050194889307022095, 0.03126293793320656, 0.04436741769313812, 0.03049505315721035, 0.02522324025630951, 0.018690884113311768, 0.021037403494119644, 0.01811833307147026, 0.019761012867093086, 0.03744314983487129, 0.03825591132044792, 0.018286695703864098, 0.02401047572493553, 0.016922108829021454, 0.018084518611431122, 0.01752084493637085, 0.016647497192025185, 0.03992149978876114, 0.0490226149559021, 0.03499341383576393, 0.044545821845531464, 0.05562550947070122]], [[0.059215325862169266, 0.09605798870325089, 0.059215325862169266, 0.033465318381786346, 0.0331556536257267, 0.013364908285439014, 0.02045171894133091, 0.07306751608848572, 0.059215325862169266, 0.033465318381786346, 0.0331556536257267, 0.013364908285439014, 0.009257946163415909, 0.012347200885415077, 0.1373642086982727, 0.018039768561720848, 0.059215325862169266, 0.033465318381786346, 0.0331556536257267, 0.013364908285439014, 0.009257946163415909, 0.012347200885415077, 0.017316225916147232, 0.03685355186462402, 0.029220476746559143, 0.032896481454372406, 0.018702823668718338], [0.18421831727027893, 0.04039229080080986, 0.04793066903948784, 0.037178706377744675, 0.043317634612321854, 0.02719801291823387, 0.04220236465334892, 0.028851568698883057, 0.026432927697896957, 0.021096142008900642, 0.019998697564005852, 0.017914921045303345, 0.016948005184531212, 0.027724288403987885, 0.037347212433815, 0.018427487462759018, 0.025417454540729523, 0.019846700131893158, 0.01740070804953575, 0.01685032993555069, 0.01535978727042675, 0.034396734088659286, 0.041567299515008926, 0.03220679610967636, 0.0365280844271183, 0.049705952405929565, 0.07354089617729187]], [[0.04015692323446274, 0.06365563720464706, 0.04015692323446274, 0.03049095906317234, 0.026847049593925476, 0.01257563941180706, 0.01577642373740673, 0.051742345094680786, 0.04015692323446274, 0.03049095906317234, 0.026847049593925476, 0.01257563941180706, 0.010733392089605331, 0.012219725176692009, 0.14545771479606628, 0.011195443570613861, 0.04015692323446274, 0.03049095906317234, 0.026847049593925476, 0.01257563941180706, 0.010733392089605331, 0.012219725176692009, 0.01140841469168663, 0.03361920639872551, 0.022861478850245476, 0.023504137992858887, 0.023532116785645485, 0.18097220361232758], [0.17561212182044983, 0.037342093884944916, 0.04259480535984039, 0.031400736421346664, 0.0407564640045166, 0.022448977455496788, 0.037657223641872406, 0.024775754660367966, 0.02512679249048233, 0.018008185550570488, 0.021359160542488098, 0.017390692606568336, 0.01617562770843506, 0.030669908970594406, 0.03772083669900894, 0.01533458661288023, 0.024477330967783928, 0.016951024532318115, 0.018924415111541748, 0.016172893345355988, 0.013492273166775703, 0.03362438827753067, 0.0460580550134182, 0.03063339926302433, 0.03889656439423561, 0.057455550879240036, 0.07079961895942688, 0.03814050927758217]], [[0.03923739120364189, 0.09958824515342712, 0.03923739120364189, 0.03126930072903633, 0.02586299739778042, 0.010823098011314869, 0.015861567109823227, 0.03968125581741333, 0.03923739120364189, 0.03126930072903633, 0.02586299739778042, 0.010823098011314869, 0.02226884476840496, 0.014898418448865414, 0.18030431866645813, 0.007052898406982422, 0.03923739120364189, 0.03126930072903633, 0.02586299739778042, 0.010823098011314869, 0.02226884476840496, 0.014898418448865414, 0.00942893885076046, 0.01922193542122841, 0.021245965734124184, 0.024032268673181534, 0.01677533984184265, 0.11725140362977982, 0.014405587688088417], [0.1756225824356079, 0.036466971039772034, 0.041510824114084244, 0.03234865888953209, 0.03661845624446869, 0.02371489815413952, 0.03863788768649101, 0.026646587997674942, 0.023213112726807594, 0.018333736807107925, 0.0199285838752985, 0.01705082505941391, 0.016386685892939568, 0.0280311219394207, 0.03646212816238403, 0.014796237461268902, 0.02204761654138565, 0.01700543984770775, 0.01584363915026188, 0.015065988525748253, 0.01372435875236988, 0.03173654153943062, 0.047224726527929306, 0.03218862786889076, 0.03523499146103859, 0.051512982696294785, 0.0603082999587059, 0.037967897951602936, 0.034369565546512604]]];
        var y_action = [[[6.681255854346091e-06, 1.9024504638309736e-07, 0.9998310804367065, 0.00016194983618333936]], [[6.465762453444768e-06, 0.9995930790901184, 0.0003956870932597667, 4.755375357490266e-06]], [[1.7803693026507972e-06, 3.391489144632942e-06, 1.3143621746536382e-09, 0.9999948740005493]], [[1.5040277503430843e-06, 0.9991611242294312, 8.628203795524314e-05, 0.0007511022267863154]], [[1.2109434521789808e-07, 5.070021069641939e-10, 2.4276847893078823e-11, 0.9999998807907104]], [[3.0529901096087997e-07, 1.1864814041473437e-05, 0.9999874830245972, 3.351832162934443e-07]], [[0.00016493962903041393, 5.015974602429196e-05, 1.0112670452144812e-06, 0.9997839331626892]], [[0.0001038626505760476, 0.0038791673723608255, 0.9960123300552368, 4.684964096668409e-06]], [[2.5296172680100426e-05, 0.00011705446377163753, 2.3488378531055787e-07, 0.9998574256896973]], [[3.938814785442446e-08, 0.999639630317688, 0.00035840930650010705, 1.87398632078839e-06]], [[1.6922904251259752e-06, 9.735797945609193e-09, 3.007600923865539e-08, 0.9999982118606567]], [[8.264016287284903e-06, 0.00018994879792444408, 4.30400250479579e-05, 0.999758780002594]], [[2.929354195657652e-06, 6.651920614331175e-08, 3.804157358899829e-06, 0.9999932050704956]], [[5.0938019739987794e-06, 7.566427484562155e-10, 4.0248394839181856e-08, 0.9999948740005493]], [[0.03310966119170189, 0.6735215187072754, 0.03760106489062309, 0.2557677626609802]], [[2.4997123546199873e-05, 1.1079396244895179e-06, 0.9723221063613892, 0.0276518315076828]], [[2.4502653104718775e-05, 1.2717217032331973e-05, 3.4582794228299463e-07, 0.9999624490737915]], [[1.357652834599321e-08, 0.9999829530715942, 1.6901205526664853e-05, 9.012376267492073e-08]], [[1.242628286490799e-06, 3.1093996710751526e-08, 6.332250563900743e-07, 0.9999980926513672]], [[5.509898315381179e-08, 1.6602598407189362e-07, 9.574352333174829e-08, 0.9999996423721313]], [[7.30274365423611e-08, 1.896070784823678e-07, 4.440317624698764e-08, 0.9999996423721313]], [[6.787602160329698e-07, 0.001990332268178463, 0.9980090260505676, 6.187149126368752e-10]], [[3.571201887098141e-05, 1.8834207082818466e-07, 1.530348114897606e-08, 0.9999641180038452]], [[8.513718618985422e-09, 0.9999997615814209, 1.9889783686721785e-07, 5.756155552205655e-09]], [[5.912797132623382e-05, 1.8511593680159422e-06, 7.675531321638118e-09, 0.99993896484375]], [[0.00038158189272508025, 2.7046171453548595e-05, 2.1952655515633523e-07, 0.9995911717414856]], [[9.846504326560535e-06, 5.439591888034556e-08, 2.938917442740774e-10, 0.9999901056289673]], [[1.0516926218784306e-09, 1.0, 4.767591210708133e-09, 7.912712707280889e-10]], [[7.766745693515986e-05, 3.8884234498937076e-08, 4.772852779666437e-09, 0.9999222755432129]], [[0.00047276506666094065, 0.0001443516812287271, 1.610094477655366e-05, 0.999366819858551]]]; // action probs
        var action =  [[2], [1], [3], [1], [3], [2], [3], [2], [3], [1], [3], [3], [3], [3], [1], [2], [3], [1], [3], [3], [3], [2], [3], [1], [3], [3], [3], [1], [3], [3]];
        var action_names = [['no-op', 'rotate left', 'rotate right', 'move forward']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Attention Scores") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step;
        visualizeAttentionScores(y_attention_weights[step], top_n);
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
        // Add event handler for clicking on a marker
        document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);

          // Add event handler for clicking on a marker
          document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>