<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
        min-width: 1737px;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row nowrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: absolute;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="location.href='../index.html'">Back</button>
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MortarMayhem-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 200002<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>arena_size</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>allowed_commands</b>: 9<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_count</b>: [10]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_duration</b>: [6]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_delay</b>: [18]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_failure</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_success</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_episode_success</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 200002<br><b>reward_normalization</b>: 0<br><b>positional_endocing</b>: False<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: -1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 512<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_layers</b>: 1<br><b>obs_decoder</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>attach_to</b>: memory<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>detach_gradient</b>: False<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 30000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 1000<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <br>
      <center>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Attention Scores</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Number of Top Attention Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_200002_70.webm', '', 'videos/video_seed_200002_71.webm', '', 'videos/video_seed_200002_72.webm', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.34042996168136597], [0.3422307074069977], [0.3436742424964905], [0.34389179944992065], [0.3493329584598541], [0.34812021255493164], [0.3502315580844879], [0.351776123046875], [0.35554009675979614], [0.35590359568595886], [0.35737770795822144], [0.359233558177948], [0.3648407757282257], [0.36596813797950745], [0.3679468333721161], [0.370792955160141], [0.3674481213092804], [0.3694223463535309], [0.3707648813724518], [0.375168114900589], [0.374426007270813], [0.3761259615421295], [0.37741485238075256], [0.3794790804386139], [0.3810400664806366], [0.38303592801094055], [0.38412389159202576], [0.38639476895332336], [0.3886052668094635], [0.39021021127700806], [0.3917105495929718], [0.3950818181037903], [0.39620834589004517], [0.3982372581958771], [0.39917227625846863], [0.4026423394680023], [0.40352553129196167], [0.40446969866752625], [0.4053448736667633], [0.40759944915771484], [0.4131929576396942], [0.4158017635345459], [0.41814932227134705], [0.42165133357048035], [0.4223633110523224], [0.4262429177761078], [0.4271546006202698], [0.4297509491443634], [0.43175286054611206], [0.4343411922454834], [0.4372352063655853], [0.4396198093891144], [0.4415316879749298], [0.4444028437137604], [0.44528383016586304], [0.44874751567840576], [0.45050498843193054], [0.45096296072006226], [0.3547869622707367], [0.35456010699272156], [0.35551193356513977], [0.35719478130340576], [0.36165282130241394], [0.3651491403579712], [0.36530157923698425], [0.3684263527393341], [0.3723328411579132], [0.373607337474823], [0.37488338351249695], [0.37574508786201477], [0.37851566076278687], [0.38121065497398376], [0.38260433077812195], [0.3852529525756836], [0.3875631093978882], [0.38801702857017517], [0.3912351429462433], [0.39339330792427063], [0.39480116963386536], [0.3967449367046356], [0.397977739572525], [0.3997974097728729], [0.30135899782180786], [0.3033594787120819], [0.30410781502723694], [0.30440399050712585], [0.3062707185745239], [0.3100135326385498], [0.3110905885696411], [0.3111319839954376], [0.3152678608894348], [0.31671804189682007], [0.3156055510044098], [0.31740936636924744], [0.320037305355072], [0.3224351108074188], [0.32178640365600586], [0.32400640845298767], [0.3249785602092743], [0.3268914222717285], [0.3285785913467407], [0.3306698501110077], [0.3326398730278015], [0.334307998418808], [0.33548420667648315], [0.336117148399353], [0.23785382509231567], [0.2375715970993042], [0.23788458108901978], [0.23766466975212097], [0.2449713498353958], [0.24439643323421478], [0.24107925593852997], [0.242662250995636], [0.24801960587501526], [0.2511323094367981], [0.2527469992637634], [0.24925090372562408], [0.24628007411956787], [0.24883681535720825], [0.2491934895515442], [0.2513629198074341], [0.25416886806488037], [0.2593517005443573], [0.2594318687915802], [0.259319543838501], [0.25971752405166626], [0.2561340034008026], [0.2601076662540436], [0.26099538803100586], [0.16400094330310822], [0.1665753424167633], [0.168462336063385], [0.17118799686431885], [0.1710585355758667], [0.16788046061992645], [0.17301452159881592], [0.1762789487838745], [0.18042661249637604], [0.18409238755702972], [0.18432477116584778], [0.1861552894115448], [0.1883658617734909], [0.18788497149944305], [0.1866653859615326], [0.19030648469924927], [0.1915433704853058], [0.1922537237405777], [0.19323144853115082], [0.19525682926177979], [0.19670890271663666], [0.1977832317352295], [0.19324928522109985], [0.1978352963924408], [0.0951472744345665], [0.09537132829427719], [0.09646328538656235], [0.0973835214972496], [0.09776896983385086], [0.09536755830049515], [0.09874895215034485], [0.10115355253219604], [0.10222619771957397], [0.10185517370700836], [0.10823237895965576], [0.10627777874469757], [0.10636124014854431], [0.10165771096944809], [0.10535409301519394], [0.10782346874475479], [0.10840960592031479], [0.10921082645654678], [0.11321145296096802], [0.1078101247549057], [0.10993857681751251], [0.11168912053108215], [0.11335372179746628], [0.11349721252918243], [0.013972818851470947], [0.01533237099647522], [0.013953685760498047], [0.015097998082637787], [0.0141020268201828], [0.01746758073568344], [0.015058860182762146], [0.01427500694990158], [0.01707727462053299], [0.013778448104858398], [0.0156840980052948], [0.017977669835090637], [0.018081769347190857], [0.015094354748725891], [0.016019143164157867], [0.01591981202363968], [0.015136480331420898], [0.014858067035675049], [0.016268014907836914], [0.01645013689994812], [0.018017321825027466], [0.015112355351448059], [0.016821518540382385], [0.017443165183067322], [0.01468588411808014]];
        var y_entropy = [[0.7969299554824829, 1.0790865421295166], [0.819229781627655, 0.8344380855560303], [0.866757333278656, 0.7482782602310181], [0.6240589618682861, 0.08819422125816345], [0.7384187579154968, 0.18069949746131897], [0.7185547351837158, 0.06254521012306213], [0.768355131149292, 0.04751003161072731], [0.055779628455638885, 0.033941082656383514], [0.42763552069664, 0.35282304883003235], [0.5318536758422852, 0.4268155097961426], [0.5983102917671204, 0.4361722469329834], [0.196808323264122, 0.3560754656791687], [0.805992603302002, 0.9674561023712158], [0.8484461903572083, 1.0219073295593262], [0.8437198400497437, 1.0367093086242676], [1.0790488719940186, 0.9373688697814941], [1.039373517036438, 0.9685461521148682], [1.0185765027999878, 0.9623147249221802], [1.0156712532043457, 0.9657261371612549], [0.38443344831466675, 0.6097102761268616], [0.969080924987793, 1.0205851793289185], [0.9515128135681152, 1.008880615234375], [0.9459909200668335, 1.0119290351867676], [0.09410028904676437, 0.13327758014202118], [1.0019018650054932, 1.0422040224075317], [1.0285906791687012, 1.0410871505737305], [1.0310202836990356, 1.0393810272216797], [0.06900085508823395, 0.08036496490240097], [1.0205756425857544, 0.9132789373397827], [1.0486080646514893, 1.011538028717041], [1.0504751205444336, 1.0151925086975098], [0.0617004819214344, 0.03938380256295204], [0.9680817127227783, 0.9823203086853027], [1.0162410736083984, 1.0257453918457031], [1.0219308137893677, 1.025855302810669], [0.07274235039949417, 0.04291181638836861], [0.9952089786529541, 0.876891016960144], [1.0475456714630127, 0.9893196821212769], [1.0526474714279175, 0.9965542554855347], [0.07741506397724152, 0.023842934519052505], [0.002822378883138299, 0.005777905695140362], [0.003898205002769828, 0.0002544261806178838], [0.014806798659265041, 1.728099391584692e-06], [0.5935260653495789, 3.219160498701967e-05], [0.0038911064621061087, 0.100168377161026], [0.243820920586586, 0.5426502227783203], [0.8886229395866394, 0.571108341217041], [0.8747780323028564, 0.5036277770996094], [0.8129317760467529, 0.4655250310897827], [0.10995669662952423, 0.3987642526626587], [0.7767701148986816, 0.5307208895683289], [0.777157187461853, 0.5035723447799683], [0.6874775886535645, 0.5969546437263489], [0.6436981558799744, 0.6282602548599243], [0.47358688712120056, 0.5789557695388794], [0.6726743578910828, 0.6115261316299438], [0.6651363968849182, 0.6865499019622803], [0.40207743644714355, 0.6863141059875488], [0.3807394504547119, 0.27793318033218384], [0.11554048210382462, 0.1891176998615265], [0.04022778943181038, 0.6961620450019836], [0.4751337766647339, 0.49199819564819336], [0.026889098808169365, 0.6852947473526001], [0.5047720670700073, 0.5396469831466675], [0.000398919073631987, 0.27610668540000916], [0.000484502874314785, 0.35123929381370544], [0.05410626903176308, 0.5794020295143127], [0.509655237197876, 0.6925758123397827], [0.6117486357688904, 0.8224358558654785], [0.7091514468193054, 0.840964138507843], [0.7963870167732239, 0.47634264826774597], [0.8244880437850952, 0.6745889782905579], [1.038516879081726, 1.0132249593734741], [1.0974581241607666, 1.0811692476272583], [0.7161760330200195, 0.5122188329696655], [1.0867074728012085, 1.0841599702835083], [0.7335942387580872, 0.6046988368034363], [0.7777352333068848, 0.9356913566589355], [0.7120743989944458, 0.6030704975128174], [0.9942994117736816, 0.8236396908760071], [0.7635761499404907, 1.0502182245254517], [0.7892193794250488, 0.7341507077217102], [0.7513480186462402, 0.10829884558916092], [0.5699014067649841, 0.27537456154823303], [0.06249650567770004, 0.5320886969566345], [0.04441802576184273, 0.3958198130130768], [0.1005580723285675, 0.6219518184661865], [0.5457326769828796, 0.02548658847808838], [0.1400100737810135, 0.3009374737739563], [0.024304509162902832, 0.08136045187711716], [0.0031810079235583544, 0.6614550948143005], [0.01933709904551506, 0.7288230657577515], [0.05708373337984085, 0.7198500633239746], [0.09834244847297668, 0.6433848738670349], [0.19148753583431244, 0.5825066566467285], [0.30439141392707825, 0.4429500102996826], [0.09233462065458298, 0.06247258558869362], [0.4236365258693695, 0.5509002804756165], [0.24206319451332092, 0.13265593349933624], [0.6115544438362122, 0.2633786201477051], [0.795469343662262, 0.06337959319353104], [0.6932111978530884, 0.05521262437105179], [0.7188054323196411, 0.05266517400741577], [0.719664990901947, 0.05124537646770477], [0.717950165271759, 0.052810534834861755], [0.7128657102584839, 0.05587320402264595], [0.6519347429275513, 0.004604544956237078], [0.04644525796175003, 0.05367074906826019], [0.0344705805182457, 0.10293993353843689], [0.010799510404467583, 0.0004624074208550155], [5.839729624312895e-07, 0.02191755175590515], [5.994007512555299e-10, 0.0011607379419729114], [6.503100991039901e-08, 0.5715049505233765], [0.05799054354429245, 0.04068213701248169], [0.7439651489257812, 0.06336027383804321], [0.6093571782112122, 0.14414705336093903], [0.3323078155517578, 0.6503634452819824], [0.8285138607025146, 0.6871939897537231], [0.7622508406639099, 0.3991676867008209], [0.8731650114059448, 0.7169163823127747], [0.8697023391723633, 0.7087062001228333], [0.1240517720580101, 0.6840531229972839], [1.0167067050933838, 0.8781564235687256], [0.7040908932685852, 0.44495072960853577], [0.3111337423324585, 0.9180534482002258], [0.7045391798019409, 0.6540980935096741], [0.843258798122406, 0.2553478479385376], [0.6540332436561584, 0.3771390914916992], [1.055262565612793, 0.42558884620666504], [0.9820295572280884, 0.41218480467796326], [0.5274600982666016, 0.5714018940925598], [0.11586684733629227, 0.33284831047058105], [0.022114470601081848, 0.28591740131378174], [0.4305487871170044, 0.4102209210395813], [0.0013061215868219733, 0.043349552899599075], [0.02076764777302742, 0.6224578022956848], [0.0005677483859471977, 0.005308506544679403], [0.005416918080300093, 1.7117238257924328e-06], [0.08852136135101318, 0.0001275815156986937], [0.24448664486408234, 0.017660971730947495], [0.7050974369049072, 0.6417431235313416], [1.03863525390625, 0.6288886666297913], [0.993290364742279, 0.9981241822242737], [0.06035537272691727, 0.3118129372596741], [0.48253658413887024, 0.8847852945327759], [0.8259386420249939, 0.6451002955436707], [0.41517049074172974, 1.0220251083374023], [0.5528969168663025, 0.9970217943191528], [0.6508132815361023, 0.7996708154678345], [0.4838491678237915, 1.0016980171203613], [0.5174484848976135, 0.9970289468765259], [0.846207857131958, 0.4741920828819275], [0.7153093218803406, 0.6774904131889343], [0.38981902599334717, 1.065704345703125], [0.1573973000049591, 0.657697856426239], [0.009127351455390453, 0.08333415538072586], [0.011191649362444878, 0.6628310680389404], [0.1055436059832573, 0.9519516229629517], [0.014613785780966282, 0.6699168682098389], [0.00018103545880876482, 0.6652570962905884], [1.8802609702106565e-05, 0.6090636253356934], [7.599279797432246e-06, 0.6711874604225159], [0.0008693728595972061, 0.44758936762809753], [0.6363179683685303, 0.5466251373291016], [0.7132589221000671, 0.1991121768951416], [0.6695221662521362, 0.3348093032836914], [0.7030192613601685, 0.5024979114532471], [0.6379860639572144, 0.588234543800354], [0.7297097444534302, 0.5509421229362488], [0.7574267387390137, 0.4522249102592468], [0.7521074414253235, 0.5457338094711304], [0.7469972968101501, 0.656482458114624], [0.9455205202102661, 1.0800410509109497], [0.09983140975236893, 0.17245645821094513], [0.6963728070259094, 0.8034435510635376], [0.5553479790687561, 0.7511863708496094], [0.9962126016616821, 0.5623671412467957], [0.8816595077514648, 0.6337667107582092], [0.8340108394622803, 0.012733954936265945], [1.0895873856497929e-06, 0.29667049646377563], [3.313318302389234e-05, 0.18441061675548553], [5.67975512240082e-05, 0.029536087065935135], [0.001346900244243443, 0.41423529386520386], [0.7272300124168396, 0.6948550939559937], [2.5486291633569635e-05, 0.5704320073127747], [0.21223008632659912, 0.5163475275039673], [0.0001638131943764165, 0.012042737565934658], [7.4565468821674585e-06, 1.6927373280850588e-07], [0.009679990820586681, 1.7296933947363868e-06], [0.0003902924945577979, 1.4150544302538037e-05], [0.00026841138605959713, 0.06157076358795166], [4.776083528668096e-07, 0.014152653515338898], [0.0006802460993640125, 1.0074112651636824e-05], [9.719889931147918e-06, 0.0022553279995918274], [4.810525311427227e-09, 0.00015851587522774935], [1.936031003424432e-05, 4.356542859795809e-08], [4.287391493562609e-05, 0.0004978437209501863], [1.2237374846790772e-07, 3.490109520498663e-06], [0.005329575855284929, 2.822729356921627e-07], [0.0002205127093475312, 0.02458619512617588], [0.07558031380176544, 0.0347059927880764], [2.4989731173263863e-08, 0.0029131616465747356], [0.6927603483200073, 0.04736226052045822]];
        var y_attention_weights = [];
        var y_action = [[[0.1349712312221527, 0.713607132434845, 0.1514216959476471], [0.24372725188732147, 0.39132505655288696, 0.36494773626327515]], [[0.14231182634830475, 0.6994519829750061, 0.15823617577552795], [0.14621776342391968, 0.6893315315246582, 0.1644507199525833]], [[0.1770218312740326, 0.6667783856391907, 0.15619982779026031], [0.10476124286651611, 0.7400420308113098, 0.1551966667175293]], [[0.8070032000541687, 0.10146171599626541, 0.09153500944375992], [0.010376768186688423, 0.9848040342330933, 0.004819223191589117]], [[0.021290509030222893, 0.34538277983665466, 0.6333267092704773], [0.02633398026227951, 0.9629582762718201, 0.010707666166126728]], [[0.0344880037009716, 0.2661961317062378, 0.6993159055709839], [0.007770579308271408, 0.9897955060005188, 0.002433926099911332]], [[0.04282267391681671, 0.295421302318573, 0.6617559790611267], [0.0055327946320176125, 0.9926555156707764, 0.0018117156578227878]], [[0.9913339018821716, 0.00418119877576828, 0.004484898876398802], [0.003847398329526186, 0.9950350522994995, 0.0011175669496878982]], [[0.01653742976486683, 0.1094341054558754, 0.8740284442901611], [0.08948178589344025, 0.9013051390647888, 0.009213155135512352]], [[0.050196174532175064, 0.1062270998954773, 0.8435767292976379], [0.12923741340637207, 0.8635239005088806, 0.007238606456667185]], [[0.05519525706768036, 0.1334669142961502, 0.8113378882408142], [0.1354704052209854, 0.8577717542648315, 0.00675790524110198]], [[0.9570944309234619, 0.03549898788332939, 0.007406559307128191], [0.029803277924656868, 0.9113239049911499, 0.058872777968645096]], [[0.18826839327812195, 0.1101345345377922, 0.7015970945358276], [0.3144330084323883, 0.5471533536911011, 0.13841363787651062]], [[0.22835904359817505, 0.1073007583618164, 0.6643401980400085], [0.33053937554359436, 0.4918077886104584, 0.17765292525291443]], [[0.22312502562999725, 0.10781706869602203, 0.6690579056739807], [0.3353780210018158, 0.47345295548439026, 0.19116897881031036]], [[0.33328747749328613, 0.25299739837646484, 0.4137151837348938], [0.13929691910743713, 0.26784878969192505, 0.5928543210029602]], [[0.19474487006664276, 0.33381885290145874, 0.4714363217353821], [0.5764051675796509, 0.17480804026126862, 0.24878676235675812]], [[0.20140400528907776, 0.278200626373291, 0.5203953981399536], [0.5863298177719116, 0.18373116850852966, 0.2299390286207199]], [[0.20185640454292297, 0.2729896008968353, 0.5251539945602417], [0.582818329334259, 0.18441572785377502, 0.23276598751544952]], [[0.05794718489050865, 0.03924696147441864, 0.9028058052062988], [0.12028758227825165, 0.06914360076189041, 0.8105688095092773]], [[0.1188279464840889, 0.3880296051502228, 0.4931424856185913], [0.5186145901679993, 0.27713829278945923, 0.2042471319437027]], [[0.11868850886821747, 0.3389875292778015, 0.5423239469528198], [0.529681921005249, 0.2797401547431946, 0.19057784974575043]], [[0.11708550900220871, 0.3326898217201233, 0.5502246618270874], [0.527502715587616, 0.27742865681648254, 0.19506867229938507]], [[0.013526605442166328, 0.0033622635528445244, 0.9831111431121826], [0.025001969188451767, 0.0023251993115991354, 0.9726728796958923]], [[0.1496358960866928, 0.48895859718322754, 0.36140549182891846], [0.42503154277801514, 0.18387022614479065, 0.3910982608795166]], [[0.16798153519630432, 0.43415510654449463, 0.39786332845687866], [0.4682655930519104, 0.19593128561973572, 0.33580318093299866]], [[0.16996435821056366, 0.42280876636505127, 0.4072268605232239], [0.46845826506614685, 0.19294743239879608, 0.33859434723854065]], [[0.00994211994111538, 0.0018173102289438248, 0.9882405996322632], [0.014075574465095997, 0.000784180941991508, 0.9851402640342712]], [[0.1627468317747116, 0.4593145251274109, 0.3779385983943939], [0.2527972161769867, 0.13166192173957825, 0.6155409216880798]], [[0.19320884346961975, 0.37913888692855835, 0.4276522696018219], [0.331510066986084, 0.16746863722801208, 0.5010212659835815]], [[0.19682753086090088, 0.37177884578704834, 0.4313935339450836], [0.3395666778087616, 0.16792264580726624, 0.492510586977005]], [[0.00910053588449955, 0.0012921689776703715, 0.9896072745323181], [0.006085424218326807, 0.00024372799089178443, 0.9936708211898804]], [[0.1355690360069275, 0.5414989590644836, 0.3229319751262665], [0.35532668232917786, 0.13561128079891205, 0.5090619921684265]], [[0.16156123578548431, 0.47396624088287354, 0.36447253823280334], [0.4276036024093628, 0.16427597403526306, 0.40812045335769653]], [[0.1647290140390396, 0.4607750177383423, 0.3744959235191345], [0.4386413097381592, 0.16531963646411896, 0.39603903889656067]], [[0.010212876833975315, 0.002220886293798685, 0.9875662326812744], [0.006777037866413593, 0.0002487811434548348, 0.9929741621017456]], [[0.16865421831607819, 0.5350677371025085, 0.29627808928489685], [0.2820156514644623, 0.09579005837440491, 0.6221942901611328]], [[0.19900448620319366, 0.4521546959877014, 0.3488408327102661], [0.3861347436904907, 0.13416951894760132, 0.47969573736190796]], [[0.20375998318195343, 0.4419485628604889, 0.35429149866104126], [0.40328577160835266, 0.13760808110237122, 0.4591061770915985]], [[0.010788261890411377, 0.0025626150891184807, 0.9866490960121155], [0.0033660572953522205, 0.00013262433640193194, 0.9965013265609741]], [[0.000271440832875669, 2.8049955290043727e-05, 0.9997005462646484], [0.0006520628230646253, 3.0049517590668984e-05, 0.9993178844451904]], [[0.000446452759206295, 4.897610779153183e-07, 0.9995530247688293], [1.9763403543038294e-05, 1.4404594139705296e-06, 0.99997878074646]], [[0.002061267616227269, 2.012124494799039e-10, 0.9979386925697327], [1.0227503111082115e-07, 4.2498320418360436e-09, 0.9999998807907104]], [[0.2806064486503601, 5.83748445137644e-08, 0.7193934917449951], [2.3325726488110377e-06, 1.6935316482502571e-09, 0.999997615814209]], [[0.0004465973179321736, 5.211624101025825e-12, 0.999553382396698], [0.02053575962781906, 3.8305602174659725e-06, 0.9794603586196899]], [[0.06624186784029007, 9.140492807091505e-07, 0.9337572455406189], [0.8284221887588501, 0.033187683671712875, 0.13839010894298553]], [[0.6466999650001526, 0.20838306844234467, 0.14491692185401917], [0.8294255137443542, 0.06707118451595306, 0.1035032570362091]], [[0.5969729423522949, 0.07980284839868546, 0.3232242166996002], [0.8593379855155945, 0.06875934451818466, 0.07190267741680145]], [[0.5528333783149719, 0.03606925159692764, 0.41109737753868103], [0.8738840818405151, 0.05584026128053665, 0.07027573138475418]], [[0.023122839629650116, 4.968471145616604e-08, 0.9768771529197693], [0.8850109577178955, 0.013674139976501465, 0.10131490230560303]], [[0.6130065321922302, 0.03157799690961838, 0.3554155230522156], [0.841230034828186, 0.04336687922477722, 0.11540307104587555]], [[0.5297876596450806, 0.020993439480662346, 0.44921886920928955], [0.8583234548568726, 0.057242657989263535, 0.08443388342857361]], [[0.5855306386947632, 0.0013420464238151908, 0.4131273031234741], [0.2838171124458313, 4.0054565033642575e-05, 0.7161428332328796]], [[0.6703338027000427, 0.0015317205106839538, 0.3281345069408417], [0.3215082287788391, 2.2932730644242838e-05, 0.6784688830375671]], [[0.8503919243812561, 0.13328644633293152, 0.016321660950779915], [0.7447960376739502, 0.0018535362323746085, 0.2533504366874695]], [[0.3736521899700165, 0.0017101700650528073, 0.6246376633644104], [0.8008340001106262, 0.05005088448524475, 0.14911513030529022]], [[0.3521669805049896, 0.002494625048711896, 0.6453384160995483], [0.7219216823577881, 0.030141888186335564, 0.2479363977909088]], [[0.8848058581352234, 0.10004524886608124, 0.015148883685469627], [0.6046369075775146, 0.002515154192224145, 0.3928478956222534]], [[0.8780174851417542, 0.12006067484617233, 0.0019217546796426177], [0.9311522245407104, 0.05953378230333328, 0.009313991293311119]], [[0.977744996547699, 0.01922799088060856, 0.0030270989518612623], [0.9581282138824463, 0.004977612756192684, 0.036894138902425766]], [[0.9935291409492493, 0.0002828198776114732, 0.006188047118484974], [0.4982610046863556, 0.0003675762563943863, 0.5013713836669922]], [[0.8175737261772156, 7.293684120668331e-06, 0.18241897225379944], [0.19364356994628906, 5.004092599847354e-05, 0.8063063621520996]], [[0.004138053394854069, 3.86806868846179e-06, 0.9958581328392029], [0.4073724150657654, 0.5913032293319702, 0.0013244455913081765]], [[0.20288622379302979, 3.583506622817367e-05, 0.7970779538154602], [0.799490749835968, 0.19091002643108368, 0.009599201381206512]], [[3.548886888893321e-05, 2.293334827596638e-10, 0.9999644756317139], [0.923163652420044, 0.0758829265832901, 0.0009534939890727401]], [[4.39178038504906e-05, 3.362421452379749e-12, 0.9999561309814453], [0.8882627487182617, 0.00014477835793513805, 0.11159246414899826]], [[0.00958921853452921, 6.075754299672553e-08, 0.9904106855392456], [0.26152923703193665, 0.0005835408810526133, 0.7378872036933899]], [[0.19977258145809174, 0.0012875464744865894, 0.7989398241043091], [0.4001656770706177, 0.0031157536432147026, 0.5967184901237488]], [[0.23004798591136932, 0.014615246094763279, 0.7553367018699646], [0.5671665072441101, 0.04221229627728462, 0.39062124490737915]], [[0.272731751203537, 0.029422979801893234, 0.6978452801704407], [0.4078773558139801, 0.047296881675720215, 0.5448257923126221]], [[0.4703243374824524, 0.026434017345309258, 0.5032416582107544], [0.178145170211792, 0.001009311992675066, 0.8208455443382263]], [[0.41354960203170776, 0.040134552866220474, 0.5463157892227173], [0.33818960189819336, 0.006121593061834574, 0.6556887626647949]], [[0.43730607628822327, 0.18074889481067657, 0.3819449841976166], [0.4712287485599518, 0.15714062750339508, 0.37163057923316956]], [[0.3480125367641449, 0.3408016264438629, 0.3111858367919922], [0.421428382396698, 0.30262187123298645, 0.27594974637031555]], [[0.4497295320034027, 0.0049169305711984634, 0.5453535318374634], [0.18133658170700073, 0.006686409469693899, 0.8119770288467407]], [[0.388126403093338, 0.3461974561214447, 0.2656761109828949], [0.4144907593727112, 0.2990533113479614, 0.28645598888397217]], [[0.5149633884429932, 0.008030109107494354, 0.4770064949989319], [0.2293526530265808, 0.013060669414699078, 0.757586658000946]], [[0.5560302734375, 0.023137858137488365, 0.4208318591117859], [0.2391813099384308, 0.6051259636878967, 0.15569278597831726]], [[0.7300811409950256, 0.04968905448913574, 0.22022978961467743], [0.2425532042980194, 0.00905081257224083, 0.7483959794044495]], [[0.5029832720756531, 0.3507454991340637, 0.14627119898796082], [0.4740874171257019, 0.03621437028050423, 0.48969829082489014]], [[0.6795652508735657, 0.04860266298055649, 0.27183207869529724], [0.3605384826660156, 0.44047632813453674, 0.19898521900177002]], [[0.6280055642127991, 0.04106732830405235, 0.33092716336250305], [0.1771881878376007, 0.7407281398773193, 0.08208366483449936]], [[0.7314983606338501, 0.08763827383518219, 0.1808634251356125], [0.022673897445201874, 0.9773240685462952, 2.020948841163772e-06]], [[0.25332653522491455, 0.00047096185153350234, 0.7462025284767151], [0.9380089044570923, 0.030577536672353745, 0.03141351044178009]], [[0.01143366377800703, 4.069989927302231e-07, 0.988565981388092], [0.7977488040924072, 0.006453583016991615, 0.19579759240150452]], [[0.007519823499023914, 1.245963267137995e-05, 0.9924677014350891], [0.12450423836708069, 0.8724971413612366, 0.0029986067675054073]], [[0.020436080172657967, 7.931456639198586e-05, 0.9794846177101135], [0.7645596861839294, 0.02338378131389618, 0.21205656230449677]], [[0.23496109247207642, 4.991607056581415e-05, 0.7649890184402466], [0.0036459399852901697, 0.9962143301963806, 0.00013962172670289874]], [[0.03151325136423111, 3.43508713740448e-06, 0.9684832692146301], [0.08576090633869171, 0.9131652116775513, 0.0010739063145592809]], [[0.0036799723748117685, 3.701798618749308e-07, 0.9963196516036987], [0.015830907970666885, 1.6711084072085214e-06, 0.9841673970222473]], [[0.0003527050430420786, 1.7241794694200507e-06, 0.9996455907821655], [0.7417159676551819, 0.22953633964061737, 0.028747741132974625]], [[0.002669554203748703, 8.183748286683112e-05, 0.9972485899925232], [0.7530434131622314, 0.11071833223104477, 0.13623815774917603]], [[0.009679798036813736, 0.0002788987767416984, 0.9900413155555725], [0.7518025636672974, 0.0849962905049324, 0.16320107877254486]], [[0.018188467249274254, 0.0009351187036372721, 0.9808763861656189], [0.7977505326271057, 0.10671205818653107, 0.09553743898868561]], [[0.03926650434732437, 0.003993484191596508, 0.9567399621009827], [0.8240911960601807, 0.10788701474666595, 0.0680217519402504]], [[0.06907124817371368, 0.009533615782856941, 0.9213951230049133], [0.8824687600135803, 0.06414598226547241, 0.053385134786367416]], [[0.0177878700196743, 0.0003381388960406184, 0.9818739891052246], [0.011118225753307343, 0.9887402653694153, 0.00014146255853120238]], [[0.12002217769622803, 0.010439072735607624, 0.8695387244224548], [0.8310236930847168, 0.12522588670253754, 0.04375050216913223]], [[0.06146278604865074, 0.0014895328786224127, 0.9370476603507996], [0.028442110866308212, 0.9711766242980957, 0.0003812556678894907]], [[0.22626052796840668, 0.015727005898952484, 0.7580124735832214], [0.9414505958557129, 0.03145156800746918, 0.027097826823592186]], [[0.35118457674980164, 0.03894076868891716, 0.6098746657371521], [0.9891424179077148, 0.0010603182017803192, 0.009797297418117523]], [[0.3167087137699127, 0.01414547674357891, 0.6691458821296692], [0.9906200170516968, 0.0005452178302221, 0.00883469358086586]], [[0.3738228678703308, 0.011621794663369656, 0.6145553588867188], [0.9909226298332214, 0.0001965678675333038, 0.00888076052069664]], [[0.41172194480895996, 0.007966957055032253, 0.5803111791610718], [0.9911310076713562, 9.11950774025172e-05, 0.008777801878750324]], [[0.45080626010894775, 0.005252660717815161, 0.543941080570221], [0.9907468557357788, 4.221895869704895e-05, 0.009210965596139431]], [[0.4838907718658447, 0.0033546483609825373, 0.5127546191215515], [0.9900606870651245, 2.1031453798059374e-05, 0.00991827342659235]], [[0.29494601488113403, 0.008366419933736324, 0.696687638759613], [0.9994673132896423, 1.2013083505735267e-05, 0.0005206134519539773]], [[0.007968565449118614, 1.616742792975856e-07, 0.9920313358306885], [0.990504801273346, 1.8819943647940818e-07, 0.009494930505752563]], [[0.005571099929511547, 8.885127300573004e-09, 0.9944288730621338], [0.9787308573722839, 1.2582422925788705e-07, 0.021269043907523155]], [[0.0011634541442617774, 0.9986514449119568, 0.00018513960822019726], [0.9999610185623169, 1.8388771422905847e-05, 2.065341323032044e-05]], [[3.390849556694775e-08, 1.0, 3.1444218756560005e-11], [0.9967432618141174, 0.003254955168813467, 1.7442060880057397e-06]], [[2.452776697026149e-11, 1.0, 4.77861980468044e-15], [0.9998874664306641, 0.00010609652963466942, 6.470449079643004e-06]], [[3.331535269879282e-09, 1.0, 6.829426806875431e-17], [0.7415018677711487, 1.9448766579444055e-06, 0.25849613547325134]], [[0.010434419848024845, 0.9895654916763306, 1.2426028206391493e-07], [0.9938390851020813, 0.0013069442939013243, 0.00485402112826705]], [[0.42749887704849243, 0.5596839785575867, 0.012817156501114368], [0.9899015426635742, 0.004365157801657915, 0.005733329802751541]], [[0.2391434907913208, 0.7494415044784546, 0.011415037326514721], [0.9725659489631653, 0.01091831550002098, 0.0165157001465559]], [[0.10173144936561584, 0.0003935881541110575, 0.8978749513626099], [0.7286255359649658, 0.2535569667816162, 0.017817586660385132]], [[0.6392558217048645, 0.06803726404905319, 0.29270684719085693], [0.5575178861618042, 6.948002555873245e-05, 0.4424126148223877]], [[0.37828829884529114, 0.5985177755355835, 0.023193903267383575], [0.8982163667678833, 0.05521600693464279, 0.046567630022764206]], [[0.4343494176864624, 0.05876154825091362, 0.5068890452384949], [0.364492267370224, 0.6231426000595093, 0.012365174479782581]], [[0.31789430975914, 0.07894561439752579, 0.6031600832939148], [0.4352033734321594, 0.004039171151816845, 0.5607574582099915]], [[0.02697032317519188, 2.6524938334659964e-07, 0.973029375076294], [0.7483510375022888, 0.04615267366170883, 0.20549637079238892]], [[0.529091477394104, 0.21896407008171082, 0.25194454193115234], [0.4302842915058136, 0.5083094239234924, 0.06140633299946785]], [[0.5099704265594482, 0.0016677225939929485, 0.48836177587509155], [0.1533254086971283, 0.8442674875259399, 0.0024071282241493464]], [[0.09371121227741241, 7.265343356266385e-06, 0.9062815308570862], [0.5151633024215698, 0.39964497089385986, 0.08519168943166733]], [[0.4899164140224457, 0.0017354179872199893, 0.5083481669425964], [0.36094072461128235, 1.1814684512501117e-05, 0.6390474438667297]], [[0.32783007621765137, 0.6084928512573242, 0.06367696076631546], [0.9415273666381836, 0.01436832919716835, 0.04410426318645477]], [[0.3610503375530243, 0.6389487981796265, 9.017893489726703e-07], [0.8971107602119446, 0.016775798052549362, 0.08611346781253815]], [[0.4553988575935364, 0.21680527925491333, 0.3277958929538727], [0.8877789378166199, 0.04250773414969444, 0.06971330940723419]], [[0.566067636013031, 0.24304094910621643, 0.19089145958423615], [0.8862265944480896, 0.023426957428455353, 0.09034645557403564]], [[0.791065514087677, 0.20611996948719025, 0.0028145781252533197], [0.25187015533447266, 0.7472192049026489, 0.0009106452343985438]], [[0.9758340120315552, 0.0003982472699135542, 0.02376772090792656], [0.10356589406728745, 1.0179930509668367e-10, 0.8964341282844543]], [[0.9969758987426758, 0.002390905749052763, 0.0006331923650577664], [0.9170929789543152, 0.08289650082588196, 1.0517625014472287e-05]], [[0.15452738106250763, 0.8454676270484924, 5.082436473458074e-06], [0.14291539788246155, 0.8570846319198608, 1.1176036984750226e-08]], [[0.00013116604532115161, 0.9998687505722046, 1.6038286787534162e-07], [0.9926676154136658, 0.0073321168310940266, 1.9813400342627574e-07]], [[0.001187422196380794, 0.9972614049911499, 0.0015512254321947694], [0.31419599056243896, 0.6858008503913879, 3.073211473747506e-06]], [[1.6061380847531836e-07, 0.9999477863311768, 5.203624823479913e-05], [0.0006336091901175678, 0.9993658661842346, 6.1291677866393e-07]], [[5.234974196355324e-06, 0.9993545413017273, 0.0006402285071089864], [1.043427673153019e-07, 0.9999998807907104, 1.7013250808162184e-09]], [[0.015841038897633553, 0.9832667112350464, 0.0008922945708036423], [1.018409056996461e-05, 0.9999898672103882, 1.3877966553721421e-09]], [[0.9355050325393677, 0.06345444172620773, 0.0010405171196907759], [0.002530238125473261, 0.9974695444107056, 2.682681667920406e-07]], [[0.3449418246746063, 0.6428186297416687, 0.012239525094628334], [0.7301873564720154, 0.2545467019081116, 0.015265855938196182]], [[0.38316500186920166, 0.436134934425354, 0.18070000410079956], [0.8010584712028503, 0.1273832470178604, 0.07155832648277283]], [[0.31122738122940063, 0.15989187359809875, 0.528880774974823], [0.5470535755157471, 0.19443736970424652, 0.2585090696811676]], [[0.01095716841518879, 1.3983590285704395e-08, 0.9890428185462952], [0.9059876203536987, 8.633684956294019e-06, 0.09400378912687302]], [[0.17127972841262817, 0.003869465086609125, 0.8248507976531982], [0.2688531279563904, 0.10602851212024689, 0.6251183152198792]], [[0.2509285509586334, 0.6652218103408813, 0.08384963124990463], [0.15169283747673035, 0.78725266456604, 0.06105447933077812]], [[0.057189423590898514, 0.8926317095756531, 0.050178878009319305], [0.5126914381980896, 0.19807587563991547, 0.28923267126083374]], [[0.19606469571590424, 0.010968770831823349, 0.7929665446281433], [0.2871268093585968, 0.17514584958553314, 0.5377272963523865]], [[0.2800246775150299, 0.011222966015338898, 0.7087523937225342], [0.17819532752037048, 0.11407695710659027, 0.7077277898788452]], [[0.07800795882940292, 0.8664142489433289, 0.05557780712842941], [0.4185252785682678, 0.14081618189811707, 0.4406585097312927]], [[0.06587042659521103, 0.8534756302833557, 0.08065392822027206], [0.4427647292613983, 0.4205409586429596, 0.13669438660144806]], [[0.2900265157222748, 0.0771511122584343, 0.6328223347663879], [0.15677383542060852, 0.8363511562347412, 0.006874943617731333]], [[0.23951038718223572, 0.04282421991229057, 0.717665433883667], [0.10454141348600388, 0.11460257321596146, 0.7808560132980347]], [[0.06633958220481873, 0.8997378945350647, 0.03392251953482628], [0.2193538397550583, 0.3662377595901489, 0.4144083559513092]], [[0.023076256737113, 0.9686708450317383, 0.008252949453890324], [0.30148372054100037, 0.690093994140625, 0.008422303944826126]], [[0.0011788163101300597, 1.0884890211393383e-11, 0.9988211989402771], [0.016316454857587814, 1.5056253119261065e-11, 0.9836835265159607]], [[0.0014899339294061065, 2.860512893221312e-07, 0.9985097050666809], [0.36603665351867676, 0.0007818870362825692, 0.6331815123558044]], [[0.02175077237188816, 7.301961159100756e-05, 0.9781761765480042], [0.11328055709600449, 0.3594025671482086, 0.5273168683052063]], [[0.0018904886674135923, 8.37636471260339e-05, 0.9980257749557495], [0.015036413446068764, 0.7006765604019165, 0.2842869758605957]], [[1.4895562344463542e-05, 1.2121391890218547e-08, 0.9999850988388062], [0.01966305449604988, 0.7188940644264221, 0.2614428699016571]], [[1.3070666682324372e-06, 7.54772244704327e-09, 0.9999986886978149], [0.2793087661266327, 0.718172013759613, 0.0025192350149154663]], [[5.092268793305266e-07, 1.208891919901589e-08, 0.9999995231628418], [0.6243521571159363, 0.3742356300354004, 0.0014121370622888207]], [[8.358501509064808e-05, 6.654289563812199e-08, 0.9999163150787354], [0.880036473274231, 0.047985415905714035, 0.07197819650173187]], [[0.6858454346656799, 0.0023679938167333603, 0.31178656220436096], [0.7640500664710999, 2.5543115043547004e-05, 0.23592448234558105]], [[0.5213982462882996, 0.4750349819660187, 0.0035667766351252794], [0.9499954581260681, 7.822397310519591e-05, 0.04992630332708359]], [[0.7488692998886108, 0.2135801762342453, 0.03755047544836998], [0.9075108170509338, 0.007716051768511534, 0.08477311581373215]], [[0.4775911569595337, 0.0016030605183914304, 0.5208057761192322], [0.8124997615814209, 0.00415049958974123, 0.18334978818893433]], [[0.6748536825180054, 0.0010898307664319873, 0.3240565061569214], [0.788969099521637, 0.02311297506093979, 0.18791794776916504]], [[0.5425336360931396, 0.4494948089122772, 0.007971564307808876], [0.7830299735069275, 0.006127262953668833, 0.21084274351596832]], [[0.4041672348976135, 0.5772407650947571, 0.01859198696911335], [0.8442694544792175, 0.004307876341044903, 0.1514226347208023]], [[0.41364288330078125, 0.5702031850814819, 0.016153918579220772], [0.7913200855255127, 0.007874921895563602, 0.2008049637079239]], [[0.3958129584789276, 0.5876761674880981, 0.01651083119213581], [0.6849372982978821, 0.0069527640007436275, 0.30810990929603577]], [[0.4534635543823242, 0.4487670361995697, 0.09776945412158966], [0.42207086086273193, 0.2681504786014557, 0.3097785711288452]], [[0.020383793860673904, 2.6217743652523495e-05, 0.9795899391174316], [0.9602932333946228, 0.001218699268065393, 0.03848801553249359]], [[0.5665606260299683, 0.0018815869698300958, 0.43155771493911743], [0.7086663842201233, 0.12933515012264252, 0.16199848055839539]], [[0.14616994559764862, 0.820945143699646, 0.03288499265909195], [0.6446141004562378, 0.02900605835020542, 0.3263798952102661]], [[0.48562952876091003, 0.37194228172302246, 0.14242824912071228], [0.7917073965072632, 0.19453340768814087, 0.013759195804595947]], [[0.437092125415802, 0.500320315361023, 0.06258752942085266], [0.7658064365386963, 0.20428019762039185, 0.029913300648331642]], [[0.042581308633089066, 0.5308198928833008, 0.42659878730773926], [0.001730529242195189, 0.9982694387435913, 3.963795514039248e-09]], [[6.57213590216088e-08, 1.1801620791729306e-10, 0.9999998807907104], [0.005292327608913183, 0.9206300377845764, 0.07407759130001068]], [[2.399768391114776e-06, 9.329662375989756e-09, 0.999997615814209], [0.04445849359035492, 0.0002787046250887215, 0.9552628397941589]], [[1.1350591648806585e-06, 2.939843398053199e-06, 0.9999959468841553], [0.0006517282454296947, 0.0036455532535910606, 0.9957026839256287]], [[7.812665785422723e-07, 0.00013470025442074984, 0.9998644590377808], [0.0009276174241676927, 0.8579632043838501, 0.1411091685295105]], [[0.23663242161273956, 0.04830055683851242, 0.7150670289993286], [0.0002694065624382347, 0.48270687460899353, 0.5170236825942993]], [[7.22763218163891e-07, 1.0015814950747881e-06, 0.9999983310699463], [1.4136591744318139e-05, 0.25734758377075195, 0.7426382899284363]], [[1.7969148757401854e-05, 0.054660942405462265, 0.9453210830688477], [2.533745600885595e-06, 0.2117857187986374, 0.7882117033004761]], [[7.122141099102919e-09, 1.3397738257481251e-05, 0.9999866485595703], [1.0924226501174417e-07, 0.998377799987793, 0.0016220198012888432]], [[3.12912249000874e-07, 1.4566931838544406e-07, 0.9999995231628418], [6.500647131701953e-09, 1.0, 2.351900674213425e-09]], [[0.001109735225327313, 9.99680269160308e-05, 0.9987903237342834], [1.0771000091835958e-07, 0.9999998807907104, 6.894612658570054e-11]], [[1.6478241377626546e-05, 0.9999675750732422, 1.597005575604271e-05], [9.093552080230438e-07, 0.9999990463256836, 3.169357398746797e-08]], [[1.5948142390698195e-05, 0.9999781847000122, 5.834113380842609e-06], [0.0033420526888221502, 0.0064980159513652325, 0.9901599287986755]], [[6.2938689815439375e-09, 2.025154977047805e-08, 1.0], [2.581536682555452e-05, 0.9980661273002625, 0.0019081187201663852]], [[2.804229204400599e-08, 0.9999362230300903, 6.375078373821452e-05], [4.888302100880537e-07, 1.5933565578052367e-07, 0.9999994039535522]], [[5.5678324173413785e-08, 0.9999994039535522, 5.432070793176536e-07], [1.4607844605052378e-05, 0.00022065298981033266, 0.9997647404670715]], [[4.2747147374578784e-14, 2.160926437788646e-10, 1.0], [6.01678948441986e-06, 6.193046829139348e-06, 0.9999878406524658]], [[3.363581357884726e-10, 1.3622694723380846e-06, 0.9999986886978149], [2.5787638691099346e-10, 1.8851828986754526e-09, 1.0]], [[3.1582806059304858e-06, 5.512526546347374e-10, 0.9999969005584717], [0.9999547004699707, 4.5291362766874954e-05, 4.159578584350676e-11]], [[6.101111171830098e-09, 1.0, 3.18869985971304e-10], [1.430656482170889e-07, 0.9999997615814209, 7.532244694630208e-08]], [[0.0006374371005222201, 0.9993624091148376, 1.0434110464530022e-07], [9.754718810484064e-09, 1.0, 5.374669598268156e-09]], [[3.890894276992185e-06, 1.3796865459880792e-05, 0.9999823570251465], [4.403494585858425e-06, 0.9962748289108276, 0.003720824373885989]], [[9.111624240176752e-05, 0.014230691827833652, 0.9856781363487244], [0.005611852277070284, 0.9943865537643433, 1.7148536244349089e-06]], [[1.1480562056576105e-09, 1.0, 5.7542630382823035e-11], [0.0003213977615814656, 4.4091476070207136e-07, 0.9996781349182129]], [[5.337039965525037e-07, 0.48595109581947327, 0.5140483379364014], [0.0006369460024870932, 0.007067576516419649, 0.992295503616333]]]; // action probs
        var action =  [[1, 1], [1, 1], [1, 1], [0, 1], [2, 1], [1, 1], [2, 1], [0, 1], [2, 1], [0, 1], [2, 1], [0, 1], [2, 0], [2, 1], [0, 1], [0, 1], [2, 0], [1, 0], [2, 1], [1, 2], [1, 2], [2, 2], [2, 0], [2, 2], [2, 2], [0, 0], [0, 2], [2, 2], [2, 0], [2, 2], [0, 2], [2, 2], [0, 2], [2, 2], [2, 0], [2, 2], [0, 0], [1, 2], [1, 0], [2, 2], [2, 2], [2, 2], [2, 2], [0, 2], [2, 2], [2, 0], [0, 0], [0, 0], [1, 0], [2, 0], [0, 0], [0, 1], [0, 0], [2, 2], [1, 0], [0, 0], [2, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 2], [2, 1], [2, 0], [2, 0], [2, 0], [2, 0], [0, 2], [2, 2], [0, 1], [2, 2], [0, 2], [2, 0], [1, 1], [2, 2], [1, 1], [0, 2], [0, 1], [2, 2], [1, 2], [0, 2], [2, 0], [0, 1], [2, 0], [2, 0], [2, 1], [2, 2], [2, 1], [2, 1], [2, 2], [2, 0], [2, 0], [2, 0], [2, 0], [2, 0], [2, 2], [2, 1], [2, 2], [2, 1], [2, 0], [0, 0], [2, 0], [0, 0], [2, 0], [2, 0], [2, 0], [2, 0], [2, 0], [2, 0], [1, 0], [1, 0], [1, 0], [1, 2], [1, 0], [0, 0], [1, 0], [2, 1], [2, 2], [1, 2], [0, 1], [1, 0], [2, 2], [1, 2], [0, 1], [2, 1], [2, 2], [2, 0], [1, 0], [0, 0], [0, 0], [0, 1], [0, 2], [0, 0], [1, 1], [1, 0], [1, 1], [1, 1], [1, 1], [1, 1], [0, 1], [1, 1], [1, 0], [1, 1], [2, 2], [0, 2], [2, 1], [1, 0], [0, 0], [2, 0], [0, 2], [1, 0], [0, 1], [2, 2], [0, 1], [1, 1], [2, 2], [2, 2], [2, 2], [2, 2], [2, 1], [2, 1], [2, 1], [2, 0], [2, 0], [1, 0], [1, 0], [0, 0], [2, 0], [0, 0], [0, 0], [0, 0], [1, 2], [1, 0], [2, 0], [2, 0], [1, 2], [0, 0], [0, 0], [1, 1], [2, 1], [2, 2], [2, 2], [2, 1], [2, 2], [2, 2], [2, 1], [2, 1], [2, 1], [2, 1], [1, 1], [1, 2], [2, 1], [1, 2], [1, 2], [2, 2], [2, 2], [2, 0], [1, 1], [1, 1], [2, 1], [2, 1], [1, 2], [2, 2]];
        var action_names = [['no-op', 'left', 'right'], ['no-op', 'up', 'down']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Attention Scores") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step;
        visualizeAttentionScores(y_attention_weights[step], top_n);
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
        // Add event handler for clicking on a marker
        document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);

          // Add event handler for clicking on a marker
          document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>