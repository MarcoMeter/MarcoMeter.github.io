<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet"/>
    <script src="template/cdn.plot.ly_plotly-2.6.3.min.js"></script>
    <style>
     /* Style the body */
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000;
        color: white;
        font-family: "Montserrat", sans-serif;
        min-width: 1737px;
      }

      /* Set the width and hight of the video*/
      video {
        width: 600px;
        height: 400px;
      }

      /* Style the timeline text*/
      #selector_header {
        font-weight: 200;
      }

      /* Buttons should be displayed in a row */
      buttonrow {
        display: inline;
      }

      /* Style the figures */
      #figures {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-flow: row nowrap;
      }

      /* Style the tab */
      .tab {
        overflow: hidden;
        background-color: #54595f;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: white;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #909090;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #838383;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
        background-color: #000;
      }

      .mediatabcontent {
        display: none;
        padding: 0 px 0 px;
        border-top: none;
        background-color: #000;
        width: 100%;
        height: 100%;
      }

      /* Style the close button */
      .topright {
        float: right;
        cursor: pointer;
        font-size: 28px;
      }

      .topright:hover {
        color: red;
      }

      /* Style of the dropdown button */
      .dropbtn {
        background-color: #17202A;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
      }
      
      /* Style of the dropdown content */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        background-color: #A6ACAF;
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .gotostepcontainer {
          margin-bottom: 10px;
      }
      
      #score-container label, #score-container input {
        display: inline-block;
      }

      /* Style of the dropdown at hover */
      .dropdown-content a:hover {background-color: #ddd;}
      
      .dropdown:hover .dropdown-content {display: block;}
      
      .dropdown:hover .dropbtn {background-color: #161515;}
    </style>
  </head>
  <body>
    <!--- Define tabs -->
    <div class="tab">
      <button class="tablinks" onclick="location.href='../index.html'">Back</button>
      <button class="tablinks" onclick="openTab(event, 'Environment')">Environment</button>
      <button class="tablinks" onclick="openTab(event, 'Sampler')">Sampler</button>
      <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
      <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
      <button class="tablinks" onclick="openTab(event, 'Media')" id="defaultOpen">Media</button>
    </div>

    <!--- Define tab content -->
    <div id="Environment" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>type</b>: MemoryGym<br><b>name</b>: MortarMayhem-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>positional_encoding</b>: False<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 200002<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>agent_scale</b>: 0.25<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>arena_size</b>: 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>allowed_commands</b>: 9<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>command_count</b>: [10]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_duration</b>: [6]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>explosion_delay</b>: [18]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_failure</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_command_success</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reward_episode_success</b>: 0.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>seed</b>: 200002<br><b>reward_normalization</b>: 0<br><b>positional_endocing</b>: False<br>
    </div>

    <div id="Model" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>load_model</b>: False<br><b>model_path</b>: <br><b>checkpoint_interval</b>: 500<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: -1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 512<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num_layers</b>: 1<br>
    </div>

    <div id="Sampler" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>n_workers</b>: 32<br><b>worker_steps</b>: 512<br>
    </div>

    <div id="Hyperparameters" class="tabcontent">
      <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
      <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.995<br><b>lamda</b>: 0.95<br><b>updates</b>: 30000<br><b>epochs</b>: 3<br><b>refresh_buffer_epoch</b>: -1<br><b>n_mini_batches</b>: 8<br><b>advantage_normalization</b>: no<br><b>value_coefficient</b>: 0.5<br><b>max_grad_norm</b>: 0.25<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.000275<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 10000<br><b>obs_reconstruction_schedule</b>: {'initial': 0.0}<br>
    </div>

    <div id="Media" class="mediatabcontent">
      <center>
        <h1> Mortar Mayhem <br> + Gated Recurrent Unit</h1>
        <br>
        <div id="figures" style="display: flex; flex-direction: column;">
          <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column;">
              <div style="display: flex; flex-direction: row;">
                <label for="video_speed">Frame Rate: </label>
                <input type="text" id="video_speed" size="3" value="6" onkeydown="set_video_speed(event)">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_ground_truth">Show Ground Truth Estimation</label>
                <input type="checkbox" id="show_ground_truth" onclick="show_ground_truth()">
              </div>

              <div style="display: flex; flex-direction: row;">
                <label for="show_decoder_video">Show Decoder Video</label>
                <input type="checkbox" id="show_decoder_video" onclick="show_decoder_video()">
              </div>

            <div style="display: flex; flex-direction: row;">
              <label for="show_agent_video">Show Agent Video</label>
              <input type="checkbox" id="show_agent_video" onclick="show_agent_video()">
            </div>
          </div>
          
            <div>
              <video id="video_player">
                <source src="" type="video/webm" />
              </video>
            </div>
            <div id="action_distr"></div>
          </div>
        </div>

        <br>
        <!-- Set buttons to control the figures -->
        <div class="gotostepcontainer">
          <label for="gotostep_text">Step:</label>
          <input type="text" id="gotostep_text" size="3" value="0" onkeydown="go_to_step(event)">
          <button id="return_button" type="return_button" onclick="return_to_step()">Return to step 0</button>
        </div>
        <buttonrow>
          <button id="play_pause_button" onclick="play_pause()" style="width:53px">Play</button>
          <button id="reset_button" onclick="reset()">Reset</button>
          <button id="back_button" onclick="back()">Back</button>
          <button id="next_button" onclick="next()">Next</button>
          <button id="stats_button" onclick="statistic()">Attention Scores</button>
        </buttonrow>
        <br>
        <!-- Set slider to control the figures -->
        <input id="time_selector" type="range" min="0" max="100" step="1" value="0" style="width: 300px;"/>

        <!-- Set transformer plot -->
        <div id="score-container">
          <label for="top_n_scores">Number of Top Attention Scores:</label>
          <input type="text" id="top_n_scores" size="3" value="-1" onkeydown="top_scores()">
        </div>
        <div id="transformer"></div>

        <!-- Set value plot and entropy plot -->
        <div id="figures">
          <div id="value_func"></div>
          <div id="entropy_func"></div>
          <!-- Dropdown button with some options-->
          <div class="dropdown" id="options">
            <button class="dropbtn">Options</button>
            <div class="dropdown-content" id="dropdown_content">
              <a href ="#" onclick="marker('value')">value_marker_toggle</a>
              <a href ="#" onclick="marker('entropy')">entropy_marker_toggle</a>
              <a href="#" id="all" onclick="set_action_space('all')">All</a>
            </div>
          </div>
        </div>
      </center>
    </div>

    <script>
        // Set active tab
        document.getElementById("defaultOpen").click();

        // Set video player
        const video_player = document.getElementById("video_player");
        const video_speed = document.getElementById("video_speed");
        const video_path = ['videos/video_seed_200002_63.webm', '', '', '', 'videos/video_seed_200002_64.webm', ''];
        var render_id = 0; var render_gt_id = 1; var render_decoder_id = 2; var render_decoder_gt_id = 3; var  render_agent_id = 4; var render_agent_gt_id = 5;
        var video_id = 0;
        // Hide video player if there is no ground truth video
        if (video_path[render_gt_id].length == 0 && video_path[render_decoder_gt_id].length == 0 && video_path[render_agent_gt_id].length == 0){
          document.querySelector('label[for="show_ground_truth"]').style.display = 'none';
          document.getElementById("show_ground_truth").style.display = 'none';
        } 
        if (video_path[render_decoder_id].length == 0){
          document.querySelector('label[for="show_decoder_video"]').style.display = 'none';
          document.getElementById("show_decoder_video").style.display = 'none';
        }
        if (video_path[render_agent_id].length == 0){
          document.querySelector('label[for="show_agent_video"]').style.display = 'none';
          document.getElementById("show_agent_video").style.display = 'none';
        }

        video_player.querySelector("source").src = video_path[0];
        video_player.load();
        var video_length = 0;

        // Play and pause button
        const play_pause_button = document.getElementById("play_pause_button");

        // Set step input
        const gotostep_text = document.getElementById('gotostep_text');
        var past_steps = [0];
        var step = 0;

        // Set number of scores input
        const top_n_scores = document.getElementById('top_n_scores');

        // Const stats button
        const stats_button = document.getElementById("stats_button");

        // Set time selector
        const time_selector = document.getElementById('time_selector');
        var tS_step_size = 1.0;

        // Set values for the plots
        var y_values = [[0.34325361251831055], [0.3440121114253998], [0.3463941812515259], [0.34668973088264465], [0.34631606936454773], [0.3516903221607208], [0.3527202308177948], [0.3535875082015991], [0.35525187849998474], [0.35737162828445435], [0.35949456691741943], [0.3621348738670349], [0.3609309792518616], [0.3621898889541626], [0.36420106887817383], [0.36694735288619995], [0.3669050931930542], [0.37116366624832153], [0.37195712327957153], [0.37381577491760254], [0.35327091813087463], [0.35220223665237427], [0.3518035113811493], [0.352559894323349], [0.35378068685531616], [0.35400640964508057], [0.3554699420928955], [0.3557063043117523], [0.3580350875854492], [0.35964009165763855], [0.3615988492965698], [0.36309218406677246], [0.36686235666275024], [0.36730527877807617], [0.36943185329437256], [0.3720824122428894], [0.37297284603118896], [0.3728873133659363], [0.3767116367816925], [0.3793331980705261], [0.37645983695983887], [0.3825439214706421], [0.382662832736969], [0.37986457347869873], [0.38531726598739624], [0.39344149827957153], [0.38997822999954224], [0.3943139314651489], [0.39312320947647095], [0.39893901348114014], [0.3984143137931824], [0.3989867568016052], [0.3991977870464325], [0.4031829237937927], [0.403913676738739], [0.40583091974258423], [0.40637362003326416], [0.40567636489868164], [0.3134819567203522], [0.31151917576789856], [0.3129272162914276], [0.31154191493988037], [0.3146347105503082], [0.3121921122074127], [0.31324711441993713], [0.32818102836608887], [0.3253386914730072], [0.31581223011016846], [0.3155955672264099], [0.31692326068878174], [0.31715717911720276], [0.3208608031272888], [0.32474249601364136], [0.32737067341804504], [0.3293481767177582], [0.3310055732727051], [0.33263784646987915], [0.33378127217292786], [0.33468684554100037], [0.3354639410972595], [0.33616504073143005], [0.3366765081882477], [0.24732881784439087], [0.23695993423461914], [0.23811089992523193], [0.23947277665138245], [0.2489599883556366], [0.24884700775146484], [0.24528026580810547], [0.24868708848953247], [0.24916058778762817], [0.2524435222148895], [0.24984988570213318], [0.24629545211791992], [0.24435517191886902], [0.24396994709968567], [0.24487072229385376], [0.24595338106155396], [0.2490413784980774], [0.25057724118232727], [0.25175583362579346], [0.25263822078704834], [0.25318726897239685], [0.25426340103149414], [0.25490686297416687], [0.2557426989078522], [0.15765762329101562], [0.15748748183250427], [0.1639394760131836], [0.17095942795276642], [0.17709475755691528], [0.17407076060771942], [0.17700403928756714], [0.16987018287181854], [0.17604100704193115], [0.18023908138275146], [0.17834392189979553], [0.17495182156562805], [0.17970451712608337], [0.18140533566474915], [0.18506652116775513], [0.18055754899978638], [0.182750403881073], [0.18563412129878998], [0.18581199645996094], [0.18665045499801636], [0.18719696998596191], [0.18816718459129333], [0.18927836418151855], [0.1961173415184021], [0.0860634446144104], [0.09817485511302948], [0.0958106592297554], [0.0890391394495964], [0.08974024653434753], [0.08030975610017776], [0.09117040783166885], [0.09461504966020584], [0.09982306510210037], [0.09720674157142639], [0.09108126908540726], [0.09739193320274353], [0.09386428445577621], [0.09539695829153061], [0.09603039920330048], [0.09587547183036804], [0.09667997807264328], [0.09404484182596207], [0.09475333988666534], [0.09546902775764465], [0.09635578095912933], [0.09870264679193497], [0.09856334328651428], [0.09753858298063278], [-0.0009629577398300171], [-0.005057699978351593], [-0.007388792932033539], [-0.01957561820745468], [-0.016678012907505035], [-0.007869362831115723], [-0.007542535662651062], [-0.0031976252794265747], [0.0034366175532341003], [-0.0021068453788757324], [-0.004585795104503632], [-0.004697136580944061], [-0.0011846795678138733], [-0.001267939805984497], [0.0007246881723403931], [-0.00039365142583847046], [0.0005907714366912842], [-0.0017817988991737366], [0.002860046923160553], [-0.004271559417247772], [-0.002009645104408264], [-0.00011029094457626343], [0.0021685808897018433], [0.001136496663093567], [-0.0010937675833702087]];
        var y_entropy = [[0.7473398447036743, 1.0030611753463745], [0.5471539497375488, 0.9691012501716614], [0.6915053129196167, 0.5583443641662598], [0.891771674156189, 0.5653941631317139], [0.2487204372882843, 1.0171821117401123], [0.44366684556007385, 0.9498696327209473], [0.4337499439716339, 0.9189309477806091], [0.738209068775177, 0.7526669502258301], [0.11584088206291199, 0.7498148679733276], [0.23626984655857086, 0.8690555691719055], [0.3083299398422241, 0.8726168870925903], [0.671257734298706, 0.9037169218063354], [0.676338791847229, 0.7692595720291138], [1.0461498498916626, 0.7500284910202026], [1.06390380859375, 0.6839710474014282], [1.064428687095642, 0.9923927187919617], [1.0544190406799316, 0.7121956944465637], [1.092814564704895, 0.7440692782402039], [1.0955190658569336, 0.7214850783348083], [0.9750993251800537, 1.0847420692443848], [1.0811587572097778, 0.9003829956054688], [1.080078125, 0.7895994186401367], [1.0559957027435303, 0.7993996739387512], [0.06738267838954926, 0.6372248530387878], [0.5196624994277954, 0.8998786211013794], [0.691338837146759, 0.9223172664642334], [0.793664813041687, 0.931773841381073], [0.011281808838248253, 0.2411956787109375], [0.4102703332901001, 0.9837307929992676], [0.6023898124694824, 0.9638168811798096], [0.7514197826385498, 0.921398401260376], [0.011153311468660831, 0.2037886083126068], [0.25511062145233154, 0.9027857780456543], [0.3695487976074219, 0.9909102916717529], [0.4711197018623352, 0.943946361541748], [0.0043610380962491035, 0.10104836523532867], [0.20582365989685059, 0.9011924862861633], [0.33873364329338074, 0.9578654766082764], [0.4443921744823456, 0.9313066005706787], [0.006189972162246704, 0.08921664208173752], [0.00028760734130628407, 0.0045783305540680885], [6.0194364777999e-05, 8.940883708419278e-05], [4.7752622776897624e-05, 4.107745098735904e-06], [9.491799573879689e-06, 3.0215603601391194e-06], [2.3478252842323855e-05, 0.00015126630023587495], [0.03386174142360687, 0.026959741488099098], [0.7101352214813232, 0.24422574043273926], [0.33735132217407227, 0.6400966644287109], [0.6507037281990051, 0.8819160461425781], [0.3628767132759094, 1.0576529502868652], [0.22760391235351562, 1.083405613899231], [0.5391285419464111, 1.0867676734924316], [0.24532809853553772, 0.9733912944793701], [0.5305086374282837, 1.0721611976623535], [0.43275314569473267, 1.08793306350708], [0.06685730814933777, 0.8238807320594788], [0.1408289521932602, 1.0957802534103394], [0.8936760425567627, 1.0743857622146606], [0.08538065105676651, 0.011356894858181477], [0.9560446739196777, 0.002567711751908064], [0.48817723989486694, 0.22990089654922485], [0.5137928128242493, 0.6844933032989502], [0.6813615560531616, 0.0025429639499634504], [0.17885206639766693, 0.1970117688179016], [0.006928029004484415, 0.6084626913070679], [0.0008995293756015599, 0.2629406452178955], [3.57895061142699e-07, 0.14501053094863892], [0.007731209043413401, 0.3591066598892212], [0.750865638256073, 0.015126150101423264], [0.29838675260543823, 0.03739432990550995], [0.1632828414440155, 0.044561754912137985], [0.1287246197462082, 0.04337348788976669], [0.15107226371765137, 0.04326706752181053], [0.1595354974269867, 0.04335610195994377], [0.18097662925720215, 0.04683306813240051], [0.20847488939762115, 0.052233267575502396], [0.23788104951381683, 0.059045493602752686], [0.26479339599609375, 0.06693046540021896], [0.29232531785964966, 0.07592124491930008], [0.3241651952266693, 0.08564911037683487], [0.3581811189651489, 0.09586452692747116], [0.3855799734592438, 0.10488364845514297], [0.02349269762635231, 0.01974884606897831], [0.15554854273796082, 0.1058855876326561], [0.41782909631729126, 0.19389142096042633], [0.0008343709632754326, 0.010764379985630512], [0.43338102102279663, 0.23710888624191284], [0.004550795536488295, 0.0415492057800293], [0.4237135648727417, 0.0055955275893211365], [0.6579190492630005, 0.46438682079315186], [0.19272297620773315, 0.4593955874443054], [0.12254142016172409, 0.4326138198375702], [0.17325255274772644, 0.2305906116962433], [0.2481832057237625, 0.22013798356056213], [0.2936784327030182, 0.2538251280784607], [0.3712176978588104, 0.3364829123020172], [0.3958536684513092, 0.33342981338500977], [0.45648449659347534, 0.42195260524749756], [0.5482667684555054, 0.43487119674682617], [0.6039990186691284, 0.4991307854652405], [0.6382484436035156, 0.541869044303894], [0.6797003149986267, 0.6110512018203735], [0.6920336484909058, 0.5951129198074341], [0.7019460201263428, 0.6244288682937622], [0.712881326675415, 0.6435947418212891], [0.721230685710907, 0.6606839895248413], [0.3150600790977478, 0.6961978673934937], [0.21189796924591064, 0.6641619801521301], [0.00789887085556984, 0.03535475209355354], [0.39614492654800415, 0.07749778032302856], [0.05930757522583008, 0.029606111347675323], [0.036042727530002594, 0.008701839484274387], [8.66249538375996e-05, 0.16197572648525238], [0.00020799199410248548, 0.01678309589624405], [0.38384130597114563, 0.2251289188861847], [0.4985032081604004, 0.5718837380409241], [1.0480213165283203, 0.890494704246521], [1.0192663669586182, 0.310677707195282], [0.7710093259811401, 0.5273830890655518], [0.37944191694259644, 0.6971487998962402], [0.6719588041305542, 0.7524359822273254], [0.9781906604766846, 0.5830368995666504], [0.7154182195663452, 0.6225632429122925], [0.638344407081604, 0.616642951965332], [0.6549285650253296, 0.6153943538665771], [0.632764458656311, 0.6086527109146118], [0.6169894933700562, 0.6088740229606628], [0.5822364091873169, 0.6107689738273621], [0.5529321432113647, 0.6125156879425049], [0.4715709686279297, 0.7092488408088684], [0.300430566072464, 0.0022514762822538614], [0.263054758310318, 0.0003469349758233875], [0.30599355697631836, 0.08008017390966415], [0.0315568745136261, 0.401311457157135], [0.0023532079067081213, 6.227976700756699e-05], [1.746808152347512e-06, 2.798698233164032e-07], [3.037005456008046e-07, 5.1619696023408324e-05], [1.8742368013136002e-07, 0.024263989180326462], [0.005362972617149353, 0.014599419198930264], [0.37795108556747437, 0.013363607227802277], [0.6431759595870972, 0.06967441737651825], [0.6068265438079834, 0.7118939161300659], [0.5706385374069214, 0.7008475065231323], [0.8734768629074097, 0.19016170501708984], [0.9522775411605835, 0.865271806716919], [0.1939995139837265, 0.6487370133399963], [0.47181516885757446, 1.0735360383987427], [0.3974995017051697, 0.3927207589149475], [0.43023499846458435, 0.7943202257156372], [1.0519109964370728, 0.3800216317176819], [0.31466975808143616, 0.8079259991645813], [0.16557160019874573, 0.9059297442436218], [0.9594178199768066, 0.14236530661582947], [0.8904628753662109, 0.5461626052856445], [0.01953909359872341, 0.0005896809743717313], [2.3569884433527477e-05, 0.6593992710113525], [0.00025136195472441614, 1.491705717282521e-11], [0.02898244559764862, 5.386991200340141e-12], [0.0038583939895033836, 9.585439083180429e-17], [0.0004126990679651499, 4.306852214811439e-20], [0.04501719772815704, 1.5217391589720814e-16], [0.011424480937421322, 3.2546840778024944e-09], [0.0014997649705037475, 0.021315118297934532], [5.016874638386071e-05, 0.17481151223182678], [0.7941240072250366, 0.6697577238082886], [0.9993524551391602, 0.29097670316696167], [0.004211451392620802, 0.09297092258930206], [0.07872657477855682, 0.05670352280139923], [1.0808210372924805, 0.07487194240093231], [0.34697744250297546, 0.8632297515869141], [0.8780080080032349, 0.6092349290847778], [0.6327527761459351, 1.0800608396530151], [0.10787960141897202, 0.42226067185401917], [0.6104991436004639, 0.7483155131340027], [0.016768965870141983, 0.7006195783615112], [0.1725044846534729, 0.7417371273040771], [0.6067041158676147, 0.7842048406600952], [0.027109842747449875, 0.63994300365448], [1.297437506764254e-06, 0.0004093160096090287]];
        var y_attention_weights = [];
        var y_action = [[[0.7214502692222595, 0.06884481012821198, 0.2097049504518509], [0.20960400998592377, 0.24539192020893097, 0.5450040698051453]], [[0.12512752413749695, 0.042547307908535004, 0.8323251605033875], [0.18871644139289856, 0.2311185747385025, 0.5801649689674377]], [[0.22468462586402893, 0.040415067225694656, 0.7349003553390503], [0.09448070824146271, 0.06965261697769165, 0.8358667492866516]], [[0.10583487898111343, 0.6163780093193054, 0.27778714895248413], [0.15894947946071625, 0.811652660369873, 0.029397841542959213]], [[0.9410480856895447, 0.05026554316282272, 0.008686388842761517], [0.5060743093490601, 0.31368932127952576, 0.18023639917373657]], [[0.872356116771698, 0.10358358174562454, 0.024060223251581192], [0.4030958116054535, 0.1037009134888649, 0.4932033121585846]], [[0.8806474208831787, 0.08858589082956314, 0.030766626819968224], [0.39820441603660583, 0.08588588982820511, 0.5159096121788025]], [[0.33382534980773926, 0.6427722573280334, 0.02340237982571125], [0.7336929440498352, 0.09434977918863297, 0.17195725440979004]], [[0.9788827300071716, 0.014014547690749168, 0.007102640345692635], [0.688453197479248, 0.045468803495168686, 0.2660779356956482]], [[0.9480594992637634, 0.035933706909418106, 0.016006752848625183], [0.5296525359153748, 0.059027574956417084, 0.41131991147994995]], [[0.9279694557189941, 0.040071822702884674, 0.031958792358636856], [0.5721537470817566, 0.06955159455537796, 0.35829466581344604]], [[0.21272753179073334, 0.7487801909446716, 0.03849225118756294], [0.6372940540313721, 0.1594538539648056, 0.20325204730033875]], [[0.773614227771759, 0.15453150868415833, 0.07185419648885727], [0.7288191914558411, 0.11500146985054016, 0.15617941319942474]], [[0.47772061824798584, 0.21549153327941895, 0.30678778886795044], [0.7405104041099548, 0.11227912455797195, 0.14721040427684784]], [[0.4085879921913147, 0.21488645672798157, 0.3765255808830261], [0.7775087952613831, 0.10555752366781235, 0.1169336587190628]], [[0.2378816455602646, 0.44976937770843506, 0.31234899163246155], [0.548764169216156, 0.2699401080608368, 0.18129578232765198]], [[0.4709082543849945, 0.29610157012939453, 0.23299022018909454], [0.7447677254676819, 0.1908208727836609, 0.06441134959459305]], [[0.3682880401611328, 0.3470876216888428, 0.2846243381500244], [0.7181347012519836, 0.21918293833732605, 0.0626823827624321]], [[0.34681349992752075, 0.35619601607322693, 0.2969904839992523], [0.7433421015739441, 0.18503990769386292, 0.07161800563335419]], [[0.13268117606639862, 0.3467593491077423, 0.520559549331665], [0.3131265342235565, 0.409894734621048, 0.2769787609577179]], [[0.24911363422870636, 0.391364723443985, 0.35952162742614746], [0.6283517479896545, 0.24167877435684204, 0.129969522356987]], [[0.25071510672569275, 0.34463563561439514, 0.40464919805526733], [0.6935809254646301, 0.2288200706243515, 0.07759901881217957]], [[0.22660113871097565, 0.3102337419986725, 0.46316513419151306], [0.6934787034988403, 0.21923935413360596, 0.08728191256523132]], [[0.011066663078963757, 0.0008055769721977413, 0.9881277680397034], [0.2528855800628662, 0.014556984417140484, 0.7325574159622192]], [[0.11858685314655304, 0.03765343874692917, 0.8437596559524536], [0.6174623966217041, 0.11584062874317169, 0.266696959733963]], [[0.11303462833166122, 0.11311601847410202, 0.7738494277000427], [0.6237456202507019, 0.19945867359638214, 0.17679572105407715]], [[0.12045598030090332, 0.16586075723171234, 0.7136832475662231], [0.613268256187439, 0.21953319013118744, 0.16719864308834076]], [[0.0014819127973169088, 1.1940521289943717e-05, 0.9985061287879944], [0.0627744272351265, 0.0008296422311104834, 0.9363958835601807]], [[0.09081640094518661, 0.02260904386639595, 0.8865745663642883], [0.5036886930465698, 0.13514970242977142, 0.3611616790294647]], [[0.08911657333374023, 0.09374194592237473, 0.8171415328979492], [0.582861065864563, 0.2397320568561554, 0.1774069219827652]], [[0.1044216975569725, 0.15764744579792023, 0.7379308938980103], [0.6133408546447754, 0.2447519600391388, 0.141907200217247]], [[0.001461824867874384, 1.2171114576631226e-05, 0.9985260367393494], [0.04939478635787964, 0.0008847084827721119, 0.949720561504364]], [[0.05272066965699196, 0.008528592996299267, 0.9387507438659668], [0.49637508392333984, 0.07370156794786453, 0.4299233853816986]], [[0.05248965695500374, 0.03936908021569252, 0.9081412553787231], [0.5477553606033325, 0.17613837122917175, 0.27610620856285095]], [[0.06734342128038406, 0.06065832078456879, 0.8719983100891113], [0.6003722548484802, 0.1655205339193344, 0.23410718142986298]], [[0.0005054780631326139, 1.3172777926229173e-06, 0.9994932413101196], [0.02049883082509041, 0.00010602478141663596, 0.9793952107429504]], [[0.03998711332678795, 0.006294997408986092, 0.9537178874015808], [0.42127057909965515, 0.07360444962978363, 0.5051249265670776]], [[0.05527419596910477, 0.027676107361912727, 0.917049765586853], [0.5661366581916809, 0.14087703824043274, 0.29298633337020874]], [[0.07177481800317764, 0.047064803540706635, 0.8811603784561157], [0.6073867082595825, 0.15061135590076447, 0.2420019656419754]], [[0.0007523050880990922, 1.9245960629632464e-06, 0.9992457628250122], [0.017553461715579033, 8.263367635663599e-05, 0.9823639392852783]], [[2.4779790692264214e-05, 5.038450212602186e-10, 0.9999752044677734], [0.0005366979748941958, 1.8188117678619165e-08, 0.9994632601737976]], [[4.502122919802787e-06, 2.259158311812559e-11, 0.9999954700469971], [6.96721144777257e-06, 1.05986254494983e-10, 0.999993085861206]], [[3.4964070891874144e-06, 4.589277846633877e-10, 0.999996542930603], [2.7145617309543013e-07, 1.537035776433271e-10, 0.9999997615814209]], [[5.952375090600981e-07, 2.633980811239667e-10, 0.9999994039535522], [1.9487937663598132e-07, 4.898740857406381e-10, 0.9999997615814209]], [[1.6045971733547049e-06, 8.692991215752954e-09, 0.9999983310699463], [1.2271836567379069e-05, 5.037583683531466e-09, 0.9999877214431763]], [[0.003766703652217984, 0.0011721760965883732, 0.9950610995292664], [0.004040021914988756, 6.188314000610262e-05, 0.9958980679512024]], [[0.028778808191418648, 0.6952381134033203, 0.2759830057621002], [0.019930029287934303, 0.03363167122006416, 0.9464382529258728]], [[0.06153031811118126, 0.022506501525640488, 0.9159631729125977], [0.1319170594215393, 0.07279317080974579, 0.7952897548675537]], [[0.04952353984117508, 0.7757018208503723, 0.17477461695671082], [0.10892447829246521, 0.2596368193626404, 0.6314386129379272]], [[0.07966150343418121, 0.01705966517329216, 0.9032788276672363], [0.3929281532764435, 0.20410959422588348, 0.40296226739883423]], [[0.02614975906908512, 0.9514838457107544, 0.022366434335708618], [0.2557530701160431, 0.39174169301986694, 0.35250526666641235]], [[0.10302578657865524, 0.055229704827070236, 0.8417445421218872], [0.40261292457580566, 0.31888774037361145, 0.2784993052482605]], [[0.0288548544049263, 0.9465777277946472, 0.02456732466816902], [0.14833243191242218, 0.5500151515007019, 0.3016524612903595]], [[0.09820191562175751, 0.05583220720291138, 0.8459659218788147], [0.3993750512599945, 0.37125417590141296, 0.22937069833278656]], [[0.049975331872701645, 0.8860743045806885, 0.06395041197538376], [0.3368072807788849, 0.3908693492412567, 0.2723233997821808]], [[0.012377570383250713, 0.9876060485839844, 1.6330634025507607e-05], [0.453467458486557, 0.036894481629133224, 0.5096381306648254]], [[0.026984652504324913, 0.9706284403800964, 0.0023868416901677847], [0.36480268836021423, 0.33181464672088623, 0.30338263511657715]], [[0.09136626869440079, 0.5911012291908264, 0.3175325095653534], [0.3375340402126312, 0.4201909601688385, 0.24227499961853027]], [[0.01658475212752819, 0.98332279920578, 9.234854223905131e-05], [0.001492356532253325, 1.2580511793203186e-05, 0.9984951019287109]], [[0.5405305624008179, 0.12226185947656631, 0.337207555770874], [0.0002795366744976491, 6.583496059420213e-08, 0.9997203946113586]], [[0.8108349442481995, 0.18871520459651947, 0.00044986343709751964], [0.060925573110580444, 3.5212153306929395e-05, 0.9390391707420349]], [[0.7901245951652527, 0.20987538993358612, 7.255822254137456e-08], [0.5787957310676575, 0.42071205377578735, 0.0004922313964925706]], [[0.42171284556388855, 5.0527309213066474e-05, 0.5782365798950195], [0.00027656948077492416, 3.050578456509356e-08, 0.9997233748435974]], [[0.043434206396341324, 1.1640272532531526e-05, 0.9565541744232178], [0.049258168786764145, 6.482057506218553e-05, 0.9506770372390747]], [[0.000708437932189554, 0.00010664706496754661, 0.9991849064826965], [0.7028153538703918, 1.7443990429910627e-07, 0.29718446731567383]], [[6.039163508830825e-06, 7.856482261558995e-05, 0.999915361404419], [0.9263657927513123, 7.09921366137678e-08, 0.07363409548997879]], [[2.019862321844812e-08, 8.231281324946882e-13, 1.0], [0.9670032262802124, 5.8434427074871564e-08, 0.03299665451049805]], [[0.000974475871771574, 2.2206275929192998e-08, 0.9990254640579224], [0.11610279232263565, 1.3361187711780076e-06, 0.8838959336280823]], [[0.5766692757606506, 0.016440128907561302, 0.4068906009197235], [0.002111074747517705, 7.761485676383018e-07, 0.9978881478309631]], [[0.0795791819691658, 0.0030827915761619806, 0.9173380732536316], [0.006131922826170921, 3.2009545520850224e-06, 0.9938648343086243]], [[0.0314980149269104, 0.003535147290676832, 0.9649668335914612], [0.007496730890125036, 3.654393367469311e-05, 0.9924667477607727]], [[0.025338176637887955, 0.0014027851866558194, 0.9732590317726135], [0.007238534279167652, 4.421839912538417e-05, 0.9927172660827637]], [[0.031941670924425125, 0.001261992147192359, 0.9667963981628418], [0.007187427021563053, 5.8945381169905886e-05, 0.9927535653114319]], [[0.03494974225759506, 0.00101691042073071, 0.964033305644989], [0.007187481038272381, 6.811050116084516e-05, 0.9927444458007812]], [[0.041622817516326904, 0.001006447128020227, 0.9573707580566406], [0.007860063575208187, 8.858037472236902e-05, 0.992051362991333]], [[0.050589002668857574, 0.0010547374840825796, 0.9483562111854553], [0.008936611004173756, 0.00011722835915861651, 0.9909461736679077]], [[0.06071414053440094, 0.001163832494057715, 0.9381219744682312], [0.010332003235816956, 0.00015621009515598416, 0.9895117878913879]], [[0.0704251155257225, 0.0013324739411473274, 0.9282423853874207], [0.011974007822573185, 0.00021681093494407833, 0.9878091812133789]], [[0.08097006380558014, 0.001510538742877543, 0.9175193905830383], [0.013887422159314156, 0.00030099216382950544, 0.9858115911483765]], [[0.09412186592817307, 0.0016716362442821264, 0.9042065143585205], [0.01601186953485012, 0.00040553725557401776, 0.9835825562477112]], [[0.10942863672971725, 0.001783314161002636, 0.8887880444526672], [0.018305623903870583, 0.0005269843968562782, 0.9811673760414124]], [[0.12261414527893066, 0.001887603895738721, 0.8754982352256775], [0.02038583904504776, 0.0006418398697860539, 0.978972315788269]], [[0.0035364695359021425, 1.546535166596641e-08, 0.9964635968208313], [0.0028833288233727217, 3.6472349052019126e-07, 0.9971163272857666]], [[0.03616196662187576, 2.5569071859798953e-10, 0.9638380408287048], [0.02204243279993534, 5.583981632639734e-08, 0.977957546710968]], [[0.8527955412864685, 3.9022354791917735e-10, 0.14720439910888672], [0.9515695571899414, 2.157315293516149e-06, 0.048428282141685486]], [[0.9999202489852905, 2.894033741540625e-07, 7.94914667494595e-05], [0.9986414313316345, 0.00013451061386149377, 0.0012240108335390687]], [[0.1560986191034317, 2.0434990801732056e-05, 0.8438809514045715], [0.9363072514533997, 1.0188239684794098e-05, 0.06368256360292435]], [[0.0005330972489900887, 6.619340187086209e-09, 0.9994669556617737], [0.9930400848388672, 4.797045221494045e-06, 0.006955085322260857]], [[0.8508598804473877, 0.00035499822115525603, 0.1487850695848465], [0.9993277788162231, 1.8661228295968613e-06, 0.000670397246722132]], [[0.6501988172531128, 0.001670787576586008, 0.34813037514686584], [0.8246151804924011, 5.662852800014662e-06, 0.17537915706634521]], [[0.04796430468559265, 2.0974503058823757e-05, 0.952014684677124], [0.17211949825286865, 1.3692505490325857e-05, 0.827866792678833]], [[0.026538347825407982, 3.4231038625875954e-06, 0.9734582304954529], [0.15552857518196106, 3.951553298975341e-05, 0.8444319367408752]], [[0.04166092723608017, 4.9733334890333936e-06, 0.9583340883255005], [0.06119222566485405, 3.140846820315346e-05, 0.9387763738632202]], [[0.06785081326961517, 1.133013574872166e-05, 0.9321379065513611], [0.05735288932919502, 4.7467405238421634e-05, 0.9425996541976929]], [[0.08607219159603119, 2.8423766707419418e-05, 0.9138993620872498], [0.06963793933391571, 0.00011211915989406407, 0.9302499294281006]], [[0.12182817608118057, 6.319611566141248e-05, 0.8781086802482605], [0.10449390858411789, 0.00017114993534050882, 0.8953349590301514]], [[0.13405534625053406, 0.00019468451500870287, 0.8657499551773071], [0.10196557641029358, 0.00047376559814438224, 0.8975606560707092]], [[0.16880927979946136, 0.000276562524959445, 0.8309141993522644], [0.14525097608566284, 0.0009733916376717389, 0.8537755608558655]], [[0.23256227374076843, 0.0007449918193742633, 0.7666926980018616], [0.15169298648834229, 0.001225097686983645, 0.8470818996429443]], [[0.28305691480636597, 0.0010930361459031701, 0.7158500552177429], [0.19117723405361176, 0.0015432813670486212, 0.8072794675827026]], [[0.32048499584198, 0.0015560714527964592, 0.6779589653015137], [0.22132061421871185, 0.0018945250194519758, 0.7767848968505859]], [[0.38763535022735596, 0.0017539660912007093, 0.6106107234954834], [0.28724387288093567, 0.0016047576209530234, 0.7111513614654541]], [[0.3932710886001587, 0.003560540033504367, 0.6031683683395386], [0.2609816789627075, 0.0032780710607767105, 0.7357401847839355]], [[0.41633614897727966, 0.0037893017288297415, 0.579874575138092], [0.2879617214202881, 0.003883724333718419, 0.7081544995307922]], [[0.4375741183757782, 0.004779738374054432, 0.5576461553573608], [0.3058026134967804, 0.004646384157240391, 0.6895509958267212]], [[0.4542129337787628, 0.005834400653839111, 0.5399526953697205], [0.32333049178123474, 0.0053720008581876755, 0.6712974905967712]], [[0.09548831731081009, 3.107315649231168e-07, 0.9045113325119019], [0.532457709312439, 0.0006856751278974116, 0.46685662865638733]], [[0.0546191930770874, 4.293474603622727e-11, 0.9453808069229126], [0.6198679208755493, 2.5753815862117335e-06, 0.38012954592704773]], [[0.9990028738975525, 1.472208055020019e-06, 0.000995735521428287], [0.9943140745162964, 0.005635356530547142, 5.066896846983582e-05]], [[0.13519512116909027, 0.8648048639297485, 3.434083239994834e-08], [0.014908128418028355, 0.9850918650627136, 2.108659358235343e-10]], [[0.01072506420314312, 0.9892749190330505, 1.1060552473907137e-09], [0.9954093098640442, 5.799490827484988e-05, 0.0045326570980250835]], [[0.005875865928828716, 0.9941241145133972, 2.1320747833897258e-08], [0.9988916516304016, 8.9957438831334e-06, 0.001099307439289987]], [[6.706460226268973e-06, 0.9999933242797852, 3.0056293010005675e-09], [0.9619103074073792, 0.038072362542152405, 1.7348738765576854e-05]], [[1.7405316611984745e-05, 0.9999825954437256, 4.467653358375401e-09], [0.9976845979690552, 0.00010275947715854272, 0.0022125965915620327]], [[0.1284104436635971, 0.8715447783470154, 4.481837459024973e-05], [0.9510880708694458, 0.014616480097174644, 0.03429538756608963]], [[0.853884756565094, 0.03691940754652023, 0.10919587314128876], [0.179340198636055, 0.7986123561859131, 0.022047417238354683]], [[0.41168537735939026, 0.3976918160915375, 0.19062277674674988], [0.3836061656475067, 0.5431659817695618, 0.07322783768177032]], [[0.23934848606586456, 0.5273025035858154, 0.23334895074367523], [0.09345410764217377, 1.8689355783862993e-05, 0.9065271615982056]], [[0.23438741266727448, 0.6989125609397888, 0.06670001894235611], [0.8168946504592896, 0.014758837409317493, 0.16834652423858643]], [[0.1261461079120636, 4.0798975533107296e-05, 0.8738131523132324], [0.5644494295120239, 0.0019203599076718092, 0.43363016843795776]], [[0.6512838006019592, 0.004793551284819841, 0.34392276406288147], [0.20741212368011475, 0.7203269004821777, 0.07226090878248215]], [[0.5475854277610779, 0.2992458641529083, 0.1531687080860138], [0.7323154807090759, 0.0002645036147441715, 0.2674200236797333]], [[0.730489194393158, 0.05232376232743263, 0.21718700230121613], [0.6869553923606873, 0.00011799481580965221, 0.31292662024497986]], [[0.7765477895736694, 0.0414009690284729, 0.18205128610134125], [0.693705141544342, 5.610807420453057e-05, 0.3062388002872467]], [[0.7590728998184204, 0.03668384626507759, 0.2042432427406311], [0.6950075626373291, 3.573227149900049e-05, 0.30495670437812805]], [[0.7733232975006104, 0.03500102832913399, 0.19167566299438477], [0.7028903365135193, 2.4770481104496866e-05, 0.29708483815193176]], [[0.7802530527114868, 0.03154904022812843, 0.18819795548915863], [0.70256108045578, 1.824567880248651e-05, 0.2974206805229187]], [[0.7968750596046448, 0.0259079709649086, 0.17721699178218842], [0.7002811431884766, 1.2943967703904491e-05, 0.29970595240592957]], [[0.8105573654174805, 0.021745242178440094, 0.16769738495349884], [0.6981697082519531, 9.54460756474873e-06, 0.3018207252025604]], [[0.8308255672454834, 0.003489408176392317, 0.1656850129365921], [0.7625998854637146, 0.13864953815937042, 0.09875054657459259]], [[0.08909133821725845, 1.177436259602871e-09, 0.9109086394309998], [0.00024134828709065914, 6.899029145277652e-14, 0.9997586607933044]], [[0.07367964088916779, 6.9126041696288e-12, 0.9263203740119934], [3.0424025680986233e-05, 4.559578024197654e-17, 0.9999696016311646]], [[0.09148938953876495, 0.9085090160369873, 1.650737317504536e-06], [0.9844954609870911, 1.1571136383281555e-05, 0.015492984093725681]], [[0.0050138551741838455, 0.9949859380722046, 2.7393937784836453e-07], [0.055574219673871994, 0.8974702954292297, 0.04695549234747887]], [[0.00025356750120408833, 0.9997463822364807, 4.482497928393059e-09], [5.553313711659236e-11, 0.9999953508377075, 4.686755801230902e-06]], [[1.089518022467928e-07, 0.9999998807907104, 1.9908846706634398e-12], [1.3342861971549214e-12, 1.0, 1.5565118971494485e-08]], [[1.6907190314441323e-08, 1.0, 4.78677583681808e-11], [3.8320422390825115e-06, 0.9999961853027344, 5.314482187657177e-10]], [[1.0047699561255286e-08, 1.0, 1.0379160725326741e-10], [0.9963261485099792, 0.003673803759738803, 8.649280293718253e-13]], [[0.0006414430681616068, 0.9993582367897034, 3.9375390770146623e-07], [0.0020278242882341146, 0.9979721903800964, 1.4052333515562898e-12]], [[0.9042404890060425, 0.033988453447818756, 0.06177102401852608], [0.0018299206858500838, 0.998170018196106, 3.21030455552318e-08]], [[0.7944644689559937, 0.07559356838464737, 0.12994199991226196], [0.012870396487414837, 8.331554272444919e-05, 0.9870462417602539]], [[0.7382557988166809, 0.0069159651175141335, 0.2548282742500305], [0.42005112767219543, 0.5743430256843567, 0.005605950020253658]], [[0.7763996124267578, 0.009471006691455841, 0.21412943303585052], [0.3977242410182953, 0.597310483455658, 0.004965243395417929]], [[0.5230016708374023, 0.060486361384391785, 0.41651201248168945], [0.039306603372097015, 0.0037297422531992197, 0.9569635987281799]], [[0.5696806311607361, 0.13654249906539917, 0.29377689957618713], [0.4940023720264435, 0.45182862877845764, 0.05416898429393768]], [[0.047612570226192474, 0.9521052241325378, 0.00028221646789461374], [0.21215572953224182, 0.7564486265182495, 0.03139566257596016]], [[0.14223210513591766, 0.0119228670373559, 0.8458450436592102], [0.2693212926387787, 0.4403577744960785, 0.29032087326049805]], [[0.11481726169586182, 0.8781458139419556, 0.007036866620182991], [0.06651571393013, 0.8988138437271118, 0.03467036038637161]], [[0.10332983732223511, 0.020547538995742798, 0.8761226534843445], [0.082698754966259, 0.22321486473083496, 0.6940863132476807]], [[0.20355476438999176, 0.35175827145576477, 0.4446869194507599], [0.04014289751648903, 0.9045136570930481, 0.05534344166517258]], [[0.09042997658252716, 0.9080655574798584, 0.0015044126193970442], [0.03952910378575325, 0.3727404475212097, 0.5877304077148438]], [[0.032118819653987885, 0.0035655563697218895, 0.96431565284729], [0.0942724198102951, 0.329228937625885, 0.5764986872673035]], [[0.22773529589176178, 0.589235782623291, 0.1830289214849472], [0.021657653152942657, 0.9720665812492371, 0.006275803782045841]], [[0.15918885171413422, 0.19232290983200073, 0.6484882831573486], [0.025094086304306984, 0.8187554478645325, 0.15615050494670868]], [[0.0028484640643000603, 0.9971515536308289, 8.022175979061075e-11], [5.4522995924344286e-05, 4.055090485621804e-09, 0.9999455213546753]], [[1.6251041188297677e-06, 0.9999983310699463, 2.5403204648064886e-17], [0.6434504389762878, 0.0011931871995329857, 0.35535645484924316]], [[2.1429348635138012e-05, 0.9999785423278809, 1.0947726015661519e-12], [5.276577243716607e-13, 1.0, 3.2482267404023606e-28]], [[1.3598867553810123e-05, 0.995484471321106, 0.004501881543546915], [1.8328047413085358e-13, 1.0, 3.306416932408803e-16]], [[0.00023273313126992434, 0.9995934367179871, 0.00017382201622240245], [2.323514565099962e-18, 1.0, 3.371559096197731e-20]], [[8.714677278476302e-06, 0.9999650716781616, 2.61955337919062e-05], [7.398055204100835e-22, 1.0, 1.4056664507390172e-22]], [[0.00579037144780159, 0.9929870963096619, 0.0012225601822137833], [4.500611130742831e-19, 1.0, 3.3083440150818677e-18]], [[2.4744949769228697e-05, 0.998492956161499, 0.0014823201345279813], [1.4336265508063661e-10, 1.0, 1.798181422556569e-13]], [[2.757877552994614e-07, 0.9998469352722168, 0.0001527999120298773], [0.003154292469844222, 0.9968456625938416, 9.87048220935094e-10]], [[3.4864506233134307e-06, 0.9999964237213135, 1.625577681352297e-07], [0.042169637978076935, 0.9578280448913574, 2.327476295249653e-06]], [[0.32672667503356934, 0.6293756365776062, 0.04389764741063118], [0.7516525387763977, 0.039768483489751816, 0.2085789442062378]], [[0.520250678062439, 0.16234931349754333, 0.3173999786376953], [0.9221184253692627, 0.004577136132866144, 0.07330438494682312]], [[0.00045843858970329165, 1.9304887246107683e-05, 0.9995222091674805], [0.9821984171867371, 0.0009179640328511596, 0.01688363589346409]], [[0.01341042947024107, 0.0009552789269946516, 0.9856342673301697], [0.9905771017074585, 0.0010877284221351147, 0.008335201069712639]], [[0.3896278440952301, 0.24784517288208008, 0.3625269830226898], [0.9875582456588745, 0.0041620261035859585, 0.008279758505523205]], [[0.10985829681158066, 0.8900688886642456, 7.284843013621867e-05], [0.5869302153587341, 0.06832465529441833, 0.3447451591491699]], [[0.12373507767915726, 0.22932371497154236, 0.6469412446022034], [0.7668699026107788, 0.21397949755191803, 0.0191506277769804]], [[0.3262507915496826, 0.673616886138916, 0.0001322510070167482], [0.41338708996772766, 0.3300528824329376, 0.2565600574016571]], [[0.021698279306292534, 0.9779295325279236, 0.00037217812496237457], [0.11118533462285995, 0.8745058178901672, 0.014308824203908443]], [[0.06497679650783539, 0.12622080743312836, 0.8088023662567139], [0.3462199568748474, 0.6296657919883728, 0.02411428838968277]], [[0.0018714996986091137, 0.0003512138791847974, 0.9977772831916809], [0.6966508030891418, 0.2780981659889221, 0.025251047685742378]], [[0.024479683488607407, 0.010386074893176556, 0.9651342630386353], [0.62644362449646, 0.3525323271751404, 0.021024059504270554]], [[0.8131260871887207, 0.07304764539003372, 0.11382627487182617], [0.17881587147712708, 0.7158358693122864, 0.10534822940826416]], [[0.004186890088021755, 0.995812714099884, 3.1271909506358497e-07], [0.29221925139427185, 0.006257242057472467, 0.70152348279953]], [[1.8828458236974654e-10, 0.9999998807907104, 7.908268884193603e-08], [3.6197699955664575e-05, 1.8729987516508118e-07, 0.999963641166687]]]; // action probs
        var action =  [[0, 1], [2, 1], [0, 2], [0, 1], [0, 0], [0, 1], [0, 1], [1, 1], [0, 2], [0, 0], [0, 2], [1, 0], [0, 1], [2, 0], [0, 2], [1, 0], [0, 0], [2, 0], [2, 2], [2, 2], [0, 2], [1, 0], [0, 0], [2, 2], [2, 0], [2, 0], [2, 0], [2, 2], [2, 2], [2, 0], [2, 0], [2, 2], [2, 0], [2, 0], [2, 0], [2, 2], [2, 2], [2, 1], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [1, 2], [2, 2], [1, 1], [2, 0], [1, 2], [2, 2], [1, 2], [2, 1], [2, 0], [1, 2], [1, 2], [2, 0], [1, 2], [0, 2], [0, 2], [0, 1], [2, 2], [2, 2], [2, 2], [2, 0], [2, 0], [2, 2], [0, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [0, 2], [2, 2], [2, 2], [0, 0], [0, 0], [2, 0], [2, 0], [0, 0], [2, 0], [2, 2], [2, 2], [2, 2], [2, 2], [0, 2], [2, 2], [2, 0], [2, 2], [2, 2], [0, 0], [0, 2], [2, 2], [2, 2], [2, 2], [0, 0], [2, 0], [2, 0], [2, 2], [0, 0], [1, 1], [1, 0], [1, 0], [1, 0], [1, 0], [1, 0], [0, 1], [0, 1], [0, 2], [1, 0], [2, 2], [0, 1], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 2], [0, 1], [2, 2], [2, 2], [1, 0], [1, 1], [1, 1], [1, 1], [1, 1], [1, 0], [1, 1], [0, 1], [0, 2], [0, 0], [0, 1], [2, 2], [2, 0], [1, 0], [2, 0], [1, 1], [2, 2], [0, 1], [1, 2], [2, 2], [0, 1], [2, 1], [1, 2], [1, 2], [1, 1], [1, 1], [1, 1], [1, 1], [1, 1], [1, 1], [1, 1], [1, 1], [0, 0], [1, 0], [2, 0], [2, 0], [2, 0], [1, 0], [2, 0], [1, 2], [1, 1], [1, 0], [2, 0], [2, 1], [0, 1], [1, 2], [1, 2]];
        var action_names = [['no-op', 'left', 'right'], ['no-op', 'up', 'down']];
        var x_values = [...Array(y_values.length).keys()];

        var y_entropy_plot = [];
        var y_values_plot = [];

        // Set marker for plots
        var entropy_marker = false;
        var value_marker = false;

        // Set the to be shown statistic
        var statistic_type = 'general'
        // Only used for the transformer plot to show the correct statistic with tab switching
        var statistic_plot_id = 0;
        // Hide statistic type button if there is no attention weights
        if(y_attention_weights.length == 0) stats_button.style.display = 'none';

        // Set the to be shown action_space(s) for the entropy plot
        var entr_selected_action_space = null;

        var is_multi_discrete = action[0].length != 1;
        var is_discrete = action[0].length == 1;

        // Reformat the data for the plots
        // Each function y - value should be stored in a separate array
        for(var j = 0; j < y_values[0].length; j++)
            for(var i = 0; i < y_values.length; i++)
                y_values_plot.push(y_values[i][j]);

        if(is_discrete) { // If action_space is discrete
          for(var j = 0; j < y_entropy[0].length; j++)
              for(var i = 0; i < y_values.length; i++)
                  y_entropy_plot.push(y_entropy[i][j]);
        }
        else { // If action_space is multi discrete
          for(var j = 0; j < y_entropy[0].length; j++) {
            var y_entropy_vals = [];
            for(var i = 0; i < y_entropy.length; i++) {
                y_entropy_vals.push(y_entropy[i][j]);
            }
            y_entropy_plot.push(y_entropy_vals);
          }
        }

        // Set action_names for distr. plot if it does not exist
        if(action_names == null){
          action_names = [];
          for(var i = 0; i < y_action[0].length; i++){
            for(var j = 0; j < y_action[0][0].length; j++)
              if(is_discrete){ // if action space is discrete
                action_names.push("action_" + String(j));
            }
            else { // if action space is multi_discrete
              var action_branch_names = []; // Names of the branches of the action space
              for(var j = 0; j < y_action[0][i].length; j++){
                action_branch_names.push("action_" + String(j));
              }
              action_names.push(action_branch_names);
            }     
          }
        }
        else{
          if(action[0].length == 1 && Array.isArray(action_names[0])){ // If action space is discrete and action_names is multi_discrete
            action_names = action_names[0]; // Set action_names to the first branch of the action space
          }
        }

        // Modify dropdown menu
        if(is_discrete){ // if action space is discrete
          document.getElementById("all").outerHTML=""; // remove dropdown option 'all'
        }
        else { // If action space is multi_discrete
          // Create dropdown menu for the entropy function
          var dropdown_content = document.getElementById("dropdown_content"); 
          for(var i = 0; i < action[0].length; i++){
            var entropy_dropdown_option = document.createElement("a");
            entropy_dropdown_option.innerHTML = "action_space_" + String(i);
            entropy_dropdown_option.setAttribute("href", "#");
            entropy_dropdown_option.setAttribute("onclick", "set_action_space(" + String(i) + ")");
            dropdown_content.appendChild(entropy_dropdown_option);
          }
        }

        window.addEventListener('load', () => {
          // Set video length to length - 0.9999 because the last frame is two seconds long
          video_length = video_player.duration - 0.9999;
          time_selector.setAttribute('max', video_length); // Set max value of time selector to video length

          video_player.addEventListener('timeupdate', timeListener); // Update time selector and plots when video is playing
          video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);}); // Open video in fullscreen when video is double clicked
          video_player.playbackRate = 6; // Set video playback rate to frame rate
          reset(); // Reset video to start
        }, false);
      
      // Update video time if time selector is changed
      time_selector.addEventListener('input', () => {
          video_player.currentTime = time_selector.value
          pause();
          update();
      })

      // Add event manager for tab
      window.addEventListener('keydown', function(event) {
          if (event.key === 'Tab') {
              if (statistic_type == "transformer") {
                statistic_plot_id = (statistic_plot_id + 1) % 3;
                // Set action plot if statistic_plot_id is 0
                if(statistic_plot_id == 0){
                  // Update action plot
                  if(is_discrete) { // If action_space is discrete
                    set_bar_action_plot(y_action[step][0], action[step][0], action_names);
                  }
                  else { // If action_space is multi discrete
                      set_stacked_bar_action_plot(y_action[step], action[step], action_names);
                  }
                }
                // Set value plot if statistic_plot_id is 1
                if (statistic_plot_id == 1) {
                  set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
                }

              // Set entropy plot if statistic_plot_id is 2
              if (statistic_plot_id == 2) {
                  if(is_discrete) { // If action_space is discrete
                      set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
                  else { // If action_space is multi discrete
                      set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
                  }
              }
          }
      }
    });

    // Show ground truth if checkbox is checked
    function show_ground_truth() {
        // Get the checkbox element by its ID
        var checkbox = document.getElementById("show_ground_truth");
        
        // Check if the checkbox is checked
        if (checkbox.checked) { // Show the ground truth
          if (video_id == render_id) video_id = render_gt_id;
          if (video_id == render_decoder_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else {
          if (video_id == render_gt_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_agent_id;
          set_video(video_path[video_id]);
        }
      }

    // Show decoder video if checkbox is checked
    function show_decoder_video() {
      var checkbox = document.getElementById("show_decoder_video");
      document.getElementById("show_agent_video").checked = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_decoder_id;
          if (video_id == render_gt_id) video_id = render_decoder_gt_id;
          if (video_id == render_agent_id) video_id = render_decoder_id;
          if (video_id == render_agent_gt_id) video_id = render_decoder_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide decoder video
          if (video_id == render_decoder_id) video_id = render_id;
          if (video_id == render_decoder_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Show agent video if checkbox is checked
    function show_agent_video() {
      var checkbox = document.getElementById("show_agent_video");
      document.getElementById("show_decoder_video").checked  = false;

      if (checkbox.checked) { 
          if (video_id == render_id) video_id = render_agent_id;
          if (video_id == render_gt_id) video_id = render_agent_gt_id;
          if (video_id == render_decoder_id) video_id = render_agent_id;
          if (video_id == render_decoder_gt_id) video_id = render_agent_gt_id;
          set_video(video_path[video_id]);
        } else { // Hide agent video
          if (video_id == render_agent_id) video_id = render_id;
          if (video_id == render_agent_gt_id) video_id = render_gt_id;
          set_video(video_path[video_id]);
        }
    }

    // Set the video to the given path
    function set_video(path) {
        // Get video data to make the switch seamless
        var current_time = video_player.currentTime;
        var play_back_rate = video_player.playbackRate;
        var is_paused = video_player.paused;
        video_player.querySelector("source").src = path;
        // Reload video
        video_player.load();
        video_player.currentTime = current_time;
        video_player.playbackRate = play_back_rate;
        if(is_paused) pause();
        else play();
    }


      /**
      * Update time selector and plots when video is playing
      */
      function timeListener() {
        if(!video_player.paused) {
          update();
        } 
      }

      /**
      * Toggles button and video between playing and paused
      */
      function play_pause() {
        if(video_player.paused)
          play();
        else 
          pause();
      }

      /**
       * Returns to the previous frame step
       */
       function return_to_step() {
        video_player.currentTime = past_steps.pop();
        pause();
        update();
        gotostep_text.value = step;
        return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Updates the plots and time selector
       */
       function go_to_step(event) {
        if (event.keyCode === 13) {
          past_steps.push(step);
          video_player.currentTime = Number(gotostep_text.value);
          pause();
          update();
          gotostep_text.value = step;
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
        }
      }

      function set_video_speed(event) {
        if (event.keyCode === 13) {
          video_player.playbackRate = Number(video_speed.value);
        }
      }

      /**
       * Updates the plots and time selector
       */
       function top_scores() {
        if (event.keyCode === 13) update()
      }

      /**
      * Pauses video
      */
      function pause() {
          play_pause_button.innerHTML = "Play";
          video_player.pause();
      }

      /**
      * Plays the video
      */
      function play() {
          play_pause_button.innerHTML = "Pause";
          video_player.play();
      }

      /**
      * Resets the video and plots to the start
      */
      function reset() {
          video_player.currentTime = 0;
          past_steps.push(step);
          pause();
          update();
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the previous frame
      */
      function back() {
          video_player.currentTime = video_player.currentTime - tS_step_size
          pause();
          update();
          past_steps.push(step + 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
      * Goes to the next frame
      */
      function next() {
          video_player.currentTime = video_player.currentTime + tS_step_size;
          pause();
          update();
          past_steps.push(step - 1);
          return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
      }

      /**
       * Switches between general and transformer statistics
       */
       function statistic() {
        if (stats_button.innerHTML == "General") {
          statistic_type = "general";
          stats_button.innerHTML = "Transformer";
        }
        else if (stats_button.innerHTML == "Attention Scores") {
          statistic_type = "transformer";
          stats_button.innerHTML = "General";
        }
        update();
      }
      /**
      * Opens the video in fullscreen
      */
      function open_fullscreen(vid_elem) {
          if (vid_elem.requestFullscreen) {
              vid_elem.requestFullscreen();
          } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
              vid_elem.webkitRequestFullscreen();
          } else if (vid_elem.msRequestFullscreen) { /* IE11 */
              vid_elem.msRequestFullscreen();
          }
          vid_elem.pause();
      }

      // Selects the action space for the entropy plot
      function set_action_space(spaces){
        if (spaces == 'all')
          entr_selected_action_space = null;
        else
          entr_selected_action_space = Number(spaces);
        update();
      }

      function marker(marker_id){
        if(marker_id == "entropy")
          entropy_marker = !entropy_marker;
        else if(marker_id == "value")
          value_marker = !value_marker;
        update();
      }

      /**
      * Updates the plots and time selector
      */
      function update()  {
        if(video_player.currentTime == Math.round(video_player.currentTime)) // If time t of video is a natural number then step is t - 1
              video_player.currentTime += 0.0001 // Add a small number to make sure that the step and the current time are the same
        if(video_player.currentTime > video_length) {
           video_player.currentTime = video_length;
           pause();
        } // Video can't go past the end
        time_selector.value = video_player.currentTime; // Update time selector
        step = Math.floor(video_player.currentTime); // Get step of video for plots

        // Update plots
        if (statistic_type == "general")
          render_general_statistics();
        else if (statistic_type == "transformer")
          render_transformer_statistics();

        if(statistic_type == "general") {
          // Reset plot id
          statistic_plot_id = 0;
          // Update action plot
          if(is_discrete) { // If action_space is discrete
            set_bar_action_plot(y_action[step][0], action[step][0], action_names);
          }
          else { // If action_space is multi discrete
              set_stacked_bar_action_plot(y_action[step], action[step], action_names);
          }
        }
      }

      /**
      * Renders the general statistics
      */
      function render_general_statistics() {
        // Disables the transformer statistics and enables the general statistics
          document.getElementById('transformer').style.display = 'none';
          document.getElementById('top_n_scores').style.display = 'none';
          document.querySelector('label[for="top_n_scores"]').style.display = 'none';
          document.getElementById('value_func').style.display = 'block';
          document.getElementById('entropy_func').style.display = 'block';
          document.getElementById('options').style.display = 'block';
        // Updates the plots
          set_scatter_line_plot('value_func', "Value Function", y_values_plot, step, value_marker);
          if(is_discrete) { // If action_space is discrete
              set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
          else { // If action_space is multi discrete
              set_scatter_lines_plot('entropy_func', "Entropy Function", y_entropy_plot, step, entropy_marker);
          }
        }
      
      /*
      * Renders the transformer statistics
      */
      function render_transformer_statistics() {
        // Disables the general statistics and enables the transformer statistics
        document.getElementById('transformer').style.display = 'block';
        document.getElementById('top_n_scores').style.display = 'block';
        document.querySelector('label[for="top_n_scores"]').style.display = 'block';
        document.getElementById('value_func').style.display = 'none';
        document.getElementById('entropy_func').style.display = 'none';
        document.getElementById('options').style.display = 'none';
        // Updates the plots
        var top_n = Number(top_n_scores.value);
        if (top_n == -1) top_n = step + 1;
        visualizeAttentionScores(y_attention_weights[step], top_n);
          // Set action plot if statistic_plot_id is 0
          if(statistic_plot_id == 0){
            // Update action plot
            if(is_discrete) { // If action_space is discrete
              set_bar_action_plot(y_action[step][0], action[step][0], action_names);
            }
            else { // If action_space is multi discrete
                set_stacked_bar_action_plot(y_action[step], action[step], action_names);
            }
          }
          // Set value plot if statistic_plot_id is 1
          if (statistic_plot_id == 1) {
            set_scatter_line_plot('action_distr', "Value Function", y_values_plot, step, value_marker);
          }

        // Set entropy plot if statistic_plot_id is 2
        if (statistic_plot_id == 2) {
            if(is_discrete) { // If action_space is discrete
                set_scatter_line_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
            }
            else { // If action_space is multi discrete
                set_scatter_lines_plot('action_distr', "Entropy Function", y_entropy_plot, step, entropy_marker);
            }
        }
        }


      /**
       * Renders attention scores
      */
      async function visualizeAttentionScores(attentionScores, n_values) {
        const numHeads = attentionScores.length;
        
        let data = [];
        let layout = {
          grid: {
              rows: numHeads, 
              columns: 1, 
              pattern: 'independent',
              subplots: [...Array(numHeads).keys()].map(i => `xy${i + 1}`),
              ygap: 0.4 // adjust this value according to your preference
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          margin: {
              t: 0,  // reduce top margin
          },
      }

        // Flatten the array to find the max value across all arrays
        let flatScores = attentionScores.flat();
        let maxScore = Math.max(...flatScores);

        // Iterate through each attention head
        for (let headIdx = 0; headIdx < numHeads; headIdx++) {
            // Get attention scores for the current head
            let headScores = attentionScores[headIdx];
            
            // This array will keep up to the 10 highest scores
            let topScores = [];

            for (let i = 0; i < headScores.length; i++) {
                // Insert current score into the top scores array
                topScores.push({score: headScores[i], index: i});
                
                // Sort the top scores array
                topScores.sort((a, b) => b.score - a.score);

                // If there are more than 10 scores, remove the smallest
                if (topScores.length > n_values) {
                    topScores.pop();
                }
            }

            // Sort the topScores array by index
            topScores.sort((a, b) => a.index - b.index);

            // Now topScores contains the top 10 scores sorted by their indices.
            // You can extract the scores and their indices into separate arrays:
            let filteredHeadScores = topScores.map(x => x.score);
            let filteredTicks = topScores.map(x => x.index);


            const sequenceLength = filteredHeadScores.length;

            layout.height = 400;
            layout.width = window.innerWidth - 50;

            const headScoresPlot = {
                z: [filteredHeadScores],
                type: 'heatmap',
                showscale: true,  
                colorscale: 'Hot',
                zmin: 0,
                zmax: maxScore,
                xaxis: `x${headIdx + 1}`,
                yaxis: `y${headIdx + 1}`,
            };

            data.push(headScoresPlot);

            layout[`xaxis${headIdx + 1}`] = {
                tickmode: 'array',
                tickvals: Array.from({length: sequenceLength}, (_, i) => i),
                ticktext: filteredTicks
            };

            layout[`yaxis${headIdx + 1}`] = {
                title: `Block ${headIdx + 1}`,
                ticks: 'outside',
                tick0: 0,
                dtick: 1,
                ticklen: 8,
                tickwidth: 4,
                tickcolor: '#000'
            };
        }

        const config = {responsive: true};

        Plotly.newPlot('transformer', data, layout, config).then(function() {
          var myPlot = document.getElementById('transformer');
          myPlot.on('plotly_click', function(data){
            // Jump to the step that was clicked
              past_steps.push(step);
              video_player.currentTime = Number(data.points[0].xaxis.ticktext[data.points[0].x]);
              pause();
              update();
              return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      });
    }

      /** 
      * Sets a stacked bar plot for the multi discrete action distribution
      * @param {array} y_values - The action distribution
      * @param {array} action - The action
      * @param {array} action_names - The names of the actions
      */
      function set_stacked_bar_action_plot(y_values, action, action_names) {
        var bar_plot_data_action = [];
        // Set data for each action
        for(var j = 0; j < action_names[0].length; j++) {
            var color = ""
            for(var i = 0; i < action_names.length; i++) {
                if(action[i] == j) // If action sampled in the current frame
                    color = '#FF0000'; // Color it red
                else
                    color = '#FAEBD7'; // Color it white
                var trace = {
                    x: [["action_space_", String(i)].join("")],
                    y: [y_values[i][j]],
                    text: [y_values[i][j], action_names[i][j]].map(String).join("<br>"), // Add action name and prob to the bar
                    marker: {
                        color: color,
                        line: {
                            color: '#000000',
                            width: 1
                          }
                    },
                    type: 'bar'
                };
                bar_plot_data_action.push(trace);
            }
        }

        // Set layout for the plot
        var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            barmode: 'stack',
            showlegend: false
      };

      // Plot the data
      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }

      /**
      * Sets a bar plot for the discrete action distribution
      */
      function set_bar_action_plot(y_values, action, action_names) {

          var color_value = new Array(y_values.length).fill('#FAEBD7'); // Set color for all actions to white
          color_value[action] = '#FF0000'; // Except the selected action should be red
          // Set data for the plot
          var bar_plot_data_action = [
              {
                  x: action_names,
                  y: y_values,
                  type: 'bar',
                  marker: {
                      color: color_value
                  },
                  textposition: 'auto',
                  text: y_values.map(String), // Add prob to the bar plot
                  textfont: {
                      family: 'Montserrat',
                      size: 12,
                  },
                  textangle: 0,
                  textposition: 'bottom center',
              }
          ];

          // Set layout for the plot
          var bar_plot_layout_action = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 28,
                r: 0,
                b: 30,
                t: 22,
                pad: 4
              },
            yaxis: {
              automargin: true,
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: 'Action Distribution',
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            }
      };
          
          // Plot the action distribution
          Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
      }


      /**
      * Sets a scatter plot for the emtropy function if multi discrete actions are used
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The entropy function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_lines_plot(id, title, y_values, step, marker) {
        line_scatter_plot_data_value = [];

        // Set colors and data for the plot
        var colors = ['#FAEBD780', '#7CFC0080', '#FFBF0080', '#FF7F5080', '#DE316380', '#9FE2BF80', '#40E0D080', '#6495ED80', '#CCCCFF80']
        for(var i = 0; i < y_values.length; i++) {
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values[i].slice(0, step + 1);
            var trace = [
            {
                x: x_values_marker,
                y: y_values_marker,
                mode: 'line',
                line: {
                    color: colors[i]
                },
                name: 'action_space_' + String(i),
                showlegend: true,
            },
            {
                x: x_values,
                y: y_values[i],
                mode: 'markers',
                name: 'action_space_' + String(i) + "_marker",
                marker: {
                    color: colors[i]
                },
                showlegend: true,
            }
        ];
            // Add data to the plot
            line_scatter_plot_data_value.push(trace[0]);
            if(marker)
              line_scatter_plot_data_value.push(trace[1]); 
        }

        // Select the selected action_space for the entropy plot
        if(entr_selected_action_space != null && marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space * 2], line_scatter_plot_data_value[entr_selected_action_space * 2 + 1]];
        else if(entr_selected_action_space != null && !marker)
          line_scatter_plot_data_value = [line_scatter_plot_data_value[entr_selected_action_space]];

        // Set layout for the plot
        var line__scatter_plot_layout_value = {
            autosize: true,
            width: 600,
            height: 360,
            margin: {
                l: 50,
                r: 0,
                b: 30,
                t: 25,
                pad: 4
                },
            yaxis: {
                automargin: true
            },
            plot_bgcolor: '#000',
            paper_bgcolor: '#000',
            font: {
                family: 'Montserrat',
                size: 12,
                color: '#fff'
            },
            title: {
                text: title,
                font: {
                    family: 'Montserrat',
                    size: 15,
                    color: '#fff'
                }
            },
            showlegend: true,
        };

        // Plot the data
        Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
        // Add event handler for clicking on a marker
        document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }


      /**
      * Sets a scatter plot for the value function
      * @param {string} id - The id of the plot
      * @param {string} title - The title of the plot
      * @param {array} y_values - The value function y values
      * @param {int} step - The step of the video
      * @param {boolean} marker - If the marker should be shown
      */
      function set_scatter_line_plot(id, title, y_values, step, marker) {
          // Set data for layout for the plot
          var line__scatter_plot_layout_value = {
              autosize: true,
              width: 600,
              height: 360,
              margin: {
                  l: 50,
                  r: 0,
                  b: 30,
                  t: 25,
                  pad: 4
                  },
              yaxis: {
                  automargin: true
              },
              plot_bgcolor: '#000',
              paper_bgcolor: '#000',
              font: {
                  family: 'Montserrat',
                  size: 12,
                  color: '#fff'
              },
              title: {
                  text: title,
                  font: {
                      family: 'Montserrat',
                      size: 15,
                      color: '#fff'
                  }
              },
              showlegend: false,
          };

          // Set data for the plot
          var x_values_marker = x_values.slice(0, step + 1);
          var y_values_marker = y_values.slice(0, step + 1);

          var line_scatter_plot_data_value = [
              {
                  x: x_values_marker,
                  y: y_values_marker,
                  mode: 'line',
                  line: {
                      color: '#FAEBD7'
                  },
                  name: 'function',
              },
              {
                  x: x_values,
                  y: y_values,
                  mode: 'markers',
                  marker: {
                      color: '#7CFC0080'
                  },
                  name: 'marker',
              }
          ];

          if(!marker)
            line_scatter_plot_data_value = [line_scatter_plot_data_value[0]];

          // Plot the value function
          Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);

          // Add event handler for clicking on a marker
          document.getElementById(id).on('plotly_click', function(data){
            past_steps.push(step);
            video_player.currentTime = Number(data.points[0].x);
            pause();
            update();
            return_button.innerHTML = "Return to step " + past_steps[past_steps.length - 1]; 
          });
      }
    
    /**
    * Opens the specific tab based on the probided id
    * @param {string} id - The id of the tab
    */
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        // Hide all elements with class="tabcontent" and "mediacontent" by default
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Show the specific tab content
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>